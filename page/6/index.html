<!DOCTYPE HTML>
<html>
<head>
	<meta name="generator" content="Hugo 0.51" />
	<meta charset="utf-8">
    
    
    <title>凝雨 - Yun</title>
    <meta name="author" content="凝雨-Yun">
    <meta name="description" content="">
    <meta name="keywords" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link href="https://ningyu1.github.io/site/index.xml" rel="alternate" title="凝雨 - Yun" type="application/atom+xml">
    <link href="https://ningyu1.github.io/site/images/fav.ico" rel="shortcut icon">
    <style>
    @charset "UTF-8";
@font-face {
  font-family: 'FontAwesome';
  src: url("https://ningyu1.github.io/site/font/fontawesome-webfont.eot");
  src: url("https://ningyu1.github.io/site/font/fontawesome-webfont.eot?#iefix") format("embedded-opentype"),
  url("https://ningyu1.github.io/site/font/fontawesome-webfont.woff") format("woff"),
  url("https://ningyu1.github.io/site/font/fontawesome-webfont.ttf") format("truetype"),
  url("https://ningyu1.github.io/site/font/fontawesome-webfont.svgz#FontAwesomeRegular") format("svg"),
  url("https://ningyu1.github.io/site/font/fontawesome-webfont.svg#FontAwesomeRegular") format("svg");
  font-weight: normal;
  font-style: normal; }

@font-face{
    font-family: 'MyHermit';
    src: url('https://ningyu1.github.io/site/font/hermit-medium-webfont.eot');
    src: url('https://ningyu1.github.io/site/font/hermit-medium-webfont.eot?#iefix') format('embedded-opentype'),
         url('https://ningyu1.github.io/site/font/hermit-medium-webfont.woff') format('woff'),
         url('https://ningyu1.github.io/site/font/hermit-medium-webfont.ttf') format('truetype');
}

* {
  margin: 0;
  padding: 0; }

body {
  font-family: 'PingFang SC', serif;
  font-weight: 300;
  font-size: 16px;
  /*background: url("https://ningyu1.github.io/site/images/retina_dust.png");*/
  color: #444;
  colori: #666666; }
  @media screen and (max-width: 1040px) {
    body {
      margin: 0 20px; } }
  @media screen and (max-width: 600px) {
    body {
      font-size: 13px; } }

.bBackground {
  position: fixed;
  height: 100%;
  width: 100%;
  background: -moz-radial-gradient(50% 50%, farthest-side, white, #efefef);
  background: -webkit-gradient(radial, 50% 50%, 250, 50% 50%, 750, from(white), to(#bbbbbb));
  z-index: -100; }

h1 {
  font-size: 1.8em; }

h2 {
  font-family: 'Fjalla One', sans-serif;
  font-size: 1.5em; }

h3 {
  font-size: 1.3em; }

a {
  text-decoration: none;
  outline-width: 0;
  color: #258fb8; }

.alignleft {
  float: left; }

.alignright {
  float: right; }

.clearfix {
  *zoom: 1; }
  .clearfix:after {
    content: "";
    display: table;
    clear: both; }

.inner {
  width: 900px;
  margin: 0 auto; }
  @media screen and (max-width: 1040px) {
    .inner {
      width: 100%; } }

#w2btoTop {
  display: none;
  text-decoration: none;
  position: fixed;
  bottom: 10px;
  right: 10px;
  overflow: hidden;
  width: 51px;
  height: 51px;
  border: none;
  text-indent: -999px;
  background: url(https://ningyu1.github.io/site/images/totop.png) no-repeat left top; }

#w2btoTopHover {
  background: url(https://ningyu1.github.io/site/images/totop.png) no-repeat left -51px;
  width: 51px;
  height: 51px;
  display: block;
  overflow: hidden;
  float: left;
  opacity: 0;
  -moz-opacity: 0;
  filter: alpha(opacity=0); }

#w2btoTop:active, #w2btoTop:focus {
  outline: none; }

.basic-alignment.left, article .entry-content img.left, article .entry-content video.left {
  float: left;
  margin-right: 1.5em; }
.basic-alignment.right, article .entry-content img.right, article .entry-content video.right {
  float: right;
  margin-left: 1.5em; }
.basic-alignment.center, article .entry-content img.center, article .entry-content video.center {
  display: block;
  margin: 0 auto 1.5em; }
.basic-alignment.left, article .entry-content img.left, article .entry-content video.left, .basic-alignment.right, article .entry-content img.right, article .entry-content video.right {
  margin-bottom: .8em; }

/* changes tooltip, to use, make elements 'class' as 'tooltip' and 'title' would be shown in tooltip */
.tooltip {
  display: inline;
  position: relative; }

.tooltip:hover {
  text-decoration: none; }

.tooltip:hover:after {
  background: #111;
  background: rgba(0, 0, 0, 0.8);
  border-radius: 5px;
  bottom: 18px;
  color: #fff;
  content: attr(title);
  display: block;
  left: 50%;
  padding: 5px 15px;
  position: absolute;
  white-space: nowrap;
  z-index: 98; }

.tooltip:hover:before {
  border: solid;
  border-color: #111 transparent;
  border-width: 6px 6px 0 6px;
  bottom: 12px;
  content: "";
  display: block;
  left: 75%;
  position: absolute;
  z-index: 99; }

.pullquote-right:before,
.pullquote-left:before {
  /* Reset metrics. */
  padding: 0;
  border: none;
  /* Content */
  content: attr(data-pullquote);
  /* Pull out to the right, modular scale based margins. */
  float: right;
  width: 45%;
  margin: .5em 0 1em 1.5em;
  /* Baseline correction */
  position: relative;
  top: 7px;
  font-size: 1.4em;
  line-height: 1.45em; }

.pullquote-left:before {
  /* Make left pullquotes align properly. */
  float: left;
  margin: .5em 1.5em 1em 0; }

#header {
  padding: 20px 0 20px 0; }
  @media screen and (max-width: 1040px) {
    #header {
      height: auto;
      position: relative;
      padding-bottom: 10px; } }
  #header a {
    color: #666666;
    -webkit-transition: compact(compact(color 0.3s, false, false, false, false, false, false, false, false, false) false false);
    -moz-transition: compact(compact(color 0.3s, false, false, false, false, false, false, false, false, false) false false false);
    -o-transition: compact(compact(color 0.3s, false, false, false, false, false, false, false, false, false) false false false);
    transition: compact(color 0.3s, false, false, false, false, false, false, false, false, false); }
    #header a:hover {
      color: #258fb8; }
  #header h1 {
    font-family: 'Slackey', cursive;
    font-weight: 300;
    font-size: 52px; }
    @media screen and (max-width: 1040px) {
      #header h1 {
        float: none; } }

#headerbg {
  text-align: center;
  background: #444;
  padding: 10px 10px;
  display: table;
  color: #fff;
  margin: 0 auto;
  border-radius: 5px;
  font-weight: bold;
  -webkit-mask-image: -webkit-linear-gradient(black, rgba(0, 0, 0, 0.9));
  -webkit-backface-visibility: hidden;
  -moz-backface-visibility: hidden;
  -ms-backface-visibility: hidden;
  -o-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-animation-duration: 1s;
  -webkit-animation-delay: .2s;
  -webkit-animation-timing-function: ease;
  -webkit-animation-fill-mode: both;
  -moz-animation-duration: 1s;
  -moz-animation-delay: .2s;
  -moz-animation-timing-function: ease;
  -moz-animation-fill-mode: both;
  -ms-animation-duration: 1s;
  -ms-animation-delay: .2s;
  -ms-animation-timing-function: ease;
  -ms-animation-fill-mode: both;
  -o-animation-duration: 1s;
  -o-animation-delay: .2s;
  -o-animation-timing-function: ease;
  -o-animation-fill-mode: both;
  animation-duration: 1s;
  animation-delay: .2s;
  animation-timing-function: ease;
  animation-fill-mode: both; }

#load {
  display: none;
  position: absolute;
  right: 50%;
  top: 50%;
  background: url("https://ningyu1.github.io/site/images/loading.gif");
  width: 50px;
  height: 50px;
  text-indent: -9999em; }

#social-links li {
  display: inline-block;
  width: 35px;
  height: 35px;
  border-radius: 35px;
  margin-top: 20px;
  margin-right: 9px;
  background-color: #ddd;
  text-align: center;
  line-height: 35px;
  -webkit-transition: compact(compact(background-color 1s ease-in-out, false, false, false, false, false, false, false, false, false) false false);
  -moz-transition: compact(compact(background-color 1s ease-in-out, false, false, false, false, false, false, false, false, false) false false false);
  -o-transition: compact(compact(background-color 1s ease-in-out, false, false, false, false, false, false, false, false, false) false false false);
  transition: compact(background-color 1s ease-in-out, false, false, false, false, false, false, false, false, false); }
  #social-links li:hover {
    background-color: #555; }
#social-links a {
  display: inline-block;
  position: relative;
  width: 100%;
  height: 100%; }
  #social-links a svg {
    position: absolute; }
  #social-links a .github {
    top: 3px;
    left: 2px; }
  #social-links a .sina-weibo {
    top: 8px;
    left: 6px; }
  #social-links a .tencent-weibo {
    top: 6px;
    left: 4px; }
  #social-links a .twitter {
    top: 2px;
    left: 3px; }

a.facebook {
  background: url("https://ningyu1.github.io/site/images/social/Facebook.png") center no-repeat; }

a.facebook:hover {
  background: url("https://ningyu1.github.io/site/images/social/FacebookH.png") center no-repeat; }

a.github {
  background: url("https://ningyu1.github.io/site/images/social/Github.png") center no-repeat; }

a.github:hover {
  background: url("https://ningyu1.github.io/site/images/social/GithubH.png") center no-repeat; }

a.gitee {
  background: url("https://ningyu1.github.io/site/images/social/Gitee.png") center no-repeat; }

a.gitee:hover {
  background: url("https://ningyu1.github.io/site/images/social/GiteeH.png") center no-repeat; }

a.gitlab {
  background: url("https://ningyu1.github.io/site/images/social/Gitlab.png") center no-repeat; }

a.gitlab:hover {
  background: url("https://ningyu1.github.io/site/images/social/GitlabH.png") center no-repeat; }

a.email {
  background: url("https://ningyu1.github.io/site/images/social/Email.png") center no-repeat; }

a.email:hover {
  background: url("https://ningyu1.github.io/site/images/social/EmailH.png") center no-repeat; }

a.rss {
  background: url("https://ningyu1.github.io/site/images/social/Rss.png") center no-repeat; }

a.rss:hover {
  background: url("https://ningyu1.github.io/site/images/social/RssH.png") center no-repeat; }

a.twitter {
  background: url("https://ningyu1.github.io/site/images/social/Twitter.png") center no-repeat; }

a.twitter:hover {
  background: url("https://ningyu1.github.io/site/images/social/TwitterH.png") center no-repeat; }

a.google {
  background: url("https://ningyu1.github.io/site/images/social/Picasa.png") center no-repeat; }

a.google:hover {
  background: url("https://ningyu1.github.io/site/images/social/PicasaH.png") center no-repeat; }

a.skype {
  background: url("https://ningyu1.github.io/site/images/social/Skype.png") center no-repeat; }

a.skype:hover {
  background: url("https://ningyu1.github.io/site/images/social/SkypeH.png") center no-repeat; }

a.linkedin {
  background: url("https://ningyu1.github.io/site/images/social/LinkedIn.png") center no-repeat; }

a.linkedin:hover {
  background: url("https://ningyu1.github.io/site/images/social/LinkedInH.png") center no-repeat; }

a.youtube {
  background: url("https://ningyu1.github.io/site/images/social/Youtube.png") center no-repeat; }

a.youtube:hover {
  background: url("https://ningyu1.github.io/site/images/social/YoutubeH.png") center no-repeat; }

a.lastfm {
  background: url("https://ningyu1.github.io/site/images/social/LastFM.png") center no-repeat; }

a.lastfm:hover {
  background: url("https://ningyu1.github.io/site/images/social/LastFMH.png") center no-repeat; }

/* search bar */
#search {
  display: inline; }

#search input[type="text"] {
  background: url("https://ningyu1.github.io/site/images/search-dark.png") no-repeat 10px 6px #444444;
  border: 0 none;
  font: bold 12px Arial,Helvetica,Sans-serif;
  color: #777;
  width: 110px;
  padding: 6px 15px 6px 35px;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  border-radius: 20px;
  text-shadow: 0 2px 2px rgba(0, 0, 0, 0.3);
  -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  -webkit-transition: all 0.7s ease 0s;
  -moz-transition: all 0.7s ease 0s;
  -o-transition: all 0.7s ease 0s;
  transition: all 0.7s ease 0s; }

#search input[type="text"]:focus {
  width: 160px; }

#dark {
  display: inline-block;
  height: 70px; }

#dark #search input[type="text"] {
  background: url("https://ningyu1.github.io/site/images/search-dark.png") no-repeat 10px 6px #444444;
  border: 0 none;
  font: bold 12px Arial,Helvetica,Sans-serif;
  color: #ddd;
  width: 110px;
  padding: 6px 15px 6px 35px;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  border-radius: 20px;
  text-shadow: 0 2px 2px rgba(0, 0, 0, 0.3);
  -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  -webkit-transition: all 0.4s ease 0s;
  -moz-transition: all 0.4s ease 0s;
  -o-transition: all 0.4s ease 0s;
  transition: all 0.4s ease 0s; }

#dark #search input[type="text"]:focus {
  width: 160px;
  outline: 0; }

/* nav */
#nav {
  text-align: center;
  position: relative;
  margin: 10px auto; }

ul#nav *{
	box-sizing:content-box
}

ul#nav li {
  display: inline-block; }

ul#nav li {
  list-style-type: none;
  background-repeat: no-repeat;
  overflow: hidden;
  margin-right: 1px; }

ul#nav li a {
  display: inline-block;
  width: 110px;
  height: 40px;
  text-align: center;
  padding-top: 20px;
  padding-bottom: 20px;
  color: #222;
  font-weight: normal;
  text-decoration: none;
  font-family: "Lucida Grande", Arial, Helvetica, sans-serif;
  text-transform: uppercase;
  font-size: 16px;
  font-style: normal;
  text-shadow: 1px 1px 10px #222;
  overflow: hidden; }

ul#nav li a:hover {
  color: #fff;
  font-style: normal;
  font-weight: normal;
  background-image: url("https://ningyu1.github.io/site/images/hover.png");
  background-repeat: no-repeat;
  background-position: center top; }

ul#nav li a:active {
  position: relative;
  top: 2px; }

ul#nav li#active a {
  color: #FFF;
  background-image: url("https://ningyu1.github.io/site/images/active.png");
  background-repeat: no-repeat;
  background-position: center top; }

#pagenavi {
  padding: 20px 0;
  height: 20px;
  line-height: 20px;
  position: relative;
  border-top: 1px solid white;
  border-bottom: 1px solid #dddddd; }
  #pagenavi a:hover {
    text-decoration: underline; }
  #pagenavi .prev, #pagenavi .next {
    position: absolute; }
  #pagenavi .prev {
    padding-left: 30px;
    left: 0; }
    #pagenavi .prev:before {
      content: "\f060";
      font: 1.3em FontAwesome;
      position: absolute;
      left: 0; }
  #pagenavi .next {
    padding-right: 30px;
    right: 0; }
    #pagenavi .next:before {
      content: "\f061";
      font: 1.3em FontAwesome;
      position: absolute;
      right: 0; }
  #pagenavi .center {
    text-align: center;
    width: 100%;
    display: block; }
    @media screen and (max-width: 400px) {
      #pagenavi .center {
        display: none; } }

article {
  border-bottom: 1px solid #dddddd;
  padding: 30px 0;
  position: relative; }
  @media screen and (max-width: 800px) {
    article {
      padding-bottom: 15px; } }
  @media screen and (max-width: 600px) {
    article {
      padding: 15px 0; } }
  article h2.title {
    font-family: 'Fjalla One', sans-serif;
    font-size: 2em;
    font-weight: 300;
    line-height: 35px;
    margin-bottom: 20px; }
    article h2.title a {
      color: #1094e8; }
  article .title a {
    color: #7c7873;
    -webkit-transition: all 1s ease-in-out;
    -moz-transition: all 1s ease-in-out;
    -o-transition: all 1s ease-in-out;
    transition: all 1s ease-in-out; }
  article .title a:hover {
    color: #084B8A;
    text-shadow: 3px 3px 12px #888;
    -webkit-transform: scale(1.3);
    -moz-transform: scale(1.3); }
  article .entry-content {
    line-height: 2;
    text-align: justify; }
    article .entry-content a:hover {
      text-decoration: underline; }
    article .entry-content .more-link {
      display: block;
      margin-top: 16px;
      padding-left: 30px;
      position: relative; }
      article .entry-content .more-link:before {
        content: "\f061";
        font: 1.3em FontAwesome;
        line-height: 1.6em;
        position: absolute;
        left: 0; }
    article .entry-content p, article .entry-content blockquote, article .entry-content ul, article .entry-content ol, article .entry-content dl, article .entry-content iframe, article .entry-content h1, article .entry-content h2, article .entry-content h3, article .entry-content h4, article .entry-content h5, article .entry-content h6, article .entry-content .video-container {
      margin-top: 10px; }
    article .entry-content ul, article .entry-content ol, article .entry-content dl {
      margin-left: 20px; }
      article .entry-content ul ul, article .entry-content ul ol, article .entry-content ul dl, article .entry-content ol ul, article .entry-content ol ol, article .entry-content ol dl, article .entry-content dl ul, article .entry-content dl ol, article .entry-content dl dl {
        margin-top: 0; }
    article .entry-content strong {
      font-weight: bold; }
    article .entry-content em {
      font-style: italic; }
    article .entry-content p {
      margin-top: 10px; }
    article .entry-content h2 {
      font-weight: 300;
      border-bottom: 1px solid #dddddd;
      position: relative; }
      article .entry-content h2:before {
        content: "";
        position: absolute;
        bottom: -2px;
        border-bottom: 1px solid white;
        width: 100%; }
    article .entry-content img, article .entry-content video {
      margin: 10px 0;
      max-width: 100%;
      height: auto;
      -moz-border-radius: 0.3em;
      -webkit-border-radius: 0.3em;
      -o-border-radius: 0.3em;
      -ms-border-radius: 0.3em;
      -khtml-border-radius: 0.3em;
      border-radius: 0.3em;
      -moz-box-shadow: rgba(0, 0, 0, 0.75) 0 1px 4px;
      -webkit-box-shadow: rgba(0, 0, 0, 0.75) 0 1px 4px;
      -o-box-shadow: rgba(0, 0, 0, 0.75) 0 1px 4px;
      box-shadow: rgba(0, 0, 0, 0.75) 0 1px 4px;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
      -ms-box-sizing: border-box;
      box-sizing: border-box;
      border: #fff 0.3em solid; }
    article .entry-content img.noborder, article .entry-content video.noborder {
      border: none;
      box-shadow: none; }
    article .entry-content blockquote {
      background: #dddddd;
      border-left: 5px solid #cccccc;
      padding: 15px 20px;
      margin-top: 10px; }
      article .entry-content blockquote > p:first-of-type {
        margin-top: 0; }
    article .entry-content iframe {
      border: none; }
    article .entry-content .caption {
      display: block;
      font-size: 0.9em;
      color: #999999;
      padding-left: 25px;
      position: relative; }
      article .entry-content .caption:before {
        content: "\f040";
        color: #cccccc;
        font: 1.3em FontAwesome;
        line-height: 1.6em;
        position: absolute;
        left: 0; }
    article .entry-content .video-container {
      position: relative;
      padding-bottom: 56.25%;
      padding-top: 30px;
      height: 0;
      overflow: hidden; }
      article .entry-content .video-container iframe, article .entry-content .video-container object, article .entry-content .video-container embed {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        margin-top: 0; }

.share {
  padding: 15px 0;
  border-top: 1px solid white;
  border-bottom: 1px solid #dddddd; }

@media screen and (max-width: 800px) {
  .post h2.title, .post .entry-content {
    margin-left: 0; } }
.post .meta {
  line-height: 2;
  color: #999999;
  width: 370px; }
  @media screen and (max-width: 800px) {
    .post .meta {
      margin-top: 15px;
      position: static;
      width: auto; } }
  .post .meta a {
    color: #999999;
    -webkit-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false);
    -moz-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
    -o-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
    transition: compact(0.3s, false, false, false, false, false, false, false, false, false); }
    .post .meta a:hover {
      color: #666666; }
  .post .meta .date, .post .meta .tags, .post .meta .comments {
    padding-left: 30px;
    position: relative; }
    .post .meta .date:before, .post .meta .tags:before, .post .meta .comments:before {
      color: #cccccc;
      font: 1.3em FontAwesome;
      line-height: 1.6em;
      position: absolute;
      left: 0; }
    @media screen and (max-width: 800px) {
      .post .meta .date, .post .meta .tags, .post .meta .comments {
        display: -moz-inline-stack;
        display: inline-block;
        vertical-align: middle;
        *vertical-align: auto;
        zoom: 1;
        *display: inline;
        margin-right: 30px; } }
  .post .meta .date:before {
    content: "\f073"; }
  .post .meta .tags:before {
    content: "\f02c"; }
  .post .meta .comments:before {
    content: "\f075"; }

.archives {
  position: relative; }
  .archives:last-of-type:before {
    content: "";
    position: absolute;
    bottom: 0;
    width: 200px;
    border-top: 1px solid #dddddd; }
  .archives .top-border-padding {
    border-top: 1px solid #fff; }
    .archives .top-border-padding:before {
      content: "";
      position: absolute;
      top: -1px;
      width: 100%;
      border-top: 1px solid #dddddd; }
  .archives .year {
    line-height: 35px;
    width: 200px;
    position: absolute;
    top: 0;
    padding-top: 15px;
    border-top: 1px solid #fff; }
    .archives .year:before {
      content: "";
      position: absolute;
      top: -2px;
      width: 100%;
      border-top: 1px solid #dddddd; }
    @media screen and (max-width: 600px) {
      .archives .year {
        position: relative;
        width: 100%; } }
  .archives article {
    margin-left: 200px;
    padding: 10px 0; }
    @media screen and (max-width: 600px) {
      .archives article {
        margin-left: 0; }
        .archives article:first-of-type {
          border-top: none;
          padding-top: 30px; } }
    .archives article .title {
      margin-bottom: 0;
      font-size: 25px; }
    .archives article .meta {
      color: #999999;
      font-size: 0.9em;
      line-height: 2;
      margin-top: 10px; }
      @media screen and (max-width: 600px) {
        .archives article .meta {
          display: none; } }
      .archives article .meta span {
        margin-right: 30px;
        display: -moz-inline-stack;
        display: inline-block;
        vertical-align: middle;
        *vertical-align: auto;
        zoom: 1;
        *display: inline; }
        .archives article .meta span:before {
          color: #cccccc;
          font: 1.3em FontAwesome;
          padding-right: 10px; }
      .archives article .meta a {
        color: #999999;
        -webkit-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false);
        -moz-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
        -o-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
        transition: compact(0.3s, false, false, false, false, false, false, false, false, false); }
        .archives article .meta a:hover {
          color: #666666; }
      .archives article .meta .date:before {
        content: "\f073"; }
      .archives article .meta .tags:before {
        content: "\f02c"; }
      .archives article .meta .comments:before {
        content: "\f075"; }

#comment {
  padding: 30px 0;
  border-top: 1px solid white;
  border-bottom: 1px solid #dddddd; }
  #comment h2.title {
    font-size: 25px;
    font-weight: 300;
    line-height: 35px;
    margin-bottom: 20px; }

footer {
  padding: 20px 0;
  text-align: center;
  font-size: 0.6em;
  color: #666; }

footer a {
  color: #123; }

footer a:hover {
  color: #456; }

#banner {
  color: #999999;
  padding: 30px 0;
  line-height: 30px;
  text-align: center;
  position: relative;
  display: none;
  border-top: 1px solid white;
  border-bottom: 1px solid #dddddd; }
  #banner:hover a {
    color: #258fb8; }
  #banner a {
    color: #999999;
    -webkit-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false);
    -moz-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
    -o-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
    transition: compact(0.3s, false, false, false, false, false, false, false, false, false); }
    #banner a:hover {
      text-decoration: underline; }
  #banner small {
    position: absolute;
    right: 0;
    bottom: 0; }
  #banner .loading {
    background: image-url("loading_pacman.gif") center no-repeat;
    text-indent: -9999px; }
  #banner .container {
    height: 30px;
    overflow: hidden;
    position: relative;
    display: none; }
    #banner .container .feed {
      list-style: none;
      position: absolute;
      top: 0;
      width: 100%; }
      #banner .container .feed li {
        position: relative; }
        #banner .container .feed li small {
          position: absolute;
          right: 0; }

/*! fancyBox v2.0.6 fancyapps.com | fancyapps.com/fancybox/#license */
.fancybox-tmp iframe, .fancybox-tmp object {
  vertical-align: top;
  padding: 0;
  margin: 0; }

.fancybox-wrap {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 8020; }

.fancybox-skin {
  position: relative;
  padding: 0;
  margin: 0;
  background: #f9f9f9;
  color: #444;
  text-shadow: none;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  -ms-border-radius: 4px;
  -o-border-radius: 4px;
  border-radius: 4px; }

.fancybox-opened {
  z-index: 8030; }

.fancybox-opened .fancybox-skin {
  -webkit-box-shadow: compact(0 10px 25px rgba(0, 0, 0, 0.5), false, false, false, false, false, false, false, false, false);
  -moz-box-shadow: compact(0 10px 25px rgba(0, 0, 0, 0.5), false, false, false, false, false, false, false, false, false);
  box-shadow: compact(0 10px 25px rgba(0, 0, 0, 0.5), false, false, false, false, false, false, false, false, false); }

.fancybox-outer, .fancybox-inner {
  padding: 0;
  margin: 0;
  position: relative;
  outline: none; }

.fancybox-inner {
  overflow: hidden; }

.fancybox-type-iframe .fancybox-inner {
  -webkit-overflow-scrolling: touch; }

.fancybox-error {
  color: #444;
  font: 14px/20px "Helvetica Neue",Helvetica,Arial,sans-serif;
  margin: 0;
  padding: 10px; }

.fancybox-image, .fancybox-iframe {
  display: block;
  width: 100%;
  height: 100%;
  border: 0;
  padding: 0;
  margin: 0;
  vertical-align: top; }

.fancybox-image {
  max-width: 100%;
  max-height: 100%; }

#fancybox-loading, .fancybox-close, .fancybox-prev span, .fancybox-next span {
  background-image: image-url("fancybox/fancybox_sprite.png"); }

#fancybox-loading {
  position: fixed;
  top: 50%;
  left: 50%;
  margin-top: -22px;
  margin-left: -22px;
  background-position: 0 -108px;
  opacity: 0.8;
  cursor: pointer;
  z-index: 8020; }

#fancybox-loading div {
  width: 44px;
  height: 44px;
  background: image-url("fancybox/fancybox_loading.gif") center center no-repeat; }

.fancybox-close {
  position: absolute;
  top: -18px;
  right: -18px;
  width: 36px;
  height: 36px;
  cursor: pointer;
  z-index: 8040; }

.fancybox-nav {
  position: absolute;
  top: 0;
  width: 40%;
  height: 100%;
  cursor: pointer;
  background: transparent image-url("fancybox/blank.gif");
  /* helps IE */
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  z-index: 8040; }

.fancybox-prev {
  left: 0; }

.fancybox-next {
  right: 0; }

.fancybox-nav span {
  position: absolute;
  top: 50%;
  width: 36px;
  height: 34px;
  margin-top: -18px;
  cursor: pointer;
  z-index: 8040;
  visibility: hidden; }

.fancybox-prev span {
  left: 20px;
  background-position: 0 -36px; }

.fancybox-next span {
  right: 20px;
  background-position: 0 -72px; }

.fancybox-nav:hover span {
  visibility: visible; }

.fancybox-tmp {
  position: absolute;
  top: -9999px;
  left: -9999px;
  padding: 0;
  overflow: visible;
  visibility: hidden; }

/* Overlay helper */
#fancybox-overlay {
  position: absolute;
  top: 0;
  left: 0;
  overflow: hidden;
  display: none;
  z-index: 8010;
  background: #000; }

#fancybox-overlay.overlay-fixed {
  position: fixed;
  bottom: 0;
  right: 0; }

/* Title helper */
.fancybox-title {
  visibility: hidden;
  font: normal 13px/20px "Helvetica Neue",Helvetica,Arial,sans-serif;
  position: relative;
  text-shadow: none;
  z-index: 8050; }

.fancybox-opened .fancybox-title {
  visibility: visible; }

.fancybox-title-float-wrap {
  position: absolute;
  bottom: 0;
  right: 50%;
  margin-bottom: -35px;
  z-index: 8030;
  text-align: center; }

.fancybox-title-float-wrap .child {
  display: inline-block;
  margin-right: -100%;
  padding: 2px 20px;
  background: transparent;
  /* Fallback for web browsers that doesn't support RGBa */
  background: rgba(0, 0, 0, 0.8);
  text-shadow: 0 1px 2px #222;
  color: #FFF;
  font-weight: bold;
  line-height: 24px;
  white-space: nowrap;
  -webkit-border-radius: 15px;
  -moz-border-radius: 15px;
  -ms-border-radius: 15px;
  -o-border-radius: 15px;
  border-radius: 15px; }

.fancybox-title-outside-wrap {
  position: relative;
  margin-top: 10px;
  color: #fff; }

.fancybox-title-inside-wrap {
  margin-top: 10px; }

.fancybox-title-over-wrap {
  position: absolute;
  bottom: 0;
  left: 0;
  color: #fff;
  padding: 10px;
  background: #000;
  background: rgba(0, 0, 0, 0.8); }

/*
Animate.css - http://daneden.me/animate
Licensed under the ☺ license (http://licence.visualidiot.com/)

Copyright (c) 2012 Dan Eden

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
body {
  /* Addresses a small issue in webkit: http://bit.ly/NEdoDq */
  -webkit-backface-visibility: hidden; }

.animated {
  -webkit-animation-duration: 1s;
  -moz-animation-duration: 1s;
  -o-animation-duration: 1s;
  animation-duration: 1s;
  -webkit-animation-fill-mode: both;
  -moz-animation-fill-mode: both;
  -o-animation-fill-mode: both;
  animation-fill-mode: both; }

.animated.hinge {
  -webkit-animation-duration: 2s;
  -moz-animation-duration: 2s;
  -o-animation-duration: 2s;
  animation-duration: 2s; }

@-webkit-keyframes flash {
  0%, 50%, 100% {
    opacity: 1; }

  25%, 75% {
    opacity: 0; } }

@-moz-keyframes flash {
  0%, 50%, 100% {
    opacity: 1; }

  25%, 75% {
    opacity: 0; } }

@-o-keyframes flash {
  0%, 50%, 100% {
    opacity: 1; }

  25%, 75% {
    opacity: 0; } }

@keyframes flash {
  0%, 50%, 100% {
    opacity: 1; }

  25%, 75% {
    opacity: 0; } }

.flash {
  -webkit-animation-name: flash;
  -moz-animation-name: flash;
  -o-animation-name: flash;
  animation-name: flash; }

@-webkit-keyframes shake {
  0%, 100% {
    -webkit-transform: translateX(0); }

  10%, 30%, 50%, 70%, 90% {
    -webkit-transform: translateX(-10px); }

  20%, 40%, 60%, 80% {
    -webkit-transform: translateX(10px); } }

@-moz-keyframes shake {
  0%, 100% {
    -moz-transform: translateX(0); }

  10%, 30%, 50%, 70%, 90% {
    -moz-transform: translateX(-10px); }

  20%, 40%, 60%, 80% {
    -moz-transform: translateX(10px); } }

@-o-keyframes shake {
  0%, 100% {
    -o-transform: translateX(0); }

  10%, 30%, 50%, 70%, 90% {
    -o-transform: translateX(-10px); }

  20%, 40%, 60%, 80% {
    -o-transform: translateX(10px); } }

@keyframes shake {
  0%, 100% {
    transform: translateX(0); }

  10%, 30%, 50%, 70%, 90% {
    transform: translateX(-10px); }

  20%, 40%, 60%, 80% {
    transform: translateX(10px); } }

.shake {
  -webkit-animation-name: shake;
  -moz-animation-name: shake;
  -o-animation-name: shake;
  animation-name: shake; }

@-webkit-keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    -webkit-transform: translateY(0); }

  40% {
    -webkit-transform: translateY(-30px); }

  60% {
    -webkit-transform: translateY(-15px); } }

@-moz-keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    -moz-transform: translateY(0); }

  40% {
    -moz-transform: translateY(-30px); }

  60% {
    -moz-transform: translateY(-15px); } }

@-o-keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    -o-transform: translateY(0); }

  40% {
    -o-transform: translateY(-30px); }

  60% {
    -o-transform: translateY(-15px); } }

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0); }

  40% {
    transform: translateY(-30px); }

  60% {
    transform: translateY(-15px); } }

.bounce {
  -webkit-animation-name: bounce;
  -moz-animation-name: bounce;
  -o-animation-name: bounce;
  animation-name: bounce; }

@-webkit-keyframes tada {
  0% {
    -webkit-transform: scale(1); }

  10%, 20% {
    -webkit-transform: scale(0.9) rotate(-3deg); }

  30%, 50%, 70%, 90% {
    -webkit-transform: scale(1.1) rotate(3deg); }

  40%, 60%, 80% {
    -webkit-transform: scale(1.1) rotate(-3deg); }

  100% {
    -webkit-transform: scale(1) rotate(0); } }

@-moz-keyframes tada {
  0% {
    -moz-transform: scale(1); }

  10%, 20% {
    -moz-transform: scale(0.9) rotate(-3deg); }

  30%, 50%, 70%, 90% {
    -moz-transform: scale(1.1) rotate(3deg); }

  40%, 60%, 80% {
    -moz-transform: scale(1.1) rotate(-3deg); }

  100% {
    -moz-transform: scale(1) rotate(0); } }

@-o-keyframes tada {
  0% {
    -o-transform: scale(1); }

  10%, 20% {
    -o-transform: scale(0.9) rotate(-3deg); }

  30%, 50%, 70%, 90% {
    -o-transform: scale(1.1) rotate(3deg); }

  40%, 60%, 80% {
    -o-transform: scale(1.1) rotate(-3deg); }

  100% {
    -o-transform: scale(1) rotate(0); } }

@keyframes tada {
  0% {
    transform: scale(1); }

  10%, 20% {
    transform: scale(0.9) rotate(-3deg); }

  30%, 50%, 70%, 90% {
    transform: scale(1.1) rotate(3deg); }

  40%, 60%, 80% {
    transform: scale(1.1) rotate(-3deg); }

  100% {
    transform: scale(1) rotate(0); } }

.tada {
  -webkit-animation-name: tada;
  -moz-animation-name: tada;
  -o-animation-name: tada;
  animation-name: tada; }

@-webkit-keyframes swing {
  20%, 40%, 60%, 80%, 100% {
    -webkit-transform-origin: top center; }

  20% {
    -webkit-transform: rotate(15deg); }

  40% {
    -webkit-transform: rotate(-10deg); }

  60% {
    -webkit-transform: rotate(5deg); }

  80% {
    -webkit-transform: rotate(-5deg); }

  100% {
    -webkit-transform: rotate(0deg); } }

@-moz-keyframes swing {
  20% {
    -moz-transform: rotate(15deg); }

  40% {
    -moz-transform: rotate(-10deg); }

  60% {
    -moz-transform: rotate(5deg); }

  80% {
    -moz-transform: rotate(-5deg); }

  100% {
    -moz-transform: rotate(0deg); } }

@-o-keyframes swing {
  20% {
    -o-transform: rotate(15deg); }

  40% {
    -o-transform: rotate(-10deg); }

  60% {
    -o-transform: rotate(5deg); }

  80% {
    -o-transform: rotate(-5deg); }

  100% {
    -o-transform: rotate(0deg); } }

@keyframes swing {
  20% {
    transform: rotate(15deg); }

  40% {
    transform: rotate(-10deg); }

  60% {
    transform: rotate(5deg); }

  80% {
    transform: rotate(-5deg); }

  100% {
    transform: rotate(0deg); } }

.swing {
  -webkit-transform-origin: top center;
  -moz-transform-origin: top center;
  -o-transform-origin: top center;
  transform-origin: top center;
  -webkit-animation-name: swing;
  -moz-animation-name: swing;
  -o-animation-name: swing;
  animation-name: swing; }

/* originally authored by Nick Pettit - https://github.com/nickpettit/glide */
@-webkit-keyframes wobble {
  0% {
    -webkit-transform: translateX(0%); }

  15% {
    -webkit-transform: translateX(-25%) rotate(-5deg); }

  30% {
    -webkit-transform: translateX(20%) rotate(3deg); }

  45% {
    -webkit-transform: translateX(-15%) rotate(-3deg); }

  60% {
    -webkit-transform: translateX(10%) rotate(2deg); }

  75% {
    -webkit-transform: translateX(-5%) rotate(-1deg); }

  100% {
    -webkit-transform: translateX(0%); } }

@-moz-keyframes wobble {
  0% {
    -moz-transform: translateX(0%); }

  15% {
    -moz-transform: translateX(-25%) rotate(-5deg); }

  30% {
    -moz-transform: translateX(20%) rotate(3deg); }

  45% {
    -moz-transform: translateX(-15%) rotate(-3deg); }

  60% {
    -moz-transform: translateX(10%) rotate(2deg); }

  75% {
    -moz-transform: translateX(-5%) rotate(-1deg); }

  100% {
    -moz-transform: translateX(0%); } }

@-o-keyframes wobble {
  0% {
    -o-transform: translateX(0%); }

  15% {
    -o-transform: translateX(-25%) rotate(-5deg); }

  30% {
    -o-transform: translateX(20%) rotate(3deg); }

  45% {
    -o-transform: translateX(-15%) rotate(-3deg); }

  60% {
    -o-transform: translateX(10%) rotate(2deg); }

  75% {
    -o-transform: translateX(-5%) rotate(-1deg); }

  100% {
    -o-transform: translateX(0%); } }

@keyframes wobble {
  0% {
    transform: translateX(0%); }

  15% {
    transform: translateX(-25%) rotate(-5deg); }

  30% {
    transform: translateX(20%) rotate(3deg); }

  45% {
    transform: translateX(-15%) rotate(-3deg); }

  60% {
    transform: translateX(10%) rotate(2deg); }

  75% {
    transform: translateX(-5%) rotate(-1deg); }

  100% {
    transform: translateX(0%); } }

.wobble {
  -webkit-animation-name: wobble;
  -moz-animation-name: wobble;
  -o-animation-name: wobble;
  animation-name: wobble; }

/* originally authored by Nick Pettit - https://github.com/nickpettit/glide */
@-webkit-keyframes pulse {
  0% {
    -webkit-transform: scale(1); }

  50% {
    -webkit-transform: scale(1.1); }

  100% {
    -webkit-transform: scale(1); } }

@-moz-keyframes pulse {
  0% {
    -moz-transform: scale(1); }

  50% {
    -moz-transform: scale(1.1); }

  100% {
    -moz-transform: scale(1); } }

@-o-keyframes pulse {
  0% {
    -o-transform: scale(1); }

  50% {
    -o-transform: scale(1.1); }

  100% {
    -o-transform: scale(1); } }

@keyframes pulse {
  0% {
    transform: scale(1); }

  50% {
    transform: scale(1.1); }

  100% {
    transform: scale(1); } }

.pulse {
  -webkit-animation-name: pulse;
  -moz-animation-name: pulse;
  -o-animation-name: pulse;
  animation-name: pulse; }

@-webkit-keyframes flip {
  0% {
    -webkit-transform: perspective(400px) rotateY(0);
    -webkit-animation-timing-function: ease-out; }

  40% {
    -webkit-transform: perspective(400px) translateZ(150px) rotateY(170deg);
    -webkit-animation-timing-function: ease-out; }

  50% {
    -webkit-transform: perspective(400px) translateZ(150px) rotateY(190deg) scale(1);
    -webkit-animation-timing-function: ease-in; }

  80% {
    -webkit-transform: perspective(400px) rotateY(360deg) scale(0.95);
    -webkit-animation-timing-function: ease-in; }

  100% {
    -webkit-transform: perspective(400px) scale(1);
    -webkit-animation-timing-function: ease-in; } }

@-moz-keyframes flip {
  0% {
    -moz-transform: perspective(400px) rotateY(0);
    -moz-animation-timing-function: ease-out; }

  40% {
    -moz-transform: perspective(400px) translateZ(150px) rotateY(170deg);
    -moz-animation-timing-function: ease-out; }

  50% {
    -moz-transform: perspective(400px) translateZ(150px) rotateY(190deg) scale(1);
    -moz-animation-timing-function: ease-in; }

  80% {
    -moz-transform: perspective(400px) rotateY(360deg) scale(0.95);
    -moz-animation-timing-function: ease-in; }

  100% {
    -moz-transform: perspective(400px) scale(1);
    -moz-animation-timing-function: ease-in; } }

@-o-keyframes flip {
  0% {
    -o-transform: perspective(400px) rotateY(0);
    -o-animation-timing-function: ease-out; }

  40% {
    -o-transform: perspective(400px) translateZ(150px) rotateY(170deg);
    -o-animation-timing-function: ease-out; }

  50% {
    -o-transform: perspective(400px) translateZ(150px) rotateY(190deg) scale(1);
    -o-animation-timing-function: ease-in; }

  80% {
    -o-transform: perspective(400px) rotateY(360deg) scale(0.95);
    -o-animation-timing-function: ease-in; }

  100% {
    -o-transform: perspective(400px) scale(1);
    -o-animation-timing-function: ease-in; } }

@keyframes flip {
  0% {
    transform: perspective(400px) rotateY(0);
    animation-timing-function: ease-out; }

  40% {
    transform: perspective(400px) translateZ(150px) rotateY(170deg);
    animation-timing-function: ease-out; }

  50% {
    transform: perspective(400px) translateZ(150px) rotateY(190deg) scale(1);
    animation-timing-function: ease-in; }

  80% {
    transform: perspective(400px) rotateY(360deg) scale(0.95);
    animation-timing-function: ease-in; }

  100% {
    transform: perspective(400px) scale(1);
    animation-timing-function: ease-in; } }

.flip {
  -webkit-backface-visibility: visible !important;
  -webkit-animation-name: flip;
  -moz-backface-visibility: visible !important;
  -moz-animation-name: flip;
  -o-backface-visibility: visible !important;
  -o-animation-name: flip;
  backface-visibility: visible !important;
  animation-name: flip; }

@-webkit-keyframes flipInX {
  0% {
    -webkit-transform: perspective(400px) rotateX(90deg);
    opacity: 0; }

  40% {
    -webkit-transform: perspective(400px) rotateX(-10deg); }

  70% {
    -webkit-transform: perspective(400px) rotateX(10deg); }

  100% {
    -webkit-transform: perspective(400px) rotateX(0deg);
    opacity: 1; } }

@-moz-keyframes flipInX {
  0% {
    -moz-transform: perspective(400px) rotateX(90deg);
    opacity: 0; }

  40% {
    -moz-transform: perspective(400px) rotateX(-10deg); }

  70% {
    -moz-transform: perspective(400px) rotateX(10deg); }

  100% {
    -moz-transform: perspective(400px) rotateX(0deg);
    opacity: 1; } }

@-o-keyframes flipInX {
  0% {
    -o-transform: perspective(400px) rotateX(90deg);
    opacity: 0; }

  40% {
    -o-transform: perspective(400px) rotateX(-10deg); }

  70% {
    -o-transform: perspective(400px) rotateX(10deg); }

  100% {
    -o-transform: perspective(400px) rotateX(0deg);
    opacity: 1; } }

@keyframes flipInX {
  0% {
    transform: perspective(400px) rotateX(90deg);
    opacity: 0; }

  40% {
    transform: perspective(400px) rotateX(-10deg); }

  70% {
    transform: perspective(400px) rotateX(10deg); }

  100% {
    transform: perspective(400px) rotateX(0deg);
    opacity: 1; } }

.flipInX {
  -webkit-backface-visibility: visible !important;
  -webkit-animation-name: flipInX;
  -moz-backface-visibility: visible !important;
  -moz-animation-name: flipInX;
  -o-backface-visibility: visible !important;
  -o-animation-name: flipInX;
  backface-visibility: visible !important;
  animation-name: flipInX; }

@-webkit-keyframes flipOutX {
  0% {
    -webkit-transform: perspective(400px) rotateX(0deg);
    opacity: 1; }

  100% {
    -webkit-transform: perspective(400px) rotateX(90deg);
    opacity: 0; } }

@-moz-keyframes flipOutX {
  0% {
    -moz-transform: perspective(400px) rotateX(0deg);
    opacity: 1; }

  100% {
    -moz-transform: perspective(400px) rotateX(90deg);
    opacity: 0; } }

@-o-keyframes flipOutX {
  0% {
    -o-transform: perspective(400px) rotateX(0deg);
    opacity: 1; }

  100% {
    -o-transform: perspective(400px) rotateX(90deg);
    opacity: 0; } }

@keyframes flipOutX {
  0% {
    transform: perspective(400px) rotateX(0deg);
    opacity: 1; }

  100% {
    transform: perspective(400px) rotateX(90deg);
    opacity: 0; } }

.flipOutX {
  -webkit-animation-name: flipOutX;
  -webkit-backface-visibility: visible !important;
  -moz-animation-name: flipOutX;
  -moz-backface-visibility: visible !important;
  -o-animation-name: flipOutX;
  -o-backface-visibility: visible !important;
  animation-name: flipOutX;
  backface-visibility: visible !important; }

@-webkit-keyframes flipInY {
  0% {
    -webkit-transform: perspective(400px) rotateY(90deg);
    opacity: 0; }

  40% {
    -webkit-transform: perspective(400px) rotateY(-10deg); }

  70% {
    -webkit-transform: perspective(400px) rotateY(10deg); }

  100% {
    -webkit-transform: perspective(400px) rotateY(0deg);
    opacity: 1; } }

@-moz-keyframes flipInY {
  0% {
    -moz-transform: perspective(400px) rotateY(90deg);
    opacity: 0; }

  40% {
    -moz-transform: perspective(400px) rotateY(-10deg); }

  70% {
    -moz-transform: perspective(400px) rotateY(10deg); }

  100% {
    -moz-transform: perspective(400px) rotateY(0deg);
    opacity: 1; } }

@-o-keyframes flipInY {
  0% {
    -o-transform: perspective(400px) rotateY(90deg);
    opacity: 0; }

  40% {
    -o-transform: perspective(400px) rotateY(-10deg); }

  70% {
    -o-transform: perspective(400px) rotateY(10deg); }

  100% {
    -o-transform: perspective(400px) rotateY(0deg);
    opacity: 1; } }

@keyframes flipInY {
  0% {
    transform: perspective(400px) rotateY(90deg);
    opacity: 0; }

  40% {
    transform: perspective(400px) rotateY(-10deg); }

  70% {
    transform: perspective(400px) rotateY(10deg); }

  100% {
    transform: perspective(400px) rotateY(0deg);
    opacity: 1; } }

.flipInY {
  -webkit-backface-visibility: visible !important;
  -webkit-animation-name: flipInY;
  -moz-backface-visibility: visible !important;
  -moz-animation-name: flipInY;
  -o-backface-visibility: visible !important;
  -o-animation-name: flipInY;
  backface-visibility: visible !important;
  animation-name: flipInY; }

@-webkit-keyframes flipOutY {
  0% {
    -webkit-transform: perspective(400px) rotateY(0deg);
    opacity: 1; }

  100% {
    -webkit-transform: perspective(400px) rotateY(90deg);
    opacity: 0; } }

@-moz-keyframes flipOutY {
  0% {
    -moz-transform: perspective(400px) rotateY(0deg);
    opacity: 1; }

  100% {
    -moz-transform: perspective(400px) rotateY(90deg);
    opacity: 0; } }

@-o-keyframes flipOutY {
  0% {
    -o-transform: perspective(400px) rotateY(0deg);
    opacity: 1; }

  100% {
    -o-transform: perspective(400px) rotateY(90deg);
    opacity: 0; } }

@keyframes flipOutY {
  0% {
    transform: perspective(400px) rotateY(0deg);
    opacity: 1; }

  100% {
    transform: perspective(400px) rotateY(90deg);
    opacity: 0; } }

.flipOutY {
  -webkit-backface-visibility: visible !important;
  -webkit-animation-name: flipOutY;
  -moz-backface-visibility: visible !important;
  -moz-animation-name: flipOutY;
  -o-backface-visibility: visible !important;
  -o-animation-name: flipOutY;
  backface-visibility: visible !important;
  animation-name: flipOutY; }

@-webkit-keyframes fadeIn {
  0% {
    opacity: 0; }

  100% {
    opacity: 1; } }

@-moz-keyframes fadeIn {
  0% {
    opacity: 0; }

  100% {
    opacity: 1; } }

@-o-keyframes fadeIn {
  0% {
    opacity: 0; }

  100% {
    opacity: 1; } }

@keyframes fadeIn {
  0% {
    opacity: 0; }

  100% {
    opacity: 1; } }

.fadeIn {
  -webkit-animation-name: fadeIn;
  -moz-animation-name: fadeIn;
  -o-animation-name: fadeIn;
  animation-name: fadeIn; }

@-webkit-keyframes fadeInUp {
  0% {
    opacity: 0;
    -webkit-transform: translateY(20px); }

  100% {
    opacity: 1;
    -webkit-transform: translateY(0); } }

@-moz-keyframes fadeInUp {
  0% {
    opacity: 0;
    -moz-transform: translateY(20px); }

  100% {
    opacity: 1;
    -moz-transform: translateY(0); } }

@-o-keyframes fadeInUp {
  0% {
    opacity: 0;
    -o-transform: translateY(20px); }

  100% {
    opacity: 1;
    -o-transform: translateY(0); } }

@keyframes fadeInUp {
  0% {
    opacity: 0;
    transform: translateY(20px); }

  100% {
    opacity: 1;
    transform: translateY(0); } }

.fadeInUp {
  -webkit-animation-name: fadeInUp;
  -moz-animation-name: fadeInUp;
  -o-animation-name: fadeInUp;
  animation-name: fadeInUp; }

@-webkit-keyframes fadeInDown {
  0% {
    opacity: 0;
    -webkit-transform: translateY(-20px); }

  100% {
    opacity: 1;
    -webkit-transform: translateY(0); } }

@-moz-keyframes fadeInDown {
  0% {
    opacity: 0;
    -moz-transform: translateY(-20px); }

  100% {
    opacity: 1;
    -moz-transform: translateY(0); } }

@-o-keyframes fadeInDown {
  0% {
    opacity: 0;
    -o-transform: translateY(-20px); }

  100% {
    opacity: 1;
    -o-transform: translateY(0); } }

@keyframes fadeInDown {
  0% {
    opacity: 0;
    transform: translateY(-20px); }

  100% {
    opacity: 1;
    transform: translateY(0); } }

.fadeInDown {
  -webkit-animation-name: fadeInDown;
  -moz-animation-name: fadeInDown;
  -o-animation-name: fadeInDown;
  animation-name: fadeInDown; }

@-webkit-keyframes fadeInLeft {
  0% {
    opacity: 0;
    -webkit-transform: translateX(-20px); }

  100% {
    opacity: 1;
    -webkit-transform: translateX(0); } }

@-moz-keyframes fadeInLeft {
  0% {
    opacity: 0;
    -moz-transform: translateX(-20px); }

  100% {
    opacity: 1;
    -moz-transform: translateX(0); } }

@-o-keyframes fadeInLeft {
  0% {
    opacity: 0;
    -o-transform: translateX(-20px); }

  100% {
    opacity: 1;
    -o-transform: translateX(0); } }

@keyframes fadeInLeft {
  0% {
    opacity: 0;
    transform: translateX(-20px); }

  100% {
    opacity: 1;
    transform: translateX(0); } }

.fadeInLeft {
  -webkit-animation-name: fadeInLeft;
  -moz-animation-name: fadeInLeft;
  -o-animation-name: fadeInLeft;
  animation-name: fadeInLeft; }

@-webkit-keyframes fadeInRight {
  0% {
    opacity: 0;
    -webkit-transform: translateX(20px); }

  100% {
    opacity: 1;
    -webkit-transform: translateX(0); } }

@-moz-keyframes fadeInRight {
  0% {
    opacity: 0;
    -moz-transform: translateX(20px); }

  100% {
    opacity: 1;
    -moz-transform: translateX(0); } }

@-o-keyframes fadeInRight {
  0% {
    opacity: 0;
    -o-transform: translateX(20px); }

  100% {
    opacity: 1;
    -o-transform: translateX(0); } }

@keyframes fadeInRight {
  0% {
    opacity: 0;
    transform: translateX(20px); }

  100% {
    opacity: 1;
    transform: translateX(0); } }

.fadeInRight {
  -webkit-animation-name: fadeInRight;
  -moz-animation-name: fadeInRight;
  -o-animation-name: fadeInRight;
  animation-name: fadeInRight; }

@-webkit-keyframes fadeInUpBig {
  0% {
    opacity: 0;
    -webkit-transform: translateY(2000px); }

  100% {
    opacity: 1;
    -webkit-transform: translateY(0); } }

@-moz-keyframes fadeInUpBig {
  0% {
    opacity: 0;
    -moz-transform: translateY(2000px); }

  100% {
    opacity: 1;
    -moz-transform: translateY(0); } }

@-o-keyframes fadeInUpBig {
  0% {
    opacity: 0;
    -o-transform: translateY(2000px); }

  100% {
    opacity: 1;
    -o-transform: translateY(0); } }

@keyframes fadeInUpBig {
  0% {
    opacity: 0;
    transform: translateY(2000px); }

  100% {
    opacity: 1;
    transform: translateY(0); } }

.fadeInUpBig {
  -webkit-animation-name: fadeInUpBig;
  -moz-animation-name: fadeInUpBig;
  -o-animation-name: fadeInUpBig;
  animation-name: fadeInUpBig; }

@-webkit-keyframes fadeInDownBig {
  0% {
    opacity: 0;
    -webkit-transform: translateY(-2000px); }

  100% {
    opacity: 1;
    -webkit-transform: translateY(0); } }

@-moz-keyframes fadeInDownBig {
  0% {
    opacity: 0;
    -moz-transform: translateY(-2000px); }

  100% {
    opacity: 1;
    -moz-transform: translateY(0); } }

@-o-keyframes fadeInDownBig {
  0% {
    opacity: 0;
    -o-transform: translateY(-2000px); }

  100% {
    opacity: 1;
    -o-transform: translateY(0); } }

@keyframes fadeInDownBig {
  0% {
    opacity: 0;
    transform: translateY(-2000px); }

  100% {
    opacity: 1;
    transform: translateY(0); } }

.fadeInDownBig {
  -webkit-animation-name: fadeInDownBig;
  -moz-animation-name: fadeInDownBig;
  -o-animation-name: fadeInDownBig;
  animation-name: fadeInDownBig; }

@-webkit-keyframes fadeInLeftBig {
  0% {
    opacity: 0;
    -webkit-transform: translateX(-2000px); }

  100% {
    opacity: 1;
    -webkit-transform: translateX(0); } }

@-moz-keyframes fadeInLeftBig {
  0% {
    opacity: 0;
    -moz-transform: translateX(-2000px); }

  100% {
    opacity: 1;
    -moz-transform: translateX(0); } }

@-o-keyframes fadeInLeftBig {
  0% {
    opacity: 0;
    -o-transform: translateX(-2000px); }

  100% {
    opacity: 1;
    -o-transform: translateX(0); } }

@keyframes fadeInLeftBig {
  0% {
    opacity: 0;
    transform: translateX(-2000px); }

  100% {
    opacity: 1;
    transform: translateX(0); } }

.fadeInLeftBig {
  -webkit-animation-name: fadeInLeftBig;
  -moz-animation-name: fadeInLeftBig;
  -o-animation-name: fadeInLeftBig;
  animation-name: fadeInLeftBig; }

@-webkit-keyframes fadeInRightBig {
  0% {
    opacity: 0;
    -webkit-transform: translateX(2000px); }

  100% {
    opacity: 1;
    -webkit-transform: translateX(0); } }

@-moz-keyframes fadeInRightBig {
  0% {
    opacity: 0;
    -moz-transform: translateX(2000px); }

  100% {
    opacity: 1;
    -moz-transform: translateX(0); } }

@-o-keyframes fadeInRightBig {
  0% {
    opacity: 0;
    -o-transform: translateX(2000px); }

  100% {
    opacity: 1;
    -o-transform: translateX(0); } }

@keyframes fadeInRightBig {
  0% {
    opacity: 0;
    transform: translateX(2000px); }

  100% {
    opacity: 1;
    transform: translateX(0); } }

.fadeInRightBig {
  -webkit-animation-name: fadeInRightBig;
  -moz-animation-name: fadeInRightBig;
  -o-animation-name: fadeInRightBig;
  animation-name: fadeInRightBig; }

@-webkit-keyframes fadeOut {
  0% {
    opacity: 1; }

  100% {
    opacity: 0; } }

@-moz-keyframes fadeOut {
  0% {
    opacity: 1; }

  100% {
    opacity: 0; } }

@-o-keyframes fadeOut {
  0% {
    opacity: 1; }

  100% {
    opacity: 0; } }

@keyframes fadeOut {
  0% {
    opacity: 1; }

  100% {
    opacity: 0; } }

.fadeOut {
  -webkit-animation-name: fadeOut;
  -moz-animation-name: fadeOut;
  -o-animation-name: fadeOut;
  animation-name: fadeOut; }

@-webkit-keyframes fadeOutUp {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(-20px); } }

@-moz-keyframes fadeOutUp {
  0% {
    opacity: 1;
    -moz-transform: translateY(0); }

  100% {
    opacity: 0;
    -moz-transform: translateY(-20px); } }

@-o-keyframes fadeOutUp {
  0% {
    opacity: 1;
    -o-transform: translateY(0); }

  100% {
    opacity: 0;
    -o-transform: translateY(-20px); } }

@keyframes fadeOutUp {
  0% {
    opacity: 1;
    transform: translateY(0); }

  100% {
    opacity: 0;
    transform: translateY(-20px); } }

.fadeOutUp {
  -webkit-animation-name: fadeOutUp;
  -moz-animation-name: fadeOutUp;
  -o-animation-name: fadeOutUp;
  animation-name: fadeOutUp; }

@-webkit-keyframes fadeOutDown {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(20px); } }

@-moz-keyframes fadeOutDown {
  0% {
    opacity: 1;
    -moz-transform: translateY(0); }

  100% {
    opacity: 0;
    -moz-transform: translateY(20px); } }

@-o-keyframes fadeOutDown {
  0% {
    opacity: 1;
    -o-transform: translateY(0); }

  100% {
    opacity: 0;
    -o-transform: translateY(20px); } }

@keyframes fadeOutDown {
  0% {
    opacity: 1;
    transform: translateY(0); }

  100% {
    opacity: 0;
    transform: translateY(20px); } }

.fadeOutDown {
  -webkit-animation-name: fadeOutDown;
  -moz-animation-name: fadeOutDown;
  -o-animation-name: fadeOutDown;
  animation-name: fadeOutDown; }

@-webkit-keyframes fadeOutLeft {
  0% {
    opacity: 1;
    -webkit-transform: translateX(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(-20px); } }

@-moz-keyframes fadeOutLeft {
  0% {
    opacity: 1;
    -moz-transform: translateX(0); }

  100% {
    opacity: 0;
    -moz-transform: translateX(-20px); } }

@-o-keyframes fadeOutLeft {
  0% {
    opacity: 1;
    -o-transform: translateX(0); }

  100% {
    opacity: 0;
    -o-transform: translateX(-20px); } }

@keyframes fadeOutLeft {
  0% {
    opacity: 1;
    transform: translateX(0); }

  100% {
    opacity: 0;
    transform: translateX(-20px); } }

.fadeOutLeft {
  -webkit-animation-name: fadeOutLeft;
  -moz-animation-name: fadeOutLeft;
  -o-animation-name: fadeOutLeft;
  animation-name: fadeOutLeft; }

@-webkit-keyframes fadeOutRight {
  0% {
    opacity: 1;
    -webkit-transform: translateX(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(20px); } }

@-moz-keyframes fadeOutRight {
  0% {
    opacity: 1;
    -moz-transform: translateX(0); }

  100% {
    opacity: 0;
    -moz-transform: translateX(20px); } }

@-o-keyframes fadeOutRight {
  0% {
    opacity: 1;
    -o-transform: translateX(0); }

  100% {
    opacity: 0;
    -o-transform: translateX(20px); } }

@keyframes fadeOutRight {
  0% {
    opacity: 1;
    transform: translateX(0); }

  100% {
    opacity: 0;
    transform: translateX(20px); } }

.fadeOutRight {
  -webkit-animation-name: fadeOutRight;
  -moz-animation-name: fadeOutRight;
  -o-animation-name: fadeOutRight;
  animation-name: fadeOutRight; }

@-webkit-keyframes fadeOutUpBig {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(-2000px); } }

@-moz-keyframes fadeOutUpBig {
  0% {
    opacity: 1;
    -moz-transform: translateY(0); }

  100% {
    opacity: 0;
    -moz-transform: translateY(-2000px); } }

@-o-keyframes fadeOutUpBig {
  0% {
    opacity: 1;
    -o-transform: translateY(0); }

  100% {
    opacity: 0;
    -o-transform: translateY(-2000px); } }

@keyframes fadeOutUpBig {
  0% {
    opacity: 1;
    transform: translateY(0); }

  100% {
    opacity: 0;
    transform: translateY(-2000px); } }

.fadeOutUpBig {
  -webkit-animation-name: fadeOutUpBig;
  -moz-animation-name: fadeOutUpBig;
  -o-animation-name: fadeOutUpBig;
  animation-name: fadeOutUpBig; }

@-webkit-keyframes fadeOutDownBig {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(2000px); } }

@-moz-keyframes fadeOutDownBig {
  0% {
    opacity: 1;
    -moz-transform: translateY(0); }

  100% {
    opacity: 0;
    -moz-transform: translateY(2000px); } }

@-o-keyframes fadeOutDownBig {
  0% {
    opacity: 1;
    -o-transform: translateY(0); }

  100% {
    opacity: 0;
    -o-transform: translateY(2000px); } }

@keyframes fadeOutDownBig {
  0% {
    opacity: 1;
    transform: translateY(0); }

  100% {
    opacity: 0;
    transform: translateY(2000px); } }

.fadeOutDownBig {
  -webkit-animation-name: fadeOutDownBig;
  -moz-animation-name: fadeOutDownBig;
  -o-animation-name: fadeOutDownBig;
  animation-name: fadeOutDownBig; }

@-webkit-keyframes fadeOutLeftBig {
  0% {
    opacity: 1;
    -webkit-transform: translateX(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(-2000px); } }

@-moz-keyframes fadeOutLeftBig {
  0% {
    opacity: 1;
    -moz-transform: translateX(0); }

  100% {
    opacity: 0;
    -moz-transform: translateX(-2000px); } }

@-o-keyframes fadeOutLeftBig {
  0% {
    opacity: 1;
    -o-transform: translateX(0); }

  100% {
    opacity: 0;
    -o-transform: translateX(-2000px); } }

@keyframes fadeOutLeftBig {
  0% {
    opacity: 1;
    transform: translateX(0); }

  100% {
    opacity: 0;
    transform: translateX(-2000px); } }

.fadeOutLeftBig {
  -webkit-animation-name: fadeOutLeftBig;
  -moz-animation-name: fadeOutLeftBig;
  -o-animation-name: fadeOutLeftBig;
  animation-name: fadeOutLeftBig; }

@-webkit-keyframes fadeOutRightBig {
  0% {
    opacity: 1;
    -webkit-transform: translateX(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(2000px); } }

@-moz-keyframes fadeOutRightBig {
  0% {
    opacity: 1;
    -moz-transform: translateX(0); }

  100% {
    opacity: 0;
    -moz-transform: translateX(2000px); } }

@-o-keyframes fadeOutRightBig {
  0% {
    opacity: 1;
    -o-transform: translateX(0); }

  100% {
    opacity: 0;
    -o-transform: translateX(2000px); } }

@keyframes fadeOutRightBig {
  0% {
    opacity: 1;
    transform: translateX(0); }

  100% {
    opacity: 0;
    transform: translateX(2000px); } }

.fadeOutRightBig {
  -webkit-animation-name: fadeOutRightBig;
  -moz-animation-name: fadeOutRightBig;
  -o-animation-name: fadeOutRightBig;
  animation-name: fadeOutRightBig; }

@-webkit-keyframes bounceIn {
  0% {
    opacity: 0;
    -webkit-transform: scale(0.3); }

  50% {
    opacity: 1;
    -webkit-transform: scale(1.05); }

  70% {
    -webkit-transform: scale(0.9); }

  100% {
    -webkit-transform: scale(1); } }

@-moz-keyframes bounceIn {
  0% {
    opacity: 0;
    -moz-transform: scale(0.3); }

  50% {
    opacity: 1;
    -moz-transform: scale(1.05); }

  70% {
    -moz-transform: scale(0.9); }

  100% {
    -moz-transform: scale(1); } }

@-o-keyframes bounceIn {
  0% {
    opacity: 0;
    -o-transform: scale(0.3); }

  50% {
    opacity: 1;
    -o-transform: scale(1.05); }

  70% {
    -o-transform: scale(0.9); }

  100% {
    -o-transform: scale(1); } }

@keyframes bounceIn {
  0% {
    opacity: 0;
    transform: scale(0.3); }

  50% {
    opacity: 1;
    transform: scale(1.05); }

  70% {
    transform: scale(0.9); }

  100% {
    transform: scale(1); } }

.bounceIn {
  -webkit-animation-name: bounceIn;
  -moz-animation-name: bounceIn;
  -o-animation-name: bounceIn;
  animation-name: bounceIn; }

@-webkit-keyframes bounceInUp {
  0% {
    opacity: 0;
    -webkit-transform: translateY(2000px); }

  60% {
    opacity: 1;
    -webkit-transform: translateY(-30px); }

  80% {
    -webkit-transform: translateY(10px); }

  100% {
    -webkit-transform: translateY(0); } }

@-moz-keyframes bounceInUp {
  0% {
    opacity: 0;
    -moz-transform: translateY(2000px); }

  60% {
    opacity: 1;
    -moz-transform: translateY(-30px); }

  80% {
    -moz-transform: translateY(10px); }

  100% {
    -moz-transform: translateY(0); } }

@-o-keyframes bounceInUp {
  0% {
    opacity: 0;
    -o-transform: translateY(2000px); }

  60% {
    opacity: 1;
    -o-transform: translateY(-30px); }

  80% {
    -o-transform: translateY(10px); }

  100% {
    -o-transform: translateY(0); } }

@keyframes bounceInUp {
  0% {
    opacity: 0;
    transform: translateY(2000px); }

  60% {
    opacity: 1;
    transform: translateY(-30px); }

  80% {
    transform: translateY(10px); }

  100% {
    transform: translateY(0); } }

.bounceInUp {
  -webkit-animation-name: bounceInUp;
  -moz-animation-name: bounceInUp;
  -o-animation-name: bounceInUp;
  animation-name: bounceInUp; }

@-webkit-keyframes bounceInDown {
  0% {
    opacity: 0;
    -webkit-transform: translateY(-2000px); }

  60% {
    opacity: 1;
    -webkit-transform: translateY(30px); }

  80% {
    -webkit-transform: translateY(-10px); }

  100% {
    -webkit-transform: translateY(0); } }

@-moz-keyframes bounceInDown {
  0% {
    opacity: 0;
    -moz-transform: translateY(-2000px); }

  60% {
    opacity: 1;
    -moz-transform: translateY(30px); }

  80% {
    -moz-transform: translateY(-10px); }

  100% {
    -moz-transform: translateY(0); } }

@-o-keyframes bounceInDown {
  0% {
    opacity: 0;
    -o-transform: translateY(-2000px); }

  60% {
    opacity: 1;
    -o-transform: translateY(30px); }

  80% {
    -o-transform: translateY(-10px); }

  100% {
    -o-transform: translateY(0); } }

@keyframes bounceInDown {
  0% {
    opacity: 0;
    transform: translateY(-2000px); }

  60% {
    opacity: 1;
    transform: translateY(30px); }

  80% {
    transform: translateY(-10px); }

  100% {
    transform: translateY(0); } }

.bounceInDown {
  -webkit-animation-name: bounceInDown;
  -moz-animation-name: bounceInDown;
  -o-animation-name: bounceInDown;
  animation-name: bounceInDown; }

@-webkit-keyframes bounceInLeft {
  0% {
    opacity: 0;
    -webkit-transform: translateX(-2000px); }

  60% {
    opacity: 1;
    -webkit-transform: translateX(30px); }

  80% {
    -webkit-transform: translateX(-10px); }

  100% {
    -webkit-transform: translateX(0); } }

@-moz-keyframes bounceInLeft {
  0% {
    opacity: 0;
    -moz-transform: translateX(-2000px); }

  60% {
    opacity: 1;
    -moz-transform: translateX(30px); }

  80% {
    -moz-transform: translateX(-10px); }

  100% {
    -moz-transform: translateX(0); } }

@-o-keyframes bounceInLeft {
  0% {
    opacity: 0;
    -o-transform: translateX(-2000px); }

  60% {
    opacity: 1;
    -o-transform: translateX(30px); }

  80% {
    -o-transform: translateX(-10px); }

  100% {
    -o-transform: translateX(0); } }

@keyframes bounceInLeft {
  0% {
    opacity: 0;
    transform: translateX(-2000px); }

  60% {
    opacity: 1;
    transform: translateX(30px); }

  80% {
    transform: translateX(-10px); }

  100% {
    transform: translateX(0); } }

.bounceInLeft {
  -webkit-animation-name: bounceInLeft;
  -moz-animation-name: bounceInLeft;
  -o-animation-name: bounceInLeft;
  animation-name: bounceInLeft; }

@-webkit-keyframes bounceInRight {
  0% {
    opacity: 0;
    -webkit-transform: translateX(2000px); }

  60% {
    opacity: 1;
    -webkit-transform: translateX(-30px); }

  80% {
    -webkit-transform: translateX(10px); }

  100% {
    -webkit-transform: translateX(0); } }

@-moz-keyframes bounceInRight {
  0% {
    opacity: 0;
    -moz-transform: translateX(2000px); }

  60% {
    opacity: 1;
    -moz-transform: translateX(-30px); }

  80% {
    -moz-transform: translateX(10px); }

  100% {
    -moz-transform: translateX(0); } }

@-o-keyframes bounceInRight {
  0% {
    opacity: 0;
    -o-transform: translateX(2000px); }

  60% {
    opacity: 1;
    -o-transform: translateX(-30px); }

  80% {
    -o-transform: translateX(10px); }

  100% {
    -o-transform: translateX(0); } }

@keyframes bounceInRight {
  0% {
    opacity: 0;
    transform: translateX(2000px); }

  60% {
    opacity: 1;
    transform: translateX(-30px); }

  80% {
    transform: translateX(10px); }

  100% {
    transform: translateX(0); } }

.bounceInRight {
  -webkit-animation-name: bounceInRight;
  -moz-animation-name: bounceInRight;
  -o-animation-name: bounceInRight;
  animation-name: bounceInRight; }

@-webkit-keyframes bounceOut {
  0% {
    -webkit-transform: scale(1); }

  25% {
    -webkit-transform: scale(0.95); }

  50% {
    opacity: 1;
    -webkit-transform: scale(1.1); }

  100% {
    opacity: 0;
    -webkit-transform: scale(0.3); } }

@-moz-keyframes bounceOut {
  0% {
    -moz-transform: scale(1); }

  25% {
    -moz-transform: scale(0.95); }

  50% {
    opacity: 1;
    -moz-transform: scale(1.1); }

  100% {
    opacity: 0;
    -moz-transform: scale(0.3); } }

@-o-keyframes bounceOut {
  0% {
    -o-transform: scale(1); }

  25% {
    -o-transform: scale(0.95); }

  50% {
    opacity: 1;
    -o-transform: scale(1.1); }

  100% {
    opacity: 0;
    -o-transform: scale(0.3); } }

@keyframes bounceOut {
  0% {
    transform: scale(1); }

  25% {
    transform: scale(0.95); }

  50% {
    opacity: 1;
    transform: scale(1.1); }

  100% {
    opacity: 0;
    transform: scale(0.3); } }

.bounceOut {
  -webkit-animation-name: bounceOut;
  -moz-animation-name: bounceOut;
  -o-animation-name: bounceOut;
  animation-name: bounceOut; }

@-webkit-keyframes bounceOutUp {
  0% {
    -webkit-transform: translateY(0); }

  20% {
    opacity: 1;
    -webkit-transform: translateY(20px); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(-2000px); } }

@-moz-keyframes bounceOutUp {
  0% {
    -moz-transform: translateY(0); }

  20% {
    opacity: 1;
    -moz-transform: translateY(20px); }

  100% {
    opacity: 0;
    -moz-transform: translateY(-2000px); } }

@-o-keyframes bounceOutUp {
  0% {
    -o-transform: translateY(0); }

  20% {
    opacity: 1;
    -o-transform: translateY(20px); }

  100% {
    opacity: 0;
    -o-transform: translateY(-2000px); } }

@keyframes bounceOutUp {
  0% {
    transform: translateY(0); }

  20% {
    opacity: 1;
    transform: translateY(20px); }

  100% {
    opacity: 0;
    transform: translateY(-2000px); } }

.bounceOutUp {
  -webkit-animation-name: bounceOutUp;
  -moz-animation-name: bounceOutUp;
  -o-animation-name: bounceOutUp;
  animation-name: bounceOutUp; }

@-webkit-keyframes bounceOutDown {
  0% {
    -webkit-transform: translateY(0); }

  20% {
    opacity: 1;
    -webkit-transform: translateY(-20px); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(2000px); } }

@-moz-keyframes bounceOutDown {
  0% {
    -moz-transform: translateY(0); }

  20% {
    opacity: 1;
    -moz-transform: translateY(-20px); }

  100% {
    opacity: 0;
    -moz-transform: translateY(2000px); } }

@-o-keyframes bounceOutDown {
  0% {
    -o-transform: translateY(0); }

  20% {
    opacity: 1;
    -o-transform: translateY(-20px); }

  100% {
    opacity: 0;
    -o-transform: translateY(2000px); } }

@keyframes bounceOutDown {
  0% {
    transform: translateY(0); }

  20% {
    opacity: 1;
    transform: translateY(-20px); }

  100% {
    opacity: 0;
    transform: translateY(2000px); } }

.bounceOutDown {
  -webkit-animation-name: bounceOutDown;
  -moz-animation-name: bounceOutDown;
  -o-animation-name: bounceOutDown;
  animation-name: bounceOutDown; }

@-webkit-keyframes bounceOutLeft {
  0% {
    -webkit-transform: translateX(0); }

  20% {
    opacity: 1;
    -webkit-transform: translateX(20px); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(-2000px); } }

@-moz-keyframes bounceOutLeft {
  0% {
    -moz-transform: translateX(0); }

  20% {
    opacity: 1;
    -moz-transform: translateX(20px); }

  100% {
    opacity: 0;
    -moz-transform: translateX(-2000px); } }

@-o-keyframes bounceOutLeft {
  0% {
    -o-transform: translateX(0); }

  20% {
    opacity: 1;
    -o-transform: translateX(20px); }

  100% {
    opacity: 0;
    -o-transform: translateX(-2000px); } }

@keyframes bounceOutLeft {
  0% {
    transform: translateX(0); }

  20% {
    opacity: 1;
    transform: translateX(20px); }

  100% {
    opacity: 0;
    transform: translateX(-2000px); } }

.bounceOutLeft {
  -webkit-animation-name: bounceOutLeft;
  -moz-animation-name: bounceOutLeft;
  -o-animation-name: bounceOutLeft;
  animation-name: bounceOutLeft; }

@-webkit-keyframes bounceOutRight {
  0% {
    -webkit-transform: translateX(0); }

  20% {
    opacity: 1;
    -webkit-transform: translateX(-20px); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(2000px); } }

@-moz-keyframes bounceOutRight {
  0% {
    -moz-transform: translateX(0); }

  20% {
    opacity: 1;
    -moz-transform: translateX(-20px); }

  100% {
    opacity: 0;
    -moz-transform: translateX(2000px); } }

@-o-keyframes bounceOutRight {
  0% {
    -o-transform: translateX(0); }

  20% {
    opacity: 1;
    -o-transform: translateX(-20px); }

  100% {
    opacity: 0;
    -o-transform: translateX(2000px); } }

@keyframes bounceOutRight {
  0% {
    transform: translateX(0); }

  20% {
    opacity: 1;
    transform: translateX(-20px); }

  100% {
    opacity: 0;
    transform: translateX(2000px); } }

.bounceOutRight {
  -webkit-animation-name: bounceOutRight;
  -moz-animation-name: bounceOutRight;
  -o-animation-name: bounceOutRight;
  animation-name: bounceOutRight; }

@-webkit-keyframes rotateIn {
  0% {
    -webkit-transform-origin: center center;
    -webkit-transform: rotate(-200deg);
    opacity: 0; }

  100% {
    -webkit-transform-origin: center center;
    -webkit-transform: rotate(0);
    opacity: 1; } }

@-moz-keyframes rotateIn {
  0% {
    -moz-transform-origin: center center;
    -moz-transform: rotate(-200deg);
    opacity: 0; }

  100% {
    -moz-transform-origin: center center;
    -moz-transform: rotate(0);
    opacity: 1; } }

@-o-keyframes rotateIn {
  0% {
    -o-transform-origin: center center;
    -o-transform: rotate(-200deg);
    opacity: 0; }

  100% {
    -o-transform-origin: center center;
    -o-transform: rotate(0);
    opacity: 1; } }

@keyframes rotateIn {
  0% {
    transform-origin: center center;
    transform: rotate(-200deg);
    opacity: 0; }

  100% {
    transform-origin: center center;
    transform: rotate(0);
    opacity: 1; } }

.rotateIn {
  -webkit-animation-name: rotateIn;
  -moz-animation-name: rotateIn;
  -o-animation-name: rotateIn;
  animation-name: rotateIn; }

@-webkit-keyframes rotateInUpLeft {
  0% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(0);
    opacity: 1; } }

@-moz-keyframes rotateInUpLeft {
  0% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(0);
    opacity: 1; } }

@-o-keyframes rotateInUpLeft {
  0% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(0);
    opacity: 1; } }

@keyframes rotateInUpLeft {
  0% {
    transform-origin: left bottom;
    transform: rotate(90deg);
    opacity: 0; }

  100% {
    transform-origin: left bottom;
    transform: rotate(0);
    opacity: 1; } }

.rotateInUpLeft {
  -webkit-animation-name: rotateInUpLeft;
  -moz-animation-name: rotateInUpLeft;
  -o-animation-name: rotateInUpLeft;
  animation-name: rotateInUpLeft; }

@-webkit-keyframes rotateInDownLeft {
  0% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(0);
    opacity: 1; } }

@-moz-keyframes rotateInDownLeft {
  0% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(0);
    opacity: 1; } }

@-o-keyframes rotateInDownLeft {
  0% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(0);
    opacity: 1; } }

@keyframes rotateInDownLeft {
  0% {
    transform-origin: left bottom;
    transform: rotate(-90deg);
    opacity: 0; }

  100% {
    transform-origin: left bottom;
    transform: rotate(0);
    opacity: 1; } }

.rotateInDownLeft {
  -webkit-animation-name: rotateInDownLeft;
  -moz-animation-name: rotateInDownLeft;
  -o-animation-name: rotateInDownLeft;
  animation-name: rotateInDownLeft; }

@-webkit-keyframes rotateInUpRight {
  0% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(0);
    opacity: 1; } }

@-moz-keyframes rotateInUpRight {
  0% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(0);
    opacity: 1; } }

@-o-keyframes rotateInUpRight {
  0% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(0);
    opacity: 1; } }

@keyframes rotateInUpRight {
  0% {
    transform-origin: right bottom;
    transform: rotate(-90deg);
    opacity: 0; }

  100% {
    transform-origin: right bottom;
    transform: rotate(0);
    opacity: 1; } }

.rotateInUpRight {
  -webkit-animation-name: rotateInUpRight;
  -moz-animation-name: rotateInUpRight;
  -o-animation-name: rotateInUpRight;
  animation-name: rotateInUpRight; }

@-webkit-keyframes rotateInDownRight {
  0% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(0);
    opacity: 1; } }

@-moz-keyframes rotateInDownRight {
  0% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(0);
    opacity: 1; } }

@-o-keyframes rotateInDownRight {
  0% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(0);
    opacity: 1; } }

@keyframes rotateInDownRight {
  0% {
    transform-origin: right bottom;
    transform: rotate(90deg);
    opacity: 0; }

  100% {
    transform-origin: right bottom;
    transform: rotate(0);
    opacity: 1; } }

.rotateInDownRight {
  -webkit-animation-name: rotateInDownRight;
  -moz-animation-name: rotateInDownRight;
  -o-animation-name: rotateInDownRight;
  animation-name: rotateInDownRight; }

@-webkit-keyframes rotateOut {
  0% {
    -webkit-transform-origin: center center;
    -webkit-transform: rotate(0);
    opacity: 1; }

  100% {
    -webkit-transform-origin: center center;
    -webkit-transform: rotate(200deg);
    opacity: 0; } }

@-moz-keyframes rotateOut {
  0% {
    -moz-transform-origin: center center;
    -moz-transform: rotate(0);
    opacity: 1; }

  100% {
    -moz-transform-origin: center center;
    -moz-transform: rotate(200deg);
    opacity: 0; } }

@-o-keyframes rotateOut {
  0% {
    -o-transform-origin: center center;
    -o-transform: rotate(0);
    opacity: 1; }

  100% {
    -o-transform-origin: center center;
    -o-transform: rotate(200deg);
    opacity: 0; } }

@keyframes rotateOut {
  0% {
    transform-origin: center center;
    transform: rotate(0);
    opacity: 1; }

  100% {
    transform-origin: center center;
    transform: rotate(200deg);
    opacity: 0; } }

.rotateOut {
  -webkit-animation-name: rotateOut;
  -moz-animation-name: rotateOut;
  -o-animation-name: rotateOut;
  animation-name: rotateOut; }

@-webkit-keyframes rotateOutUpLeft {
  0% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(0);
    opacity: 1; }

  100% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(-90deg);
    opacity: 0; } }

@-moz-keyframes rotateOutUpLeft {
  0% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(0);
    opacity: 1; }

  100% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(-90deg);
    opacity: 0; } }

@-o-keyframes rotateOutUpLeft {
  0% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(0);
    opacity: 1; }

  100% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(-90deg);
    opacity: 0; } }

@keyframes rotateOutUpLeft {
  0% {
    transform-origin: left bottom;
    transform: rotate(0);
    opacity: 1; }

  100% {
    transform-origin: left bottom;
    transform: rotate(-90deg);
    opacity: 0; } }

.rotateOutUpLeft {
  -webkit-animation-name: rotateOutUpLeft;
  -moz-animation-name: rotateOutUpLeft;
  -o-animation-name: rotateOutUpLeft;
  animation-name: rotateOutUpLeft; }

@-webkit-keyframes rotateOutDownLeft {
  0% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(0);
    opacity: 1; }

  100% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(90deg);
    opacity: 0; } }

@-moz-keyframes rotateOutDownLeft {
  0% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(0);
    opacity: 1; }

  100% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(90deg);
    opacity: 0; } }

@-o-keyframes rotateOutDownLeft {
  0% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(0);
    opacity: 1; }

  100% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(90deg);
    opacity: 0; } }

@keyframes rotateOutDownLeft {
  0% {
    transform-origin: left bottom;
    transform: rotate(0);
    opacity: 1; }

  100% {
    transform-origin: left bottom;
    transform: rotate(90deg);
    opacity: 0; } }

.rotateOutDownLeft {
  -webkit-animation-name: rotateOutDownLeft;
  -moz-animation-name: rotateOutDownLeft;
  -o-animation-name: rotateOutDownLeft;
  animation-name: rotateOutDownLeft; }

@-webkit-keyframes rotateOutUpRight {
  0% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(0);
    opacity: 1; }

  100% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(90deg);
    opacity: 0; } }

@-moz-keyframes rotateOutUpRight {
  0% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(0);
    opacity: 1; }

  100% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(90deg);
    opacity: 0; } }

@-o-keyframes rotateOutUpRight {
  0% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(0);
    opacity: 1; }

  100% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(90deg);
    opacity: 0; } }

@keyframes rotateOutUpRight {
  0% {
    transform-origin: right bottom;
    transform: rotate(0);
    opacity: 1; }

  100% {
    transform-origin: right bottom;
    transform: rotate(90deg);
    opacity: 0; } }

.rotateOutUpRight {
  -webkit-animation-name: rotateOutUpRight;
  -moz-animation-name: rotateOutUpRight;
  -o-animation-name: rotateOutUpRight;
  animation-name: rotateOutUpRight; }

@-webkit-keyframes rotateOutDownRight {
  0% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(0);
    opacity: 1; }

  100% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(-90deg);
    opacity: 0; } }

@-moz-keyframes rotateOutDownRight {
  0% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(0);
    opacity: 1; }

  100% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(-90deg);
    opacity: 0; } }

@-o-keyframes rotateOutDownRight {
  0% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(0);
    opacity: 1; }

  100% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(-90deg);
    opacity: 0; } }

@keyframes rotateOutDownRight {
  0% {
    transform-origin: right bottom;
    transform: rotate(0);
    opacity: 1; }

  100% {
    transform-origin: right bottom;
    transform: rotate(-90deg);
    opacity: 0; } }

.rotateOutDownRight {
  -webkit-animation-name: rotateOutDownRight;
  -moz-animation-name: rotateOutDownRight;
  -o-animation-name: rotateOutDownRight;
  animation-name: rotateOutDownRight; }

@-webkit-keyframes hinge {
  0% {
    -webkit-transform: rotate(0);
    -webkit-transform-origin: top left;
    -webkit-animation-timing-function: ease-in-out; }

  20%, 60% {
    -webkit-transform: rotate(80deg);
    -webkit-transform-origin: top left;
    -webkit-animation-timing-function: ease-in-out; }

  40% {
    -webkit-transform: rotate(60deg);
    -webkit-transform-origin: top left;
    -webkit-animation-timing-function: ease-in-out; }

  80% {
    -webkit-transform: rotate(60deg) translateY(0);
    opacity: 1;
    -webkit-transform-origin: top left;
    -webkit-animation-timing-function: ease-in-out; }

  100% {
    -webkit-transform: translateY(700px);
    opacity: 0; } }

@-moz-keyframes hinge {
  0% {
    -moz-transform: rotate(0);
    -moz-transform-origin: top left;
    -moz-animation-timing-function: ease-in-out; }

  20%, 60% {
    -moz-transform: rotate(80deg);
    -moz-transform-origin: top left;
    -moz-animation-timing-function: ease-in-out; }

  40% {
    -moz-transform: rotate(60deg);
    -moz-transform-origin: top left;
    -moz-animation-timing-function: ease-in-out; }

  80% {
    -moz-transform: rotate(60deg) translateY(0);
    opacity: 1;
    -moz-transform-origin: top left;
    -moz-animation-timing-function: ease-in-out; }

  100% {
    -moz-transform: translateY(700px);
    opacity: 0; } }

@-o-keyframes hinge {
  0% {
    -o-transform: rotate(0);
    -o-transform-origin: top left;
    -o-animation-timing-function: ease-in-out; }

  20%, 60% {
    -o-transform: rotate(80deg);
    -o-transform-origin: top left;
    -o-animation-timing-function: ease-in-out; }

  40% {
    -o-transform: rotate(60deg);
    -o-transform-origin: top left;
    -o-animation-timing-function: ease-in-out; }

  80% {
    -o-transform: rotate(60deg) translateY(0);
    opacity: 1;
    -o-transform-origin: top left;
    -o-animation-timing-function: ease-in-out; }

  100% {
    -o-transform: translateY(700px);
    opacity: 0; } }

@keyframes hinge {
  0% {
    transform: rotate(0);
    transform-origin: top left;
    animation-timing-function: ease-in-out; }

  20%, 60% {
    transform: rotate(80deg);
    transform-origin: top left;
    animation-timing-function: ease-in-out; }

  40% {
    transform: rotate(60deg);
    transform-origin: top left;
    animation-timing-function: ease-in-out; }

  80% {
    transform: rotate(60deg) translateY(0);
    opacity: 1;
    transform-origin: top left;
    animation-timing-function: ease-in-out; }

  100% {
    transform: translateY(700px);
    opacity: 0; } }

.hinge {
  -webkit-animation-name: hinge;
  -moz-animation-name: hinge;
  -o-animation-name: hinge;
  animation-name: hinge; }

/* originally authored by Nick Pettit - https://github.com/nickpettit/glide */
@-webkit-keyframes rollIn {
  0% {
    opacity: 0;
    -webkit-transform: translateX(-100%) rotate(-120deg); }

  100% {
    opacity: 1;
    -webkit-transform: translateX(0px) rotate(0deg); } }

@-moz-keyframes rollIn {
  0% {
    opacity: 0;
    -moz-transform: translateX(-100%) rotate(-120deg); }

  100% {
    opacity: 1;
    -moz-transform: translateX(0px) rotate(0deg); } }

@-o-keyframes rollIn {
  0% {
    opacity: 0;
    -o-transform: translateX(-100%) rotate(-120deg); }

  100% {
    opacity: 1;
    -o-transform: translateX(0px) rotate(0deg); } }

@keyframes rollIn {
  0% {
    opacity: 0;
    transform: translateX(-100%) rotate(-120deg); }

  100% {
    opacity: 1;
    transform: translateX(0px) rotate(0deg); } }

.rollIn {
  -webkit-animation-name: rollIn;
  -moz-animation-name: rollIn;
  -o-animation-name: rollIn;
  animation-name: rollIn; }

/* originally authored by Nick Pettit - https://github.com/nickpettit/glide */
@-webkit-keyframes rollOut {
  0% {
    opacity: 1;
    -webkit-transform: translateX(0px) rotate(0deg); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(100%) rotate(120deg); } }

@-moz-keyframes rollOut {
  0% {
    opacity: 1;
    -moz-transform: translateX(0px) rotate(0deg); }

  100% {
    opacity: 0;
    -moz-transform: translateX(100%) rotate(120deg); } }

@-o-keyframes rollOut {
  0% {
    opacity: 1;
    -o-transform: translateX(0px) rotate(0deg); }

  100% {
    opacity: 0;
    -o-transform: translateX(100%) rotate(120deg); } }

@keyframes rollOut {
  0% {
    opacity: 1;
    transform: translateX(0px) rotate(0deg); }

  100% {
    opacity: 0;
    transform: translateX(100%) rotate(120deg); } }

.rollOut {
  -webkit-animation-name: rollOut;
  -moz-animation-name: rollOut;
  -o-animation-name: rollOut;
  animation-name: rollOut; }

/* originally authored by Angelo Rohit - https://github.com/angelorohit */
@-webkit-keyframes lightSpeedIn {
  0% {
    -webkit-transform: translateX(100%) skewX(-30deg);
    opacity: 0; }

  60% {
    -webkit-transform: translateX(-20%) skewX(30deg);
    opacity: 1; }

  80% {
    -webkit-transform: translateX(0%) skewX(-15deg);
    opacity: 1; }

  100% {
    -webkit-transform: translateX(0%) skewX(0deg);
    opacity: 1; } }

@-moz-keyframes lightSpeedIn {
  0% {
    -moz-transform: translateX(100%) skewX(-30deg);
    opacity: 0; }

  60% {
    -moz-transform: translateX(-20%) skewX(30deg);
    opacity: 1; }

  80% {
    -moz-transform: translateX(0%) skewX(-15deg);
    opacity: 1; }

  100% {
    -moz-transform: translateX(0%) skewX(0deg);
    opacity: 1; } }

@-o-keyframes lightSpeedIn {
  0% {
    -o-transform: translateX(100%) skewX(-30deg);
    opacity: 0; }

  60% {
    -o-transform: translateX(-20%) skewX(30deg);
    opacity: 1; }

  80% {
    -o-transform: translateX(0%) skewX(-15deg);
    opacity: 1; }

  100% {
    -o-transform: translateX(0%) skewX(0deg);
    opacity: 1; } }

@keyframes lightSpeedIn {
  0% {
    transform: translateX(100%) skewX(-30deg);
    opacity: 0; }

  60% {
    transform: translateX(-20%) skewX(30deg);
    opacity: 1; }

  80% {
    transform: translateX(0%) skewX(-15deg);
    opacity: 1; }

  100% {
    transform: translateX(0%) skewX(0deg);
    opacity: 1; } }

.lightSpeedIn {
  -webkit-animation-name: lightSpeedIn;
  -moz-animation-name: lightSpeedIn;
  -o-animation-name: lightSpeedIn;
  animation-name: lightSpeedIn;
  -webkit-animation-timing-function: ease-out;
  -moz-animation-timing-function: ease-out;
  -o-animation-timing-function: ease-out;
  animation-timing-function: ease-out; }

.animated.lightSpeedIn {
  -webkit-animation-duration: 0.5s;
  -moz-animation-duration: 0.5s;
  -o-animation-duration: 0.5s;
  animation-duration: 0.5s; }

/* originally authored by Angelo Rohit - https://github.com/angelorohit */
@-webkit-keyframes lightSpeedOut {
  0% {
    -webkit-transform: translateX(0%) skewX(0deg);
    opacity: 1; }

  100% {
    -webkit-transform: translateX(100%) skewX(-30deg);
    opacity: 0; } }

@-moz-keyframes lightSpeedOut {
  0% {
    -moz-transform: translateX(0%) skewX(0deg);
    opacity: 1; }

  100% {
    -moz-transform: translateX(100%) skewX(-30deg);
    opacity: 0; } }

@-o-keyframes lightSpeedOut {
  0% {
    -o-transform: translateX(0%) skewX(0deg);
    opacity: 1; }

  100% {
    -o-transform: translateX(100%) skewX(-30deg);
    opacity: 0; } }

@keyframes lightSpeedOut {
  0% {
    transform: translateX(0%) skewX(0deg);
    opacity: 1; }

  100% {
    transform: translateX(100%) skewX(-30deg);
    opacity: 0; } }

.lightSpeedOut {
  -webkit-animation-name: lightSpeedOut;
  -moz-animation-name: lightSpeedOut;
  -o-animation-name: lightSpeedOut;
  animation-name: lightSpeedOut;
  -webkit-animation-timing-function: ease-in;
  -moz-animation-timing-function: ease-in;
  -o-animation-timing-function: ease-in;
  animation-timing-function: ease-in; }

.animated.lightSpeedOut {
  -webkit-animation-duration: 0.25s;
  -moz-animation-duration: 0.25s;
  -o-animation-duration: 0.25s;
  animation-duration: 0.25s; }

/* originally authored by Angelo Rohit - https://github.com/angelorohit */
@-webkit-keyframes wiggle {
  0% {
    -webkit-transform: skewX(9deg); }

  10% {
    -webkit-transform: skewX(-8deg); }

  20% {
    -webkit-transform: skewX(7deg); }

  30% {
    -webkit-transform: skewX(-6deg); }

  40% {
    -webkit-transform: skewX(5deg); }

  50% {
    -webkit-transform: skewX(-4deg); }

  60% {
    -webkit-transform: skewX(3deg); }

  70% {
    -webkit-transform: skewX(-2deg); }

  80% {
    -webkit-transform: skewX(1deg); }

  90% {
    -webkit-transform: skewX(0deg); }

  100% {
    -webkit-transform: skewX(0deg); } }

@-moz-keyframes wiggle {
  0% {
    -moz-transform: skewX(9deg); }

  10% {
    -moz-transform: skewX(-8deg); }

  20% {
    -moz-transform: skewX(7deg); }

  30% {
    -moz-transform: skewX(-6deg); }

  40% {
    -moz-transform: skewX(5deg); }

  50% {
    -moz-transform: skewX(-4deg); }

  60% {
    -moz-transform: skewX(3deg); }

  70% {
    -moz-transform: skewX(-2deg); }

  80% {
    -moz-transform: skewX(1deg); }

  90% {
    -moz-transform: skewX(0deg); }

  100% {
    -moz-transform: skewX(0deg); } }

@-o-keyframes wiggle {
  0% {
    -o-transform: skewX(9deg); }

  10% {
    -o-transform: skewX(-8deg); }

  20% {
    -o-transform: skewX(7deg); }

  30% {
    -o-transform: skewX(-6deg); }

  40% {
    -o-transform: skewX(5deg); }

  50% {
    -o-transform: skewX(-4deg); }

  60% {
    -o-transform: skewX(3deg); }

  70% {
    -o-transform: skewX(-2deg); }

  80% {
    -o-transform: skewX(1deg); }

  90% {
    -o-transform: skewX(0deg); }

  100% {
    -o-transform: skewX(0deg); } }

@keyframes wiggle {
  0% {
    transform: skewX(9deg); }

  10% {
    transform: skewX(-8deg); }

  20% {
    transform: skewX(7deg); }

  30% {
    transform: skewX(-6deg); }

  40% {
    transform: skewX(5deg); }

  50% {
    transform: skewX(-4deg); }

  60% {
    transform: skewX(3deg); }

  70% {
    transform: skewX(-2deg); }

  80% {
    transform: skewX(1deg); }

  90% {
    transform: skewX(0deg); }

  100% {
    transform: skewX(0deg); } }

.wiggle {
  -webkit-animation-name: wiggle;
  -moz-animation-name: wiggle;
  -o-animation-name: wiggle;
  animation-name: wiggle;
  -webkit-animation-timing-function: ease-in;
  -moz-animation-timing-function: ease-in;
  -o-animation-timing-function: ease-in;
  animation-timing-function: ease-in; }

.animated.wiggle {
  -webkit-animation-duration: 0.75s;
  -moz-animation-duration: 0.75s;
  -o-animation-duration: 0.75s;
  animation-duration: 0.75s; }
  

    </style>

    <link href="https://ningyu1.github.io/site/css/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="https://ningyu1.github.io/site/css/github-markdown.css" rel="stylesheet" type="text/css">

    <link href='https://ningyu1.github.io/site/css/Slackey.css' rel='stylesheet' type='text/css'>
    <link href='https://ningyu1.github.io/site/css/Fjallaone.css' rel='stylesheet' type='text/css'>
    <link href='https://ningyu1.github.io/site/css/Amethysta.css' rel='stylesheet' type='text/css'>
	<script src="https://ningyu1.github.io/site/js/jquery.min.js"></script>
    

    <script type="text/javascript" src="https://ningyu1.github.io/site/js/jquery-tapir.js"></script>

    

    <link rel="stylesheet" href="https://ningyu1.github.io/site/css/hljs.css">
    <script src="https://ningyu1.github.io/site/js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?5bb9b9d406e3381971859973a2ca3583";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>
</head>


<a href="https://github.com/ningyu1"><img style="position: absolute; top: 0; right: 0; border: 0; width: 149px; height: 149px; z-index:9999; background-color: rgba(0, 0, 0, 0)!important;" src="https://ningyu1.github.io/site/images/right-graphite@2x.png" alt="Fork me on GitHub"></a>








<link href="https://ningyu1.github.io/site/css/music-player.css" media="screen, projection" rel="stylesheet" type="text/css">
<script type="text/javascript" src="https://ningyu1.github.io/site/js/music-player.js"></script>
<iframe class="player"  frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=86 src="https://music.163.com/outchain/player?type=2&id=1296583188&auto=0&height=66"></iframe>



<body class="markdown-body">
    <div id="wrapper">
        <header id="header" class="inner">
<h1 class="animated bounceInDown">
    <div id="headerbg">
        凝雨 - Yun
    </div>
</h1>

<span class="subtitle">快乐编程每一天 - Happy Coding Every Day</span>
<br>


<ul id="social-links" style="text-align:center; clear:both;">
	
    
    <li>
    <a href="mailto:ningbe111@163.com" class="email" title="Email"></a>
    </li>
    
    
    
    <li>
    <a href="https://github.com/ningyu1" class="github" title="Github"></a>
    </li>
    
	
    
    <li>
    <a href="https://gitlab.com/ningyu1" class="gitlab" title="Gitlab"></a>
    </li>
    
    
    
    
    
    
    
    
	
    
    <li>
    <a href="https://gitee.com/ningyu" class="gitee" title="Gitee码云"></a>
    </li>
    
	<li>

    <a href="https://ningyu1.github.io/atom.xml" class="rss" title="RSS" target="_blank"></a>
    </li>
</ul>



<ul id="nav">





    
    <li id="ajax"><a href="https://ningyu1.github.io/">Home</a></li>
    <li id="ajax"><a href="https://ningyu1.github.io/archives/">Archives</a></li>
    <li id="ajax"><a href="https://ningyu1.github.io/categories/">Categories</a></li>
    <li id="ajax"><a href="https://ningyu1.github.io/tags/">Tags</a></li>
    <li id="ajax"><a href="https://ningyu1.github.io/about/">About</a></li>
    <li id="ajax"><a href="https://g2.okk.dog/?path=register&code=qn7nOwdj">科学上网</a></li>
    
    <li>
    <div id="dark">
        
        <form action="//www.google.com/search" method="get" accept-charset="UTF-8" id="search">

            <input type="hidden" name="sitesearch" value="https://ningyu1.github.io" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
</ul>

</header>

<div id="toload">

    <div id="content" class="inner">
        




    
    <script id="dsq-count-scr" src="//ningyu.disqus.com/count.js" async></script>
    




  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/60-jmeter-plugins-dubbo-support/">Dubbo接口如何在Jmeter中测试，自研Dubbo Plugin for Apache JMeter</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-02-09T15:39:49.000&#43;00:00' itemprop="datePublished">2018-02-09</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/jmeter">jmeter</a>

<a href="https://ningyu1.github.io/site/tags/dubbo">dubbo</a>

<a href="https://ningyu1.github.io/site/tags/test">test</a>

<a href="https://ningyu1.github.io/site/tags/dubbo%E5%8F%AF%E8%A7%86%E5%8C%96%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7">Dubbo可视化测试工具</a>

<a href="https://ningyu1.github.io/site/tags/jmeter%E5%AF%B9dubbo%E6%8E%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E5%8F%AF%E8%A7%86%E5%8C%96%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95">Jmeter对Dubbo接口进行可视化压力测试</a>

<a href="https://ningyu1.github.io/site/tags/dubbo-jmeter%E6%8F%92%E4%BB%B6">Dubbo Jmeter插件</a>


</div>
    </div>
        

<p>最近公司测试需要对<code>Dubbo</code>的<code>RPC</code>接口进行测试，测试工具使用的是<code>Jmeter</code>，按照常规的做法需要包装一个<code>Java</code>请求，再配合<code>Jmeter</code>的<code>Java Sample</code>去做测试，这种做法是最简单最普遍的，但是这个方法不够灵活和方便，那我们能不能写一个<code>Jmeter Plugin</code>来解决这个问题？让<code>Dubbo RPC</code>接口测试更为方便一些？</p>

<p>那我们先了解一下Jmeter的插件机制</p>

<h1 id="jmeter-plugin">Jmeter Plugin</h1>

<p>先来看一下<code>Jmeter</code>的核心组件</p>

<ol>
<li><code>Sample</code> 取样器，这个是最主要的组件，测试的内容主要是靠Sample来实现，我们常见的Sample有，<code>HttpSample</code>、<code>FTPSample</code>、<code>JavaSample</code>、<code>SMTPSample</code>、<code>LDAPSample</code>等。</li>
<li><code>Timer</code> 定时器，主要用于配置sample之间的等待时间，可以查看：<code>org.apache.jmeter.timers.RandomTimer</code></li>
<li><code>ConfigElement</code> 配置组件，主要用于定义前置配置。如数据库连接，csv输入数据集等。主要功能是将配置转换为变量设置到JMeter context中。</li>
<li><code>Assertion</code> 验证Sampler的结果是否符合预期</li>
<li><code>PostProcessor</code> 一般用于对Sampler结果进行二次加工</li>
<li><code>Visualizer</code> 将sampler的结果进行可视化展示。</li>
<li><code>Controller</code> 对sampler进行逻辑控制。</li>
<li><code>SampleListener</code> 负责处理监听，基于事件机制。一般用于保存sampler的结果等耗费时间的操作。</li>
</ol>

<p>Jmeter的插件机制比较简单，Jmeter提供了扩展类来支持自定义插件的开发。
继承<code>org.apache.jmeter.samplers.gui.AbstractSamplerGui</code>和<code>org.apache.jmeter.samplers.AbstractSampler</code>就可以完成一个插件开发。</p>

<h1 id="jmeter的gui机制">JMeter的GUI机制</h1>

<p>由于<code>Jmeter</code>是一个基于<code>Swing</code>的GUI工具,所以开发插件需要对<code>Java Swing GUI</code>框架有一定了解。 <code>JMeter</code>内部有两种GUI的实现方式。</p>

<h2 id="第一种方式">第一种方式：</h2>

<p>直接继承JMeterGUIComponent接口的抽象实现类:</p>

<pre><code>org.apache.jmeter.config.gui.AbstractConfigGui
org.apache.jmeter.assertions.gui.AbstractAssertionGui
org.apache.jmeter.control.gui.AbstractControllerGui
org.apache.jmeter.timers.gui.AbstractTimerGui
org.apache.jmeter.visualizers.gui.AbstractVisualizer
org.apache.jmeter.samplers.gui.AbstractSamplerGui
</code></pre>

<h2 id="通过swing的bean绑定机制">通过Swing的Bean绑定机制</h2>

<p>前者的好处是自由度高，可定制性强，但需要开发者关心GUI控件布局,以及从控件到Model的转换。后者基本不需要开发者接触到GUI层的东西，定义好<code>Bean</code>以及<code>BeanInfo</code>即可。但<code>SampleListener</code>不支持<code>BeanInfo</code>方式定义。</p>

<p><strong>ps.如果java swing比较熟悉的话推荐使用第一种方式，自由度高。</strong></p>

<p>下面是我写的插件DubboSample，主要用于Dubbo RPC接口测试。</p>

<h2 id="dubbo-plugin-for-apache-jmeter">Dubbo Plugin for Apache JMeter</h2>

<p>jmeter-plugin-dubbo项目已经transfer到dubbo group下</p>

<p><a href="https://github.com/dubbo/jmeter-plugins-dubbo">github: jmeter-plugin-dubbo</a></p>

<p><a href="https://gitee.com/ningyu/jmeter-plugins-dubbo">码云: jmeter-plugin-dubbo</a></p>

<h2 id="dubbosample使用">DubboSample使用</h2>

<h3 id="支持jmeter版本">支持Jmeter版本</h3>

<p>Jmeter版本：3.0</p>

<h3 id="插件安装">插件安装</h3>

<p>插件包可以去<code>github</code>上下载。将插件包放入Jmeter的lib的ext下。</p>

<pre><code>${Path}\apache-jmeter-3.0\lib\ext
</code></pre>

<p>如果使用的是:<code>jmeter-plugins-dubbo-1.0.0-SNAPSHOT-jar-with-dependencies.jar</code>包含所有依赖。</p>

<p>如果使用的是：<code>jmeter-plugins-dubbo-1.0.0-SNAPSHOT.jar</code>需要自定添加插件的依赖包，推荐使用上面的包，依赖包版本如下：</p>

<pre><code>dubbo-2.5.3.jar
javassist-3.15.0-GA.jar
zookeeper-3.4.6.jar
zkclient-0.1.jar
jline-0.9.94.jar
netty-3.7.0-Final.jar
slf4j-api-1.7.5.jar
log4j-over-slf4j-1.7.5.jar
</code></pre>

<h3 id="插件使用">插件使用</h3>

<p>启动<code>Jmeter</code>添加<code>DubboSample</code>如下图：</p>

<p><img src="https://ningyu1.github.io/site/img/jmeter-plugins-dubbo/1.png" alt="" /></p>

<p>添加后能看到<code>DubboSample</code>的具体操作页面，如下图：</p>

<p><img src="https://ningyu1.github.io/site/img/jmeter-plugins-dubbo/2.png" alt="" /></p>

<p>根据上图提示传入值即可。</p>

<p>接口以及接口依赖包请添加到<code>classpath</code>下，可以放在<code>apache-jmeter-3.0\lib\ext</code>下，也可以通过下图方式添加：</p>

<p><img src="https://ningyu1.github.io/site/img/jmeter-plugins-dubbo/3.png" alt="" /></p>

<h3 id="运行结果">运行结果</h3>

<p><img src="https://ningyu1.github.io/site/img/jmeter-plugins-dubbo/4.png" alt="" /></p>

<p><img src="https://ningyu1.github.io/site/img/jmeter-plugins-dubbo/5.png" alt="" /></p>

<p><img src="https://ningyu1.github.io/site/img/jmeter-plugins-dubbo/6.png" alt="" /></p>

<h3 id="注意事项">注意事项</h3>

<ol>
<li>当使用zk，address填入zk地址（集群地址使用&rdquo;,&ldquo;分隔）,使用dubbo直连，address填写直连地址和服务端口</li>
<li><code>timeout</code>：服务方法调用超时时间(毫秒)</li>
<li><code>version</code>：服务版本，与服务提供者的版本一致</li>
<li><code>retries</code>：远程服务调用重试次数，不包括第一次调用，不需要重试请设为0</li>
<li><code>cluster</code>：集群方式，可选：failover/failfast/failsafe/failback/forking</li>
<li>接口需要填写类型完全名称，含包名</li>
<li>参数支持任何类型，包装类直接使用<code>java.lang</code>下的包装类，小类型使用：<code>int、float、shot、double、long、byte、boolean、char</code>，自定义类使用类完全名称。</li>
<li>参数值，基础包装类和基础小类型直接使用值，例如：int为1，boolean为true等，自定义类与<code>List</code>或者<code>Map</code>等使用json格式数据。</li>
<li>更多dubbo参数查看官方文档：<a href="http://dubbo.io/books/dubbo-user-book/references/xml/dubbo-reference.html">http://dubbo.io/books/dubbo-user-book/references/xml/dubbo-reference.html</a></li>
</ol>

<p>到这里插件的就介绍完了。世界和平、keep real！</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/60-jmeter-plugins-dubbo-support/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/59-py2exe-pyinstaller/">如何将Python脚本打包成可执行文件？</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-02-07T11:57:49.000&#43;00:00' itemprop="datePublished">2018-02-07</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/python">python</a>

<a href="https://ningyu1.github.io/site/tags/py2exe">py2exe</a>

<a href="https://ningyu1.github.io/site/tags/pyinstaller">pyinstaller</a>

<a href="https://ningyu1.github.io/site/tags/bbfreeze">bbFreeze</a>

<a href="https://ningyu1.github.io/site/tags/cx_freeze">cx_Freeze</a>

<a href="https://ningyu1.github.io/site/tags/py2app">py2app</a>


</div>
    </div>
        

<p>我们有时候经常会使用<code>python</code>写一些小工具，在<code>Linux</code>环境下可以很方便运行，因为<code>Linux</code>默认都会有<code>python</code>环境，我们只需要添加<code>python</code>脚本依赖的类库即可执行。但是有的时候我们需要把小工具给到一些麻瓜去用的时候就会出现一些问题，他们大多是在<code>Windows</code>上运行工具，那就必须要先准备<code>python</code>的可运行环境才行，这就给麻瓜们带来了使用成本，我们能否将<code>python</code>脚本打包成windows下可执行文件呢？</p>

<p>接下来让我们先了解一下<code>python</code>有哪些类库可以帮助我们解决这个问题。</p>

<p>这是一个来自<strong>Freezing Your Code</strong>的统计</p>

<table>
<thead>
<tr>
<th align="center">Solution</th>
<th align="center">Windows</th>
<th align="center">Linux</th>
<th align="center">OS X</th>
<th align="center">Python 3</th>
<th align="center">License</th>
<th align="center">One-file mode</th>
<th align="center">Zipfile import</th>
<th align="center">Eggs</th>
<th align="center">pkg_resources support</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">bbFreeze</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">no</td>
<td align="center">MIT</td>
<td align="center">no</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">yes</td>
</tr>

<tr>
<td align="center">py2exe</td>
<td align="center">yes</td>
<td align="center">no</td>
<td align="center">no</td>
<td align="center">yes</td>
<td align="center">MIT</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">no</td>
<td align="center">no</td>
</tr>

<tr>
<td align="center">pyInstaller</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">GPL</td>
<td align="center">yes</td>
<td align="center">no</td>
<td align="center">yes</td>
<td align="center">no</td>
</tr>

<tr>
<td align="center">cx_Freeze</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">PSF</td>
<td align="center">no</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">no</td>
</tr>

<tr>
<td align="center">py2app</td>
<td align="center">no</td>
<td align="center">no</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">MIT</td>
<td align="center">no</td>
<td align="center">yes</td>
<td align="center">yes</td>
<td align="center">yes</td>
</tr>
</tbody>
</table>

<p>我们能看到有很多类库都可以解决我们的问题，其中<code>pyInstaller</code>、<code>cx_Freeze</code>、<code>bbFreeze</code>都不错，pkg_resources新版的<code>pyInstaller</code>貌似是支持的。</p>

<p>我们这里选用<code>pyInstaller</code>尝试一下，因为它各方面支持的是最好的。</p>

<h1 id="pyinstaller原理介绍">PyInstaller原理介绍</h1>

<p><code>PyInstaller</code>其实就是把<code>python</code>解析器和脚本以及脚本的依赖库打包成一个可执行的文件，这和编译成真正的机器码是两回事，所以通过<code>PyInstaller</code>打包成一个可执行文件可能不会提高运行效率，相反可能会降低运行效率，但是它带来的好处就是在运行者的机器上不用安装<code>python</code>和你的脚本依赖的库。在<code>Linux</code>操作系统下，它主要用的<code>binutil</code>工具包里面的<code>ldd</code>和<code>objdump</code>命令。</p>

<p><code>PyInstaller</code>输入你指定的的脚本，首先分析脚本所依赖的其他脚本，然后去查找，复制，把所有相关的脚本收集起来，包括<code>Python</code>解析器，然后把这些文件放在一个目录下，再打包进一个可执行文件里。</p>

<p>这样就可以直接发布输出整个文件夹里面的文件，或者生成可执行文件。你只需要告诉用户，你的App是自我包含的，不需要安装其他包，或某个版本的<code>Python</code>，就可以直接运行。</p>

<p>但是需要注意的是，<code>PyInstaller</code>打包的执行文件，只能在和打包机器系统同样的环境下运行。它不具备可移植性，若需要在不同系统上运行，就必须针对不同平台进行打包。</p>

<h1 id="安装pyinstaller">安装PyInstaller</h1>

<p>网络情况可以的话使用<code>pip</code>安装还是很方便的。</p>

<pre><code>pip install pyinstaller
</code></pre>

<p>如果网络不稳定，尤其在天朝访问墙外站点是很痛苦的，我们还可以通过下载源码包来安装。</p>

<pre><code># 在源码包的根目录下执行
python setup.py install
</code></pre>

<p>安装完成后，检查安装版本。</p>

<pre><code>pyinstaller --version
</code></pre>

<h1 id="使用pyinstaller进行打包">使用PyInstaller进行打包</h1>

<p><code>pyinstaller</code>的语法</p>

<pre><code>pyinstaller [options] script [script ...] | specfile
</code></pre>

<p>具体命令如何使用可以通过help或<a href="http://pythonhosted.org/PyInstaller/usage.html">官方文档</a>去查询具体的用法。</p>

<p>我这里只说几个注意的点。</p>

<p><code>-F, --onefile  Create a one-file bundled executable.</code>创建一个可执行文件</p>

<p><code>-w, --windowed, --noconsole</code>去除黑框</p>

<pre><code># A path to search for imports (like using PYTHONPATH). Multiple paths are allowed, separated by ‘:’, or use this option multiple times

-p DIR, --paths DIR
</code></pre>

<p>设置一个可搜索的入口路径，怎么理解呢？如果不指定这个参数打包出来的文件只能在生成它的目录下运行，如果打包时指定参数为<code>-p .</code>打包出来的文件可以放在任意路径下运行，如下示例：</p>

<pre><code>pyinstaller -w -F -p . your.py
</code></pre>

<h1 id="参考资料">参考资料</h1>

<ul>
<li><a href="http://docs.python-guide.org/en/latest/shipping/freezing/#comparison-of-freezing-tools">Freezing Your Code</a></li>
<li><a href="http://pythonhosted.org/PyInstaller/usage.html">PyInstaller官方WIKI</a></li>
<li><a href="https://github.com/pyinstaller/pyinstaller">PyInstaller Github</a></li>
</ul>

<p>到这里<code>PyInstaller</code>就简单介绍完毕，感兴趣的可以试一试，我以前使用的是<code>py2exe</code>，其实<code>py2exe</code>也蛮好只不过它需要创建一个<code>py</code>脚本来把需要打包的脚本包含进去，用起来没有<code>PyInstaller</code>方便，希望这个简单的入门可以帮助到需要的朋友。</p>

<p>Keep Real！</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/59-py2exe-pyinstaller/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/58-git-ssh/">Git SSH Key settings and passphrase reset</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-01-30T16:10:20.000&#43;00:00' itemprop="datePublished">2018-01-30</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/git">git</a>

<a href="https://ningyu1.github.io/site/tags/github">github</a>

<a href="https://ningyu1.github.io/site/tags/ssh-key">ssh key</a>

<a href="https://ningyu1.github.io/site/tags/passphrase">passphrase</a>


</div>
    </div>
        

<p>在使用github仓库的时候我们经常会看到<code>clone</code>有两种方式:<code>https</code>、<code>ssh</code>，<code>https</code>的方式使用起来非常简单但是每次在<code>pull</code>、<code>push</code>的时候需要输入密码，一两次还可以忍受但是作为常态是有点崩溃的，这个时候我们可以使用<code>ssh</code>的方式，<code>ssh</code>的好处就是在<code>pull</code>、<code>push</code>的时候可以使用密码也可以不使用密码，但是前提是要设置好<code>ssh key</code>，如果你是<code>Repository</code>的管理员那很好设置，如果不是管理员那就老老实实的使用<code>https</code>的方式，下来我们就说一下使用<code>ssh</code>遇到的问题。</p>

<h1 id="修改用户主目录-home">修改用户主目录（home）</h1>

<p>当出现下图问题时：</p>

<p><img src="https://ningyu1.github.io/site/img/git-ssh/1.png" alt="" /></p>

<p>是说明你的.ssh目录设置的有问题，关于用户主目录（home）的问题，一般windows机器安装完git后home都会是<code>C:\Users\用户名</code>这种目录，但是打开Git bash时它无法识别home目录使用到了其他莫名其妙的目录（有的时候会是不存在的目录或是网络盘符），在这个时候就需要变更home目录，变更的方法如下：</p>

<p>环境：windows</p>

<h2 id="git-version-1-x系列">Git version 1.x系列</h2>

<p>如果是Git version 1.x系列，打开profile文件，文件位置：<code>$\Git\etc\profile</code>（$替换成你的盘符）。
在profile中找到：<code>HOME=&quot;$(cd &quot;$HOME&quot; ; pwd)&quot;</code>这个位置，在前面增加你想变成的home目录，例如：</p>

<pre><code># normalize HOME to unix path
HOME=&quot;C:\Users\用户名&quot;
HOME=&quot;$(cd &quot;$HOME&quot; ; pwd)&quot;

export PATH=&quot;$HOME/bin:$PATH&quot;

export GNUPGHOME=~/.gnupg
</code></pre>

<p>当修改好之后，重启Git bash即可，输入<code>cd ~/.ssh</code>，会进入你设置好的目录，在这个目录下生成相关的配置文件，如：.ssh、.gnupg、.bash_history、.gitconfig等，如果以前已经有这些文件可以copy到这个目录下直接使用。</p>

<h2 id="git-version-2-x系列">Git version 2.x系列</h2>

<p>如果是Git version 2.x系列，请设置环境变量，增加HOME的环境变量，目录为：<code>C:\Users\用户名</code>（你想设置的目录），随后重启Git bash即可，输入<code>cd ~/.ssh</code>，会进入你设置好的目录。</p>

<p>按照上面步骤修改好之后，出现下图所示就证明修改完成了。如：</p>

<p><img src="https://ningyu1.github.io/site/img/git-ssh/2.png" alt="" /></p>

<h1 id="ssh-key设置">ssh key设置</h1>

<p>输入<code>cd ~/.ssh</code>进入home目录使用如下如下方法生成ssh key</p>

<ul>
<li>可以在Git bash中使用<code>ssh-keygen</code>生成ssh key</li>
<li>还可以使用eclipse的ssh2工具生成，操作如下：Window -&gt; Preferences -&gt; General -&gt; Network Connections -&gt; SSH -&gt; Key Management -&gt; Generate RSA Key</li>
<li>还可以使用TortoiseGit的PuTTY Key Generator工具生成。</li>
</ul>

<p>方法有很多，生成好的private key用文本编辑器打开复制出来，粘贴到git hub的settings中即可，操作如下：github -&gt; Settings -&gt; SSH and GPG keys -&gt; New SSH key，起个名字粘贴key然后保存即可。</p>

<h1 id="每次都输入passphrase问题">每次都输入passphrase问题</h1>

<p>当我们在第一次<code>git clone</code>的时候会提示<code>Enter passphrase</code>，这个时候如果输入了密码，那以后<code>pull</code>、<code>push</code>都需要输入这个密码，就像我下图这样：</p>

<p><img src="https://ningyu1.github.io/site/img/git-ssh/3.png" alt="" /></p>

<p>我们使用ssh就是图个方便不想输入密码，出现这个问题怎么办呢？</p>

<p>在第一次<code>git clone</code>的时候提示<code>Enter passphrase</code>的时候不要输入密码，直接回车即可，如果输入了密码那就需要重置密码才能解决这个问题。</p>

<h2 id="重置passphrase">重置passphrase</h2>

<p>打开Git bash使用如下命令重置密码</p>

<pre><code>ssh-keygen -p
</code></pre>

<p>输入后根据下图提示操作：</p>

<p><img src="https://ningyu1.github.io/site/img/git-ssh/4.png" alt="" /></p>

<p>这样就完成了重置密码为空的操作了，后面再<code>pull</code>、<code>push</code>的时候都不会再提示输入密码。</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/58-git-ssh/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/about/">关于凝雨</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-01-30T11:03:36.000&#43;00:00' itemprop="datePublished">2018-01-30</time>
</div>
        <div class="tags">Tags: 
</div>
    </div>
        

<p>大家好，我是凝雨，我不是高手，我也不是牛人，我只是单纯的喜欢编程，我觉得做任何事情还是要跟着自己的心走。</p>

<h1 id="网络信息">网络信息</h1>

<ul>
<li>Blog: <a href="https://ningyu1.github.io/blog/index.html">https://ningyu1.github.io/blog/index.html</a></li>
<li>Email： ningbe111@163.com &amp;&amp; ningbe111@gmail.com</li>
<li>GitHub：<a href="https://github.com/ningyu1">https://github.com/ningyu1</a></li>

<li><p>座右铭：</p>

<p>十年饮冰，难凉热血</p>

<p>心无杂念，快乐编程</p>

<p>世界和平，Keep Real</p></li>
</ul>

<h1 id="个人介绍">个人介绍</h1>

<p>我是一个技术型带管理经验的IT从业者，目前在生鲜冷链供应链领域做架构师，擅长底层技术架构，框架编写，团队管理。对分布式、微服务、高并发、高性能、高可用有丰富经验积累和心得体会，喜欢在开源社区游走主要以学习为目的，保持空杯心态学无止境，写代码的时候有洁癖，完美主义者。</p>

<p>兴趣爱好：</p>

<ul>
<li>钓鱼（越来越专业）</li>
<li>羽毛球（打的一般吧）</li>
<li>台球（偶尔会一杆清）</li>
<li>足球（和老友们没事会踢一场）</li>
<li>唱歌（闲暇时会录几首歌）</li>
<li>看书（技术类、文学类书籍）</li>
</ul>

<h1 id="我的微信">我的微信</h1>

<p><img src="https://ningyu1.github.io/site/img/about/wechat.jpg" alt="" /></p>

<p><strong>ps.添加时请备注来源博客，技术讨论否则拒绝</strong></p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/about/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/57-cas-server1/">CAS Server强制踢人功能实现方式</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-01-26T15:07:36.000&#43;00:00' itemprop="datePublished">2018-01-26</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/cas">CAS</a>

<a href="https://ningyu1.github.io/site/tags/slo">SLO</a>

<a href="https://ningyu1.github.io/site/tags/single-logout">Single Logout</a>

<a href="https://ningyu1.github.io/site/tags/ticket">Ticket</a>

<a href="https://ningyu1.github.io/site/tags/ticket-registry">Ticket Registry</a>

<a href="https://ningyu1.github.io/site/tags/session-centralized-storage">Session Centralized Storage</a>

<a href="https://ningyu1.github.io/site/tags/cookie">Cookie</a>

<a href="https://ningyu1.github.io/site/tags/cas-cluster">CAS Cluster</a>

<a href="https://ningyu1.github.io/site/tags/cas-server">CAS Server</a>

<a href="https://ningyu1.github.io/site/tags/forcelogout">ForceLogout</a>


</div>
    </div>
        

<p>前面写过一篇关于CAS Server使用的经验总结，主要总结了CAS Server在使用的时候遇到的一些常见问题，比如说：证书、SLO、集群session处理、自定义用户认证、Ticket持久化等问题，传送门：<a href="https://ningyu1.github.io/site/post/54-cas-server/">CAS使用经验总结，纯干货</a>，这次在基础上又增加了一个很常见很普通的问题，那就是踢人功能。</p>

<p>在管理系统这个领域里面踢人功能并不陌生，为了更好的管理用户串用账号，安全等方面考虑，接下来我们就细说一下CAS如何实现踢人的功能。</p>

<p>先说一下踢人功能的场景：</p>

<p>用户A在机器A上登录了APP1，用户A在机器B上登录APP1，在这种情况下后者登录需要踢掉前者的登录状态。</p>

<p>用户A在机器A上登录了APP1，用户B在机器B上登录了APP1，在这种情况下不存在踢人操作。</p>

<p>用户A在机器A上登录了APP1，用户A在机器B上登录了APP2，在这种情况下要分情况了，可以踢也可以不踢，这个就根据产品情况来选择，我们本次测试不能解决这个场景，如何解决我还在摸索中。</p>

<p>要做踢人功能之前先了解一下CAS的认证授权机制是如何完成的？</p>

<p>我这里直接引用官网的架构图：</p>

<p><img src="https://ningyu1.github.io/site/img/cas/1.png" alt="" /></p>

<p>CAS Server与应用的Session交互图：</p>

<p><img src="https://ningyu1.github.io/site/img/cas/2.png" alt="" /></p>

<p>其实CAS就是生成维护Ticket信息和应用session做绑定，当然它的Ticket实现还是比较复杂的，有树形关系以及和Service关联关系，从Ticket的源码能看的出来它有root的判断和Service的映射列表。</p>

<p>根据上面对CAS的理解，接下来我们说CAS怎么操作踢人功能？</p>

<h1 id="踢人功能实现思路">踢人功能实现思路</h1>

<p>在登录认证的时候记录一下，在下次登录获取到登录的人员列表，然后去匹配找出是否存在相同的用户，如果存在相同的用户，就注销掉这个用户的登录信息，这个是常规的思路和做法，但是在CAS里如何去找到切入点来进行判断操作呢？</p>

<p>我们在上一篇中提到了自定义认证逻辑，那么我们就可以继续在认证的这个切入点去进一步分析。</p>

<p>这里要先搞清楚一个概念：<code>Authentication</code>和<code>Authorization</code>这两者是不同的。</p>

<p><code>Authentication</code>：字面意思认证，怎么理解这个认证呢？举个例子：我们每个人都有身份证，比如你去买火车票，买火车票需要出示身份证，那这个身份证就是证明你是你自己的凭证，那这个证明的过程就是认证。</p>

<p><code>Authorization</code>：字面意思授权，怎么理解这个授权呢？举个例子：继续拿买火车票来说，你刚才出示了身份证证明了你自己，然后给了钱买了一张火车票，铁道部给了你一张票，这个票授权了你可以乘坐X车次X座位的权限其他车次你无权乘坐，那么这张票就是证明你确实买了X车次X座位的凭证，这就是授权。</p>

<p>换回系统的角度来说，认证就是验证用户名密码，授权就是验证你能不能操作某个功能的权限。</p>

<p>理解完认证和授权的区别，我们就开始从认证这块的切入点去看如何操作，CAS提供了这个类<code>TicketRegistry</code>它是管理所有<code>Ticket</code>的接口，通过调用<code>TicketRegistry.getTickets()</code>方法可以获取到所有认证用户的凭证。</p>

<pre><code>/**
 * Retrieve all tickets from the registry.
 *
 * @return collection of tickets currently stored in the registry. Tickets
 * might or might not be valid i.e. expired.
 */
Collection&lt;Ticket&gt; getTickets();
</code></pre>

<p>那有了凭证信息就好更进一步操作。</p>

<p>CAS提供了<code>TicketGrantingTicket</code>，这个类是<code>Ticket</code>接口的一个实现类，可以通过<code>TicketGrantingTicket.getAuthentication().getPrincipal().getId()</code>来获取用户的身份。</p>

<pre><code>/**
 * @return the unique id for the Principal
 */
String getId();
</code></pre>

<p><code>getId()</code>返回的是登录的用户名，那拿到了用户名就要考虑如何注销的事情了。</p>

<p>刚才说到了它<code>TicketGrantingTicket</code>是<code>Ticket</code>接口的实现类，它的<code>t.markTicketExpired()</code>方法就是标记<code>Ticket</code>过期的动作。</p>

<pre><code>/**
 * Mark a ticket as expired.
 */
void markTicketExpired();
</code></pre>

<p>光标记过期还不能完成注销操作，还需要通过<code>ticketRegistry.deleteTicket(t.getId())</code>来删除<code>Ticket</code>信息。</p>

<pre><code>/**
 * Remove a specific ticket from the registry.
 * If ticket to delete is TGT then related service tickets are removed as well.
 *
 * @param ticketId The id of the ticket to delete.
 * @return the number of tickets deleted including children.
 */
int deleteTicket(String ticketId);
</code></pre>

<p>上面的分析过程看上去是可行的，那我们就来测试一下是否可以达到踢人功能的目的。</p>

<h1 id="踢人功能实现过程">踢人功能实现过程</h1>

<p>话不多说直接帖实现代码</p>

<pre><code>/**
 * 登录成功，踢掉前一个相同登录的人
 * 
 * @param username
 */
public void forceLogout(final String username) {
	TicketRegistry ticketRegistry = (TicketRegistry) ApplicationContextProvider.getApplicationContext().getBean(&quot;ticketRegistry&quot;);
	final Collection&lt;Ticket&gt; ticketsInCache = ticketRegistry.getTickets();
	for (final Ticket ticket : ticketsInCache) {
		TicketGrantingTicket t = null;
		try {
			log.info(&quot;cast TicketGrantingTicketImpl&quot;);
			t = (TicketGrantingTicketImpl) ticket;
		} catch (Exception e) {
			log.error(&quot;cast TicketGrantingTicketImpl is error:&quot;, e);
			t = ((ServiceTicketImpl) ticket).getGrantingTicket();
		}
		if (t.getAuthentication().getPrincipal().getId().equals(username) &amp;&amp; t.getId() != null) {
			/***
			 * 注销方法一 涉及到cookie的删除，但是无法获取response 该方法有待考究 未测试
			 */
			// centralAuthenticationService.destroyTicketGrantingTicket(t.getId());
			/***
			 * 注销方法二
			 */
			// t.expire();
			t.markTicketExpired();
			ticketRegistry.deleteTicket(t.getId());
		}
	}
}
</code></pre>

<p>上面的代码放到认证的切入点上调用，切入的位置如下：</p>

<ol>
<li>项目：<code>cas-site</code></li>
<li>类：<code>org.apereo.cas.adaptors.jdbc.QueryAndEncodeDatabaseAuthenticationHandler</code></li>
<li>方法：<code>authenticateUsernamePasswordInternal()</code>的<code>createHandlerResult()</code>之前调用。</li>
</ol>

<p>代码如下：</p>

<pre><code>@Override
protected HandlerResult authenticateUsernamePasswordInternal(final UsernamePasswordCredential transformedCredential)
        throws GeneralSecurityException, PreventedException {

    if (StringUtils.isBlank(this.sql) || StringUtils.isBlank(this.algorithmName) || getJdbcTemplate() == null) {
        throw new GeneralSecurityException(&quot;Authentication handler is not configured correctly&quot;);
    }

    final String username = transformedCredential.getUsername();
    try {
        // Get password and salt
        final Map&lt;String, Object&gt; rows = getJdbcTemplate().queryForMap(this.sql, username);
        final String encodedPassword = rows.get(&quot;password&quot;).toString();
        final String dbSalt = rows.get(&quot;salt&quot;).toString();
        SaltPasswordEncoder passwordEncoder = new SaltPasswordEncoder();
        passwordEncoder.setSalt(dbSalt);
        if (!passwordEncoder.matches(transformedCredential.getPassword(), encodedPassword)) {
            throw new FailedLoginException(&quot;Password does not match value on record.&quot;);
        }
		// 登录成功，踢掉前一个相同登录的人
        forceLogout(username);
        return createHandlerResult(transformedCredential, this.principalFactory.createPrincipal(username), null);

    } catch (final IncorrectResultSizeDataAccessException e) {
        if (e.getActualSize() == 0) {
            throw new AccountNotFoundException(username + &quot; not found with SQL query&quot;);
        } else {
            throw new FailedLoginException(&quot;Multiple records found for &quot; + username);
        }
    } catch (final DataAccessException e) {
        throw new PreventedException(&quot;SQL exception while executing query for &quot; + username, e);
    }

}
</code></pre>

<p>cas-site项目我已经放入到了github，在这篇<a href="https://ningyu1.github.io/site/post/54-cas-server/">《CAS使用经验总结，纯干货》</a>博文中可以找到。</p>

<p>万事俱备只欠东风了，接下来就是启动程序来验证它。</p>

<p>理想很美好，现实很骨感，出现了如下错误：</p>

<pre><code>javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably process 'remove' call
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:282) ~[spring-orm-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at com.sun.proxy.$Proxy175.remove(Unknown Source) ~[?:?]
	at org.apereo.cas.ticket.registry.JpaTicketRegistry.removeTicket(JpaTicketRegistry.java:72) ~[cas-server-support-jpa-ticket-registry-5.0.4.jar:5.0.4]
	at org.apereo.cas.ticket.registry.JpaTicketRegistry.deleteTicketsFromResultList(JpaTicketRegistry.java:214) ~[cas-server-support-jpa-ticket-registry-5.0.4.jar:5.0.4]
	at org.apereo.cas.ticket.registry.JpaTicketRegistry.deleteTicketGrantingTickets(JpaTicketRegistry.java:244) ~[cas-server-support-jpa-ticket-registry-5.0.4.jar:5.0.4]
	at org.apereo.cas.ticket.registry.JpaTicketRegistry.deleteSingleTicket(JpaTicketRegistry.java:158) ~[cas-server-support-jpa-ticket-registry-5.0.4.jar:5.0.4]
	at org.apereo.cas.ticket.registry.AbstractTicketRegistry.deleteTicket(AbstractTicketRegistry.java:125) ~[cas-server-core-tickets-5.0.4.jar:5.0.4]
	at org.apereo.cas.ticket.registry.AbstractTicketRegistry$$FastClassBySpringCGLIB$$d3c67a11.invoke(&lt;generated&gt;) ~[cas-server-core-tickets-5.0.4.jar:5.0.4]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:651) ~[spring-aop-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.apereo.cas.ticket.registry.JpaTicketRegistry$$EnhancerBySpringCGLIB$$b6d104b8.deleteTicket(&lt;generated&gt;) ~[cas-server-support-jpa-ticket-registry-5.0.4.jar:5.0.4]
	at org.apereo.cas.ticket.registry.AbstractTicketRegistry$$FastClassBySpringCGLIB$$d3c67a11.invoke(&lt;generated&gt;) ~[cas-server-core-tickets-5.0.4.jar:5.0.4]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:651) ~[spring-aop-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.apereo.cas.ticket.registry.JpaTicketRegistry$$EnhancerBySpringCGLIB$$ef44b76a.deleteTicket(&lt;generated&gt;) ~[cas-server-support-jpa-ticket-registry-5.0.4.jar:5.0.4]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_31]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_31]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_31]
	at java.lang.reflect.Method.invoke(Method.java:483) ~[?:1.8.0_31]
</code></pre>

<p><strong>ps.异常堆栈很长我只截了一部分展示出来。</strong></p>

<p>这个错误是个什么鬼？从异常字面理解：在当前的线程中没有找到可用的事务，无法处理“删除”调用。</p>

<p>这个错误是<code>JPA</code>的错误，因为我的<code>Ticket Registry</code>配置的是<code>JPA</code>的方式，我猜测换成其他方式也会有类似的错误，我去掉<code>JPA</code>采用<code>InMemroy</code>的方式处理<code>Ticket Registry</code>，再次进行测试。</p>

<p>果然出现了类似的错误，如下：</p>

<pre><code>javax.persistence.TransactionRequiredException: no transaction is in progress
	at org.hibernate.internal.SessionImpl.checkTransactionNeeded(SessionImpl.java:3428) ~[hibernate-core-5.2.2.Final.jar:5.2.2.Final]
	at org.hibernate.internal.SessionImpl.find(SessionImpl.java:3362) ~[hibernate-core-5.2.2.Final.jar:5.2.2.Final]
	at org.hibernate.internal.SessionImpl.find(SessionImpl.java:3342) ~[hibernate-core-5.2.2.Final.jar:5.2.2.Final]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_31]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_31]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_31]
	at java.lang.reflect.Method.invoke(Method.java:483) ~[?:1.8.0_31]
	at org.springframework.orm.jpa.ExtendedEntityManagerCreator$ExtendedEntityManagerInvocationHandler.invoke(ExtendedEntityManagerCreator.java:347) ~[spring-orm-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at com.sun.proxy.$Proxy175.find(Unknown Source) ~[?:?]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_31]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_31]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_31]
	at java.lang.reflect.Method.invoke(Method.java:483) ~[?:1.8.0_31]
	at org.springframework.orm.jpa.SharedEntityManagerCreator$SharedEntityManagerInvocationHandler.invoke(SharedEntityManagerCreator.java:298) ~[spring-orm-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at com.sun.proxy.$Proxy175.find(Unknown Source) ~[?:?]
</code></pre>

<p>说白了就是没有开启事务被禁止操作了。</p>

<p>这个怎么解决？cas-site采用的是<code>overlays</code>的方式构建，要看具体功能就要翻CAS的源码来看它是如何控制事务的。</p>

<p>于是去翻CAS的源码，翻源码也要讲究技巧的，要不然翻一天都翻不到关键点。</p>

<p>我们这里需要找如何开启事务的代码，还好CAS使用的是<code>Spring</code>来管理事务的，<code>Spring</code>的事务开启无非就这两种：一种是<code>AOP</code>方式，一种是手动方式。</p>

<p>那么<code>AOP</code>的方式可以使用注解（<code>Annotation</code>）也可以使用<code>XML</code>的配置去做。</p>

<p>CAS v5.0.4使用的<code>Spring Boot</code>的方式构建，说白了就是使用编程（<code>Java Config</code>）的方式替换<code>XML</code>的配置方式。而且我们使用的<code>Ticket Registry</code>是<code>JPA</code>，<code>JPA</code>的操作肯定要处理事务的，因此我们就锁定到注解（<code>Annotation</code>）的方式和<code>JPA</code>的实现上去找。</p>

<p>最终目标定位到了<code>cas-server-support-jpq-ticket-registry-5.0.4.jar</code>这个包上。</p>

<p>查看这个包的<code>org.apereo.cas.ticket.registry.JpaTicketRegistry</code>类代码</p>

<pre><code>/**
 * JPA implementation of a CAS {@link TicketRegistry}. This implementation of
 * ticket registry is suitable for HA environments.
 *
 * @author Scott Battaglia
 * @author Marvin S. Addison
 * @since 3.2.1
 */
@EnableTransactionManagement(proxyTargetClass = true)
@Transactional(transactionManager = &quot;ticketTransactionManager&quot;, readOnly = false)
public class JpaTicketRegistry extends AbstractTicketRegistry {
.....................其余的省略..............................
}
</code></pre>

<p>很明显就是我们说的注解（<code>Annotation</code>）的使用方式，我们再次修改代码。</p>

<h2 id="踢人功能代码重构">踢人功能代码重构</h2>

<p><code>@EnableTransactionManagement(proxyTargetClass = true)</code>开启代理的方式，那我们就要抽一个接口和一个实现类来做，这里的具体原因就不多说了做多了都明白。</p>

<p><code>@Transactional(transactionManager = &quot;ticketTransactionManager&quot;, readOnly = false)</code>在实现类上直接使用这个注解方式。</p>

<p>直接贴重构后的代码：</p>

<p>新建接口<code>ForceLogoutManager</code></p>

<pre><code>public interface ForceLogoutManager {

	public void doLogout(final String username);
}
</code></pre>

<p>新建实现类<code>ForceLogoutManagerImpl</code></p>

<pre><code>import java.util.Collection;
import org.apereo.cas.ticket.ServiceTicketImpl;
import org.apereo.cas.ticket.Ticket;
import org.apereo.cas.ticket.TicketGrantingTicket;
import org.apereo.cas.ticket.TicketGrantingTicketImpl;
import org.apereo.cas.ticket.registry.TicketRegistry;
import org.apereo.cas.util.ApplicationContextProvider;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.stereotype.Component;
import org.springframework.transaction.annotation.EnableTransactionManagement;
import org.springframework.transaction.annotation.Transactional;

@EnableTransactionManagement(proxyTargetClass = true)
@Transactional(transactionManager = &quot;ticketTransactionManager&quot;, readOnly = false)
@Component(&quot;forceLogoutManager&quot;)
public class ForceLogoutManagerImpl implements ForceLogoutManager {
	
	private final Logger log = LoggerFactory.getLogger(this.getClass());

	/**
	 * 登录成功，踢掉前一个相同登录的人
	 * 
	 * @param username
	 */
	public void doLogout(final String username) {
		TicketRegistry ticketRegistry = (TicketRegistry) ApplicationContextProvider.getApplicationContext()
				.getBean(&quot;ticketRegistry&quot;);
		final Collection&lt;Ticket&gt; ticketsInCache = ticketRegistry.getTickets();
		for (final Ticket ticket : ticketsInCache) {
			TicketGrantingTicket t = null;
			try {
				log.info(&quot;cast TicketGrantingTicketImpl&quot;);
				t = (TicketGrantingTicketImpl) ticket;
			} catch (Exception e) {
				log.error(&quot;cast TicketGrantingTicketImpl is error:&quot;, e);
				t = ((ServiceTicketImpl) ticket).getGrantingTicket();
			}
			if (t.getAuthentication().getPrincipal().getId().equals(username) &amp;&amp; t.getId() != null) {
				/***
				 * 注销方法一 涉及到cookie的删除，但是无法获取response 该方法有待考究 未测试
				 */
				// centralAuthenticationService.destroyTicketGrantingTicket(t.getId());
				/***
				 * 注销方法二
				 */
				// t.expire();
				t.markTicketExpired();
				ticketRegistry.deleteTicket(t.getId());
			}
		}
	}
}
</code></pre>

<p>修改<code>org.apereo.cas.adaptors.jdbc.QueryAndEncodeDatabaseAuthenticationHandler</code>类<code>authenticateUsernamePasswordInternal</code>方法</p>

<pre><code>public ForceLogoutManager getForceLogoutManager() {
	return (ForceLogoutManager) ApplicationContextProvider.getApplicationContext().getBean(&quot;forceLogoutManager&quot;);
}

@Override
protected HandlerResult authenticateUsernamePasswordInternal(final UsernamePasswordCredential transformedCredential)
        throws GeneralSecurityException, PreventedException {

    if (StringUtils.isBlank(this.sql) || StringUtils.isBlank(this.algorithmName) || getJdbcTemplate() == null) {
        throw new GeneralSecurityException(&quot;Authentication handler is not configured correctly&quot;);
    }

    final String username = transformedCredential.getUsername();
    try {
        // Get password and salt
        final Map&lt;String, Object&gt; rows = getJdbcTemplate().queryForMap(this.sql, username);
        final String encodedPassword = rows.get(&quot;password&quot;).toString();
        final String dbSalt = rows.get(&quot;salt&quot;).toString();
        SaltPasswordEncoder passwordEncoder = new SaltPasswordEncoder();
        passwordEncoder.setSalt(dbSalt);
        if (!passwordEncoder.matches(transformedCredential.getPassword(), encodedPassword)) {
            throw new FailedLoginException(&quot;Password does not match value on record.&quot;);
        }
		// 登录成功，踢掉前一个相同登录的人
        getForceLogoutManager().doLogout(username);
        return createHandlerResult(transformedCredential, this.principalFactory.createPrincipal(username), null);

    } catch (final IncorrectResultSizeDataAccessException e) {
        if (e.getActualSize() == 0) {
            throw new AccountNotFoundException(username + &quot; not found with SQL query&quot;);
        } else {
            throw new FailedLoginException(&quot;Multiple records found for &quot; + username);
        }
    } catch (final DataAccessException e) {
        throw new PreventedException(&quot;SQL exception while executing query for &quot; + username, e);
    }

}
</code></pre>

<p>再次启动测试。</p>

<p>很顺利调用没有任何问题，到这里基于CAS v5.0.4的踢人功能的处理过程就整理完毕了。</p>

<p>最后还有一句话，我的愿望是：世界和平，快乐编程每一天，keep real！</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/57-cas-server1/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/56-websocket-ssl/">Trouble Shooting —— HTTPS(SSL)站点使用WebSocket(ws)出现SecurityError问题</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-01-25T17:04:36.000&#43;00:00' itemprop="datePublished">2018-01-25</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/websocket">WebSocket</a>

<a href="https://ningyu1.github.io/site/tags/ssl">ssl</a>

<a href="https://ningyu1.github.io/site/tags/wss">wss</a>

<a href="https://ningyu1.github.io/site/tags/ws">ws</a>

<a href="https://ningyu1.github.io/site/tags/securityerror">SecurityError</a>


</div>
    </div>
        

<p>最近发生了一个问题我觉得挺有意思的，所以针对这个问题总结一下。</p>

<p>最近公司服务上了https(SSL)，在https(SSL)的环境下呢本因为可以愉快的玩耍，但是后来发现程序有使用websocket（ws://domain.com），这里就有朋友想了使用ws跟ssl有什么关系？我可以很明确的告诉你当然有关系。</p>

<p>当你的站点使用的是http的时候，使用ws可以很愉快的玩耍。当换成了https(SSL)那么问题来了。</p>

<p>在chrome下是测试没有问题可以正常使用，但是在ie下就出现了问题，报SecurityError的错误，那这个错误是什么原因呢?</p>

<pre><code>WebSocket connection to 'ws://domain.com/websocket' failed: Error in connection establishment: net::ERR_CONNECTION_REFUSED
</code></pre>

<p>应该是每个浏览器对websocket的支持不一样或者说每个浏览器的安全沙箱不太一样，禁止了一些用法，各大浏览器对websocket的支持情况请看：<a href="https://caniuse.com/#search=websocket">https://caniuse.com/#search=websocket</a></p>

<p>无意中看到了mozilla的websocket支持详细说明如下：</p>

<p><span style="color:red">
<strong>Security considerations</strong><br>
WebSockets should not be used in a mixed content environment; that is, you shouldn&rsquo;t open a non-secure WebSocket connection from a page loaded using HTTPS or vice-versa. In fact, some browsers explicitly forbid this, including Firefox 8 and later.
</span></p>

<p>具体地址：<a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications">https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications</a></p>

<p>意思呢就是，ws与http对应，wss与https对应，如果站点使用的是https那就必须使用wss来做websocket请求不能使用ws来请求，不允许混合的方式使用。</p>

<p>看到这个就更加明确了问题所在：安全机制问题，最好不要混合使用避免奇怪的问题。</p>

<p>于是就开启了wss服务的使用路程。</p>

<p>如果你的wss服务是使用ip方式访问的，那么需要制作一个对应这个ip的证书，可以使用openssl生成自签名证书，但是不推荐使用ip的方式访问WebSocket。</p>

<p>如果你的wss服务是使用域名方式访问的，那么需要制作一个对应这个域名证书（最好是通配符域名证书），这样在构建wss服务的时候将证书配置进去。</p>

<p>构建wss服务有很多种方式，我这里提供一种比较简单的方式。</p>

<h1 id="使用nginx提供ssl代理">使用nginx提供ssl代理</h1>

<p>保留以前的ws服务提供方式不做任何变更，增加一个nginx开启ssl代理，配置跟常规的ssl配置有一些细微的变化，那就是header会有一些变化，websocket需要指定<code>header：Upgrade</code>和<code>http version：1.1</code> ，因此我这里给出配置详情：</p>

<pre><code>server {
    listen       443 ssl;
	server_name  your.domain.com;#你的域名，如果没有域名就去掉
	ssl on;
	#ssl_certificate     127.0.0.1.crt;
    #ssl_certificate_key 127.0.0.1.key;
	ssl_certificate     your.domain.com.pem;#这里可以使用pem文件和crt文件
    ssl_certificate_key your.domain.com.key;
	ssl_session_timeout 5m;
	ssl_session_cache shared:SSL:50m;
	ssl_protocols SSLv3 SSLv2 TLSv1 TLSv1.1 TLSv1.2;
	ssl_ciphers ALL:!ADH:!EXPORT56:RC4+RSA:+HIGH:+MEDIUM:+LOW:+SSLv2:+EXP;

	location / {
		proxy_pass http://127.0.0.1:19808;# 这里换成你想转发的ws服务地址即可
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection &quot;Upgrade&quot;;
		proxy_set_header X-Real-IP $remote_addr;
        }
}
</code></pre>

<p>将证书文件放到conf同级目录即可，如果证书放在其他目录，需要修改ssl_certificate、ssl_certificate_key指定的位置。</p>

<p>这样就可以不用修改以前的ws服务来提供wss服务。</p>

<h1 id="修改ws的请求方式为wss">修改ws的请求方式为wss</h1>

<pre><code>wss://your.domain.com
</code></pre>

<p>ws服务这里也简单的说一下，有很多服务都可以构建ws服务，nginx、Workerman都可以，或者自己写程序开启ws服务。方式很多看个人喜好和公司的项目背景。</p>

<h1 id="附录">附录</h1>

<ol>
<li><a href="http://nginx.org/en/docs/">nginx官方文档</a></li>
<li><a href="https://ningyu1.github.io/site/post/51-ssl-cert/">Openssl生成自签名证书，简单步骤</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_client_applications">mozilla的websocket支持说明</a></li>
<li><a href="https://caniuse.com/#search=websocket">各大浏览器对websocket的支持情况</a></li>
</ol>

<h1 id="常见错误">常见错误</h1>

<p>如果在ie下报如下错误：</p>

<pre><code>IE Network Error 12038, 证书中的主名称无效或不相符
</code></pre>

<p>那是因为证书与请求地址不匹配导致的错误，在chrome测试它的https验证不会这么严格，在ie下https验证很严格（坑爹的ie）。</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/56-websocket-ssl/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/55-java-jvm-analysis/">生产环境如何快速跟踪、分析、定位问题-Java</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-01-23T14:36:36.000&#43;00:00' itemprop="datePublished">2018-01-23</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/java">Java</a>

<a href="https://ningyu1.github.io/site/tags/jvm">JVM</a>

<a href="https://ningyu1.github.io/site/tags/cpu-top">CPU TOP</a>

<a href="https://ningyu1.github.io/site/tags/jstack">Jstack</a>

<a href="https://ningyu1.github.io/site/tags/jmap">Jmap</a>

<a href="https://ningyu1.github.io/site/tags/jvm-dump">JVM dump</a>


</div>
    </div>
        

<p>我相信做技术的都会遇到过这样的问题，生产环境服务遇到宕机的情况下如何去分析问题？比如说JVM内存爆掉、CPU持续高位运行、线程被夯住或线程deadlocks，面对这样的问题，如何在生产环境第一时间跟踪分析与定位问题很关键。下来让我们看看通过如下步骤在第一时间分析问题。</p>

<h1 id="cpu占用较高场景">CPU占用较高场景</h1>

<p>收集当前CPU占用较高的线程信息，执行如下命令：</p>

<pre><code>top -H -p PID -b -d 1 -n 1 &gt; top.log
或
top -H -p PID
</code></pre>

<p>结果如下：</p>

<p><img src="https://ningyu1.github.io/site/img/jvm-analysis/1.png" alt="" /></p>

<p>上图显示的都是某一个进程内的线程信息，找到cpu消耗最高的线程id，再配合jstack来分析耗cpu的代码位置，那如何分析呢？</p>

<p>先执行jstack获取线程信息</p>

<pre><code>jstack -l PID &gt; jstackl.log
</code></pre>

<p>将PID（29978）转成16进制：0x751a，16进制转换工具很多可以在线随便搜索一个或者基本功好的自己计算。</p>

<p>打开jstackl.log，查找nid=0x751a的信息，这样就定位到了具体的代码位置，这里由于是安全原因我就不贴图了。</p>

<p>通过上面的步骤就可以轻松的定位那个线程导致cpu过高，当然也可以通过其他方式来定位，下面介绍一个快捷的方式</p>

<pre><code>#线程cpu占用
#!/bin/bash

[ $# -ne 1 ] &amp;&amp; exit 1

jstack $1 &gt;/tmp/jstack.log

for cpu_tid in `ps -mp $1 -o THREAD,tid,time|sort -k2nr| sed -n '2,15p' |awk '{print$2&quot;_&quot;$(NF-1)}'`;do

cpu=`echo $cpu_tid | cut -d_ -f1`

tid=`echo $cpu_tid | cut -d_ -f2`

xtid=`printf &quot;%x\n&quot; $tid`

echo -e &quot;\033[31m========================$xtid $cpu%\033[0m&quot;

cat /tmp/jstack.log | sed -n -e &quot;/0x$xtid/,/^$/ p&quot;

#cat /tmp/jstack.log | grep &quot;$xtid&quot; -A15

done

rm /tmp/jstack.log
</code></pre>

<p>上述命令会以百分比的方式来显示每个线程的cpu消耗百分比，这里我就不贴图了，谁用谁知道。</p>

<h1 id="内存消耗过高场景">内存消耗过高场景</h1>

<p>收集当前活跃对象数据量信息，执行以下命令获取</p>

<pre><code>jmap -histo:live pid &gt; jmaplive.log
</code></pre>

<p><span style="color:red"><strong>ps. jmap -histo:live 数据可以多进行几次，比如说间隔几分钟输出一次，然后对比两个文件的差异可以看出gc回收的对象，如果多次结果没有差异并且gc频繁执行，证明剩余对象在引用无法gc回收，这时就需要对服务进行限流给服务喘气的机会。</strong></span></p>

<p>或者收集dump信息，通常这种获取方式需要较长时间执行，并产生大容量的dump文件，我们会考虑逐步废掉通过这个文件来分析。执行以下命令获取</p>

<pre><code>jmap -dump:file=./dump.mdump pid
</code></pre>

<p>dump文件通过MAT工具来进行内存泄漏分析。</p>

<h1 id="线程-内存分析工具">线程、内存分析工具</h1>

<p>上面说过通过jstack生成的线程文件是可以通过工具来直接打开可视化分析的，这里我推荐使用：tda（Thread Dump Analyzer）这个工具可以自行搜索下载。</p>

<p>通过jmap -dump生成的dump文件也是可以通过工具来进行可视化分析的，这里我推荐使用MAT（Memory Analysis Tools）它可以通过eclipse plugin的方式使用或者独立的下载安装包使用。</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/55-java-jvm-analysis/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/54-cas-server/">CAS使用经验总结，纯干货</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-01-19T16:25:36.000&#43;00:00' itemprop="datePublished">2018-01-19</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/cas">CAS</a>

<a href="https://ningyu1.github.io/site/tags/ssl">SSL</a>

<a href="https://ningyu1.github.io/site/tags/cert">Cert</a>

<a href="https://ningyu1.github.io/site/tags/slo">SLO</a>

<a href="https://ningyu1.github.io/site/tags/single-logout">Single Logout</a>

<a href="https://ningyu1.github.io/site/tags/ticket">Ticket</a>

<a href="https://ningyu1.github.io/site/tags/ticket-registry">Ticket Registry</a>

<a href="https://ningyu1.github.io/site/tags/session-centralized-storage">Session Centralized Storage</a>

<a href="https://ningyu1.github.io/site/tags/cookie">Cookie</a>

<a href="https://ningyu1.github.io/site/tags/cas-cluster">CAS Cluster</a>

<a href="https://ningyu1.github.io/site/tags/cas-server">CAS Server</a>


</div>
    </div>
        

<p>最近在处理公司项目对接到CAS server，在使用CAS发生了很多问题，下面整理一下遇到的问题与解决方式，希望可以帮助到需要的工程师们</p>

<p>CAS它是什么？它能做什么？这些我就不概述了，自行去搜索了解，<a href="https://baike.baidu.com/item/CAS/1329561">https://baike.baidu.com/item/CAS/1329561</a></p>

<p>我们在使用CAS的时候基本都会遇到如下的几种问题：</p>

<ol>
<li>证书问题</li>
<li>Client接入配置</li>
<li>SLO（Single Logout）</li>
<li>CAS callback回调问题</li>
<li>Cookie问题</li>
<li>用户数据源以及认证问题</li>
<li>CAS Server Ticket持久化问题</li>
<li>Client Server集群模式下session问题</li>
</ol>

<p>还有一些是公司内部项目框架集成问题这里就不多说了。</p>

<p><strong>以下总结都是基于CAS v5.0.4版本测试</strong></p>

<p>我用的CAS Server是通过overlays改造后的项目，为什么需要修改原有的CAS Server呢？</p>

<p>我相信每个公司都有一些特殊的需求比如说：</p>

<ol>
<li>对登录页面的修改</li>
<li>自有的密码加密验证方式</li>
<li>新老项目架构参差不齐</li>
<li>使用公司自有用户数据源</li>
</ol>

<p>等等很多问题都需要对CAS Server进行改造</p>

<p>这里我将改造的CAS Server放到github上：</p>

<p>项目地址：<a href="https://github.com/ningyu1/cas-site">cas-site</a></p>

<p><a href="https://github.com/ningyu1/cas-site/releases"><img src="https://img.shields.io/github/release/ningyu1/cas-site.svg?style=social&amp;label=Release"></a>&nbsp;<a href="https://github.com/ningyu1/cas-site/stargazers"><img src="https://img.shields.io/github/stars/ningyu1/cas-site.svg?style=social&amp;label=Star"></a>&nbsp;<a href="https://github.com/ningyu1/cas-site/fork"><img src="https://img.shields.io/github/forks/ningyu1/cas-site.svg?style=social&amp;label=Fork"></a>&nbsp;<a href="https://github.com/ningyu1/cas-site/watchers"><img src="https://img.shields.io/github/watchers/ningyu1/cas-site.svg?style=social&amp;label=Watch"></a> <a href="http://www.gnu.org/licenses/gpl-3.0.html"><img src="https://img.shields.io/badge/license-GPLv3-blue.svg"></a></p>

<p>下面具体说一下上述的问题将如何来分析并解决</p>

<h1 id="证书问题">证书问题</h1>

<p>如果你的服务不打算使用SSL那请跳过这段说明。</p>

<p>一般公司项目会有很多域名大概都是子域名的方式，例如：account.xxxx.com,login.xxxx.com，那么最好使用通配符证书，为什么呢？这样你的cas server上配置一个通配符证书即可，如果没有使用通配符证书那cas server上要配置所有授信域名的证书，这样就很麻烦，除非一些历史问题没办法才会导入多个证书，一般使用通配符证书。</p>

<p>我使用的是自签名的通配符证书，具体自签名证书如何生成可以查看我之前写的文章：</p>

<p><a href="https://ningyu1.github.io/site/post/51-ssl-cert/">《Openssl生成自签名证书，简单步骤》</a>中讲述了如何生成自签名证书。</p>

<p><a href="https://ningyu1.github.io/site/post/52-ssl-cert-2/">《使用自签名证书，简单步骤》</a>中讲述了如何使用自签名证书。</p>

<p><a href="https://ningyu1.github.io/site/post/51-ssl-cert-3/">《Java访问SSL地址，使用证书方式和免验证证书方式》</a>中讲述了Java访问ssl使用证书方式和免验证证书方式。</p>

<p><span style='color:red'><strong>ps.这里需要注意的是在制作单域名证书和通配符域名证书的区别是在：Common Name输入的时候，例如：</strong></span></p>

<p>单域名证书：<code>Common Name：account.xxxx.ccom</code>
通配符域名证书：<code>Common Name：*.xxxx.com</code></p>

<p>将制作好的证书文件通过keytool导入到jdk下即可，或使用InstallCert来生成文件copy到jdk下，具体可以参考文章：<a href="https://ningyu1.github.io/site/post/52-ssl-cert-2/">《使用自签名证书，简单步骤》</a></p>

<p>证书放在：<code>%JAVA_HOME%\jre\lib\security</code></p>

<p>我们cas server使用的jdk1.8，client服务大多是jdk1.7，因此在证书处理上要注意这个细节，上面文章中有明确说明</p>

<p><span style='color:red'><strong>如果需要使用Docker构建，可以参考我写好的Dockerfile，在cas-site项目下Dockerfile文件</strong></span></p>

<h1 id="client接入配置">Client接入配置</h1>

<p>接入cas的client端配置非常简单，可以使用spring framework对接cas方式，也可以使用spring security对接cas方式，或者其他支持cas的第三方框架，自己对接配置非常简单只需要配置<code>SingleSignOutFilter</code>和<code>SingleSignOutHttpSessionListener</code></p>

<ul>
<li>org.jasig.cas.client.session.SingleSignOutFilter：解决Logout清空TGC和session信息</li>
<li>org.jasig.cas.client.session.SingleSignOutHttpSessionListener：session监听</li>
</ul>

<p>这里在对接方面就不做过多的介绍了。</p>

<h1 id="slo-single-logout">SLO（Single Logout）</h1>

<p>SLO是个什么？</p>

<p>通俗点讲就是：浏览器多个tab页开启不同的APP（使用同一个用户登录），在某一个APP里进行登出操作，其余APP应该一起登出</p>

<p>CAS Server默认是开启SLO功能，如果想要关闭这个功能可以通过设置<code>application.properties</code>文件中的参数来关闭，具体如下：</p>

<pre><code># 是否禁用SLO功能，true为禁用SLO功能
cas.slo.disabled=true
# 使用采用异步方式进行callback
cas.slo.asynchronous=true
</code></pre>

<p><span style='color:red'><strong>这里需要注意Logout时服务重定向需要开启：</strong></span></p>

<pre><code># Logout时服务重定向
cas.logout.followServiceRedirects=true
</code></pre>

<p>CAS Server在进行异步回调时会忽略所有的错误来保证所有APP都能接收到Server发出的logout请求，因此在遇到错误时不开启trace级别日志是看不到错误信息的。</p>

<p>如果你的client端能看到接下来的章节（CAS callback回调问题） 说到的日志信息那就证明回调是没有问题的。</p>

<h1 id="cas-callback回调问题">CAS callback回调问题</h1>

<p>CAS认证过程需要server端和client端来回调用，如果发现callback回调有问题多半是第一步证书问题导致，可以开启日志trace级别查看cas的日志来排除问题。</p>

<p>cas回调有三种情况:</p>

<p>一个是授权的时候进行回调信息如下</p>

<pre><code>2018-01-19 11:44:28.419 [http-apr-8080-exec-9] TRACE org.jasig.cas.client.session.SingleSignOutHandler - Received a token request
2018-01-19 11:44:28.419 [http-apr-8080-exec-9] DEBUG org.jasig.cas.client.session.SingleSignOutHandler - Recording session for token ST-250-AouhaxqAjvmh5sfaP3Yz-8ec54e266608
2018-01-19 11:44:28.419 [http-apr-8080-exec-9] DEBUG c.j.f.c.s.storage.RedisBackedSessionMappingStorage - Attempting to remove Session=[8F24552DD446F669B7A522B1A8A0C86D]
2018-01-19 11:44:28.419 [http-apr-8080-exec-9] DEBUG c.j.f.c.s.storage.RedisBackedSessionMappingStorage - No mapping for session found.  Ignoring.
2018-01-19 11:44:28.420 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Placing URL parameters in map.
2018-01-19 11:44:28.420 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Calling template URL attribute map.

2018-01-19 11:44:28.420 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Loading custom parameters from configuration.
2018-01-19 11:44:28.420 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Constructing validation url: https://login.dev.xxx.com.cn/serviceValidate?ticket=ST-250-AouhaxqAjvmh5sfaP3Yz-8ec54e266608&amp;service=https%3A%2F%2Faccount.dev.xxx.com.cn%2Fcas_security_check_
2018-01-19 11:44:28.420 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Retrieving response from server.
2018-01-19 11:44:28.460 [http-apr-8080-exec-9] DEBUG o.j.c.c.validation.Cas20ServiceTicketValidator - Server response: &lt;cas:serviceResponse xmlns:cas='http://www.yale.edu/tp/cas'&gt;
    &lt;cas:authenticationSuccess&gt;
        &lt;cas:user&gt;admin&lt;/cas:user&gt;
        &lt;/cas:authenticationSuccess&gt;
&lt;/cas:serviceResponse&gt;

</code></pre>

<p>一个是SLO时清理session的回调信息如下</p>

<pre><code>2018-01-19 11:44:45.484 [http-apr-8080-exec-5] TRACE org.jasig.cas.client.session.SingleSignOutHandler - Received a back channel logout request
2018-01-19 11:44:45.484 [http-apr-8080-exec-5] DEBUG org.jasig.cas.client.util.CommonUtils - safeGetParameter called on a POST HttpServletRequest for Restricted Parameters.  Cannot complete check safely.  Reverting to standard behavior for this Parameter
2018-01-19 11:44:45.485 [http-apr-8080-exec-5] TRACE org.jasig.cas.client.session.SingleSignOutHandler - Logout request:
&lt;samlp:LogoutRequest xmlns:samlp=&quot;urn:oasis:names:tc:SAML:2.0:protocol&quot; ID=&quot;LR-79-M3OyvVsRH7Ft1gRVaBfeuBCAj4K1JEDnndt&quot; Version=&quot;2.0&quot; IssueInstant=&quot;2018-01-19T11:44:45Z&quot;&gt;&lt;saml:NameID xmlns:saml=&quot;urn:oasis:names:tc:SAML:2.0:assertion&quot;&gt;@NOT_USED@&lt;/saml:NameID&gt;&lt;samlp:SessionIndex&gt;ST-250-AouhaxqAjvmh5sfaP3Yz-8ec54e266608&lt;/samlp:SessionIndex&gt;&lt;/samlp:LogoutRequest&gt;
2018-01-19 11:44:45.485 [http-apr-8080-exec-5] DEBUG c.j.f.c.s.storage.RedisBackedSessionMappingStorage - Attempting to remove Session=[8F24552DD446F669B7A522B1A8A0C86D]
2018-01-19 11:44:45.485 [http-apr-8080-exec-5] DEBUG c.j.f.c.s.storage.RedisBackedSessionMappingStorage - Found mapping for session.  Session Removed.
2018-01-19 11:44:45.486 [http-apr-8080-exec-5] DEBUG org.jasig.cas.client.session.SingleSignOutHandler - Invalidating session [8F24552DD446F669B7A522B1A8A0C86D] for token [ST-250-AouhaxqAjvmh5sfaP3Yz-8ec54e266608]

</code></pre>

<p>还有一种也是SLO时清理session的回调和上面的有什么区别呢？</p>

<p>上面的SLO是back channel logout方式，还有一种方式：front channel logout，后者是cas新版本提供的新方式，我这里没有使用，具体可以参考官方说明：<a href="https://apereo.github.io/cas/5.0.x/installation/Logout-Single-Signout.html#turning-off-single-logout">https://apereo.github.io/cas/5.0.x/installation/Logout-Single-Signout.html#turning-off-single-logout</a></p>

<p>开启trace日志查看回调是否发生错误来解决回调不生效问题</p>

<h1 id="cookie问题">Cookie问题</h1>

<p>当使用单个域名时会出现Cookie清理问题从而导致SLO失效，因为CAS Server生成TGC时如果不设置cookie domain它会写在对接的service所在的域名下，最好的方式是让Cookie写在根域名的根Path（/）下，在CAS server端配置TGC的domain以及其他cookie参数，具体参考：</p>

<pre><code>cas.tgc.path=/
cas.tgc.maxAge=-1
cas.tgc.domain=your.domain.com
#cas.tgc.signingKey=
cas.tgc.name=TGC
#cas.tgc.encryptionKey=
cas.tgc.secure=true
cas.tgc.httpOnly=true
cas.tgc.rememberMeMaxAge=1209600
cas.tgc.cipherEnabled=true
</code></pre>

<p>具体说明查看官方文档：<a href="https://apereo.github.io/cas/5.0.x/installation/Configuration-Properties.html#ticket-granting-cookie">https://apereo.github.io/cas/5.0.x/installation/Configuration-Properties.html#ticket-granting-cookie</a></p>

<h2 id="举个例子理解一下">举个例子理解一下</h2>

<p>我有三个APP域名分别为：</p>

<pre><code>https://account.domain.com
https://login.domain.com
https://app.domain.com
</code></pre>

<p>我生成的通配符证书域名为：<code>*.domain.com</code></p>

<p>我三个APP在部署时jdk下放通配符域名证书</p>

<p>这样修改tgc配置为：</p>

<pre><code># cookie写的路径 / 为根域名下
cas.tgc.path=/
# cookie有效期，-1 为关闭浏览器自动清空
cas.tgc.maxAge=-1
# cookie写在那个域名下
cas.tgc.domain=domain.com
# cookie的名称
cas.tgc.name=TGC
# cookie开启器安全模式ssl
cas.tgc.secure=true
# cookie禁止js调用
cas.tgc.httpOnly=true
# 这两个采用默认配置即可
cas.tgc.rememberMeMaxAge=1209600
cas.tgc.cipherEnabled=true
</code></pre>

<h1 id="用户数据源以及认证问题">用户数据源以及认证问题</h1>

<p>CAS在这方面留了很多扩展的地方，而且很方便的配置就可以支持自定义</p>

<p>数据源支持的方式也有很多种（jdbc、mongodb、RestStorage、GIT、等）这里就不一一介绍了
认证方式支持的方式也很多种（Basic、OAuth2.0|1.0、Google Authenticator、LDAP、REST、OpenID、SPNEGO、等）这里就不一一介绍了</p>

<p>具体可以查看官方说明对应的配置：<a href="https://apereo.github.io/cas/5.0.x/installation/Configuration-Properties.html">https://apereo.github.io/cas/5.0.x/installation/Configuration-Properties.html</a></p>

<p>我使用的是jdbc方式</p>

<p>具体可以去github上查看cas-site源码：<a href="https://github.com/ningyu1/cas-site" title="项目地址">cas-site</a></p>

<h1 id="cas-server-ticket持久化问题">CAS Server Ticket持久化问题</h1>

<p>Ticket持久化方式也有很多中（JPA、Couchbase、Hazelcast、Infinispan、InMemory、Ehcache、Ignite、Memcached），默认方式（inMemory基于内存的），下面我给出JAP方式的配置参数：</p>

<pre><code>cas.ticket.registry.jpa.jpaLockingTimeout=3600
cas.ticket.registry.jpa.healthQuery=SELECT 1
cas.ticket.registry.jpa.isolateInternalQueries=false
cas.ticket.registry.jpa.url=jdbc:mysql://127.0.0.1:3306/cas?useUnicode=true&amp;characterEncoding=UTF-8&amp;noAccessToProcedureBodies=true
cas.ticket.registry.jpa.failFast=true
cas.ticket.registry.jpa.dialect=org.hibernate.dialect.MySQL5Dialect
cas.ticket.registry.jpa.leakThreshold=10
cas.ticket.registry.jpa.jpaLockingTgtEnabled=false
cas.ticket.registry.jpa.batchSize=1
#cas.ticket.registry.jpa.defaultCatalog=
cas.ticket.registry.jpa.defaultSchema=cas
cas.ticket.registry.jpa.user=root
cas.ticket.registry.jpa.ddlAuto=validate
cas.ticket.registry.jpa.password=root@123456
cas.ticket.registry.jpa.autocommit=true
cas.ticket.registry.jpa.driverClass=com.mysql.jdbc.Driver
cas.ticket.registry.jpa.idleTimeout=5000

# 下面的参数根据实际情况选择使用
# 连接池
# cas.ticket.registry.jpa.pool.suspension=false
# cas.ticket.registry.jpa.pool.minSize=6
# cas.ticket.registry.jpa.pool.maxSize=18
# cas.ticket.registry.jpa.pool.maxWait=2000
# 签名与数据加解密密钥和算法
# cas.ticket.registry.jpa.crypto.signing.key=
# cas.ticket.registry.jpa.crypto.signing.keySize=512
# cas.ticket.registry.jpa.crypto.encryption.key=
# cas.ticket.registry.jpa.crypto.encryption.keySize=16
# cas.ticket.registry.jpa.crypto.alg=AES
</code></pre>

<p>这里需要注意的是，以上给出的配置参数是建议值，ddlauto默认值是create-drop，可选值有（create、create-drop、validate、update），具体含义可以查看官方文档：<a href="https://apereo.github.io/cas/5.0.x/installation/JPA-Ticket-Registry.html">https://apereo.github.io/cas/5.0.x/installation/JPA-Ticket-Registry.html</a>，建议使用validate的方式，使用validate需要自己创建表，一共四张表下面贴出建表语句：</p>

<pre><code>CREATE TABLE `locks` (
`application_id` varchar(255) NOT NULL,
`expiration_date` datetime DEFAULT NULL,
`unique_id` varchar(255) DEFAULT NULL,
`lockVer` int(11) NOT NULL DEFAULT '0',
PRIMARY KEY (`application_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8


CREATE TABLE `oauth_tokens` (
`TYPE` varchar(31) NOT NULL,
`ID` varchar(255) NOT NULL,
`NUMBER_OF_TIMES_USED` int(11) DEFAULT NULL,
`CREATION_TIME` datetime DEFAULT NULL,
`EXPIRATION_POLICY` longblob NOT NULL,
`LAST_TIME_USED` datetime DEFAULT NULL,
`PREVIOUS_LAST_TIME_USED` datetime DEFAULT NULL,
`AUTHENTICATION` longblob NOT NULL,
`SERVICE` longblob NOT NULL,
PRIMARY KEY (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8

CREATE TABLE `serviceticket` (
`TYPE` varchar(31) NOT NULL,
`ID` varchar(255) NOT NULL,
`NUMBER_OF_TIMES_USED` int(11) DEFAULT NULL,
`CREATION_TIME` datetime DEFAULT NULL,
`EXPIRATION_POLICY` longblob NOT NULL,
`LAST_TIME_USED` datetime DEFAULT NULL,
`PREVIOUS_LAST_TIME_USED` datetime DEFAULT NULL,
`FROM_NEW_LOGIN` bit(1) NOT NULL,
`TICKET_ALREADY_GRANTED` bit(1) NOT NULL,
`SERVICE` longblob NOT NULL,
`ticketGrantingTicket_ID` varchar(255) DEFAULT NULL,
PRIMARY KEY (`ID`),
KEY `FK60oigifivx01ts3n8vboyqs38` (`ticketGrantingTicket_ID`),
CONSTRAINT `FK60oigifivx01ts3n8vboyqs38` FOREIGN KEY (`ticketGrantingTicket_ID`) REFERENCES `ticketgrantingticket` (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8

CREATE TABLE `ticketgrantingticket` (
`TYPE` varchar(31) NOT NULL,
`ID` varchar(255) NOT NULL,
`NUMBER_OF_TIMES_USED` int(11) DEFAULT NULL,
`CREATION_TIME` datetime DEFAULT NULL,
`EXPIRATION_POLICY` longblob NOT NULL,
`LAST_TIME_USED` datetime DEFAULT NULL,
`PREVIOUS_LAST_TIME_USED` datetime DEFAULT NULL,
`AUTHENTICATION` longblob NOT NULL,
`EXPIRED` bit(1) NOT NULL,
`PROXIED_BY` longblob,
`SERVICES_GRANTED_ACCESS_TO` longblob NOT NULL,
`ticketGrantingTicket_ID` varchar(255) DEFAULT NULL,
PRIMARY KEY (`ID`),
KEY `FKiqyu3qw2fxf5qaqin02mox8r4` (`ticketGrantingTicket_ID`),
CONSTRAINT `FKiqyu3qw2fxf5qaqin02mox8r4` FOREIGN KEY (`ticketGrantingTicket_ID`) REFERENCES `ticketgrantingticket` (`ID`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8
</code></pre>

<p>其他参数含义可以查看官方配置说明：<a href="https://apereo.github.io/cas/5.0.x/installation/JPA-Ticket-Registry.html">https://apereo.github.io/cas/5.0.x/installation/JPA-Ticket-Registry.html</a></p>

<h1 id="client-server集群模式下session问题">Client Server集群模式下session问题</h1>

<p>当我们CAS Server准备好后，就要处理Client接入的问题，如果我们的Client服务是单机模式那没有任何问题，一旦放到集群环境下就会发生如下有意思的事情。</p>

<p>我前面说了CAS在授权回调时会做几件事，第一TG保存到Cookie，第二个保存ticketid对应的session关系以及session对象。</p>

<p>那么如果我们的Client服务是集群的会发生什么？</p>

<p>举个例子：</p>

<p>我的APP服务部署了2台服务（S1、S2）采用loadbalance映射一个域名出去访问，当CAS授权回调时被loadbalance路由到S1上，SingleSignOutFilter以及SingleSignOutHandler进行了TGC和SessionMappingStorage，默认的持久化方式是hash的方式，也就是说本地map方式，这样在下次访问到APP时被loadbalance路由到S2上就会发生什么有意思的事情呢？我相信做过分布式服务的应该都能猜出来什么问题。</p>

<p>APP：我没找到cas认证信息，跳转到cas login页面</p>

<p>CAS：我找到了你APP已经做过认证了，跳转到APP并且给你上次认证的ticlet</p>

<p>APP：我真没找到你的认证信息，跳转到cas login页面</p>

<p>CAS：你真的已经做过认证了，跳转到APP并且给你上次认证的ticlet</p>

<p>这样就会发生无线跳转死循环问题。</p>

<p>那如何解决上面的问题呢？</p>

<p>在分布式的环境下几乎服务都是集群的，甚至有很多公司会做异地多活等等。那么在集群环境下如何解决cas授权持久化的问题呢？很简单重新实现一个cas-client的SessionMappingStorage，这里可以使用很多方式，比如说：放到db、nosql的存储上（mongodb、redis）、memcache、分布式文件存储都可以。</p>

<p>我这里采用的是redis，而且我们dev和qa环境采用单机模式，stage和prod环境使用集群模式，因此我还做了集群和本地都兼容的方式，话不多说直接贴出实现代码</p>

<pre><code>import java.util.HashMap;
import java.util.Map;
import javax.servlet.http.HttpSession;
import org.jasig.cas.client.session.SessionMappingStorage;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import xxxxxxxx.framework.redis.client.IRedisClient;

public class RedisBackedSessionMappingStorage implements SessionMappingStorage {
    
    private final Logger logger = LoggerFactory.getLogger(getClass());
    
    /**
     * Maps the ID from the CAS server to the Session.
     */
    private final Map&lt;String, HttpSession&gt; MANAGED_SESSIONS = new HashMap&lt;String, HttpSession&gt;();

    /**
     * Maps the Session ID to the key from the CAS Server.
     */
    private final Map&lt;String, String&gt; ID_TO_SESSION_KEY_MAPPING = new HashMap&lt;String, String&gt;();
    
    private final static String NAME_SPACE = &quot;CAS&quot;;
    
    private IRedisClient redisClient;
    
    /**
     * 在dev和qa环境使用单机模式：hash
     * 在stage和prod环境使用集群模式：redis
     */
    private String storageMode = &quot;hash&quot;;

    /**
     * 获取 redisClient
     * @return the redisClient
     */
    public IRedisClient getRedisClient() {
        return redisClient;
    }

    /**
     * 设置 redisClient
     * @param redisClient the redisClient to set
     */
    public void setRedisClient(IRedisClient redisClient) {
        this.redisClient = redisClient;
    }

    /**
     * 获取 storageMode
     * @return the storageMode
     */
    public String getStorageMode() {
        return storageMode;
    }

    /**
     * 设置 storageMode
     * @param storageMode the storageMode to set
     */
    public void setStorageMode(String storageMode) {
        this.storageMode = storageMode;
    }

    @Override
    public HttpSession removeSessionByMappingId(String mappingId) {
        HttpSession session = null;
        if (storageMode.equals(&quot;hash&quot;)) {
            session = MANAGED_SESSIONS.get(mappingId);
        } else {
            session = redisClient.get(mappingId, NAME_SPACE, HttpSession.class, null);
        }

        if (session != null) {
            removeBySessionById(session.getId());
        }

        return session;
    }

    @Override
    public void removeBySessionById(String sessionId) {
        logger.debug(&quot;Attempting to remove Session=[{}]&quot;, sessionId);
        String key = null;
        if (storageMode.equals(&quot;hash&quot;)) {
            key = ID_TO_SESSION_KEY_MAPPING.get(sessionId);
        } else {
            key = redisClient.get(sessionId, NAME_SPACE, null);
        }

        if (logger.isDebugEnabled()) {
            if (key != null) {
                logger.debug(&quot;Found mapping for session.  Session Removed.&quot;);
            } else {
                logger.debug(&quot;No mapping for session found.  Ignoring.&quot;);
            }
        }
        
        if (storageMode.equals(&quot;hash&quot;)) {
            MANAGED_SESSIONS.remove(key);
            ID_TO_SESSION_KEY_MAPPING.remove(sessionId);
        } else {
            redisClient.del(key, NAME_SPACE);
            redisClient.del(sessionId, NAME_SPACE);
        }
    }

    @Override
    public void addSessionById(String mappingId, HttpSession session) {
        if (storageMode.equals(&quot;hash&quot;)) {
            ID_TO_SESSION_KEY_MAPPING.put(session.getId(), mappingId);
            MANAGED_SESSIONS.put(mappingId, session);
        } else {
            redisClient.set(session.getId(), NAME_SPACE, mappingId, -1);
            redisClient.set(mappingId, NAME_SPACE, session, -1);
        }

    }

}
</code></pre>

<p>这里使用的redis-client是我自己封装，使用文档在：<a href="https://ningyu1.github.io/site/post/22-redis-client/">《RedisClient使用说明》</a>，支持redis集群模式：<a href="https://ningyu1.github.io/site/post/28-redis-client-sentinel/">《RedisClient升级支持Sentinel使用说明》</a>，代码已经放到了github上：</p>

<p>项目地址：<a href="https://github.com/ningyu1/redis-client">redis-client</a></p>

<p><a href="https://github.com/ningyu1/redis-client/releases"><img src="https://img.shields.io/github/release/ningyu1/redis-client.svg?style=social&amp;label=Release"></a>&nbsp;<a href="https://github.com/ningyu1/redis-client/stargazers"><img src="https://img.shields.io/github/stars/ningyu1/redis-client.svg?style=social&amp;label=Star"></a>&nbsp;<a href="https://github.com/ningyu1/redis-client/fork"><img src="https://img.shields.io/github/forks/ningyu1/redis-client.svg?style=social&amp;label=Fork"></a>&nbsp;<a href="https://github.com/ningyu1/redis-client/watchers"><img src="https://img.shields.io/github/watchers/ningyu1/redis-client.svg?style=social&amp;label=Watch"></a> <a href="http://www.gnu.org/licenses/gpl-3.0.html"><img src="https://img.shields.io/badge/license-GPLv3-blue.svg"></a></p>

<p>把上面的<code>RedisBackedSessionMappingStorage</code>类注入到<code>org.jasig.cas.client.session.SingleSignOutFilter</code>中即可</p>

<pre><code>    &lt;bean id=&quot;singleLogoutFilter&quot; class=&quot;org.jasig.cas.client.session.SingleSignOutFilter&quot;&gt;
    	&lt;property name=&quot;sessionMappingStorage&quot; ref=&quot;redisBackedSessionMappingStorage&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
    &lt;bean id=&quot;redisBackedSessionMappingStorage&quot; class=&quot;xxxxxxx.cas.session.storage.RedisBackedSessionMappingStorage&quot;&gt;
    	&lt;property name=&quot;redisClient&quot; ref=&quot;redisClient&quot;&gt;&lt;/property&gt;
    	&lt;property name=&quot;storageMode&quot; value=&quot;${cas.session.storage.mode}&quot;&gt;&lt;/property&gt;
    &lt;/bean&gt;
</code></pre>

<p><span style='color:red'><strong>ps.参数cas.session.storage.mode，值：hash（本地map）、redis（集中存储）</strong></span></p>

<h2 id="web服务端session集中存储处理">WEB服务端session集中存储处理</h2>

<p>WEB服务端session集中存储处理方案也有很多种，使用tomcat可以使用TomcatRedisSessionManager来解决session集中存储问题，github地址：<a href="https://github.com/ran-jit/tomcat-cluster-redis-session-manager">https://github.com/ran-jit/tomcat-cluster-redis-session-manager</a></p>

<p>如果要自己实现也很简单，我这里大致说一下思路，需要包装一个可序列话的session，说白了就是包装一下session实现序列化接口：<code>java.io.Serializable</code>接口生成一个version id，包装一个获取器，在生成session的时候序列化写入集中存储返回id，在用的使用通过id获取，id可以使用jsessionid或者自己生成一个uuid都行。这个id可以放入浏览器cookie，也可以放入url每次带入,在登录成功后将session序列化存储到redis或其他cache、nosql、db等，在登出时清空即可，就看自己喜好来实现了。</p>

<p>到这里基本上对cas的使用经验就总结完了，我相信大家在使用cas时都会遇到上面的问题，希望这篇总结可以帮助到需要的人，感谢看到最后。</p>

<p>最后我的愿望是：世界和平，快乐编程每一天，keep real</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/54-cas-server/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/53-ssl-cert-3/">Java访问SSL地址，使用证书方式和免验证证书方式</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-01-15T14:08:36.000&#43;00:00' itemprop="datePublished">2018-01-15</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/ssl">ssl</a>

<a href="https://ningyu1.github.io/site/tags/openssl">openssl</a>


</div>
    </div>
        

<h1 id="前文回顾">前文回顾</h1>

<p><a href="https://ningyu1.github.io/site/post/51-ssl-cert/">《Openssl生成自签名证书，简单步骤》</a>中讲述了如何生成自签名证书。</p>

<p><a href="https://ningyu1.github.io/site/post/52-ssl-cert-2/">《使用自签名证书，简单步骤》</a>中讲述了如何使用自签名证书。</p>

<p>下面讲述在Java中如何访问SSL地址，使用证书访问和免验证证书访问。</p>

<h1 id="java安装证书访问ssl地址">Java安装证书访问SSL地址</h1>

<h2 id="使用installcert安装证书">使用InstallCert安装证书</h2>

<p><a href="https://ningyu1.github.io/site/post/52-ssl-cert-2/">《使用自签名证书，简单步骤》</a>这篇文章中介绍的InstallCert生成jssecacerts文件。
将ssecacerts文件放入%JAVA_HOME%\jre\lib\security 下即可。</p>

<h2 id="使用keytool工具导入证书">使用keytool工具导入证书</h2>

<pre><code>keytool -import -alias xstore -keystore &quot;cacerts_path&quot; -file a.cer
</code></pre>

<ul>
<li><code>cacerts_path</code>: 你的cacerts文件路径，一般在%JAVA_HOME%jre\lib\security\cacerts</li>
<li><code>a.cer</code>: 你需要导入的cer文件路径，可以是InstallCert生成的文件</li>
<li>密码使用jdk默认密码：<code>changeit</code>，或者在上面命令后增加<code>-storepass changeit</code>设置密码参数</li>
</ul>

<p>通过上面两种方式可以将证书安装到jdk下，接下来就是java中如何访问ssl地址，不多说直接上代码。</p>

<h2 id="自定义javax-net-ssl-x509trustmanager实现类">自定义javax.net.ssl.X509TrustManager实现类</h2>

<pre><code>import java.security.cert.CertificateException;
import java.security.cert.X509Certificate;
import javax.net.ssl.X509TrustManager;

public class MyX509TrustManager implements X509TrustManager {

    @Override
    public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException {

    }

    @Override
    public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException {

    }

    @Override
    public X509Certificate[] getAcceptedIssuers() {
        return null;
    }

}
</code></pre>

<h2 id="包装httpsdemo类">包装HttpsDemo类</h2>

<p><code>HttpsDemo</code>类中包装两个方法，<code>sendHttps</code>发起ssl地址请求，<code>sendHttp</code>发起普通地址请求</p>

<pre><code>import java.io.BufferedReader;
import java.io.ByteArrayOutputStream;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.OutputStream;
import java.net.HttpURLConnection;
import java.net.URL;
import javax.net.ssl.HttpsURLConnection;
import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLSocketFactory;
import javax.net.ssl.TrustManager;
import org.apache.commons.io.IOUtils;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class HttpsDemo {

    private static final Logger logger = LoggerFactory.getLogger(HttpsDemo.class.getName());

    public static void sendHttps(String path, String outputStr) {
        InputStream inputStream = null;
        OutputStream outputStream = null;
        HttpsURLConnection httpUrlConn = null;
        BufferedReader bufferedReader = null;
        InputStreamReader inputStreamReader = null;
        StringBuffer buffer = new StringBuffer();
        try {
            // 创建SSLContext对象，并使用我们指定的信任管理器初始化
            TrustManager[] tm = { new MyX509TrustManager() };
            SSLContext sslContext = SSLContext.getInstance(&quot;SSL&quot;, &quot;SunJSSE&quot;);
            sslContext.init(null, tm, new java.security.SecureRandom());
            // 从上述SSLContext对象中得到SSLSocketFactory对象
            SSLSocketFactory ssf = sslContext.getSocketFactory();

            URL url = new URL(path);
            httpUrlConn = (HttpsURLConnection) url.openConnection();
            httpUrlConn.setSSLSocketFactory(ssf);
            httpUrlConn.setDoOutput(true);
            httpUrlConn.setDoInput(true);
            httpUrlConn.setUseCaches(false);
            httpUrlConn.setRequestMethod(&quot;GET&quot;);
            httpUrlConn.connect();

            // 当有数据需要提交时
            if (null != outputStr) {
                outputStream = httpUrlConn.getOutputStream();
                // 注意编码格式，防止中文乱码
                outputStream.write(outputStr.getBytes(&quot;UTF-8&quot;));
                outputStream.close();
            }

            // 将返回的输入流转换成字符串
            inputStream = httpUrlConn.getInputStream();
            inputStreamReader = new InputStreamReader(inputStream, &quot;utf-8&quot;);
            bufferedReader = new BufferedReader(inputStreamReader);

            String str = null;
            while ((str = bufferedReader.readLine()) != null) {
                buffer.append(str);
            }
            logger.info(&quot;地址:{}, success, result:{}&quot;, path, buffer.toString());
        } catch (Exception e) {
            logger.error(&quot;地址:{}, error, exception:{}&quot;, path, e);
        } finally {
            if (bufferedReader != null) {
                IOUtils.closeQuietly(bufferedReader);
            }
            if (inputStreamReader != null) {
                IOUtils.closeQuietly(inputStreamReader);
            }
            if (inputStream != null) {
                IOUtils.closeQuietly(inputStream);
            }
            if (httpUrlConn != null) {
                httpUrlConn.disconnect();
            }
        }
    }

    public static void sendHttp(String path) {
        InputStream inputStream = null;
        ByteArrayOutputStream outputStream = null;
        HttpURLConnection urlConnection = null;
        try {
            URL url = new URL(path);
            urlConnection = (HttpURLConnection) url.openConnection();
            urlConnection.setRequestMethod(&quot;GET&quot;);
            urlConnection.setUseCaches(false);
            inputStream = urlConnection.getInputStream();
            outputStream = new ByteArrayOutputStream();
            byte[] buffer = new byte[1024];
            int n = 0;
            while (-1 != (n = inputStream.read(buffer))) {
                outputStream.write(buffer, 0, n);
            }
            logger.info(&quot;地址:{}, success, result:{}&quot;, path, outputStream.toString());
        } catch (Exception e) {
            logger.error(&quot;地址:{}, error, exception:{}&quot;, path, e);
        } finally {
            if (outputStream != null) {
                IOUtils.closeQuietly(inputStream);
            }
            if (outputStream != null) {
                IOUtils.closeQuietly(outputStream);
            }
            if (urlConnection != null) {
                urlConnection.disconnect();
            }
        }
    }

	public static void main(String[] args) {
        sendHttps(&quot;https://xxx.com&quot;, null);
    }
}
</code></pre>

<p>上面访问ssl地址如果报错<code>java.security.cert.CertificateException: No name matching localhost found</code>那就是证书没有安装好，检查前面证书安装过程。</p>

<p>Java访问ssl其实是可以绕过证书验证的，可以不需要证书直接发起ssl地址请求，下面介绍一下。</p>

<h1 id="java绕过证书验证访问ssl地址-达到免验证证书效果">Java绕过证书验证访问SSL地址，达到免验证证书效果</h1>

<p>这种方式是采用重写HostnameVerifier的verify方法配合X509TrustManager来处理授信所有host，下面直接上代码</p>

<pre><code>import java.net.HttpURLConnection;
import java.net.URL;
import java.security.cert.X509Certificate;
import javax.net.ssl.HostnameVerifier;
import javax.net.ssl.HttpsURLConnection;
import javax.net.ssl.SSLContext;
import javax.net.ssl.SSLSession;
import javax.net.ssl.TrustManager;
import javax.net.ssl.X509TrustManager;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

public class HttpDemo {

    private static final Logger logger = LoggerFactory.getLogger(HttpDemo.class.getName());

    final static HostnameVerifier DO_NOT_VERIFY = new HostnameVerifier() {

        public boolean verify(String hostname, SSLSession session) {
            return true;
        }
    };

    public static void httpGet(String path) {
        StringBuffer tempStr = new StringBuffer();
        String responseContent = &quot;&quot;;
        HttpURLConnection conn = null;
        try {
            // Create a trust manager that does not validate certificate chains
            trustAllHosts();
            URL url = new URL(path);
            HttpsURLConnection https = (HttpsURLConnection) url.openConnection();
            if (url.getProtocol().toLowerCase().equals(&quot;https&quot;)) {
                https.setHostnameVerifier(DO_NOT_VERIFY);
                conn = https;
            } else {
                conn = (HttpURLConnection) url.openConnection();
            }
            conn.connect();
            logger.info(&quot;地址:{}, success, result:{}&quot;, path, conn.getResponseCode() + &quot; &quot; + conn.getResponseMessage());
            // HttpURLConnection conn = (HttpURLConnection)
            // url.openConnection();

            // conn.setConnectTimeout(5000);
            // conn.setReadTimeout(5000);
            // conn.setDoOutput(true);
            //
            // InputStream in = conn.getInputStream();
            // conn.setReadTimeout(10*1000);
            // BufferedReader rd = new BufferedReader(new InputStreamReader(in,
            // &quot;UTF-8&quot;));
            // String tempLine;
            // while ((tempLine = rd.readLine()) != null) {
            // tempStr.append(tempLine);
            // }
            // responseContent = tempStr.toString();
            // System.out.println(responseContent);
            // rd.close();
            // in.close();
        } catch (Exception e) {
            logger.error(&quot;地址:{}, is error&quot;, e);
        } finally {
            if (conn != null) {
                conn.disconnect();
            }
        }
    }

    /**
     * Trust every server - dont check for any certificate
     */
    private static void trustAllHosts() {

        // Create a trust manager that does not validate certificate chains
        TrustManager[] trustAllCerts = new TrustManager[] { new X509TrustManager() {

            public java.security.cert.X509Certificate[] getAcceptedIssuers() {
                return new java.security.cert.X509Certificate[] {};
            }

            public void checkClientTrusted(X509Certificate[] chain, String authType) {

            }

            public void checkServerTrusted(X509Certificate[] chain, String authType) {

            }
        } };

        // Install the all-trusting trust manager
        // 忽略HTTPS请求的SSL证书，必须在openConnection之前调用
        try {
            SSLContext sc = SSLContext.getInstance(&quot;TLS&quot;);
            sc.init(null, trustAllCerts, new java.security.SecureRandom());
            HttpsURLConnection.setDefaultSSLSocketFactory(sc.getSocketFactory());
        } catch (Exception e) {
            logger.error(&quot;trustAllHosts is error&quot;, e);
        }
    }

	public static void main(String[] args) {
        httpGet(&quot;https://xxx.com&quot;);
    }
}
</code></pre>

<p>以上代码需要注意一点：<span style="color:red"><strong>忽略HTTPS请求的SSL证书，必须在openConnection之前调用。</strong></span></p>

<h1 id="常见错误">常见错误</h1>

<h2 id="错误一">错误一</h2>

<p>如果发生如下错误，请添加vm参数：<code>-Dhttps.protocols=TLSv1.1,TLSv1.2 -Djava.net.preferIPv4Stack=true</code>，一般是jdk1.7会发生这个错误，具体原因在<a href="https://ningyu1.github.io/site/post/52-ssl-cert-2/">《使用自签名证书，简单步骤》</a>这篇文章中已经解释。</p>

<pre><code>javax.net.ssl.SSLHandshakeException: Remote host closed connection during handshake
	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:946) ~[na:1.7.0_45]
	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312) ~[na:1.7.0_45]
	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1339) ~[na:1.7.0_45]
	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1323) ~[na:1.7.0_45]
	at sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:563) ~[na:1.7.0_45]
	at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:185) ~[na:1.7.0_45]
	at sun.net.www.protocol.https.HttpsURLConnectionImpl.connect(HttpsURLConnectionImpl.java:153) ~[na:1.7.0_45]
	at HttpDemo.httpGet(HttpDemo.java:59) [classes/:na]
	at HttpDemo.main(HttpDemo.java:122) [classes/:na]
Caused by: java.io.EOFException: SSL peer shut down incorrectly
	at sun.security.ssl.InputRecord.read(InputRecord.java:482) ~[na:1.7.0_45]
	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:927) ~[na:1.7.0_45]
	... 8 common frames omitted
</code></pre>

<h2 id="错误二">错误二</h2>

<p>如果发生如下错误，是因为没有找到匹配的证书。
如果使用证书的方式访问，请检查证书安装是否错误。
如果是免验证证书访问，请检查代码没有跳过证书验证。</p>

<pre><code>javax.net.ssl.SSLHandshakeException: java.security.cert.CertificateException: No name matching xxxxxxx.com found
	at sun.security.ssl.Alerts.getSSLException(Alerts.java:192) ~[na:1.7.0_45]
	at sun.security.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1884) ~[na:1.7.0_45]
	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:276) ~[na:1.7.0_45]
	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:270) ~[na:1.7.0_45]
	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1341) ~[na:1.7.0_45]
	at sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:153) ~[na:1.7.0_45]
	at sun.security.ssl.Handshaker.processLoop(Handshaker.java:868) ~[na:1.7.0_45]
	at sun.security.ssl.Handshaker.process_record(Handshaker.java:804) ~[na:1.7.0_45]
	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1016) ~[na:1.7.0_45]
	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312) ~[na:1.7.0_45]
	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1339) ~[na:1.7.0_45]
	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1323) ~[na:1.7.0_45]
	at sun.net.www.protocol.https.HttpsClient.afterConnect(HttpsClient.java:563) ~[na:1.7.0_45]
	at sun.net.www.protocol.https.AbstractDelegateHttpsURLConnection.connect(AbstractDelegateHttpsURLConnection.java:185) ~[na:1.7.0_45]
	at sun.net.www.protocol.https.HttpsURLConnectionImpl.connect(HttpsURLConnectionImpl.java:153) ~[na:1.7.0_45]
	at HttpsDemo.sendHttps(HttpsDemo.java:62) [classes/:na]
	at HttpsDemo.main(HttpsDemo.java:133) [classes/:na]
Caused by: java.security.cert.CertificateException: No name matching xxxxxxx.com found
	at sun.security.util.HostnameChecker.matchDNS(HostnameChecker.java:208) ~[na:1.7.0_45]
	at sun.security.util.HostnameChecker.match(HostnameChecker.java:93) ~[na:1.7.0_45]
	at sun.security.ssl.X509TrustManagerImpl.checkIdentity(X509TrustManagerImpl.java:347) ~[na:1.7.0_45]
	at sun.security.ssl.AbstractTrustManagerWrapper.checkAdditionalTrust(SSLContextImpl.java:847) ~[na:1.7.0_45]
	at sun.security.ssl.AbstractTrustManagerWrapper.checkServerTrusted(SSLContextImpl.java:814) ~[na:1.7.0_45]
	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1323) ~[na:1.7.0_45]
	... 12 common frames omitted
</code></pre>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/53-ssl-cert-3/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/52-ssl-cert-2/">使用自签名证书，简单步骤</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-01-12T19:13:36.000&#43;00:00' itemprop="datePublished">2018-01-12</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/ssl">ssl</a>

<a href="https://ningyu1.github.io/site/tags/installcert">InstallCert</a>

<a href="https://ningyu1.github.io/site/tags/openssl">openssl</a>


</div>
    </div>
        

<p>在前文<a href="https://ningyu1.github.io/site/post/51-ssl-cert/">《Openssl生成自签名证书，简单步骤》</a>中讲述了如何生成自签名证书，接下来整理证书使用遇到的问题。</p>

<p>证书使用的方式也有很多中，可以使用keytool生成或导入导出证书，这里对keytool不做过多描述，可以通过&ndash;help查看使用方法。</p>

<p>证书文件可以放到应用服务器、负载均衡、jvm中使用，如：IIS、tomcat、nginx或者loadbalance、jdk等等。</p>

<p>这里介绍一个简单的工具：<code>InstallCert</code>安装证书文件到jdk下，这个在本地调试连接ssl服务器代码的时候很有用。</p>

<p>如果我们的服务端使用的是jdk1.8（比如说：cas服务），访问的客户端（业务系统）也是jdk1.8，那么直接使用<code>InstallCert</code>安装即可.</p>

<p>如果我们的服务端使用的是jdk1.8，但是客户端使用jdk1.7会遇到什么问题？</p>

<p>我们都知道jdk1.7默认的TLS版本是1.0但是支持1.1和1.2，如何查看jdk支持的TLS版本呢？</p>

<p>可以使用jdk自带的<code>jcp（java control panel）</code>工具</p>

<p><code>jcp（java control panel）</code>路径：<code>%JAVA_HOME%\jre\bin</code></p>

<p><img src="https://ningyu1.github.io/site/img/ssl-cert/2.png" alt="" /></p>

<p>点击高级，勾选TLS1.1 TSL1.2开启支持。</p>

<p>如果使用客户端程序（jdk1.7开发的）访问服务端程序（jdk1.8开发的），在使用<code>InstallCert</code>安装证书时会出现如下错误：</p>

<pre><code>javax.net.ssl.SSLHandshakeException: Remote host closed connection during handshake
    at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:946) ~[na:1.7.0_45]
    at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312) ~[na:1.7.0_45]
</code></pre>

<p>上面错误的意思就是服务器把你拒绝了！把你拒绝了！把你拒绝了！拒绝你的理由就是TLS版本不对。</p>

<p>下面我主要讲在客户端程序（jdk1.7开发的）访问服务端程序（jdk1.8开发的）的场景下安装证书如何解决上面的错误。</p>

<h1 id="通过installcert源码安装证书">通过InstallCert源码安装证书</h1>

<pre><code>/*
 * Copyright 2006 Sun Microsystems, Inc.  All Rights Reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions
 * are met:
 *
 *   - Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *
 *   - Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 *
 *   - Neither the name of Sun Microsystems nor the names of its
 *     contributors may be used to endorse or promote products derived
 *     from this software without specific prior written permission.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS
 * IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO,
 * THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
 * PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
 * CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
 * EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
 * PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
 * PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
 * LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
 * NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

import java.io.*;
import java.net.URL;

import java.security.*;
import java.security.cert.*;

import javax.net.ssl.*;

public class InstallCert {

    public static void main(String[] args) throws Exception {
    String host;
    int port;
    char[] passphrase;
    if ((args.length == 1) || (args.length == 2)) {
        String[] c = args[0].split(&quot;:&quot;);
        host = c[0];
        port = (c.length == 1) ? 443 : Integer.parseInt(c[1]);
        String p = (args.length == 1) ? &quot;changeit&quot; : args[1];
        passphrase = p.toCharArray();
    } else {
        System.out.println(&quot;Usage: java InstallCert &lt;host&gt;[:port] [passphrase]&quot;);
        return;
    }

    File file = new File(&quot;jssecacerts&quot;);
    if (file.isFile() == false) {
        char SEP = File.separatorChar;
        File dir = new File(System.getProperty(&quot;java.home&quot;) + SEP
            + &quot;lib&quot; + SEP + &quot;security&quot;);
        file = new File(dir, &quot;jssecacerts&quot;);
        if (file.isFile() == false) {
        file = new File(dir, &quot;cacerts&quot;);
        }
    }
    System.out.println(&quot;Loading KeyStore &quot; + file + &quot;...&quot;);
    InputStream in = new FileInputStream(file);
    KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());
    ks.load(in, passphrase);
    in.close();

    SSLContext context = SSLContext.getInstance(&quot;TLSv1.2&quot;);
    TrustManagerFactory tmf =
        TrustManagerFactory.getInstance(TrustManagerFactory.getDefaultAlgorithm());
    tmf.init(ks);
    X509TrustManager defaultTrustManager = (X509TrustManager)tmf.getTrustManagers()[0];
    SavingTrustManager tm = new SavingTrustManager(defaultTrustManager);
    context.init(null, new TrustManager[] {tm}, null);
    SSLSocketFactory factory = context.getSocketFactory();

    System.out.println(&quot;Opening connection to &quot; + host + &quot;:&quot; + port + &quot;...&quot;);
    SSLSocket socket = (SSLSocket)factory.createSocket(host, port);
    socket.setSoTimeout(10000);
    try {
        System.out.println(&quot;Starting SSL handshake...&quot;);
        socket.startHandshake();
        socket.close();
        System.out.println();
        System.out.println(&quot;No errors, certificate is already trusted&quot;);
    } catch (SSLException e) {
        System.out.println();
        e.printStackTrace(System.out);
    }

    X509Certificate[] chain = tm.chain;
    if (chain == null) {
        System.out.println(&quot;Could not obtain server certificate chain&quot;);
        return;
    }

    BufferedReader reader =
        new BufferedReader(new InputStreamReader(System.in));

    System.out.println();
    System.out.println(&quot;Server sent &quot; + chain.length + &quot; certificate(s):&quot;);
    System.out.println();
    MessageDigest sha1 = MessageDigest.getInstance(&quot;SHA1&quot;);
    MessageDigest md5 = MessageDigest.getInstance(&quot;MD5&quot;);
    for (int i = 0; i &lt; chain.length; i++) {
        X509Certificate cert = chain[i];
        System.out.println
            (&quot; &quot; + (i + 1) + &quot; Subject &quot; + cert.getSubjectDN());
        System.out.println(&quot;   Issuer  &quot; + cert.getIssuerDN());
        sha1.update(cert.getEncoded());
        System.out.println(&quot;   sha1    &quot; + toHexString(sha1.digest()));
        md5.update(cert.getEncoded());
        System.out.println(&quot;   md5     &quot; + toHexString(md5.digest()));
        System.out.println();
    }

    System.out.println(&quot;Enter certificate to add to trusted keystore or 'q' to quit: [1]&quot;);
    String line = reader.readLine().trim();
    int k;
    try {
        k = (line.length() == 0) ? 0 : Integer.parseInt(line) - 1;
    } catch (NumberFormatException e) {
        System.out.println(&quot;KeyStore not changed&quot;);
        return;
    }

    X509Certificate cert = chain[k];
    String alias = host + &quot;-&quot; + (k + 1);
    ks.setCertificateEntry(alias, cert);

    OutputStream out = new FileOutputStream(&quot;jssecacerts&quot;);
    ks.store(out, passphrase);
    out.close();

    System.out.println();
    System.out.println(cert);
    System.out.println();
    System.out.println
        (&quot;Added certificate to keystore 'jssecacerts' using alias '&quot;
        + alias + &quot;'&quot;);
    }

    private static final char[] HEXDIGITS = &quot;0123456789abcdef&quot;.toCharArray();

    private static String toHexString(byte[] bytes) {
    StringBuilder sb = new StringBuilder(bytes.length * 3);
    for (int b : bytes) {
        b &amp;= 0xff;
        sb.append(HEXDIGITS[b &gt;&gt; 4]);
        sb.append(HEXDIGITS[b &amp; 15]);
        sb.append(' ');
    }
    return sb.toString();
    }

    private static class SavingTrustManager implements X509TrustManager {

    private final X509TrustManager tm;
    private X509Certificate[] chain;

    SavingTrustManager(X509TrustManager tm) {
        this.tm = tm;
    }

    public X509Certificate[] getAcceptedIssuers() {
//        throw new UnsupportedOperationException();
        return new X509Certificate[0];
    }

    public void checkClientTrusted(X509Certificate[] chain, String authType)
        throws CertificateException {
        throw new UnsupportedOperationException();
    }

    public void checkServerTrusted(X509Certificate[] chain, String authType)
        throws CertificateException {
        this.chain = chain;
        tm.checkServerTrusted(chain, authType);
    }
    }

}
</code></pre>

<p>上面源码我修改了<code>SSLContext context = SSLContext.getInstance(&quot;TLSv1.2&quot;);</code>，原本是TLS，这样在jdk1.7下会报错，尽管加了vm参数：<code>-Dhttps.protocols=TLSv1.1,TLSv1.2 -Djava.net.preferIPv4Stack=true</code>，依然会报错。</p>

<p>修改为TLSv1.2后，直接运行代码，参数为：你需要签名的域名</p>

<p>运行日志会出现如下错误（不用紧张，这个错误没有关系）：</p>

<pre><code>Opening connection to login.xxxxx.com.cn:443...
Starting SSL handshake...

javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
	at sun.security.ssl.Alerts.getSSLException(Alerts.java:192)
	at sun.security.ssl.SSLSocketImpl.fatal(SSLSocketImpl.java:1884)
	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:276)
	at sun.security.ssl.Handshaker.fatalSE(Handshaker.java:270)
	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1341)
	at sun.security.ssl.ClientHandshaker.processMessage(ClientHandshaker.java:153)
	at sun.security.ssl.Handshaker.processLoop(Handshaker.java:868)
	at sun.security.ssl.Handshaker.process_record(Handshaker.java:804)
	at sun.security.ssl.SSLSocketImpl.readRecord(SSLSocketImpl.java:1016)
	at sun.security.ssl.SSLSocketImpl.performInitialHandshake(SSLSocketImpl.java:1312)
	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1339)
	at sun.security.ssl.SSLSocketImpl.startHandshake(SSLSocketImpl.java:1323)
	at InstallCert.main(InstallCert.java:99)
Caused by: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
	at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:385)
	at sun.security.validator.PKIXValidator.engineValidate(PKIXValidator.java:292)
	at sun.security.validator.Validator.validate(Validator.java:260)
	at sun.security.ssl.X509TrustManagerImpl.validate(X509TrustManagerImpl.java:326)
	at sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:231)
	at sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:107)
	at InstallCert$SavingTrustManager.checkServerTrusted(InstallCert.java:195)
	at sun.security.ssl.AbstractTrustManagerWrapper.checkServerTrusted(SSLContextImpl.java:813)
	at sun.security.ssl.ClientHandshaker.serverCertificate(ClientHandshaker.java:1323)
	... 8 more
Caused by: sun.security.provider.certpath.SunCertPathBuilderException: unable to find valid certification path to requested target
	at sun.security.provider.certpath.SunCertPathBuilder.engineBuild(SunCertPathBuilder.java:196)
	at java.security.cert.CertPathBuilder.build(CertPathBuilder.java:268)
	at sun.security.validator.PKIXValidator.doBuild(PKIXValidator.java:380)
	... 16 more

Server sent 1 certificate(s):

 1 Subject EMAILADDRESS=ningyu@xxxxxx.com, CN=login.xxxxxxx.com, OU=JY, O=JY, L=Shanghai, ST=Shanghai, C=CN
   Issuer  EMAILADDRESS=ningyu@xxxxxx.com, CN=login.xxxxxxx.com, OU=JY, O=JY, L=Shanghai, ST=Shanghai, C=CN
   sha1    18 fe a4 26 de 9f ef 9f d0 12 f9 1b da e8 f4 6e 46 a3 ca e2 
   md5     53 02 53 bc 1f 5d e3 0f c2 ce a5 fa 43 7b 53 83 

Enter certificate to add to trusted keystore or 'q' to quit: [1]
</code></pre>

<p>出现上面错误没关系，在命令行输入：1，生成文件，会在执行目录下生成：jssecacerts，并且会输出下面的日志：</p>

<pre><code>Enter certificate to add to trusted keystore or 'q' to quit: [1]
1

[
[
  Version: V1
  Subject: EMAILADDRESS=ningyu@xxxxx.com, CN=login.xxxxxxx.com, OU=JY, O=JY, L=Shanghai, ST=Shanghai, C=CN
  Signature Algorithm: SHA256withRSA, OID = 1.2.840.113549.1.1.11

  Key:  Sun RSA public key, 1024 bits
  modulus: 150111273197244637724411949927732292545940427223472330318676441758610292860528090849280500452765059055376192276098938042951946335160244351904122898746077164287399465663417510841977938344538423662939325238497292924898237072606839002269269847753256718676717424760603548961942760492908854629736493402902120207483
  public exponent: 65537
  Validity: [From: Fri Jan 12 15:15:03 CST 2018,
               To: Mon Jan 10 15:15:03 CST 2028]
  Issuer: EMAILADDRESS=ningyu@xxxxxx.com, CN=login.xxxxxx.com, OU=JY, O=JY, L=Shanghai, ST=Shanghai, C=CN
  SerialNumber: [    b9c6224c 0cf5ee1a]

]
  Algorithm: [SHA256withRSA]
  Signature:
0000: B7 F8 1B FB 3C 7E 46 31   9C 56 31 47 F5 79 2C AA  ....&lt;.F1.V1G.y,.
0010: B0 E3 FB EA CF 6C 15 72   53 8B A9 36 1D 43 E0 AB  .....l.rS..6.C..
0020: 21 3C BD 65 51 11 B3 D6   5B 42 40 DB 07 9C 35 5C  !&lt;.eQ...[B@...5\
0030: 84 9B B7 B8 02 5A E0 96   5D 5F 9E 5D B3 5F 85 A8  .....Z..]_.]._..
0040: 50 64 63 E7 12 B0 DF CA   48 DD 28 B7 B2 8D 42 33  Pdc.....H.(...B3
0050: A5 C1 E8 E1 41 08 F8 39   21 DD 6C BE 6E F1 CD EE  ....A..9!.l.n...
0060: F9 C0 DC 2F 1E 99 D2 DC   A3 2C C7 C2 64 ED 94 5E  .../.....,..d..^
0070: 32 6F CC B4 3D 93 B7 F8   09 8D F9 4E 39 CA 5E 53  2o..=......N9.^S

]

Added certificate to keystore 'jssecacerts' using alias 'login.xxxxxx.com-1'

</code></pre>

<p>这个时候再运行一遍<code>InstallCert</code>就不会报错，因为已经有jssecacerts文件，直接copy jssecacerts文件到%JAVA_HOME%\jre\lib\security下，就可以愉快的玩耍了。</p>

<p>这个在我们本地调试连接ssl服务器的代码时很有用，如果不把证书放入jdk下你会被无限的拒绝。</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/52-ssl-cert-2/#disqus_thread">Comments</a></span>
    
    
</div>
</article>



  <nav id="pagenavi">
    
        <a href="https://ningyu1.github.io/site/page/5/" class="prev">Prev</a>
    
    
        <a href="https://ningyu1.github.io/site/page/7/" class="next">Next</a>
    
    <div class="center"><a href="https://ningyu1.github.io/site/archives/index.html">Blog Archives</a></div>
  </nav>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2024
    
    凝雨-Yun
    . Powered by <a href="http://gohugo.io" target="_blank">Hugo</a> |
    Theme is <a href="https://github.com/wd/hugo-fabric">hugo-fabric</a>
</div>

    </footer>
    <script src="https://ningyu1.github.io/site/js/fabric.js"></script>


</div>
</div>
<script src="https://ningyu1.github.io/site/js/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
 
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery);
 
</script>
</body>
</html>
