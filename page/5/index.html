<!DOCTYPE HTML>
<html>
<head>
	<meta name="generator" content="Hugo 0.51" />
	<meta charset="utf-8">
    
    
    <title>凝雨 - Yun</title>
    <meta name="author" content="凝雨-Yun">
    <meta name="description" content="">
    <meta name="keywords" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <link href="https://ningyu1.github.io/site/index.xml" rel="alternate" title="凝雨 - Yun" type="application/atom+xml">
    <link href="https://ningyu1.github.io/site/images/fav.ico" rel="shortcut icon">
    <style>
    @charset "UTF-8";
@font-face {
  font-family: 'FontAwesome';
  src: url("https://ningyu1.github.io/site/font/fontawesome-webfont.eot");
  src: url("https://ningyu1.github.io/site/font/fontawesome-webfont.eot?#iefix") format("embedded-opentype"),
  url("https://ningyu1.github.io/site/font/fontawesome-webfont.woff") format("woff"),
  url("https://ningyu1.github.io/site/font/fontawesome-webfont.ttf") format("truetype"),
  url("https://ningyu1.github.io/site/font/fontawesome-webfont.svgz#FontAwesomeRegular") format("svg"),
  url("https://ningyu1.github.io/site/font/fontawesome-webfont.svg#FontAwesomeRegular") format("svg");
  font-weight: normal;
  font-style: normal; }

@font-face{
    font-family: 'MyHermit';
    src: url('https://ningyu1.github.io/site/font/hermit-medium-webfont.eot');
    src: url('https://ningyu1.github.io/site/font/hermit-medium-webfont.eot?#iefix') format('embedded-opentype'),
         url('https://ningyu1.github.io/site/font/hermit-medium-webfont.woff') format('woff'),
         url('https://ningyu1.github.io/site/font/hermit-medium-webfont.ttf') format('truetype');
}

* {
  margin: 0;
  padding: 0; }

body {
  font-family: 'PingFang SC', serif;
  font-weight: 300;
  font-size: 16px;
  /*background: url("https://ningyu1.github.io/site/images/retina_dust.png");*/
  color: #444;
  colori: #666666; }
  @media screen and (max-width: 1040px) {
    body {
      margin: 0 20px; } }
  @media screen and (max-width: 600px) {
    body {
      font-size: 13px; } }

.bBackground {
  position: fixed;
  height: 100%;
  width: 100%;
  background: -moz-radial-gradient(50% 50%, farthest-side, white, #efefef);
  background: -webkit-gradient(radial, 50% 50%, 250, 50% 50%, 750, from(white), to(#bbbbbb));
  z-index: -100; }

h1 {
  font-size: 1.8em; }

h2 {
  font-family: 'Fjalla One', sans-serif;
  font-size: 1.5em; }

h3 {
  font-size: 1.3em; }

a {
  text-decoration: none;
  outline-width: 0;
  color: #258fb8; }

.alignleft {
  float: left; }

.alignright {
  float: right; }

.clearfix {
  *zoom: 1; }
  .clearfix:after {
    content: "";
    display: table;
    clear: both; }

.inner {
  width: 900px;
  margin: 0 auto; }
  @media screen and (max-width: 1040px) {
    .inner {
      width: 100%; } }

#w2btoTop {
  display: none;
  text-decoration: none;
  position: fixed;
  bottom: 10px;
  right: 10px;
  overflow: hidden;
  width: 51px;
  height: 51px;
  border: none;
  text-indent: -999px;
  background: url(https://ningyu1.github.io/site/images/totop.png) no-repeat left top; }

#w2btoTopHover {
  background: url(https://ningyu1.github.io/site/images/totop.png) no-repeat left -51px;
  width: 51px;
  height: 51px;
  display: block;
  overflow: hidden;
  float: left;
  opacity: 0;
  -moz-opacity: 0;
  filter: alpha(opacity=0); }

#w2btoTop:active, #w2btoTop:focus {
  outline: none; }

.basic-alignment.left, article .entry-content img.left, article .entry-content video.left {
  float: left;
  margin-right: 1.5em; }
.basic-alignment.right, article .entry-content img.right, article .entry-content video.right {
  float: right;
  margin-left: 1.5em; }
.basic-alignment.center, article .entry-content img.center, article .entry-content video.center {
  display: block;
  margin: 0 auto 1.5em; }
.basic-alignment.left, article .entry-content img.left, article .entry-content video.left, .basic-alignment.right, article .entry-content img.right, article .entry-content video.right {
  margin-bottom: .8em; }

/* changes tooltip, to use, make elements 'class' as 'tooltip' and 'title' would be shown in tooltip */
.tooltip {
  display: inline;
  position: relative; }

.tooltip:hover {
  text-decoration: none; }

.tooltip:hover:after {
  background: #111;
  background: rgba(0, 0, 0, 0.8);
  border-radius: 5px;
  bottom: 18px;
  color: #fff;
  content: attr(title);
  display: block;
  left: 50%;
  padding: 5px 15px;
  position: absolute;
  white-space: nowrap;
  z-index: 98; }

.tooltip:hover:before {
  border: solid;
  border-color: #111 transparent;
  border-width: 6px 6px 0 6px;
  bottom: 12px;
  content: "";
  display: block;
  left: 75%;
  position: absolute;
  z-index: 99; }

.pullquote-right:before,
.pullquote-left:before {
  /* Reset metrics. */
  padding: 0;
  border: none;
  /* Content */
  content: attr(data-pullquote);
  /* Pull out to the right, modular scale based margins. */
  float: right;
  width: 45%;
  margin: .5em 0 1em 1.5em;
  /* Baseline correction */
  position: relative;
  top: 7px;
  font-size: 1.4em;
  line-height: 1.45em; }

.pullquote-left:before {
  /* Make left pullquotes align properly. */
  float: left;
  margin: .5em 1.5em 1em 0; }

#header {
  padding: 20px 0 20px 0; }
  @media screen and (max-width: 1040px) {
    #header {
      height: auto;
      position: relative;
      padding-bottom: 10px; } }
  #header a {
    color: #666666;
    -webkit-transition: compact(compact(color 0.3s, false, false, false, false, false, false, false, false, false) false false);
    -moz-transition: compact(compact(color 0.3s, false, false, false, false, false, false, false, false, false) false false false);
    -o-transition: compact(compact(color 0.3s, false, false, false, false, false, false, false, false, false) false false false);
    transition: compact(color 0.3s, false, false, false, false, false, false, false, false, false); }
    #header a:hover {
      color: #258fb8; }
  #header h1 {
    font-family: 'Slackey', cursive;
    font-weight: 300;
    font-size: 52px; }
    @media screen and (max-width: 1040px) {
      #header h1 {
        float: none; } }

#headerbg {
  text-align: center;
  background: #444;
  padding: 10px 10px;
  display: table;
  color: #fff;
  margin: 0 auto;
  border-radius: 5px;
  font-weight: bold;
  -webkit-mask-image: -webkit-linear-gradient(black, rgba(0, 0, 0, 0.9));
  -webkit-backface-visibility: hidden;
  -moz-backface-visibility: hidden;
  -ms-backface-visibility: hidden;
  -o-backface-visibility: hidden;
  backface-visibility: hidden;
  -webkit-animation-duration: 1s;
  -webkit-animation-delay: .2s;
  -webkit-animation-timing-function: ease;
  -webkit-animation-fill-mode: both;
  -moz-animation-duration: 1s;
  -moz-animation-delay: .2s;
  -moz-animation-timing-function: ease;
  -moz-animation-fill-mode: both;
  -ms-animation-duration: 1s;
  -ms-animation-delay: .2s;
  -ms-animation-timing-function: ease;
  -ms-animation-fill-mode: both;
  -o-animation-duration: 1s;
  -o-animation-delay: .2s;
  -o-animation-timing-function: ease;
  -o-animation-fill-mode: both;
  animation-duration: 1s;
  animation-delay: .2s;
  animation-timing-function: ease;
  animation-fill-mode: both; }

#load {
  display: none;
  position: absolute;
  right: 50%;
  top: 50%;
  background: url("https://ningyu1.github.io/site/images/loading.gif");
  width: 50px;
  height: 50px;
  text-indent: -9999em; }

#social-links li {
  display: inline-block;
  width: 35px;
  height: 35px;
  border-radius: 35px;
  margin-top: 20px;
  margin-right: 9px;
  background-color: #ddd;
  text-align: center;
  line-height: 35px;
  -webkit-transition: compact(compact(background-color 1s ease-in-out, false, false, false, false, false, false, false, false, false) false false);
  -moz-transition: compact(compact(background-color 1s ease-in-out, false, false, false, false, false, false, false, false, false) false false false);
  -o-transition: compact(compact(background-color 1s ease-in-out, false, false, false, false, false, false, false, false, false) false false false);
  transition: compact(background-color 1s ease-in-out, false, false, false, false, false, false, false, false, false); }
  #social-links li:hover {
    background-color: #555; }
#social-links a {
  display: inline-block;
  position: relative;
  width: 100%;
  height: 100%; }
  #social-links a svg {
    position: absolute; }
  #social-links a .github {
    top: 3px;
    left: 2px; }
  #social-links a .sina-weibo {
    top: 8px;
    left: 6px; }
  #social-links a .tencent-weibo {
    top: 6px;
    left: 4px; }
  #social-links a .twitter {
    top: 2px;
    left: 3px; }

a.facebook {
  background: url("https://ningyu1.github.io/site/images/social/Facebook.png") center no-repeat; }

a.facebook:hover {
  background: url("https://ningyu1.github.io/site/images/social/FacebookH.png") center no-repeat; }

a.github {
  background: url("https://ningyu1.github.io/site/images/social/Github.png") center no-repeat; }

a.github:hover {
  background: url("https://ningyu1.github.io/site/images/social/GithubH.png") center no-repeat; }

a.gitee {
  background: url("https://ningyu1.github.io/site/images/social/Gitee.png") center no-repeat; }

a.gitee:hover {
  background: url("https://ningyu1.github.io/site/images/social/GiteeH.png") center no-repeat; }

a.gitlab {
  background: url("https://ningyu1.github.io/site/images/social/Gitlab.png") center no-repeat; }

a.gitlab:hover {
  background: url("https://ningyu1.github.io/site/images/social/GitlabH.png") center no-repeat; }

a.email {
  background: url("https://ningyu1.github.io/site/images/social/Email.png") center no-repeat; }

a.email:hover {
  background: url("https://ningyu1.github.io/site/images/social/EmailH.png") center no-repeat; }

a.rss {
  background: url("https://ningyu1.github.io/site/images/social/Rss.png") center no-repeat; }

a.rss:hover {
  background: url("https://ningyu1.github.io/site/images/social/RssH.png") center no-repeat; }

a.twitter {
  background: url("https://ningyu1.github.io/site/images/social/Twitter.png") center no-repeat; }

a.twitter:hover {
  background: url("https://ningyu1.github.io/site/images/social/TwitterH.png") center no-repeat; }

a.google {
  background: url("https://ningyu1.github.io/site/images/social/Picasa.png") center no-repeat; }

a.google:hover {
  background: url("https://ningyu1.github.io/site/images/social/PicasaH.png") center no-repeat; }

a.skype {
  background: url("https://ningyu1.github.io/site/images/social/Skype.png") center no-repeat; }

a.skype:hover {
  background: url("https://ningyu1.github.io/site/images/social/SkypeH.png") center no-repeat; }

a.linkedin {
  background: url("https://ningyu1.github.io/site/images/social/LinkedIn.png") center no-repeat; }

a.linkedin:hover {
  background: url("https://ningyu1.github.io/site/images/social/LinkedInH.png") center no-repeat; }

a.youtube {
  background: url("https://ningyu1.github.io/site/images/social/Youtube.png") center no-repeat; }

a.youtube:hover {
  background: url("https://ningyu1.github.io/site/images/social/YoutubeH.png") center no-repeat; }

a.lastfm {
  background: url("https://ningyu1.github.io/site/images/social/LastFM.png") center no-repeat; }

a.lastfm:hover {
  background: url("https://ningyu1.github.io/site/images/social/LastFMH.png") center no-repeat; }

/* search bar */
#search {
  display: inline; }

#search input[type="text"] {
  background: url("https://ningyu1.github.io/site/images/search-dark.png") no-repeat 10px 6px #444444;
  border: 0 none;
  font: bold 12px Arial,Helvetica,Sans-serif;
  color: #777;
  width: 110px;
  padding: 6px 15px 6px 35px;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  border-radius: 20px;
  text-shadow: 0 2px 2px rgba(0, 0, 0, 0.3);
  -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  -webkit-transition: all 0.7s ease 0s;
  -moz-transition: all 0.7s ease 0s;
  -o-transition: all 0.7s ease 0s;
  transition: all 0.7s ease 0s; }

#search input[type="text"]:focus {
  width: 160px; }

#dark {
  display: inline-block;
  height: 70px; }

#dark #search input[type="text"] {
  background: url("https://ningyu1.github.io/site/images/search-dark.png") no-repeat 10px 6px #444444;
  border: 0 none;
  font: bold 12px Arial,Helvetica,Sans-serif;
  color: #ddd;
  width: 110px;
  padding: 6px 15px 6px 35px;
  -webkit-border-radius: 20px;
  -moz-border-radius: 20px;
  border-radius: 20px;
  text-shadow: 0 2px 2px rgba(0, 0, 0, 0.3);
  -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  box-shadow: 0 1px 0 rgba(255, 255, 255, 0.1), 0 1px 3px rgba(0, 0, 0, 0.2) inset;
  -webkit-transition: all 0.4s ease 0s;
  -moz-transition: all 0.4s ease 0s;
  -o-transition: all 0.4s ease 0s;
  transition: all 0.4s ease 0s; }

#dark #search input[type="text"]:focus {
  width: 160px;
  outline: 0; }

/* nav */
#nav {
  text-align: center;
  position: relative;
  margin: 10px auto; }

ul#nav *{
	box-sizing:content-box
}

ul#nav li {
  display: inline-block; }

ul#nav li {
  list-style-type: none;
  background-repeat: no-repeat;
  overflow: hidden;
  margin-right: 1px; }

ul#nav li a {
  display: inline-block;
  width: 110px;
  height: 40px;
  text-align: center;
  padding-top: 20px;
  padding-bottom: 20px;
  color: #222;
  font-weight: normal;
  text-decoration: none;
  font-family: "Lucida Grande", Arial, Helvetica, sans-serif;
  text-transform: uppercase;
  font-size: 16px;
  font-style: normal;
  text-shadow: 1px 1px 10px #222;
  overflow: hidden; }

ul#nav li a:hover {
  color: #fff;
  font-style: normal;
  font-weight: normal;
  background-image: url("https://ningyu1.github.io/site/images/hover.png");
  background-repeat: no-repeat;
  background-position: center top; }

ul#nav li a:active {
  position: relative;
  top: 2px; }

ul#nav li#active a {
  color: #FFF;
  background-image: url("https://ningyu1.github.io/site/images/active.png");
  background-repeat: no-repeat;
  background-position: center top; }

#pagenavi {
  padding: 20px 0;
  height: 20px;
  line-height: 20px;
  position: relative;
  border-top: 1px solid white;
  border-bottom: 1px solid #dddddd; }
  #pagenavi a:hover {
    text-decoration: underline; }
  #pagenavi .prev, #pagenavi .next {
    position: absolute; }
  #pagenavi .prev {
    padding-left: 30px;
    left: 0; }
    #pagenavi .prev:before {
      content: "\f060";
      font: 1.3em FontAwesome;
      position: absolute;
      left: 0; }
  #pagenavi .next {
    padding-right: 30px;
    right: 0; }
    #pagenavi .next:before {
      content: "\f061";
      font: 1.3em FontAwesome;
      position: absolute;
      right: 0; }
  #pagenavi .center {
    text-align: center;
    width: 100%;
    display: block; }
    @media screen and (max-width: 400px) {
      #pagenavi .center {
        display: none; } }

article {
  border-bottom: 1px solid #dddddd;
  padding: 30px 0;
  position: relative; }
  @media screen and (max-width: 800px) {
    article {
      padding-bottom: 15px; } }
  @media screen and (max-width: 600px) {
    article {
      padding: 15px 0; } }
  article h2.title {
    font-family: 'Fjalla One', sans-serif;
    font-size: 2em;
    font-weight: 300;
    line-height: 35px;
    margin-bottom: 20px; }
    article h2.title a {
      color: #1094e8; }
  article .title a {
    color: #7c7873;
    -webkit-transition: all 1s ease-in-out;
    -moz-transition: all 1s ease-in-out;
    -o-transition: all 1s ease-in-out;
    transition: all 1s ease-in-out; }
  article .title a:hover {
    color: #084B8A;
    text-shadow: 3px 3px 12px #888;
    -webkit-transform: scale(1.3);
    -moz-transform: scale(1.3); }
  article .entry-content {
    line-height: 2;
    text-align: justify; }
    article .entry-content a:hover {
      text-decoration: underline; }
    article .entry-content .more-link {
      display: block;
      margin-top: 16px;
      padding-left: 30px;
      position: relative; }
      article .entry-content .more-link:before {
        content: "\f061";
        font: 1.3em FontAwesome;
        line-height: 1.6em;
        position: absolute;
        left: 0; }
    article .entry-content p, article .entry-content blockquote, article .entry-content ul, article .entry-content ol, article .entry-content dl, article .entry-content iframe, article .entry-content h1, article .entry-content h2, article .entry-content h3, article .entry-content h4, article .entry-content h5, article .entry-content h6, article .entry-content .video-container {
      margin-top: 10px; }
    article .entry-content ul, article .entry-content ol, article .entry-content dl {
      margin-left: 20px; }
      article .entry-content ul ul, article .entry-content ul ol, article .entry-content ul dl, article .entry-content ol ul, article .entry-content ol ol, article .entry-content ol dl, article .entry-content dl ul, article .entry-content dl ol, article .entry-content dl dl {
        margin-top: 0; }
    article .entry-content strong {
      font-weight: bold; }
    article .entry-content em {
      font-style: italic; }
    article .entry-content p {
      margin-top: 10px; }
    article .entry-content h2 {
      font-weight: 300;
      border-bottom: 1px solid #dddddd;
      position: relative; }
      article .entry-content h2:before {
        content: "";
        position: absolute;
        bottom: -2px;
        border-bottom: 1px solid white;
        width: 100%; }
    article .entry-content img, article .entry-content video {
      margin: 10px 0;
      max-width: 100%;
      height: auto;
      -moz-border-radius: 0.3em;
      -webkit-border-radius: 0.3em;
      -o-border-radius: 0.3em;
      -ms-border-radius: 0.3em;
      -khtml-border-radius: 0.3em;
      border-radius: 0.3em;
      -moz-box-shadow: rgba(0, 0, 0, 0.75) 0 1px 4px;
      -webkit-box-shadow: rgba(0, 0, 0, 0.75) 0 1px 4px;
      -o-box-shadow: rgba(0, 0, 0, 0.75) 0 1px 4px;
      box-shadow: rgba(0, 0, 0, 0.75) 0 1px 4px;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
      -ms-box-sizing: border-box;
      box-sizing: border-box;
      border: #fff 0.3em solid; }
    article .entry-content img.noborder, article .entry-content video.noborder {
      border: none;
      box-shadow: none; }
    article .entry-content blockquote {
      background: #dddddd;
      border-left: 5px solid #cccccc;
      padding: 15px 20px;
      margin-top: 10px; }
      article .entry-content blockquote > p:first-of-type {
        margin-top: 0; }
    article .entry-content iframe {
      border: none; }
    article .entry-content .caption {
      display: block;
      font-size: 0.9em;
      color: #999999;
      padding-left: 25px;
      position: relative; }
      article .entry-content .caption:before {
        content: "\f040";
        color: #cccccc;
        font: 1.3em FontAwesome;
        line-height: 1.6em;
        position: absolute;
        left: 0; }
    article .entry-content .video-container {
      position: relative;
      padding-bottom: 56.25%;
      padding-top: 30px;
      height: 0;
      overflow: hidden; }
      article .entry-content .video-container iframe, article .entry-content .video-container object, article .entry-content .video-container embed {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        margin-top: 0; }

.share {
  padding: 15px 0;
  border-top: 1px solid white;
  border-bottom: 1px solid #dddddd; }

@media screen and (max-width: 800px) {
  .post h2.title, .post .entry-content {
    margin-left: 0; } }
.post .meta {
  line-height: 2;
  color: #999999;
  width: 370px; }
  @media screen and (max-width: 800px) {
    .post .meta {
      margin-top: 15px;
      position: static;
      width: auto; } }
  .post .meta a {
    color: #999999;
    -webkit-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false);
    -moz-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
    -o-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
    transition: compact(0.3s, false, false, false, false, false, false, false, false, false); }
    .post .meta a:hover {
      color: #666666; }
  .post .meta .date, .post .meta .tags, .post .meta .comments {
    padding-left: 30px;
    position: relative; }
    .post .meta .date:before, .post .meta .tags:before, .post .meta .comments:before {
      color: #cccccc;
      font: 1.3em FontAwesome;
      line-height: 1.6em;
      position: absolute;
      left: 0; }
    @media screen and (max-width: 800px) {
      .post .meta .date, .post .meta .tags, .post .meta .comments {
        display: -moz-inline-stack;
        display: inline-block;
        vertical-align: middle;
        *vertical-align: auto;
        zoom: 1;
        *display: inline;
        margin-right: 30px; } }
  .post .meta .date:before {
    content: "\f073"; }
  .post .meta .tags:before {
    content: "\f02c"; }
  .post .meta .comments:before {
    content: "\f075"; }

.archives {
  position: relative; }
  .archives:last-of-type:before {
    content: "";
    position: absolute;
    bottom: 0;
    width: 200px;
    border-top: 1px solid #dddddd; }
  .archives .top-border-padding {
    border-top: 1px solid #fff; }
    .archives .top-border-padding:before {
      content: "";
      position: absolute;
      top: -1px;
      width: 100%;
      border-top: 1px solid #dddddd; }
  .archives .year {
    line-height: 35px;
    width: 200px;
    position: absolute;
    top: 0;
    padding-top: 15px;
    border-top: 1px solid #fff; }
    .archives .year:before {
      content: "";
      position: absolute;
      top: -2px;
      width: 100%;
      border-top: 1px solid #dddddd; }
    @media screen and (max-width: 600px) {
      .archives .year {
        position: relative;
        width: 100%; } }
  .archives article {
    margin-left: 200px;
    padding: 10px 0; }
    @media screen and (max-width: 600px) {
      .archives article {
        margin-left: 0; }
        .archives article:first-of-type {
          border-top: none;
          padding-top: 30px; } }
    .archives article .title {
      margin-bottom: 0;
      font-size: 25px; }
    .archives article .meta {
      color: #999999;
      font-size: 0.9em;
      line-height: 2;
      margin-top: 10px; }
      @media screen and (max-width: 600px) {
        .archives article .meta {
          display: none; } }
      .archives article .meta span {
        margin-right: 30px;
        display: -moz-inline-stack;
        display: inline-block;
        vertical-align: middle;
        *vertical-align: auto;
        zoom: 1;
        *display: inline; }
        .archives article .meta span:before {
          color: #cccccc;
          font: 1.3em FontAwesome;
          padding-right: 10px; }
      .archives article .meta a {
        color: #999999;
        -webkit-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false);
        -moz-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
        -o-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
        transition: compact(0.3s, false, false, false, false, false, false, false, false, false); }
        .archives article .meta a:hover {
          color: #666666; }
      .archives article .meta .date:before {
        content: "\f073"; }
      .archives article .meta .tags:before {
        content: "\f02c"; }
      .archives article .meta .comments:before {
        content: "\f075"; }

#comment {
  padding: 30px 0;
  border-top: 1px solid white;
  border-bottom: 1px solid #dddddd; }
  #comment h2.title {
    font-size: 25px;
    font-weight: 300;
    line-height: 35px;
    margin-bottom: 20px; }

footer {
  padding: 20px 0;
  text-align: center;
  font-size: 0.6em;
  color: #666; }

footer a {
  color: #123; }

footer a:hover {
  color: #456; }

#banner {
  color: #999999;
  padding: 30px 0;
  line-height: 30px;
  text-align: center;
  position: relative;
  display: none;
  border-top: 1px solid white;
  border-bottom: 1px solid #dddddd; }
  #banner:hover a {
    color: #258fb8; }
  #banner a {
    color: #999999;
    -webkit-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false);
    -moz-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
    -o-transition: compact(compact(0.3s, false, false, false, false, false, false, false, false, false) false false false);
    transition: compact(0.3s, false, false, false, false, false, false, false, false, false); }
    #banner a:hover {
      text-decoration: underline; }
  #banner small {
    position: absolute;
    right: 0;
    bottom: 0; }
  #banner .loading {
    background: image-url("loading_pacman.gif") center no-repeat;
    text-indent: -9999px; }
  #banner .container {
    height: 30px;
    overflow: hidden;
    position: relative;
    display: none; }
    #banner .container .feed {
      list-style: none;
      position: absolute;
      top: 0;
      width: 100%; }
      #banner .container .feed li {
        position: relative; }
        #banner .container .feed li small {
          position: absolute;
          right: 0; }

/*! fancyBox v2.0.6 fancyapps.com | fancyapps.com/fancybox/#license */
.fancybox-tmp iframe, .fancybox-tmp object {
  vertical-align: top;
  padding: 0;
  margin: 0; }

.fancybox-wrap {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 8020; }

.fancybox-skin {
  position: relative;
  padding: 0;
  margin: 0;
  background: #f9f9f9;
  color: #444;
  text-shadow: none;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  -ms-border-radius: 4px;
  -o-border-radius: 4px;
  border-radius: 4px; }

.fancybox-opened {
  z-index: 8030; }

.fancybox-opened .fancybox-skin {
  -webkit-box-shadow: compact(0 10px 25px rgba(0, 0, 0, 0.5), false, false, false, false, false, false, false, false, false);
  -moz-box-shadow: compact(0 10px 25px rgba(0, 0, 0, 0.5), false, false, false, false, false, false, false, false, false);
  box-shadow: compact(0 10px 25px rgba(0, 0, 0, 0.5), false, false, false, false, false, false, false, false, false); }

.fancybox-outer, .fancybox-inner {
  padding: 0;
  margin: 0;
  position: relative;
  outline: none; }

.fancybox-inner {
  overflow: hidden; }

.fancybox-type-iframe .fancybox-inner {
  -webkit-overflow-scrolling: touch; }

.fancybox-error {
  color: #444;
  font: 14px/20px "Helvetica Neue",Helvetica,Arial,sans-serif;
  margin: 0;
  padding: 10px; }

.fancybox-image, .fancybox-iframe {
  display: block;
  width: 100%;
  height: 100%;
  border: 0;
  padding: 0;
  margin: 0;
  vertical-align: top; }

.fancybox-image {
  max-width: 100%;
  max-height: 100%; }

#fancybox-loading, .fancybox-close, .fancybox-prev span, .fancybox-next span {
  background-image: image-url("fancybox/fancybox_sprite.png"); }

#fancybox-loading {
  position: fixed;
  top: 50%;
  left: 50%;
  margin-top: -22px;
  margin-left: -22px;
  background-position: 0 -108px;
  opacity: 0.8;
  cursor: pointer;
  z-index: 8020; }

#fancybox-loading div {
  width: 44px;
  height: 44px;
  background: image-url("fancybox/fancybox_loading.gif") center center no-repeat; }

.fancybox-close {
  position: absolute;
  top: -18px;
  right: -18px;
  width: 36px;
  height: 36px;
  cursor: pointer;
  z-index: 8040; }

.fancybox-nav {
  position: absolute;
  top: 0;
  width: 40%;
  height: 100%;
  cursor: pointer;
  background: transparent image-url("fancybox/blank.gif");
  /* helps IE */
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  z-index: 8040; }

.fancybox-prev {
  left: 0; }

.fancybox-next {
  right: 0; }

.fancybox-nav span {
  position: absolute;
  top: 50%;
  width: 36px;
  height: 34px;
  margin-top: -18px;
  cursor: pointer;
  z-index: 8040;
  visibility: hidden; }

.fancybox-prev span {
  left: 20px;
  background-position: 0 -36px; }

.fancybox-next span {
  right: 20px;
  background-position: 0 -72px; }

.fancybox-nav:hover span {
  visibility: visible; }

.fancybox-tmp {
  position: absolute;
  top: -9999px;
  left: -9999px;
  padding: 0;
  overflow: visible;
  visibility: hidden; }

/* Overlay helper */
#fancybox-overlay {
  position: absolute;
  top: 0;
  left: 0;
  overflow: hidden;
  display: none;
  z-index: 8010;
  background: #000; }

#fancybox-overlay.overlay-fixed {
  position: fixed;
  bottom: 0;
  right: 0; }

/* Title helper */
.fancybox-title {
  visibility: hidden;
  font: normal 13px/20px "Helvetica Neue",Helvetica,Arial,sans-serif;
  position: relative;
  text-shadow: none;
  z-index: 8050; }

.fancybox-opened .fancybox-title {
  visibility: visible; }

.fancybox-title-float-wrap {
  position: absolute;
  bottom: 0;
  right: 50%;
  margin-bottom: -35px;
  z-index: 8030;
  text-align: center; }

.fancybox-title-float-wrap .child {
  display: inline-block;
  margin-right: -100%;
  padding: 2px 20px;
  background: transparent;
  /* Fallback for web browsers that doesn't support RGBa */
  background: rgba(0, 0, 0, 0.8);
  text-shadow: 0 1px 2px #222;
  color: #FFF;
  font-weight: bold;
  line-height: 24px;
  white-space: nowrap;
  -webkit-border-radius: 15px;
  -moz-border-radius: 15px;
  -ms-border-radius: 15px;
  -o-border-radius: 15px;
  border-radius: 15px; }

.fancybox-title-outside-wrap {
  position: relative;
  margin-top: 10px;
  color: #fff; }

.fancybox-title-inside-wrap {
  margin-top: 10px; }

.fancybox-title-over-wrap {
  position: absolute;
  bottom: 0;
  left: 0;
  color: #fff;
  padding: 10px;
  background: #000;
  background: rgba(0, 0, 0, 0.8); }

/*
Animate.css - http://daneden.me/animate
Licensed under the ☺ license (http://licence.visualidiot.com/)

Copyright (c) 2012 Dan Eden

Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/
body {
  /* Addresses a small issue in webkit: http://bit.ly/NEdoDq */
  -webkit-backface-visibility: hidden; }

.animated {
  -webkit-animation-duration: 1s;
  -moz-animation-duration: 1s;
  -o-animation-duration: 1s;
  animation-duration: 1s;
  -webkit-animation-fill-mode: both;
  -moz-animation-fill-mode: both;
  -o-animation-fill-mode: both;
  animation-fill-mode: both; }

.animated.hinge {
  -webkit-animation-duration: 2s;
  -moz-animation-duration: 2s;
  -o-animation-duration: 2s;
  animation-duration: 2s; }

@-webkit-keyframes flash {
  0%, 50%, 100% {
    opacity: 1; }

  25%, 75% {
    opacity: 0; } }

@-moz-keyframes flash {
  0%, 50%, 100% {
    opacity: 1; }

  25%, 75% {
    opacity: 0; } }

@-o-keyframes flash {
  0%, 50%, 100% {
    opacity: 1; }

  25%, 75% {
    opacity: 0; } }

@keyframes flash {
  0%, 50%, 100% {
    opacity: 1; }

  25%, 75% {
    opacity: 0; } }

.flash {
  -webkit-animation-name: flash;
  -moz-animation-name: flash;
  -o-animation-name: flash;
  animation-name: flash; }

@-webkit-keyframes shake {
  0%, 100% {
    -webkit-transform: translateX(0); }

  10%, 30%, 50%, 70%, 90% {
    -webkit-transform: translateX(-10px); }

  20%, 40%, 60%, 80% {
    -webkit-transform: translateX(10px); } }

@-moz-keyframes shake {
  0%, 100% {
    -moz-transform: translateX(0); }

  10%, 30%, 50%, 70%, 90% {
    -moz-transform: translateX(-10px); }

  20%, 40%, 60%, 80% {
    -moz-transform: translateX(10px); } }

@-o-keyframes shake {
  0%, 100% {
    -o-transform: translateX(0); }

  10%, 30%, 50%, 70%, 90% {
    -o-transform: translateX(-10px); }

  20%, 40%, 60%, 80% {
    -o-transform: translateX(10px); } }

@keyframes shake {
  0%, 100% {
    transform: translateX(0); }

  10%, 30%, 50%, 70%, 90% {
    transform: translateX(-10px); }

  20%, 40%, 60%, 80% {
    transform: translateX(10px); } }

.shake {
  -webkit-animation-name: shake;
  -moz-animation-name: shake;
  -o-animation-name: shake;
  animation-name: shake; }

@-webkit-keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    -webkit-transform: translateY(0); }

  40% {
    -webkit-transform: translateY(-30px); }

  60% {
    -webkit-transform: translateY(-15px); } }

@-moz-keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    -moz-transform: translateY(0); }

  40% {
    -moz-transform: translateY(-30px); }

  60% {
    -moz-transform: translateY(-15px); } }

@-o-keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    -o-transform: translateY(0); }

  40% {
    -o-transform: translateY(-30px); }

  60% {
    -o-transform: translateY(-15px); } }

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0); }

  40% {
    transform: translateY(-30px); }

  60% {
    transform: translateY(-15px); } }

.bounce {
  -webkit-animation-name: bounce;
  -moz-animation-name: bounce;
  -o-animation-name: bounce;
  animation-name: bounce; }

@-webkit-keyframes tada {
  0% {
    -webkit-transform: scale(1); }

  10%, 20% {
    -webkit-transform: scale(0.9) rotate(-3deg); }

  30%, 50%, 70%, 90% {
    -webkit-transform: scale(1.1) rotate(3deg); }

  40%, 60%, 80% {
    -webkit-transform: scale(1.1) rotate(-3deg); }

  100% {
    -webkit-transform: scale(1) rotate(0); } }

@-moz-keyframes tada {
  0% {
    -moz-transform: scale(1); }

  10%, 20% {
    -moz-transform: scale(0.9) rotate(-3deg); }

  30%, 50%, 70%, 90% {
    -moz-transform: scale(1.1) rotate(3deg); }

  40%, 60%, 80% {
    -moz-transform: scale(1.1) rotate(-3deg); }

  100% {
    -moz-transform: scale(1) rotate(0); } }

@-o-keyframes tada {
  0% {
    -o-transform: scale(1); }

  10%, 20% {
    -o-transform: scale(0.9) rotate(-3deg); }

  30%, 50%, 70%, 90% {
    -o-transform: scale(1.1) rotate(3deg); }

  40%, 60%, 80% {
    -o-transform: scale(1.1) rotate(-3deg); }

  100% {
    -o-transform: scale(1) rotate(0); } }

@keyframes tada {
  0% {
    transform: scale(1); }

  10%, 20% {
    transform: scale(0.9) rotate(-3deg); }

  30%, 50%, 70%, 90% {
    transform: scale(1.1) rotate(3deg); }

  40%, 60%, 80% {
    transform: scale(1.1) rotate(-3deg); }

  100% {
    transform: scale(1) rotate(0); } }

.tada {
  -webkit-animation-name: tada;
  -moz-animation-name: tada;
  -o-animation-name: tada;
  animation-name: tada; }

@-webkit-keyframes swing {
  20%, 40%, 60%, 80%, 100% {
    -webkit-transform-origin: top center; }

  20% {
    -webkit-transform: rotate(15deg); }

  40% {
    -webkit-transform: rotate(-10deg); }

  60% {
    -webkit-transform: rotate(5deg); }

  80% {
    -webkit-transform: rotate(-5deg); }

  100% {
    -webkit-transform: rotate(0deg); } }

@-moz-keyframes swing {
  20% {
    -moz-transform: rotate(15deg); }

  40% {
    -moz-transform: rotate(-10deg); }

  60% {
    -moz-transform: rotate(5deg); }

  80% {
    -moz-transform: rotate(-5deg); }

  100% {
    -moz-transform: rotate(0deg); } }

@-o-keyframes swing {
  20% {
    -o-transform: rotate(15deg); }

  40% {
    -o-transform: rotate(-10deg); }

  60% {
    -o-transform: rotate(5deg); }

  80% {
    -o-transform: rotate(-5deg); }

  100% {
    -o-transform: rotate(0deg); } }

@keyframes swing {
  20% {
    transform: rotate(15deg); }

  40% {
    transform: rotate(-10deg); }

  60% {
    transform: rotate(5deg); }

  80% {
    transform: rotate(-5deg); }

  100% {
    transform: rotate(0deg); } }

.swing {
  -webkit-transform-origin: top center;
  -moz-transform-origin: top center;
  -o-transform-origin: top center;
  transform-origin: top center;
  -webkit-animation-name: swing;
  -moz-animation-name: swing;
  -o-animation-name: swing;
  animation-name: swing; }

/* originally authored by Nick Pettit - https://github.com/nickpettit/glide */
@-webkit-keyframes wobble {
  0% {
    -webkit-transform: translateX(0%); }

  15% {
    -webkit-transform: translateX(-25%) rotate(-5deg); }

  30% {
    -webkit-transform: translateX(20%) rotate(3deg); }

  45% {
    -webkit-transform: translateX(-15%) rotate(-3deg); }

  60% {
    -webkit-transform: translateX(10%) rotate(2deg); }

  75% {
    -webkit-transform: translateX(-5%) rotate(-1deg); }

  100% {
    -webkit-transform: translateX(0%); } }

@-moz-keyframes wobble {
  0% {
    -moz-transform: translateX(0%); }

  15% {
    -moz-transform: translateX(-25%) rotate(-5deg); }

  30% {
    -moz-transform: translateX(20%) rotate(3deg); }

  45% {
    -moz-transform: translateX(-15%) rotate(-3deg); }

  60% {
    -moz-transform: translateX(10%) rotate(2deg); }

  75% {
    -moz-transform: translateX(-5%) rotate(-1deg); }

  100% {
    -moz-transform: translateX(0%); } }

@-o-keyframes wobble {
  0% {
    -o-transform: translateX(0%); }

  15% {
    -o-transform: translateX(-25%) rotate(-5deg); }

  30% {
    -o-transform: translateX(20%) rotate(3deg); }

  45% {
    -o-transform: translateX(-15%) rotate(-3deg); }

  60% {
    -o-transform: translateX(10%) rotate(2deg); }

  75% {
    -o-transform: translateX(-5%) rotate(-1deg); }

  100% {
    -o-transform: translateX(0%); } }

@keyframes wobble {
  0% {
    transform: translateX(0%); }

  15% {
    transform: translateX(-25%) rotate(-5deg); }

  30% {
    transform: translateX(20%) rotate(3deg); }

  45% {
    transform: translateX(-15%) rotate(-3deg); }

  60% {
    transform: translateX(10%) rotate(2deg); }

  75% {
    transform: translateX(-5%) rotate(-1deg); }

  100% {
    transform: translateX(0%); } }

.wobble {
  -webkit-animation-name: wobble;
  -moz-animation-name: wobble;
  -o-animation-name: wobble;
  animation-name: wobble; }

/* originally authored by Nick Pettit - https://github.com/nickpettit/glide */
@-webkit-keyframes pulse {
  0% {
    -webkit-transform: scale(1); }

  50% {
    -webkit-transform: scale(1.1); }

  100% {
    -webkit-transform: scale(1); } }

@-moz-keyframes pulse {
  0% {
    -moz-transform: scale(1); }

  50% {
    -moz-transform: scale(1.1); }

  100% {
    -moz-transform: scale(1); } }

@-o-keyframes pulse {
  0% {
    -o-transform: scale(1); }

  50% {
    -o-transform: scale(1.1); }

  100% {
    -o-transform: scale(1); } }

@keyframes pulse {
  0% {
    transform: scale(1); }

  50% {
    transform: scale(1.1); }

  100% {
    transform: scale(1); } }

.pulse {
  -webkit-animation-name: pulse;
  -moz-animation-name: pulse;
  -o-animation-name: pulse;
  animation-name: pulse; }

@-webkit-keyframes flip {
  0% {
    -webkit-transform: perspective(400px) rotateY(0);
    -webkit-animation-timing-function: ease-out; }

  40% {
    -webkit-transform: perspective(400px) translateZ(150px) rotateY(170deg);
    -webkit-animation-timing-function: ease-out; }

  50% {
    -webkit-transform: perspective(400px) translateZ(150px) rotateY(190deg) scale(1);
    -webkit-animation-timing-function: ease-in; }

  80% {
    -webkit-transform: perspective(400px) rotateY(360deg) scale(0.95);
    -webkit-animation-timing-function: ease-in; }

  100% {
    -webkit-transform: perspective(400px) scale(1);
    -webkit-animation-timing-function: ease-in; } }

@-moz-keyframes flip {
  0% {
    -moz-transform: perspective(400px) rotateY(0);
    -moz-animation-timing-function: ease-out; }

  40% {
    -moz-transform: perspective(400px) translateZ(150px) rotateY(170deg);
    -moz-animation-timing-function: ease-out; }

  50% {
    -moz-transform: perspective(400px) translateZ(150px) rotateY(190deg) scale(1);
    -moz-animation-timing-function: ease-in; }

  80% {
    -moz-transform: perspective(400px) rotateY(360deg) scale(0.95);
    -moz-animation-timing-function: ease-in; }

  100% {
    -moz-transform: perspective(400px) scale(1);
    -moz-animation-timing-function: ease-in; } }

@-o-keyframes flip {
  0% {
    -o-transform: perspective(400px) rotateY(0);
    -o-animation-timing-function: ease-out; }

  40% {
    -o-transform: perspective(400px) translateZ(150px) rotateY(170deg);
    -o-animation-timing-function: ease-out; }

  50% {
    -o-transform: perspective(400px) translateZ(150px) rotateY(190deg) scale(1);
    -o-animation-timing-function: ease-in; }

  80% {
    -o-transform: perspective(400px) rotateY(360deg) scale(0.95);
    -o-animation-timing-function: ease-in; }

  100% {
    -o-transform: perspective(400px) scale(1);
    -o-animation-timing-function: ease-in; } }

@keyframes flip {
  0% {
    transform: perspective(400px) rotateY(0);
    animation-timing-function: ease-out; }

  40% {
    transform: perspective(400px) translateZ(150px) rotateY(170deg);
    animation-timing-function: ease-out; }

  50% {
    transform: perspective(400px) translateZ(150px) rotateY(190deg) scale(1);
    animation-timing-function: ease-in; }

  80% {
    transform: perspective(400px) rotateY(360deg) scale(0.95);
    animation-timing-function: ease-in; }

  100% {
    transform: perspective(400px) scale(1);
    animation-timing-function: ease-in; } }

.flip {
  -webkit-backface-visibility: visible !important;
  -webkit-animation-name: flip;
  -moz-backface-visibility: visible !important;
  -moz-animation-name: flip;
  -o-backface-visibility: visible !important;
  -o-animation-name: flip;
  backface-visibility: visible !important;
  animation-name: flip; }

@-webkit-keyframes flipInX {
  0% {
    -webkit-transform: perspective(400px) rotateX(90deg);
    opacity: 0; }

  40% {
    -webkit-transform: perspective(400px) rotateX(-10deg); }

  70% {
    -webkit-transform: perspective(400px) rotateX(10deg); }

  100% {
    -webkit-transform: perspective(400px) rotateX(0deg);
    opacity: 1; } }

@-moz-keyframes flipInX {
  0% {
    -moz-transform: perspective(400px) rotateX(90deg);
    opacity: 0; }

  40% {
    -moz-transform: perspective(400px) rotateX(-10deg); }

  70% {
    -moz-transform: perspective(400px) rotateX(10deg); }

  100% {
    -moz-transform: perspective(400px) rotateX(0deg);
    opacity: 1; } }

@-o-keyframes flipInX {
  0% {
    -o-transform: perspective(400px) rotateX(90deg);
    opacity: 0; }

  40% {
    -o-transform: perspective(400px) rotateX(-10deg); }

  70% {
    -o-transform: perspective(400px) rotateX(10deg); }

  100% {
    -o-transform: perspective(400px) rotateX(0deg);
    opacity: 1; } }

@keyframes flipInX {
  0% {
    transform: perspective(400px) rotateX(90deg);
    opacity: 0; }

  40% {
    transform: perspective(400px) rotateX(-10deg); }

  70% {
    transform: perspective(400px) rotateX(10deg); }

  100% {
    transform: perspective(400px) rotateX(0deg);
    opacity: 1; } }

.flipInX {
  -webkit-backface-visibility: visible !important;
  -webkit-animation-name: flipInX;
  -moz-backface-visibility: visible !important;
  -moz-animation-name: flipInX;
  -o-backface-visibility: visible !important;
  -o-animation-name: flipInX;
  backface-visibility: visible !important;
  animation-name: flipInX; }

@-webkit-keyframes flipOutX {
  0% {
    -webkit-transform: perspective(400px) rotateX(0deg);
    opacity: 1; }

  100% {
    -webkit-transform: perspective(400px) rotateX(90deg);
    opacity: 0; } }

@-moz-keyframes flipOutX {
  0% {
    -moz-transform: perspective(400px) rotateX(0deg);
    opacity: 1; }

  100% {
    -moz-transform: perspective(400px) rotateX(90deg);
    opacity: 0; } }

@-o-keyframes flipOutX {
  0% {
    -o-transform: perspective(400px) rotateX(0deg);
    opacity: 1; }

  100% {
    -o-transform: perspective(400px) rotateX(90deg);
    opacity: 0; } }

@keyframes flipOutX {
  0% {
    transform: perspective(400px) rotateX(0deg);
    opacity: 1; }

  100% {
    transform: perspective(400px) rotateX(90deg);
    opacity: 0; } }

.flipOutX {
  -webkit-animation-name: flipOutX;
  -webkit-backface-visibility: visible !important;
  -moz-animation-name: flipOutX;
  -moz-backface-visibility: visible !important;
  -o-animation-name: flipOutX;
  -o-backface-visibility: visible !important;
  animation-name: flipOutX;
  backface-visibility: visible !important; }

@-webkit-keyframes flipInY {
  0% {
    -webkit-transform: perspective(400px) rotateY(90deg);
    opacity: 0; }

  40% {
    -webkit-transform: perspective(400px) rotateY(-10deg); }

  70% {
    -webkit-transform: perspective(400px) rotateY(10deg); }

  100% {
    -webkit-transform: perspective(400px) rotateY(0deg);
    opacity: 1; } }

@-moz-keyframes flipInY {
  0% {
    -moz-transform: perspective(400px) rotateY(90deg);
    opacity: 0; }

  40% {
    -moz-transform: perspective(400px) rotateY(-10deg); }

  70% {
    -moz-transform: perspective(400px) rotateY(10deg); }

  100% {
    -moz-transform: perspective(400px) rotateY(0deg);
    opacity: 1; } }

@-o-keyframes flipInY {
  0% {
    -o-transform: perspective(400px) rotateY(90deg);
    opacity: 0; }

  40% {
    -o-transform: perspective(400px) rotateY(-10deg); }

  70% {
    -o-transform: perspective(400px) rotateY(10deg); }

  100% {
    -o-transform: perspective(400px) rotateY(0deg);
    opacity: 1; } }

@keyframes flipInY {
  0% {
    transform: perspective(400px) rotateY(90deg);
    opacity: 0; }

  40% {
    transform: perspective(400px) rotateY(-10deg); }

  70% {
    transform: perspective(400px) rotateY(10deg); }

  100% {
    transform: perspective(400px) rotateY(0deg);
    opacity: 1; } }

.flipInY {
  -webkit-backface-visibility: visible !important;
  -webkit-animation-name: flipInY;
  -moz-backface-visibility: visible !important;
  -moz-animation-name: flipInY;
  -o-backface-visibility: visible !important;
  -o-animation-name: flipInY;
  backface-visibility: visible !important;
  animation-name: flipInY; }

@-webkit-keyframes flipOutY {
  0% {
    -webkit-transform: perspective(400px) rotateY(0deg);
    opacity: 1; }

  100% {
    -webkit-transform: perspective(400px) rotateY(90deg);
    opacity: 0; } }

@-moz-keyframes flipOutY {
  0% {
    -moz-transform: perspective(400px) rotateY(0deg);
    opacity: 1; }

  100% {
    -moz-transform: perspective(400px) rotateY(90deg);
    opacity: 0; } }

@-o-keyframes flipOutY {
  0% {
    -o-transform: perspective(400px) rotateY(0deg);
    opacity: 1; }

  100% {
    -o-transform: perspective(400px) rotateY(90deg);
    opacity: 0; } }

@keyframes flipOutY {
  0% {
    transform: perspective(400px) rotateY(0deg);
    opacity: 1; }

  100% {
    transform: perspective(400px) rotateY(90deg);
    opacity: 0; } }

.flipOutY {
  -webkit-backface-visibility: visible !important;
  -webkit-animation-name: flipOutY;
  -moz-backface-visibility: visible !important;
  -moz-animation-name: flipOutY;
  -o-backface-visibility: visible !important;
  -o-animation-name: flipOutY;
  backface-visibility: visible !important;
  animation-name: flipOutY; }

@-webkit-keyframes fadeIn {
  0% {
    opacity: 0; }

  100% {
    opacity: 1; } }

@-moz-keyframes fadeIn {
  0% {
    opacity: 0; }

  100% {
    opacity: 1; } }

@-o-keyframes fadeIn {
  0% {
    opacity: 0; }

  100% {
    opacity: 1; } }

@keyframes fadeIn {
  0% {
    opacity: 0; }

  100% {
    opacity: 1; } }

.fadeIn {
  -webkit-animation-name: fadeIn;
  -moz-animation-name: fadeIn;
  -o-animation-name: fadeIn;
  animation-name: fadeIn; }

@-webkit-keyframes fadeInUp {
  0% {
    opacity: 0;
    -webkit-transform: translateY(20px); }

  100% {
    opacity: 1;
    -webkit-transform: translateY(0); } }

@-moz-keyframes fadeInUp {
  0% {
    opacity: 0;
    -moz-transform: translateY(20px); }

  100% {
    opacity: 1;
    -moz-transform: translateY(0); } }

@-o-keyframes fadeInUp {
  0% {
    opacity: 0;
    -o-transform: translateY(20px); }

  100% {
    opacity: 1;
    -o-transform: translateY(0); } }

@keyframes fadeInUp {
  0% {
    opacity: 0;
    transform: translateY(20px); }

  100% {
    opacity: 1;
    transform: translateY(0); } }

.fadeInUp {
  -webkit-animation-name: fadeInUp;
  -moz-animation-name: fadeInUp;
  -o-animation-name: fadeInUp;
  animation-name: fadeInUp; }

@-webkit-keyframes fadeInDown {
  0% {
    opacity: 0;
    -webkit-transform: translateY(-20px); }

  100% {
    opacity: 1;
    -webkit-transform: translateY(0); } }

@-moz-keyframes fadeInDown {
  0% {
    opacity: 0;
    -moz-transform: translateY(-20px); }

  100% {
    opacity: 1;
    -moz-transform: translateY(0); } }

@-o-keyframes fadeInDown {
  0% {
    opacity: 0;
    -o-transform: translateY(-20px); }

  100% {
    opacity: 1;
    -o-transform: translateY(0); } }

@keyframes fadeInDown {
  0% {
    opacity: 0;
    transform: translateY(-20px); }

  100% {
    opacity: 1;
    transform: translateY(0); } }

.fadeInDown {
  -webkit-animation-name: fadeInDown;
  -moz-animation-name: fadeInDown;
  -o-animation-name: fadeInDown;
  animation-name: fadeInDown; }

@-webkit-keyframes fadeInLeft {
  0% {
    opacity: 0;
    -webkit-transform: translateX(-20px); }

  100% {
    opacity: 1;
    -webkit-transform: translateX(0); } }

@-moz-keyframes fadeInLeft {
  0% {
    opacity: 0;
    -moz-transform: translateX(-20px); }

  100% {
    opacity: 1;
    -moz-transform: translateX(0); } }

@-o-keyframes fadeInLeft {
  0% {
    opacity: 0;
    -o-transform: translateX(-20px); }

  100% {
    opacity: 1;
    -o-transform: translateX(0); } }

@keyframes fadeInLeft {
  0% {
    opacity: 0;
    transform: translateX(-20px); }

  100% {
    opacity: 1;
    transform: translateX(0); } }

.fadeInLeft {
  -webkit-animation-name: fadeInLeft;
  -moz-animation-name: fadeInLeft;
  -o-animation-name: fadeInLeft;
  animation-name: fadeInLeft; }

@-webkit-keyframes fadeInRight {
  0% {
    opacity: 0;
    -webkit-transform: translateX(20px); }

  100% {
    opacity: 1;
    -webkit-transform: translateX(0); } }

@-moz-keyframes fadeInRight {
  0% {
    opacity: 0;
    -moz-transform: translateX(20px); }

  100% {
    opacity: 1;
    -moz-transform: translateX(0); } }

@-o-keyframes fadeInRight {
  0% {
    opacity: 0;
    -o-transform: translateX(20px); }

  100% {
    opacity: 1;
    -o-transform: translateX(0); } }

@keyframes fadeInRight {
  0% {
    opacity: 0;
    transform: translateX(20px); }

  100% {
    opacity: 1;
    transform: translateX(0); } }

.fadeInRight {
  -webkit-animation-name: fadeInRight;
  -moz-animation-name: fadeInRight;
  -o-animation-name: fadeInRight;
  animation-name: fadeInRight; }

@-webkit-keyframes fadeInUpBig {
  0% {
    opacity: 0;
    -webkit-transform: translateY(2000px); }

  100% {
    opacity: 1;
    -webkit-transform: translateY(0); } }

@-moz-keyframes fadeInUpBig {
  0% {
    opacity: 0;
    -moz-transform: translateY(2000px); }

  100% {
    opacity: 1;
    -moz-transform: translateY(0); } }

@-o-keyframes fadeInUpBig {
  0% {
    opacity: 0;
    -o-transform: translateY(2000px); }

  100% {
    opacity: 1;
    -o-transform: translateY(0); } }

@keyframes fadeInUpBig {
  0% {
    opacity: 0;
    transform: translateY(2000px); }

  100% {
    opacity: 1;
    transform: translateY(0); } }

.fadeInUpBig {
  -webkit-animation-name: fadeInUpBig;
  -moz-animation-name: fadeInUpBig;
  -o-animation-name: fadeInUpBig;
  animation-name: fadeInUpBig; }

@-webkit-keyframes fadeInDownBig {
  0% {
    opacity: 0;
    -webkit-transform: translateY(-2000px); }

  100% {
    opacity: 1;
    -webkit-transform: translateY(0); } }

@-moz-keyframes fadeInDownBig {
  0% {
    opacity: 0;
    -moz-transform: translateY(-2000px); }

  100% {
    opacity: 1;
    -moz-transform: translateY(0); } }

@-o-keyframes fadeInDownBig {
  0% {
    opacity: 0;
    -o-transform: translateY(-2000px); }

  100% {
    opacity: 1;
    -o-transform: translateY(0); } }

@keyframes fadeInDownBig {
  0% {
    opacity: 0;
    transform: translateY(-2000px); }

  100% {
    opacity: 1;
    transform: translateY(0); } }

.fadeInDownBig {
  -webkit-animation-name: fadeInDownBig;
  -moz-animation-name: fadeInDownBig;
  -o-animation-name: fadeInDownBig;
  animation-name: fadeInDownBig; }

@-webkit-keyframes fadeInLeftBig {
  0% {
    opacity: 0;
    -webkit-transform: translateX(-2000px); }

  100% {
    opacity: 1;
    -webkit-transform: translateX(0); } }

@-moz-keyframes fadeInLeftBig {
  0% {
    opacity: 0;
    -moz-transform: translateX(-2000px); }

  100% {
    opacity: 1;
    -moz-transform: translateX(0); } }

@-o-keyframes fadeInLeftBig {
  0% {
    opacity: 0;
    -o-transform: translateX(-2000px); }

  100% {
    opacity: 1;
    -o-transform: translateX(0); } }

@keyframes fadeInLeftBig {
  0% {
    opacity: 0;
    transform: translateX(-2000px); }

  100% {
    opacity: 1;
    transform: translateX(0); } }

.fadeInLeftBig {
  -webkit-animation-name: fadeInLeftBig;
  -moz-animation-name: fadeInLeftBig;
  -o-animation-name: fadeInLeftBig;
  animation-name: fadeInLeftBig; }

@-webkit-keyframes fadeInRightBig {
  0% {
    opacity: 0;
    -webkit-transform: translateX(2000px); }

  100% {
    opacity: 1;
    -webkit-transform: translateX(0); } }

@-moz-keyframes fadeInRightBig {
  0% {
    opacity: 0;
    -moz-transform: translateX(2000px); }

  100% {
    opacity: 1;
    -moz-transform: translateX(0); } }

@-o-keyframes fadeInRightBig {
  0% {
    opacity: 0;
    -o-transform: translateX(2000px); }

  100% {
    opacity: 1;
    -o-transform: translateX(0); } }

@keyframes fadeInRightBig {
  0% {
    opacity: 0;
    transform: translateX(2000px); }

  100% {
    opacity: 1;
    transform: translateX(0); } }

.fadeInRightBig {
  -webkit-animation-name: fadeInRightBig;
  -moz-animation-name: fadeInRightBig;
  -o-animation-name: fadeInRightBig;
  animation-name: fadeInRightBig; }

@-webkit-keyframes fadeOut {
  0% {
    opacity: 1; }

  100% {
    opacity: 0; } }

@-moz-keyframes fadeOut {
  0% {
    opacity: 1; }

  100% {
    opacity: 0; } }

@-o-keyframes fadeOut {
  0% {
    opacity: 1; }

  100% {
    opacity: 0; } }

@keyframes fadeOut {
  0% {
    opacity: 1; }

  100% {
    opacity: 0; } }

.fadeOut {
  -webkit-animation-name: fadeOut;
  -moz-animation-name: fadeOut;
  -o-animation-name: fadeOut;
  animation-name: fadeOut; }

@-webkit-keyframes fadeOutUp {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(-20px); } }

@-moz-keyframes fadeOutUp {
  0% {
    opacity: 1;
    -moz-transform: translateY(0); }

  100% {
    opacity: 0;
    -moz-transform: translateY(-20px); } }

@-o-keyframes fadeOutUp {
  0% {
    opacity: 1;
    -o-transform: translateY(0); }

  100% {
    opacity: 0;
    -o-transform: translateY(-20px); } }

@keyframes fadeOutUp {
  0% {
    opacity: 1;
    transform: translateY(0); }

  100% {
    opacity: 0;
    transform: translateY(-20px); } }

.fadeOutUp {
  -webkit-animation-name: fadeOutUp;
  -moz-animation-name: fadeOutUp;
  -o-animation-name: fadeOutUp;
  animation-name: fadeOutUp; }

@-webkit-keyframes fadeOutDown {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(20px); } }

@-moz-keyframes fadeOutDown {
  0% {
    opacity: 1;
    -moz-transform: translateY(0); }

  100% {
    opacity: 0;
    -moz-transform: translateY(20px); } }

@-o-keyframes fadeOutDown {
  0% {
    opacity: 1;
    -o-transform: translateY(0); }

  100% {
    opacity: 0;
    -o-transform: translateY(20px); } }

@keyframes fadeOutDown {
  0% {
    opacity: 1;
    transform: translateY(0); }

  100% {
    opacity: 0;
    transform: translateY(20px); } }

.fadeOutDown {
  -webkit-animation-name: fadeOutDown;
  -moz-animation-name: fadeOutDown;
  -o-animation-name: fadeOutDown;
  animation-name: fadeOutDown; }

@-webkit-keyframes fadeOutLeft {
  0% {
    opacity: 1;
    -webkit-transform: translateX(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(-20px); } }

@-moz-keyframes fadeOutLeft {
  0% {
    opacity: 1;
    -moz-transform: translateX(0); }

  100% {
    opacity: 0;
    -moz-transform: translateX(-20px); } }

@-o-keyframes fadeOutLeft {
  0% {
    opacity: 1;
    -o-transform: translateX(0); }

  100% {
    opacity: 0;
    -o-transform: translateX(-20px); } }

@keyframes fadeOutLeft {
  0% {
    opacity: 1;
    transform: translateX(0); }

  100% {
    opacity: 0;
    transform: translateX(-20px); } }

.fadeOutLeft {
  -webkit-animation-name: fadeOutLeft;
  -moz-animation-name: fadeOutLeft;
  -o-animation-name: fadeOutLeft;
  animation-name: fadeOutLeft; }

@-webkit-keyframes fadeOutRight {
  0% {
    opacity: 1;
    -webkit-transform: translateX(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(20px); } }

@-moz-keyframes fadeOutRight {
  0% {
    opacity: 1;
    -moz-transform: translateX(0); }

  100% {
    opacity: 0;
    -moz-transform: translateX(20px); } }

@-o-keyframes fadeOutRight {
  0% {
    opacity: 1;
    -o-transform: translateX(0); }

  100% {
    opacity: 0;
    -o-transform: translateX(20px); } }

@keyframes fadeOutRight {
  0% {
    opacity: 1;
    transform: translateX(0); }

  100% {
    opacity: 0;
    transform: translateX(20px); } }

.fadeOutRight {
  -webkit-animation-name: fadeOutRight;
  -moz-animation-name: fadeOutRight;
  -o-animation-name: fadeOutRight;
  animation-name: fadeOutRight; }

@-webkit-keyframes fadeOutUpBig {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(-2000px); } }

@-moz-keyframes fadeOutUpBig {
  0% {
    opacity: 1;
    -moz-transform: translateY(0); }

  100% {
    opacity: 0;
    -moz-transform: translateY(-2000px); } }

@-o-keyframes fadeOutUpBig {
  0% {
    opacity: 1;
    -o-transform: translateY(0); }

  100% {
    opacity: 0;
    -o-transform: translateY(-2000px); } }

@keyframes fadeOutUpBig {
  0% {
    opacity: 1;
    transform: translateY(0); }

  100% {
    opacity: 0;
    transform: translateY(-2000px); } }

.fadeOutUpBig {
  -webkit-animation-name: fadeOutUpBig;
  -moz-animation-name: fadeOutUpBig;
  -o-animation-name: fadeOutUpBig;
  animation-name: fadeOutUpBig; }

@-webkit-keyframes fadeOutDownBig {
  0% {
    opacity: 1;
    -webkit-transform: translateY(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(2000px); } }

@-moz-keyframes fadeOutDownBig {
  0% {
    opacity: 1;
    -moz-transform: translateY(0); }

  100% {
    opacity: 0;
    -moz-transform: translateY(2000px); } }

@-o-keyframes fadeOutDownBig {
  0% {
    opacity: 1;
    -o-transform: translateY(0); }

  100% {
    opacity: 0;
    -o-transform: translateY(2000px); } }

@keyframes fadeOutDownBig {
  0% {
    opacity: 1;
    transform: translateY(0); }

  100% {
    opacity: 0;
    transform: translateY(2000px); } }

.fadeOutDownBig {
  -webkit-animation-name: fadeOutDownBig;
  -moz-animation-name: fadeOutDownBig;
  -o-animation-name: fadeOutDownBig;
  animation-name: fadeOutDownBig; }

@-webkit-keyframes fadeOutLeftBig {
  0% {
    opacity: 1;
    -webkit-transform: translateX(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(-2000px); } }

@-moz-keyframes fadeOutLeftBig {
  0% {
    opacity: 1;
    -moz-transform: translateX(0); }

  100% {
    opacity: 0;
    -moz-transform: translateX(-2000px); } }

@-o-keyframes fadeOutLeftBig {
  0% {
    opacity: 1;
    -o-transform: translateX(0); }

  100% {
    opacity: 0;
    -o-transform: translateX(-2000px); } }

@keyframes fadeOutLeftBig {
  0% {
    opacity: 1;
    transform: translateX(0); }

  100% {
    opacity: 0;
    transform: translateX(-2000px); } }

.fadeOutLeftBig {
  -webkit-animation-name: fadeOutLeftBig;
  -moz-animation-name: fadeOutLeftBig;
  -o-animation-name: fadeOutLeftBig;
  animation-name: fadeOutLeftBig; }

@-webkit-keyframes fadeOutRightBig {
  0% {
    opacity: 1;
    -webkit-transform: translateX(0); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(2000px); } }

@-moz-keyframes fadeOutRightBig {
  0% {
    opacity: 1;
    -moz-transform: translateX(0); }

  100% {
    opacity: 0;
    -moz-transform: translateX(2000px); } }

@-o-keyframes fadeOutRightBig {
  0% {
    opacity: 1;
    -o-transform: translateX(0); }

  100% {
    opacity: 0;
    -o-transform: translateX(2000px); } }

@keyframes fadeOutRightBig {
  0% {
    opacity: 1;
    transform: translateX(0); }

  100% {
    opacity: 0;
    transform: translateX(2000px); } }

.fadeOutRightBig {
  -webkit-animation-name: fadeOutRightBig;
  -moz-animation-name: fadeOutRightBig;
  -o-animation-name: fadeOutRightBig;
  animation-name: fadeOutRightBig; }

@-webkit-keyframes bounceIn {
  0% {
    opacity: 0;
    -webkit-transform: scale(0.3); }

  50% {
    opacity: 1;
    -webkit-transform: scale(1.05); }

  70% {
    -webkit-transform: scale(0.9); }

  100% {
    -webkit-transform: scale(1); } }

@-moz-keyframes bounceIn {
  0% {
    opacity: 0;
    -moz-transform: scale(0.3); }

  50% {
    opacity: 1;
    -moz-transform: scale(1.05); }

  70% {
    -moz-transform: scale(0.9); }

  100% {
    -moz-transform: scale(1); } }

@-o-keyframes bounceIn {
  0% {
    opacity: 0;
    -o-transform: scale(0.3); }

  50% {
    opacity: 1;
    -o-transform: scale(1.05); }

  70% {
    -o-transform: scale(0.9); }

  100% {
    -o-transform: scale(1); } }

@keyframes bounceIn {
  0% {
    opacity: 0;
    transform: scale(0.3); }

  50% {
    opacity: 1;
    transform: scale(1.05); }

  70% {
    transform: scale(0.9); }

  100% {
    transform: scale(1); } }

.bounceIn {
  -webkit-animation-name: bounceIn;
  -moz-animation-name: bounceIn;
  -o-animation-name: bounceIn;
  animation-name: bounceIn; }

@-webkit-keyframes bounceInUp {
  0% {
    opacity: 0;
    -webkit-transform: translateY(2000px); }

  60% {
    opacity: 1;
    -webkit-transform: translateY(-30px); }

  80% {
    -webkit-transform: translateY(10px); }

  100% {
    -webkit-transform: translateY(0); } }

@-moz-keyframes bounceInUp {
  0% {
    opacity: 0;
    -moz-transform: translateY(2000px); }

  60% {
    opacity: 1;
    -moz-transform: translateY(-30px); }

  80% {
    -moz-transform: translateY(10px); }

  100% {
    -moz-transform: translateY(0); } }

@-o-keyframes bounceInUp {
  0% {
    opacity: 0;
    -o-transform: translateY(2000px); }

  60% {
    opacity: 1;
    -o-transform: translateY(-30px); }

  80% {
    -o-transform: translateY(10px); }

  100% {
    -o-transform: translateY(0); } }

@keyframes bounceInUp {
  0% {
    opacity: 0;
    transform: translateY(2000px); }

  60% {
    opacity: 1;
    transform: translateY(-30px); }

  80% {
    transform: translateY(10px); }

  100% {
    transform: translateY(0); } }

.bounceInUp {
  -webkit-animation-name: bounceInUp;
  -moz-animation-name: bounceInUp;
  -o-animation-name: bounceInUp;
  animation-name: bounceInUp; }

@-webkit-keyframes bounceInDown {
  0% {
    opacity: 0;
    -webkit-transform: translateY(-2000px); }

  60% {
    opacity: 1;
    -webkit-transform: translateY(30px); }

  80% {
    -webkit-transform: translateY(-10px); }

  100% {
    -webkit-transform: translateY(0); } }

@-moz-keyframes bounceInDown {
  0% {
    opacity: 0;
    -moz-transform: translateY(-2000px); }

  60% {
    opacity: 1;
    -moz-transform: translateY(30px); }

  80% {
    -moz-transform: translateY(-10px); }

  100% {
    -moz-transform: translateY(0); } }

@-o-keyframes bounceInDown {
  0% {
    opacity: 0;
    -o-transform: translateY(-2000px); }

  60% {
    opacity: 1;
    -o-transform: translateY(30px); }

  80% {
    -o-transform: translateY(-10px); }

  100% {
    -o-transform: translateY(0); } }

@keyframes bounceInDown {
  0% {
    opacity: 0;
    transform: translateY(-2000px); }

  60% {
    opacity: 1;
    transform: translateY(30px); }

  80% {
    transform: translateY(-10px); }

  100% {
    transform: translateY(0); } }

.bounceInDown {
  -webkit-animation-name: bounceInDown;
  -moz-animation-name: bounceInDown;
  -o-animation-name: bounceInDown;
  animation-name: bounceInDown; }

@-webkit-keyframes bounceInLeft {
  0% {
    opacity: 0;
    -webkit-transform: translateX(-2000px); }

  60% {
    opacity: 1;
    -webkit-transform: translateX(30px); }

  80% {
    -webkit-transform: translateX(-10px); }

  100% {
    -webkit-transform: translateX(0); } }

@-moz-keyframes bounceInLeft {
  0% {
    opacity: 0;
    -moz-transform: translateX(-2000px); }

  60% {
    opacity: 1;
    -moz-transform: translateX(30px); }

  80% {
    -moz-transform: translateX(-10px); }

  100% {
    -moz-transform: translateX(0); } }

@-o-keyframes bounceInLeft {
  0% {
    opacity: 0;
    -o-transform: translateX(-2000px); }

  60% {
    opacity: 1;
    -o-transform: translateX(30px); }

  80% {
    -o-transform: translateX(-10px); }

  100% {
    -o-transform: translateX(0); } }

@keyframes bounceInLeft {
  0% {
    opacity: 0;
    transform: translateX(-2000px); }

  60% {
    opacity: 1;
    transform: translateX(30px); }

  80% {
    transform: translateX(-10px); }

  100% {
    transform: translateX(0); } }

.bounceInLeft {
  -webkit-animation-name: bounceInLeft;
  -moz-animation-name: bounceInLeft;
  -o-animation-name: bounceInLeft;
  animation-name: bounceInLeft; }

@-webkit-keyframes bounceInRight {
  0% {
    opacity: 0;
    -webkit-transform: translateX(2000px); }

  60% {
    opacity: 1;
    -webkit-transform: translateX(-30px); }

  80% {
    -webkit-transform: translateX(10px); }

  100% {
    -webkit-transform: translateX(0); } }

@-moz-keyframes bounceInRight {
  0% {
    opacity: 0;
    -moz-transform: translateX(2000px); }

  60% {
    opacity: 1;
    -moz-transform: translateX(-30px); }

  80% {
    -moz-transform: translateX(10px); }

  100% {
    -moz-transform: translateX(0); } }

@-o-keyframes bounceInRight {
  0% {
    opacity: 0;
    -o-transform: translateX(2000px); }

  60% {
    opacity: 1;
    -o-transform: translateX(-30px); }

  80% {
    -o-transform: translateX(10px); }

  100% {
    -o-transform: translateX(0); } }

@keyframes bounceInRight {
  0% {
    opacity: 0;
    transform: translateX(2000px); }

  60% {
    opacity: 1;
    transform: translateX(-30px); }

  80% {
    transform: translateX(10px); }

  100% {
    transform: translateX(0); } }

.bounceInRight {
  -webkit-animation-name: bounceInRight;
  -moz-animation-name: bounceInRight;
  -o-animation-name: bounceInRight;
  animation-name: bounceInRight; }

@-webkit-keyframes bounceOut {
  0% {
    -webkit-transform: scale(1); }

  25% {
    -webkit-transform: scale(0.95); }

  50% {
    opacity: 1;
    -webkit-transform: scale(1.1); }

  100% {
    opacity: 0;
    -webkit-transform: scale(0.3); } }

@-moz-keyframes bounceOut {
  0% {
    -moz-transform: scale(1); }

  25% {
    -moz-transform: scale(0.95); }

  50% {
    opacity: 1;
    -moz-transform: scale(1.1); }

  100% {
    opacity: 0;
    -moz-transform: scale(0.3); } }

@-o-keyframes bounceOut {
  0% {
    -o-transform: scale(1); }

  25% {
    -o-transform: scale(0.95); }

  50% {
    opacity: 1;
    -o-transform: scale(1.1); }

  100% {
    opacity: 0;
    -o-transform: scale(0.3); } }

@keyframes bounceOut {
  0% {
    transform: scale(1); }

  25% {
    transform: scale(0.95); }

  50% {
    opacity: 1;
    transform: scale(1.1); }

  100% {
    opacity: 0;
    transform: scale(0.3); } }

.bounceOut {
  -webkit-animation-name: bounceOut;
  -moz-animation-name: bounceOut;
  -o-animation-name: bounceOut;
  animation-name: bounceOut; }

@-webkit-keyframes bounceOutUp {
  0% {
    -webkit-transform: translateY(0); }

  20% {
    opacity: 1;
    -webkit-transform: translateY(20px); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(-2000px); } }

@-moz-keyframes bounceOutUp {
  0% {
    -moz-transform: translateY(0); }

  20% {
    opacity: 1;
    -moz-transform: translateY(20px); }

  100% {
    opacity: 0;
    -moz-transform: translateY(-2000px); } }

@-o-keyframes bounceOutUp {
  0% {
    -o-transform: translateY(0); }

  20% {
    opacity: 1;
    -o-transform: translateY(20px); }

  100% {
    opacity: 0;
    -o-transform: translateY(-2000px); } }

@keyframes bounceOutUp {
  0% {
    transform: translateY(0); }

  20% {
    opacity: 1;
    transform: translateY(20px); }

  100% {
    opacity: 0;
    transform: translateY(-2000px); } }

.bounceOutUp {
  -webkit-animation-name: bounceOutUp;
  -moz-animation-name: bounceOutUp;
  -o-animation-name: bounceOutUp;
  animation-name: bounceOutUp; }

@-webkit-keyframes bounceOutDown {
  0% {
    -webkit-transform: translateY(0); }

  20% {
    opacity: 1;
    -webkit-transform: translateY(-20px); }

  100% {
    opacity: 0;
    -webkit-transform: translateY(2000px); } }

@-moz-keyframes bounceOutDown {
  0% {
    -moz-transform: translateY(0); }

  20% {
    opacity: 1;
    -moz-transform: translateY(-20px); }

  100% {
    opacity: 0;
    -moz-transform: translateY(2000px); } }

@-o-keyframes bounceOutDown {
  0% {
    -o-transform: translateY(0); }

  20% {
    opacity: 1;
    -o-transform: translateY(-20px); }

  100% {
    opacity: 0;
    -o-transform: translateY(2000px); } }

@keyframes bounceOutDown {
  0% {
    transform: translateY(0); }

  20% {
    opacity: 1;
    transform: translateY(-20px); }

  100% {
    opacity: 0;
    transform: translateY(2000px); } }

.bounceOutDown {
  -webkit-animation-name: bounceOutDown;
  -moz-animation-name: bounceOutDown;
  -o-animation-name: bounceOutDown;
  animation-name: bounceOutDown; }

@-webkit-keyframes bounceOutLeft {
  0% {
    -webkit-transform: translateX(0); }

  20% {
    opacity: 1;
    -webkit-transform: translateX(20px); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(-2000px); } }

@-moz-keyframes bounceOutLeft {
  0% {
    -moz-transform: translateX(0); }

  20% {
    opacity: 1;
    -moz-transform: translateX(20px); }

  100% {
    opacity: 0;
    -moz-transform: translateX(-2000px); } }

@-o-keyframes bounceOutLeft {
  0% {
    -o-transform: translateX(0); }

  20% {
    opacity: 1;
    -o-transform: translateX(20px); }

  100% {
    opacity: 0;
    -o-transform: translateX(-2000px); } }

@keyframes bounceOutLeft {
  0% {
    transform: translateX(0); }

  20% {
    opacity: 1;
    transform: translateX(20px); }

  100% {
    opacity: 0;
    transform: translateX(-2000px); } }

.bounceOutLeft {
  -webkit-animation-name: bounceOutLeft;
  -moz-animation-name: bounceOutLeft;
  -o-animation-name: bounceOutLeft;
  animation-name: bounceOutLeft; }

@-webkit-keyframes bounceOutRight {
  0% {
    -webkit-transform: translateX(0); }

  20% {
    opacity: 1;
    -webkit-transform: translateX(-20px); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(2000px); } }

@-moz-keyframes bounceOutRight {
  0% {
    -moz-transform: translateX(0); }

  20% {
    opacity: 1;
    -moz-transform: translateX(-20px); }

  100% {
    opacity: 0;
    -moz-transform: translateX(2000px); } }

@-o-keyframes bounceOutRight {
  0% {
    -o-transform: translateX(0); }

  20% {
    opacity: 1;
    -o-transform: translateX(-20px); }

  100% {
    opacity: 0;
    -o-transform: translateX(2000px); } }

@keyframes bounceOutRight {
  0% {
    transform: translateX(0); }

  20% {
    opacity: 1;
    transform: translateX(-20px); }

  100% {
    opacity: 0;
    transform: translateX(2000px); } }

.bounceOutRight {
  -webkit-animation-name: bounceOutRight;
  -moz-animation-name: bounceOutRight;
  -o-animation-name: bounceOutRight;
  animation-name: bounceOutRight; }

@-webkit-keyframes rotateIn {
  0% {
    -webkit-transform-origin: center center;
    -webkit-transform: rotate(-200deg);
    opacity: 0; }

  100% {
    -webkit-transform-origin: center center;
    -webkit-transform: rotate(0);
    opacity: 1; } }

@-moz-keyframes rotateIn {
  0% {
    -moz-transform-origin: center center;
    -moz-transform: rotate(-200deg);
    opacity: 0; }

  100% {
    -moz-transform-origin: center center;
    -moz-transform: rotate(0);
    opacity: 1; } }

@-o-keyframes rotateIn {
  0% {
    -o-transform-origin: center center;
    -o-transform: rotate(-200deg);
    opacity: 0; }

  100% {
    -o-transform-origin: center center;
    -o-transform: rotate(0);
    opacity: 1; } }

@keyframes rotateIn {
  0% {
    transform-origin: center center;
    transform: rotate(-200deg);
    opacity: 0; }

  100% {
    transform-origin: center center;
    transform: rotate(0);
    opacity: 1; } }

.rotateIn {
  -webkit-animation-name: rotateIn;
  -moz-animation-name: rotateIn;
  -o-animation-name: rotateIn;
  animation-name: rotateIn; }

@-webkit-keyframes rotateInUpLeft {
  0% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(0);
    opacity: 1; } }

@-moz-keyframes rotateInUpLeft {
  0% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(0);
    opacity: 1; } }

@-o-keyframes rotateInUpLeft {
  0% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(0);
    opacity: 1; } }

@keyframes rotateInUpLeft {
  0% {
    transform-origin: left bottom;
    transform: rotate(90deg);
    opacity: 0; }

  100% {
    transform-origin: left bottom;
    transform: rotate(0);
    opacity: 1; } }

.rotateInUpLeft {
  -webkit-animation-name: rotateInUpLeft;
  -moz-animation-name: rotateInUpLeft;
  -o-animation-name: rotateInUpLeft;
  animation-name: rotateInUpLeft; }

@-webkit-keyframes rotateInDownLeft {
  0% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(0);
    opacity: 1; } }

@-moz-keyframes rotateInDownLeft {
  0% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(0);
    opacity: 1; } }

@-o-keyframes rotateInDownLeft {
  0% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(0);
    opacity: 1; } }

@keyframes rotateInDownLeft {
  0% {
    transform-origin: left bottom;
    transform: rotate(-90deg);
    opacity: 0; }

  100% {
    transform-origin: left bottom;
    transform: rotate(0);
    opacity: 1; } }

.rotateInDownLeft {
  -webkit-animation-name: rotateInDownLeft;
  -moz-animation-name: rotateInDownLeft;
  -o-animation-name: rotateInDownLeft;
  animation-name: rotateInDownLeft; }

@-webkit-keyframes rotateInUpRight {
  0% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(0);
    opacity: 1; } }

@-moz-keyframes rotateInUpRight {
  0% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(0);
    opacity: 1; } }

@-o-keyframes rotateInUpRight {
  0% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(-90deg);
    opacity: 0; }

  100% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(0);
    opacity: 1; } }

@keyframes rotateInUpRight {
  0% {
    transform-origin: right bottom;
    transform: rotate(-90deg);
    opacity: 0; }

  100% {
    transform-origin: right bottom;
    transform: rotate(0);
    opacity: 1; } }

.rotateInUpRight {
  -webkit-animation-name: rotateInUpRight;
  -moz-animation-name: rotateInUpRight;
  -o-animation-name: rotateInUpRight;
  animation-name: rotateInUpRight; }

@-webkit-keyframes rotateInDownRight {
  0% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(0);
    opacity: 1; } }

@-moz-keyframes rotateInDownRight {
  0% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(0);
    opacity: 1; } }

@-o-keyframes rotateInDownRight {
  0% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(90deg);
    opacity: 0; }

  100% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(0);
    opacity: 1; } }

@keyframes rotateInDownRight {
  0% {
    transform-origin: right bottom;
    transform: rotate(90deg);
    opacity: 0; }

  100% {
    transform-origin: right bottom;
    transform: rotate(0);
    opacity: 1; } }

.rotateInDownRight {
  -webkit-animation-name: rotateInDownRight;
  -moz-animation-name: rotateInDownRight;
  -o-animation-name: rotateInDownRight;
  animation-name: rotateInDownRight; }

@-webkit-keyframes rotateOut {
  0% {
    -webkit-transform-origin: center center;
    -webkit-transform: rotate(0);
    opacity: 1; }

  100% {
    -webkit-transform-origin: center center;
    -webkit-transform: rotate(200deg);
    opacity: 0; } }

@-moz-keyframes rotateOut {
  0% {
    -moz-transform-origin: center center;
    -moz-transform: rotate(0);
    opacity: 1; }

  100% {
    -moz-transform-origin: center center;
    -moz-transform: rotate(200deg);
    opacity: 0; } }

@-o-keyframes rotateOut {
  0% {
    -o-transform-origin: center center;
    -o-transform: rotate(0);
    opacity: 1; }

  100% {
    -o-transform-origin: center center;
    -o-transform: rotate(200deg);
    opacity: 0; } }

@keyframes rotateOut {
  0% {
    transform-origin: center center;
    transform: rotate(0);
    opacity: 1; }

  100% {
    transform-origin: center center;
    transform: rotate(200deg);
    opacity: 0; } }

.rotateOut {
  -webkit-animation-name: rotateOut;
  -moz-animation-name: rotateOut;
  -o-animation-name: rotateOut;
  animation-name: rotateOut; }

@-webkit-keyframes rotateOutUpLeft {
  0% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(0);
    opacity: 1; }

  100% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(-90deg);
    opacity: 0; } }

@-moz-keyframes rotateOutUpLeft {
  0% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(0);
    opacity: 1; }

  100% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(-90deg);
    opacity: 0; } }

@-o-keyframes rotateOutUpLeft {
  0% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(0);
    opacity: 1; }

  100% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(-90deg);
    opacity: 0; } }

@keyframes rotateOutUpLeft {
  0% {
    transform-origin: left bottom;
    transform: rotate(0);
    opacity: 1; }

  100% {
    transform-origin: left bottom;
    transform: rotate(-90deg);
    opacity: 0; } }

.rotateOutUpLeft {
  -webkit-animation-name: rotateOutUpLeft;
  -moz-animation-name: rotateOutUpLeft;
  -o-animation-name: rotateOutUpLeft;
  animation-name: rotateOutUpLeft; }

@-webkit-keyframes rotateOutDownLeft {
  0% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(0);
    opacity: 1; }

  100% {
    -webkit-transform-origin: left bottom;
    -webkit-transform: rotate(90deg);
    opacity: 0; } }

@-moz-keyframes rotateOutDownLeft {
  0% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(0);
    opacity: 1; }

  100% {
    -moz-transform-origin: left bottom;
    -moz-transform: rotate(90deg);
    opacity: 0; } }

@-o-keyframes rotateOutDownLeft {
  0% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(0);
    opacity: 1; }

  100% {
    -o-transform-origin: left bottom;
    -o-transform: rotate(90deg);
    opacity: 0; } }

@keyframes rotateOutDownLeft {
  0% {
    transform-origin: left bottom;
    transform: rotate(0);
    opacity: 1; }

  100% {
    transform-origin: left bottom;
    transform: rotate(90deg);
    opacity: 0; } }

.rotateOutDownLeft {
  -webkit-animation-name: rotateOutDownLeft;
  -moz-animation-name: rotateOutDownLeft;
  -o-animation-name: rotateOutDownLeft;
  animation-name: rotateOutDownLeft; }

@-webkit-keyframes rotateOutUpRight {
  0% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(0);
    opacity: 1; }

  100% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(90deg);
    opacity: 0; } }

@-moz-keyframes rotateOutUpRight {
  0% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(0);
    opacity: 1; }

  100% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(90deg);
    opacity: 0; } }

@-o-keyframes rotateOutUpRight {
  0% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(0);
    opacity: 1; }

  100% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(90deg);
    opacity: 0; } }

@keyframes rotateOutUpRight {
  0% {
    transform-origin: right bottom;
    transform: rotate(0);
    opacity: 1; }

  100% {
    transform-origin: right bottom;
    transform: rotate(90deg);
    opacity: 0; } }

.rotateOutUpRight {
  -webkit-animation-name: rotateOutUpRight;
  -moz-animation-name: rotateOutUpRight;
  -o-animation-name: rotateOutUpRight;
  animation-name: rotateOutUpRight; }

@-webkit-keyframes rotateOutDownRight {
  0% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(0);
    opacity: 1; }

  100% {
    -webkit-transform-origin: right bottom;
    -webkit-transform: rotate(-90deg);
    opacity: 0; } }

@-moz-keyframes rotateOutDownRight {
  0% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(0);
    opacity: 1; }

  100% {
    -moz-transform-origin: right bottom;
    -moz-transform: rotate(-90deg);
    opacity: 0; } }

@-o-keyframes rotateOutDownRight {
  0% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(0);
    opacity: 1; }

  100% {
    -o-transform-origin: right bottom;
    -o-transform: rotate(-90deg);
    opacity: 0; } }

@keyframes rotateOutDownRight {
  0% {
    transform-origin: right bottom;
    transform: rotate(0);
    opacity: 1; }

  100% {
    transform-origin: right bottom;
    transform: rotate(-90deg);
    opacity: 0; } }

.rotateOutDownRight {
  -webkit-animation-name: rotateOutDownRight;
  -moz-animation-name: rotateOutDownRight;
  -o-animation-name: rotateOutDownRight;
  animation-name: rotateOutDownRight; }

@-webkit-keyframes hinge {
  0% {
    -webkit-transform: rotate(0);
    -webkit-transform-origin: top left;
    -webkit-animation-timing-function: ease-in-out; }

  20%, 60% {
    -webkit-transform: rotate(80deg);
    -webkit-transform-origin: top left;
    -webkit-animation-timing-function: ease-in-out; }

  40% {
    -webkit-transform: rotate(60deg);
    -webkit-transform-origin: top left;
    -webkit-animation-timing-function: ease-in-out; }

  80% {
    -webkit-transform: rotate(60deg) translateY(0);
    opacity: 1;
    -webkit-transform-origin: top left;
    -webkit-animation-timing-function: ease-in-out; }

  100% {
    -webkit-transform: translateY(700px);
    opacity: 0; } }

@-moz-keyframes hinge {
  0% {
    -moz-transform: rotate(0);
    -moz-transform-origin: top left;
    -moz-animation-timing-function: ease-in-out; }

  20%, 60% {
    -moz-transform: rotate(80deg);
    -moz-transform-origin: top left;
    -moz-animation-timing-function: ease-in-out; }

  40% {
    -moz-transform: rotate(60deg);
    -moz-transform-origin: top left;
    -moz-animation-timing-function: ease-in-out; }

  80% {
    -moz-transform: rotate(60deg) translateY(0);
    opacity: 1;
    -moz-transform-origin: top left;
    -moz-animation-timing-function: ease-in-out; }

  100% {
    -moz-transform: translateY(700px);
    opacity: 0; } }

@-o-keyframes hinge {
  0% {
    -o-transform: rotate(0);
    -o-transform-origin: top left;
    -o-animation-timing-function: ease-in-out; }

  20%, 60% {
    -o-transform: rotate(80deg);
    -o-transform-origin: top left;
    -o-animation-timing-function: ease-in-out; }

  40% {
    -o-transform: rotate(60deg);
    -o-transform-origin: top left;
    -o-animation-timing-function: ease-in-out; }

  80% {
    -o-transform: rotate(60deg) translateY(0);
    opacity: 1;
    -o-transform-origin: top left;
    -o-animation-timing-function: ease-in-out; }

  100% {
    -o-transform: translateY(700px);
    opacity: 0; } }

@keyframes hinge {
  0% {
    transform: rotate(0);
    transform-origin: top left;
    animation-timing-function: ease-in-out; }

  20%, 60% {
    transform: rotate(80deg);
    transform-origin: top left;
    animation-timing-function: ease-in-out; }

  40% {
    transform: rotate(60deg);
    transform-origin: top left;
    animation-timing-function: ease-in-out; }

  80% {
    transform: rotate(60deg) translateY(0);
    opacity: 1;
    transform-origin: top left;
    animation-timing-function: ease-in-out; }

  100% {
    transform: translateY(700px);
    opacity: 0; } }

.hinge {
  -webkit-animation-name: hinge;
  -moz-animation-name: hinge;
  -o-animation-name: hinge;
  animation-name: hinge; }

/* originally authored by Nick Pettit - https://github.com/nickpettit/glide */
@-webkit-keyframes rollIn {
  0% {
    opacity: 0;
    -webkit-transform: translateX(-100%) rotate(-120deg); }

  100% {
    opacity: 1;
    -webkit-transform: translateX(0px) rotate(0deg); } }

@-moz-keyframes rollIn {
  0% {
    opacity: 0;
    -moz-transform: translateX(-100%) rotate(-120deg); }

  100% {
    opacity: 1;
    -moz-transform: translateX(0px) rotate(0deg); } }

@-o-keyframes rollIn {
  0% {
    opacity: 0;
    -o-transform: translateX(-100%) rotate(-120deg); }

  100% {
    opacity: 1;
    -o-transform: translateX(0px) rotate(0deg); } }

@keyframes rollIn {
  0% {
    opacity: 0;
    transform: translateX(-100%) rotate(-120deg); }

  100% {
    opacity: 1;
    transform: translateX(0px) rotate(0deg); } }

.rollIn {
  -webkit-animation-name: rollIn;
  -moz-animation-name: rollIn;
  -o-animation-name: rollIn;
  animation-name: rollIn; }

/* originally authored by Nick Pettit - https://github.com/nickpettit/glide */
@-webkit-keyframes rollOut {
  0% {
    opacity: 1;
    -webkit-transform: translateX(0px) rotate(0deg); }

  100% {
    opacity: 0;
    -webkit-transform: translateX(100%) rotate(120deg); } }

@-moz-keyframes rollOut {
  0% {
    opacity: 1;
    -moz-transform: translateX(0px) rotate(0deg); }

  100% {
    opacity: 0;
    -moz-transform: translateX(100%) rotate(120deg); } }

@-o-keyframes rollOut {
  0% {
    opacity: 1;
    -o-transform: translateX(0px) rotate(0deg); }

  100% {
    opacity: 0;
    -o-transform: translateX(100%) rotate(120deg); } }

@keyframes rollOut {
  0% {
    opacity: 1;
    transform: translateX(0px) rotate(0deg); }

  100% {
    opacity: 0;
    transform: translateX(100%) rotate(120deg); } }

.rollOut {
  -webkit-animation-name: rollOut;
  -moz-animation-name: rollOut;
  -o-animation-name: rollOut;
  animation-name: rollOut; }

/* originally authored by Angelo Rohit - https://github.com/angelorohit */
@-webkit-keyframes lightSpeedIn {
  0% {
    -webkit-transform: translateX(100%) skewX(-30deg);
    opacity: 0; }

  60% {
    -webkit-transform: translateX(-20%) skewX(30deg);
    opacity: 1; }

  80% {
    -webkit-transform: translateX(0%) skewX(-15deg);
    opacity: 1; }

  100% {
    -webkit-transform: translateX(0%) skewX(0deg);
    opacity: 1; } }

@-moz-keyframes lightSpeedIn {
  0% {
    -moz-transform: translateX(100%) skewX(-30deg);
    opacity: 0; }

  60% {
    -moz-transform: translateX(-20%) skewX(30deg);
    opacity: 1; }

  80% {
    -moz-transform: translateX(0%) skewX(-15deg);
    opacity: 1; }

  100% {
    -moz-transform: translateX(0%) skewX(0deg);
    opacity: 1; } }

@-o-keyframes lightSpeedIn {
  0% {
    -o-transform: translateX(100%) skewX(-30deg);
    opacity: 0; }

  60% {
    -o-transform: translateX(-20%) skewX(30deg);
    opacity: 1; }

  80% {
    -o-transform: translateX(0%) skewX(-15deg);
    opacity: 1; }

  100% {
    -o-transform: translateX(0%) skewX(0deg);
    opacity: 1; } }

@keyframes lightSpeedIn {
  0% {
    transform: translateX(100%) skewX(-30deg);
    opacity: 0; }

  60% {
    transform: translateX(-20%) skewX(30deg);
    opacity: 1; }

  80% {
    transform: translateX(0%) skewX(-15deg);
    opacity: 1; }

  100% {
    transform: translateX(0%) skewX(0deg);
    opacity: 1; } }

.lightSpeedIn {
  -webkit-animation-name: lightSpeedIn;
  -moz-animation-name: lightSpeedIn;
  -o-animation-name: lightSpeedIn;
  animation-name: lightSpeedIn;
  -webkit-animation-timing-function: ease-out;
  -moz-animation-timing-function: ease-out;
  -o-animation-timing-function: ease-out;
  animation-timing-function: ease-out; }

.animated.lightSpeedIn {
  -webkit-animation-duration: 0.5s;
  -moz-animation-duration: 0.5s;
  -o-animation-duration: 0.5s;
  animation-duration: 0.5s; }

/* originally authored by Angelo Rohit - https://github.com/angelorohit */
@-webkit-keyframes lightSpeedOut {
  0% {
    -webkit-transform: translateX(0%) skewX(0deg);
    opacity: 1; }

  100% {
    -webkit-transform: translateX(100%) skewX(-30deg);
    opacity: 0; } }

@-moz-keyframes lightSpeedOut {
  0% {
    -moz-transform: translateX(0%) skewX(0deg);
    opacity: 1; }

  100% {
    -moz-transform: translateX(100%) skewX(-30deg);
    opacity: 0; } }

@-o-keyframes lightSpeedOut {
  0% {
    -o-transform: translateX(0%) skewX(0deg);
    opacity: 1; }

  100% {
    -o-transform: translateX(100%) skewX(-30deg);
    opacity: 0; } }

@keyframes lightSpeedOut {
  0% {
    transform: translateX(0%) skewX(0deg);
    opacity: 1; }

  100% {
    transform: translateX(100%) skewX(-30deg);
    opacity: 0; } }

.lightSpeedOut {
  -webkit-animation-name: lightSpeedOut;
  -moz-animation-name: lightSpeedOut;
  -o-animation-name: lightSpeedOut;
  animation-name: lightSpeedOut;
  -webkit-animation-timing-function: ease-in;
  -moz-animation-timing-function: ease-in;
  -o-animation-timing-function: ease-in;
  animation-timing-function: ease-in; }

.animated.lightSpeedOut {
  -webkit-animation-duration: 0.25s;
  -moz-animation-duration: 0.25s;
  -o-animation-duration: 0.25s;
  animation-duration: 0.25s; }

/* originally authored by Angelo Rohit - https://github.com/angelorohit */
@-webkit-keyframes wiggle {
  0% {
    -webkit-transform: skewX(9deg); }

  10% {
    -webkit-transform: skewX(-8deg); }

  20% {
    -webkit-transform: skewX(7deg); }

  30% {
    -webkit-transform: skewX(-6deg); }

  40% {
    -webkit-transform: skewX(5deg); }

  50% {
    -webkit-transform: skewX(-4deg); }

  60% {
    -webkit-transform: skewX(3deg); }

  70% {
    -webkit-transform: skewX(-2deg); }

  80% {
    -webkit-transform: skewX(1deg); }

  90% {
    -webkit-transform: skewX(0deg); }

  100% {
    -webkit-transform: skewX(0deg); } }

@-moz-keyframes wiggle {
  0% {
    -moz-transform: skewX(9deg); }

  10% {
    -moz-transform: skewX(-8deg); }

  20% {
    -moz-transform: skewX(7deg); }

  30% {
    -moz-transform: skewX(-6deg); }

  40% {
    -moz-transform: skewX(5deg); }

  50% {
    -moz-transform: skewX(-4deg); }

  60% {
    -moz-transform: skewX(3deg); }

  70% {
    -moz-transform: skewX(-2deg); }

  80% {
    -moz-transform: skewX(1deg); }

  90% {
    -moz-transform: skewX(0deg); }

  100% {
    -moz-transform: skewX(0deg); } }

@-o-keyframes wiggle {
  0% {
    -o-transform: skewX(9deg); }

  10% {
    -o-transform: skewX(-8deg); }

  20% {
    -o-transform: skewX(7deg); }

  30% {
    -o-transform: skewX(-6deg); }

  40% {
    -o-transform: skewX(5deg); }

  50% {
    -o-transform: skewX(-4deg); }

  60% {
    -o-transform: skewX(3deg); }

  70% {
    -o-transform: skewX(-2deg); }

  80% {
    -o-transform: skewX(1deg); }

  90% {
    -o-transform: skewX(0deg); }

  100% {
    -o-transform: skewX(0deg); } }

@keyframes wiggle {
  0% {
    transform: skewX(9deg); }

  10% {
    transform: skewX(-8deg); }

  20% {
    transform: skewX(7deg); }

  30% {
    transform: skewX(-6deg); }

  40% {
    transform: skewX(5deg); }

  50% {
    transform: skewX(-4deg); }

  60% {
    transform: skewX(3deg); }

  70% {
    transform: skewX(-2deg); }

  80% {
    transform: skewX(1deg); }

  90% {
    transform: skewX(0deg); }

  100% {
    transform: skewX(0deg); } }

.wiggle {
  -webkit-animation-name: wiggle;
  -moz-animation-name: wiggle;
  -o-animation-name: wiggle;
  animation-name: wiggle;
  -webkit-animation-timing-function: ease-in;
  -moz-animation-timing-function: ease-in;
  -o-animation-timing-function: ease-in;
  animation-timing-function: ease-in; }

.animated.wiggle {
  -webkit-animation-duration: 0.75s;
  -moz-animation-duration: 0.75s;
  -o-animation-duration: 0.75s;
  animation-duration: 0.75s; }
  

    </style>

    <link href="https://ningyu1.github.io/site/css/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
	<link href="https://ningyu1.github.io/site/css/github-markdown.css" rel="stylesheet" type="text/css">

    <link href='https://ningyu1.github.io/site/css/Slackey.css' rel='stylesheet' type='text/css'>
    <link href='https://ningyu1.github.io/site/css/Fjallaone.css' rel='stylesheet' type='text/css'>
    <link href='https://ningyu1.github.io/site/css/Amethysta.css' rel='stylesheet' type='text/css'>
	<script src="https://ningyu1.github.io/site/js/jquery.min.js"></script>
    

    <script type="text/javascript" src="https://ningyu1.github.io/site/js/jquery-tapir.js"></script>

    

    <link rel="stylesheet" href="https://ningyu1.github.io/site/css/hljs.css">
    <script src="https://ningyu1.github.io/site/js/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
	<script>
	var _hmt = _hmt || [];
	(function() {
	  var hm = document.createElement("script");
	  hm.src = "https://hm.baidu.com/hm.js?5bb9b9d406e3381971859973a2ca3583";
	  var s = document.getElementsByTagName("script")[0]; 
	  s.parentNode.insertBefore(hm, s);
	})();
	</script>
</head>


<a href="https://github.com/ningyu1"><img style="position: absolute; top: 0; right: 0; border: 0; width: 149px; height: 149px; z-index:9999; background-color: rgba(0, 0, 0, 0)!important;" src="https://ningyu1.github.io/site/images/right-graphite@2x.png" alt="Fork me on GitHub"></a>








<link href="https://ningyu1.github.io/site/css/music-player.css" media="screen, projection" rel="stylesheet" type="text/css">
<script type="text/javascript" src="https://ningyu1.github.io/site/js/music-player.js"></script>
<iframe class="player"  frameborder="no" border="0" marginwidth="0" marginheight="0" width=280 height=86 src="https://music.163.com/outchain/player?type=2&id=1296583188&auto=0&height=66"></iframe>



<body class="markdown-body">
    <div id="wrapper">
        <header id="header" class="inner">
<h1 class="animated bounceInDown">
    <div id="headerbg">
        凝雨 - Yun
    </div>
</h1>

<span class="subtitle">快乐编程每一天 - Happy Coding Every Day</span>
<br>


<ul id="social-links" style="text-align:center; clear:both;">
	
    
    <li>
    <a href="mailto:ningbe111@163.com" class="email" title="Email"></a>
    </li>
    
    
    
    <li>
    <a href="https://github.com/ningyu1" class="github" title="Github"></a>
    </li>
    
	
    
    <li>
    <a href="https://gitlab.com/ningyu1" class="gitlab" title="Gitlab"></a>
    </li>
    
    
    
    
    
    
    
    
	
    
    <li>
    <a href="https://gitee.com/ningyu" class="gitee" title="Gitee码云"></a>
    </li>
    
	<li>

    <a href="https://ningyu1.github.io/atom.xml" class="rss" title="RSS" target="_blank"></a>
    </li>
</ul>



<ul id="nav">





    
    <li id="ajax"><a href="https://ningyu1.github.io/">Home</a></li>
    <li id="ajax"><a href="https://ningyu1.github.io/archives/">Archives</a></li>
    <li id="ajax"><a href="https://ningyu1.github.io/categories/">Categories</a></li>
    <li id="ajax"><a href="https://ningyu1.github.io/tags/">Tags</a></li>
    <li id="ajax"><a href="https://ningyu1.github.io/about/">About</a></li>
    <li id="ajax"><a href="https://g2.okk.dog/?path=register&code=qn7nOwdj">科学上网</a></li>
    
    <li>
    <div id="dark">
        
        <form action="//www.google.com/search" method="get" accept-charset="UTF-8" id="search">

            <input type="hidden" name="sitesearch" value="https://ningyu1.github.io" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
</ul>

</header>

<div id="toload">

    <div id="content" class="inner">
        




    
    <script id="dsq-count-scr" src="//ningyu.disqus.com/count.js" async></script>
    




  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/70-cas-server-pit/">Trouble Shooting —— CAS Server集群环境下TGC验证问题排查，需要开启会话保持</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-03-16T12:02:53.000&#43;00:00' itemprop="datePublished">2018-03-16</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/cas">CAS</a>

<a href="https://ningyu1.github.io/site/tags/trouble-shooting">trouble shooting</a>

<a href="https://ningyu1.github.io/site/tags/iphash">iphash</a>

<a href="https://ningyu1.github.io/site/tags/tomcatredissessionmanager">TomcatRedisSessionManager</a>

<a href="https://ningyu1.github.io/site/tags/invalid-cookie.-required-remote-address-does-not-match-ip">Invalid cookie. Required remote address does not match ip</a>


</div>
    </div>
        

<h1 id="问题现象">问题现象</h1>

<p><code>CAS</code>部署结构：</p>

<p>两台<code>cas server</code>通过<code>nginx</code>做负载均衡，两个<code>cas server</code>的<code>ticket registry</code>配置的<code>jpa</code>方式，指向同一个库。两个<code>cas server</code>的<code>tomcat</code>做了<code>TomcatRedisSessionManager</code>，使用<code>redis</code>集中存储<code>session</code>。</p>

<p>目前的现象：</p>

<p>页面上请求<code>cas</code>登录地址，登录过后频繁刷新登录页面，有时返回已登录，有时返回未登录，当返回未登录时去后台查看日志发现有如下错误，验证<code>cookie</code>发现请求的源<code>IP</code>与第一次访问的源<code>IP</code>不一致。这个很明显是<code>cas</code>集群环境下的问题。</p>

<pre><code>2018-03-16 10:02:44,418 DEBUG [org.apereo.cas.web.support.TGCCookieRetrievingCookieGenerator] - &lt;Invalid cookie. Required remote address does not match ${ip}&gt;
java.lang.IllegalStateException: Invalid cookie. Required remote address does not match ${ip}
	at org.apereo.cas.web.support.DefaultCasCookieValueManager.obtainCookieValue(DefaultCasCookieValueManager.java:84) ~[cas-server-support-cookie-5.0.4.jar:5.0.4]
	at org.apereo.cas.web.support.CookieRetrievingCookieGenerator.retrieveCookieValue(CookieRetrievingCookieGenerator.java:93) ~[cas-server-support-cookie-5.0.4.jar:5.0.4]
	at org.apereo.cas.web.support.CookieRetrievingCookieGenerator$$FastClassBySpringCGLIB$$25dba342.invoke(&lt;generated&gt;) ~[cas-server-support-cookie-5.0.4.jar:5.0.4]
	at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:204) ~[spring-core-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:720) ~[spring-aop-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:157) ~[spring-aop-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.aop.support.DelegatingIntroductionInterceptor.doProceed(DelegatingIntroductionInterceptor.java:133) ~[spring-aop-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.aop.support.DelegatingIntroductionInterceptor.invoke(DelegatingIntroductionInterceptor.java:121) ~[spring-aop-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179) ~[spring-aop-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:655) ~[spring-aop-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.apereo.cas.web.support.CookieRetrievingCookieGenerator$$EnhancerBySpringCGLIB$$10d36968.retrieveCookieValue(&lt;generated&gt;) ~[cas-server-support-cookie-5.0.4.jar:5.0.4]
	at org.apereo.cas.logging.web.ThreadContextMDCServletFilter.doFilter(ThreadContextMDCServletFilter.java:83) ~[cas-server-core-logging-5.0.4.jar:5.0.4]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208) ~[catalina.jar:7.0.85]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:99) ~[spring-web-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) ~[spring-web-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208) ~[catalina.jar:7.0.85]
	at org.springframework.web.filter.HttpPutFormContentFilter.doFilterInternal(HttpPutFormContentFilter.java:89) ~[spring-web-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) ~[spring-web-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208) ~[catalina.jar:7.0.85]
	at org.springframework.web.filter.HiddenHttpMethodFilter.doFilterInternal(HiddenHttpMethodFilter.java:77) ~[spring-web-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) ~[spring-web-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208) ~[catalina.jar:7.0.85]
	at org.springframework.boot.actuate.autoconfigure.MetricsFilter.doFilterInternal(MetricsFilter.java:107) ~[spring-boot-actuator-1.4.2.RELEASE.jar:1.4.2.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) ~[spring-web-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208) ~[catalina.jar:7.0.85]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:197) ~[spring-web-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) ~[spring-web-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208) ~[catalina.jar:7.0.85]
	at org.springframework.boot.web.support.ErrorPageFilter.doFilter(ErrorPageFilter.java:117) ~[spring-boot-1.4.2.RELEASE.jar:1.4.2.RELEASE]
	at org.springframework.boot.web.support.ErrorPageFilter.access$000(ErrorPageFilter.java:61) ~[spring-boot-1.4.2.RELEASE.jar:1.4.2.RELEASE]
	at org.springframework.boot.web.support.ErrorPageFilter$1.doFilterInternal(ErrorPageFilter.java:92) ~[spring-boot-1.4.2.RELEASE.jar:1.4.2.RELEASE]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:107) ~[spring-web-4.3.4.RELEASE.jar:4.3.4.RELEASE]
	at org.springframework.boot.web.support.ErrorPageFilter.doFilter(ErrorPageFilter.java:110) ~[spring-boot-1.4.2.RELEASE.jar:1.4.2.RELEASE]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208) ~[catalina.jar:7.0.85]
	at org.apache.logging.log4j.web.Log4jServletFilter.doFilter(Log4jServletFilter.java:71) ~[log4j-web-2.6.2.jar:2.6.2]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:241) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:208) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:219) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:110) ~[catalina.jar:7.0.85]
	at com.r.tomcat.session.management.RequestSessionHandlerValve.invoke(RequestSessionHandlerValve.java:30) ~[TomcatRedisSessionManager-1.0.jar:?]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:169) ~[catalina.jar:7.0.85]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:103) ~[catalina.jar:7.0.85]
	at org.apache.catalina.valves.AccessLogValve.invoke(AccessLogValve.java:962) ~[catalina.jar:7.0.85]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:116) ~[catalina.jar:7.0.85]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:445) ~[catalina.jar:7.0.85]
	at org.apache.coyote.http11.AbstractHttp11Processor.process(AbstractHttp11Processor.java:1115) ~[tomcat-coyote.jar:7.0.85]
	at org.apache.coyote.AbstractProtocol$AbstractConnectionHandler.process(AbstractProtocol.java:637) ~[tomcat-coyote.jar:7.0.85]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1775) ~[tomcat-coyote.jar:7.0.85]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.run(NioEndpoint.java:1734) ~[tomcat-coyote.jar:7.0.85]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) [?:1.8.0_162]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) [?:1.8.0_162]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) ~[tomcat-coyote.jar:7.0.85]
	at java.lang.Thread.run(Thread.java:748) [?:1.8.0_162]

</code></pre>

<p>网上查询资料：<a href="https://groups.google.com/a/apereo.org/forum/#!topic/cas-user/R4WVT4Tq0g8">google group</a>，相同的问题，但是没有看到具体的解决方法。</p>

<p>看到的<a href="https://tomcat.apache.org/tomcat-7.0-doc/api/org/apache/catalina/valves/RemoteIpValve.html">tomcat RemoteIpValue</a>也只是<code>tomcat</code>请求<code>ip</code>限制的方法，跟我们要的不匹配</p>

<p>根据异常查看<code>CAS</code>代码，如下：</p>

<pre><code> public String obtainCookieValue(Cookie cookie, HttpServletRequest request)
  {
    String cookieValue = (String)this.cipherExecutor.decode(cookie.getValue());
    LOGGER.debug(&quot;Decoded cookie value is [{}]&quot;, cookieValue);
    if (StringUtils.isBlank(cookieValue))
    {
      LOGGER.debug(&quot;Retrieved decoded cookie value is blank. Failed to decode cookie [{}]&quot;, cookie.getName());
      return null;
    }
    String[] cookieParts = cookieValue.split(String.valueOf('@'));
    if (cookieParts.length != 3) {
      throw new IllegalStateException(&quot;Invalid cookie. Required fields are missing&quot;);
    }
    String value = cookieParts[0];
    String remoteAddr = cookieParts[1];
    String userAgent = cookieParts[2];
    if ((StringUtils.isBlank(value)) || (StringUtils.isBlank(remoteAddr)) || 
      (StringUtils.isBlank(userAgent))) {
      throw new IllegalStateException(&quot;Invalid cookie. Required fields are empty&quot;);
    }
    if (!remoteAddr.equals(request.getRemoteAddr())) {
      throw new IllegalStateException(&quot;Invalid cookie. Required remote address does not match &quot; + request.getRemoteAddr());
    }
    String agent = WebUtils.getHttpServletRequestUserAgent(request);
    if (!userAgent.equals(agent)) {
      throw new IllegalStateException(&quot;Invalid cookie. Required user-agent does not match &quot; + agent);
    }
    return value;
  }
</code></pre>

<p><code>TGC</code>中包含了<code>user-agent</code>信息，会根据<code>request</code>的<code>user-agent</code>去跟<code>decode</code>后的<code>cookie</code>中的<code>user-agent</code>对比，而且这个验证是在<code>cas 4.1</code>版本就已经加了这个验证信息了，如果我们修改源码去掉这个<code>user-agent</code>验证可能还会引发其他问题。</p>

<h1 id="解决方案">解决方案</h1>

<p>因此我们选用负载均衡的保持会话来解决这个问题了。</p>

<ol>
<li>如果使用的是阿里云的<code>SLB</code>需要开启会话保持的选项。</li>
<li>如果使用<code>nginx</code>需要在<code>upstream</code>中增加<code>ip_hash</code>保持会话。</li>
</ol>

<p><span style="color:blue"><em>这样就可以让相同的客户端ip将会话永远路由到相同的一台后端<code>cas server</code>上去。</em></span></p>

<p>经过验证解决了上述的问题。</p>

<p>所以这里需要说明一下，在对<code>cas server</code>做集群实现无状态化，需要注意一下几点：</p>

<ol>
<li><code>cas</code>的<code>ticket</code>需要做到集中存储，可以使用<code>redis</code>、<code>jpa</code>、或者其他方式，这个官方文章上有详细介绍：<a href="https://apereo.github.io/cas/5.0.x/installation/Configuration-Properties.html#ticket-registry">ticket-registry</a></li>
<li><code>cas</code>的<code>session</code>信息需要做到集中存储，如果使用的是<code>tomcat</code>可以使用<a href="https://github.com/ran-jit/tomcat-cluster-redis-session-manager">TomcatRedisSessionMananger</a>插件来通过redis做session集中存储。</li>
<li>还有一个就是上面遇到的问题，客户端<code>cookie</code>信息：<code>TGC</code>，<code>TGC</code>采用<code>cookie</code>方式存在客户端，因此需要开启会话保持，使得相同客户端每次都会被路由到同一个<code>cas server</code>上去做<code>TGC</code>验证。</li>
<li>最后一个就是需要接入<code>sso</code>的<code>client</code>应用端的<code>session</code>信息也需要做集中存储，因此<code>cas server</code>会和<code>client</code>进行通信去验证<code>ticket</code>，验证完后会生成信息并存储到<code>sesson</code>中，因此也需要使用<a href="https://github.com/ran-jit/tomcat-cluster-redis-session-manager">TomcatRedisSessionMananger</a>插件来通过<code>redis</code>做<code>session</code>集中存储。</li>
</ol>

<p>世界和平、Keep Real！</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/70-cas-server-pit/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/69-java-reflect/">Json序列化、反序列化支持泛型，Dubbo对泛型参数方法进行反射调用</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-03-13T15:31:53.000&#43;00:00' itemprop="datePublished">2018-03-13</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/json">json</a>

<a href="https://ningyu1.github.io/site/tags/gson">gson</a>

<a href="https://ningyu1.github.io/site/tags/dubbo">dubbo</a>

<a href="https://ningyu1.github.io/site/tags/genericservice">GenericService</a>


</div>
    </div>
        

<p>最近在对Dubbo接口进行反射调用时，遇到了参数类型较为复杂的情况下，使用反射方式无法调用的问题。</p>

<p>由于Dubbo使用了proxy代理对象，因此在反射上调用是存在一定的问题，从反射对象上获取的方法和参数类型可能会导致无法正常的调用。</p>

<p>首先先让我们看一个复杂参数的接口定义</p>

<pre><code>public String testMethod(Map&lt;String,ResourceVo&gt; map, List&lt;Map&lt;String,ResourceVo&gt;&gt; list) throws BizException;
</code></pre>

<h2 id="gson反序列化复杂类型">Gson反序列化复杂类型</h2>

<p>在对参数进行反序列化时，内部的类型容易丢失，我们可以使用gson的Type进行反序列化得到正确的参数值，让我们看一下gson反序列化的两个方法</p>

<pre><code>  /**
   * This method deserializes the specified Json into an object of the specified class. It is not
   * suitable to use if the specified class is a generic type since it will not have the generic
   * type information because of the Type Erasure feature of Java. Therefore, this method should not
   * be used if the desired type is a generic type. Note that this method works fine if the any of
   * the fields of the specified object are generics, just the object itself should not be a
   * generic type. For the cases when the object is of generic type, invoke
   * {@link #fromJson(String, Type)}. If you have the Json in a {@link Reader} instead of
   * a String, use {@link #fromJson(Reader, Class)} instead.
   *
   * @param &lt;T&gt; the type of the desired object
   * @param json the string from which the object is to be deserialized
   * @param classOfT the class of T
   * @return an object of type T from the string. Returns {@code null} if {@code json} is {@code null}.
   * @throws JsonSyntaxException if json is not a valid representation for an object of type
   * classOfT
   */
  public &lt;T&gt; T fromJson(String json, Class&lt;T&gt; classOfT) throws JsonSyntaxException {
    Object object = fromJson(json, (Type) classOfT);
    return Primitives.wrap(classOfT).cast(object);
  }

 /**
   * This method deserializes the specified Json into an object of the specified type. This method
   * is useful if the specified object is a generic type. For non-generic objects, use
   * {@link #fromJson(String, Class)} instead. If you have the Json in a {@link Reader} instead of
   * a String, use {@link #fromJson(Reader, Type)} instead.
   *
   * @param &lt;T&gt; the type of the desired object
   * @param json the string from which the object is to be deserialized
   * @param typeOfT The specific genericized type of src. You can obtain this type by using the
   * {@link com.google.gson.reflect.TypeToken} class. For example, to get the type for
   * {@code Collection&lt;Foo&gt;}, you should use:
   * &lt;pre&gt;
   * Type typeOfT = new TypeToken&amp;lt;Collection&amp;lt;Foo&amp;gt;&amp;gt;(){}.getType();
   * &lt;/pre&gt;
   * @return an object of type T from the string. Returns {@code null} if {@code json} is {@code null}.
   * @throws JsonParseException if json is not a valid representation for an object of type typeOfT
   * @throws JsonSyntaxException if json is not a valid representation for an object of type
   */
  @SuppressWarnings(&quot;unchecked&quot;)
  public &lt;T&gt; T fromJson(String json, Type typeOfT) throws JsonSyntaxException {
    if (json == null) {
      return null;
    }
    StringReader reader = new StringReader(json);
    T target = (T) fromJson(reader, typeOfT);
    return target;
  }
</code></pre>

<p>让我们测试一下复杂接口参数在使用这两个方法反序列化会有什么不同</p>

<pre><code>String json = &quot;{\&quot;name\&quot;:\&quot;name\&quot;,\&quot;value\&quot;:{\&quot;service\&quot;:\&quot;test1\&quot;,\&quot;url\&quot;:\&quot;test\&quot;,\&quot;action\&quot;:\&quot;GET\&quot;,\&quot;enabled\&quot;:true,\&quot;isPublic\&quot;:false,\&quot;appId\&quot;:8,\&quot;menuId\&quot;:30001}}&quot;;
Class clazz = Map.class;
Map map = gson.fromJson(json, clazz);
</code></pre>

<p>上面代码反序列化后的map对象实际是<code>com.google.gson.internal.LinkedTreeMap&lt;K, V&gt;</code>，这个是gson中自定义的Map实现类，而且内部的对象也都是<code>LinkedTreeMap</code>，当我们换成HashMap时，返回的结果都是<code>HashMap</code>，但是我们的方法上使用的是<code>Map&lt;String,ResourceVo&gt;</code>，如何才能反序列化得到这个类型的对象呢？让我们看一下使用Type后的情况。</p>

<pre><code>String json = &quot;{\&quot;name\&quot;:\&quot;name\&quot;,\&quot;value\&quot;:{\&quot;service\&quot;:\&quot;test1\&quot;,\&quot;url\&quot;:\&quot;test\&quot;,\&quot;action\&quot;:\&quot;GET\&quot;,\&quot;enabled\&quot;:true,\&quot;isPublic\&quot;:false,\&quot;appId\&quot;:8,\&quot;menuId\&quot;:30001}}&quot;;
Type type = new TypeToken&lt;ResourceVo&gt;(){}.getType();
Map&lt;ResourceVo&gt; map = gson.fromJson(json, type);
</code></pre>

<p>通过使用TypeToken生成的Type对象可以得到<code>Map&lt;String,ResourceVo&gt;</code>这个类型的实例，但是当我们在反射调用方法时，由于不知道参数是什么类型，也不能够import自定义的对象来使用<code>TypeToken</code>来获取type对象，那我们应该怎么做呢？接着往下看</p>

<p><span style="color:blue">ps.类型：List&#60;ResourceVo&gt;和List&#60;Map&#60;Object,ResourceVo&gt;&gt;这样的类型一样使用Type来进行反序列化</span></p>

<pre><code>String json = &quot;{\&quot;name\&quot;:\&quot;name\&quot;,\&quot;value\&quot;:{\&quot;service\&quot;:\&quot;test1\&quot;,\&quot;url\&quot;:\&quot;test\&quot;,\&quot;action\&quot;:\&quot;GET\&quot;,\&quot;enabled\&quot;:true,\&quot;isPublic\&quot;:false,\&quot;appId\&quot;:8,\&quot;menuId\&quot;:30001}}&quot;;
Class clazz = Class.forName(&quot;com.package.JavaBean&quot;);
String methodName = &quot;testMethod&quot;;
Method[] methods = clazz.getMethods();
for (Method m : methods) {
	if (m.getName().equals(methodName)) {
		Type[] paramTypes = m.getGenericParameterTypes();
		for (int j = 0; j &lt; paramTypes.length; j++) {
			gson.fromJson(json, paramTypes[j]);
		}
	}
}
</code></pre>

<p>可以通过<code>method.getGenericParameterTypes()</code>获取参数的<code>Type</code>对象。</p>

<p><span style="color:blue">但是需要注意的是，当使用<code>Proxy</code>代理对象通过上面的方式获取的<code>Type</code>对象全都是<code>java.lang.Class</code></span></p>

<p>那如何解决代理对象获取的<code>Type</code>不正确的问题呢？</p>

<p>正确的做法就是放弃通过<code>Proxy</code>对象来进行反射，使用<code>Class.forName</code>获取<code>Class</code>对象进行反射。</p>

<p>可以通过<code>Class.forName</code>的方式获取<code>Class</code>对象，再获取<code>Method</code>对象，最后通过<code>Method.getGenericParameterTypes()</code>获取正确的<code>Type</code>对象，这个步骤是构造方法的参数类型和参数值。但是通过这个方式构造出来的参数类型和参数值，无法通过<code>proxy</code>对象来进行<code>method.invoke</code>，其原因就是原始接口的方法参数定义和代理对象的方法参数定义不同导致。这让我们如何是好。</p>

<p>继续往下看。</p>

<h2 id="dubbo泛化调用">Dubbo泛化调用</h2>

<p>通过<code>Dubbo</code>的官网文档找到<code>Dubbo</code>支持<code>GenericService</code>泛化调用，什么是泛化调用？</p>

<p>泛化接口调用方式主要用于客户端没有 <code>API</code> 接口及模型类元的情况，参数及返回值中的所有 <code>POJO</code> 均用 <code>Map</code> 表示，通常用于框架集成，比如：实现一个通用的服务测试框架，可通过 <code>GenericService</code> 调用所有服务实现。</p>

<p><span style="color:blue">ps. <code>GenericService</code>实际上是<code>Dubbo</code>提供的通用接口，解决使用通用接口调用任何服务方法</span></p>

<p>这样我们就可以使用前面说到的参数反序列化方式来获取方法的参数类型和参数值，传入<code>GenericService</code>通用接口来对目标方法进行调用。</p>

<p>首先先让我们看一下<code>Dubbo</code>的泛化调用如何使用。</p>

<pre><code>import com.alibaba.dubbo.rpc.config.ApplicationConfig;
import com.alibaba.dubbo.rpc.config.RegistryConfig;
import com.alibaba.dubbo.rpc.config.ConsumerConfig;
import com.alibaba.dubbo.rpc.config.ReferenceConfig;

Class clazz = Class.forName(&quot;com.package.JavaBean&quot;);
String method = &quot;testMethod&quot;
// 当前应用配置
ApplicationConfig application = new ApplicationConfig();
application.setName(&quot;yyy&quot;);
// 连接注册中心配置
RegistryConfig registry = new RegistryConfig();
registry.setAddress(&quot;10.20.130.230:9090&quot;);
// 注意：ReferenceConfig为重对象，内部封装了与注册中心的连接，以及与服务提供方的连接
// 引用远程服务
ReferenceConfig reference = new ReferenceConfig(); // 此实例很重，封装了与注册中心的连接以及与提供者的连接，请自行缓存，否则可能造成内存和连接泄漏
reference.setApplication(application);
reference.setRegistry(registry); // 多个注册中心可以用setRegistries()
reference.setInterface(clazz);
reference.setVersion(&quot;1.0.0&quot;);
reference.setRetries(0);
reference.setCluster(&quot;failfast&quot;);
reference.setTimeout(12001);
reference.setGeneric(true);
GenericService genericService = (GenericService) reference.get();
Object result = genericService.$invoke(method, parameterTypes, parameterValues);
</code></pre>

<p>只要给<code>reference</code>设置<code>generic</code>为<code>true</code>就可以使用<code>GenericService</code>通用接口来进行方法调用。</p>

<p>这样我们就可以顺利的完成任何参数类型方法的反射调用。</p>

<p><span style="color:blue">从而避免了通过<code>Proxy</code>代理类获取到不正确的参数<code>Type</code>导致反序列化参数失败，这个原因前面也说了是因为原始接口的方法参数定义和代理对象的方法参数定义不同导致。</span></p>

<p>接下来让我们看一下具体的实现</p>

<pre><code>@SuppressWarnings({&quot;unchecked&quot;, &quot;rawtypes&quot;, &quot;static-access&quot;})
private Object callDubbo(SampleResult res) {
    ApplicationConfig application = new ApplicationConfig();
    application.setName(&quot;DubboSample&quot;);
    
    // 此实例很重，封装了与注册中心的连接以及与提供者的连接，请自行缓存，否则可能造成内存和连接泄漏
    ReferenceConfig reference = new ReferenceConfig();
    // 引用远程服务
    reference.setApplication(application);
    RegistryConfig registry = null;
    
    String protocol = getProtocol();
    if (&quot;zookeeper&quot;.equals(protocol)) {
        // 连接注册中心配置
        registry = new RegistryConfig();
        registry.setProtocol(&quot;zookeeper&quot;);
        registry.setAddress(getAddress());
        reference.setRegistry(registry); // 多个注册中心可以用setRegistries()
    } else {
        StringBuffer sb = new StringBuffer();
        sb.append(protocol).append(&quot;://&quot;).append(getAddress()).append(&quot;/&quot;).append(getInterface());
        log.info(&quot;rpc invoker url : &quot; + sb.toString());
        reference.setUrl(sb.toString());
    }
    try {
        Class clazz = Class.forName(getInterface());
        reference.setInterface(clazz);
        reference.setRetries(Integer.valueOf(getRetries()));
        reference.setCluster(getCluster());
        reference.setVersion(getVersion());
        reference.setTimeout(Integer.valueOf(getTimeout()));
        reference.setGeneric(true);
        GenericService genericService = (GenericService) reference.get();
        Method method = null;
        String[] parameterTypes = null;
        Object[] parameterValues = null;
        List&lt;MethodArgument&gt; args = getMethodArgs();
        List&lt;String&gt; paramterTypeList = null;
        List&lt;Object&gt; parameterValuesList = null;
        Method[] methods = clazz.getMethods();
		for (int i = 0; i &lt; methods.length; i++) {
			Method m = methods[i];
			Type[] paramTypes = m.getGenericParameterTypes();
			paramterTypeList = new ArrayList&lt;String&gt;();
			parameterValuesList = new ArrayList&lt;Object&gt;();
			log.info(&quot;paramTypes.length=&quot;+paramTypes.length+&quot;|args.size()=&quot;+args.size());
			if (m.getName().equals(getMethod()) &amp;&amp; paramTypes.length == args.size()) {
				//名称与参数数量匹配，进行参数类型转换
				for (int j = 0; j &lt; paramTypes.length; j++) {
					paramterTypeList.add(args.get(j).getParamType());
					ClassUtils.parseParameter(paramTypes[j], parameterValuesList, args.get(j));
				}
				if (parameterValuesList.size() == paramTypes.length) {
					//没有转换错误，数量应该一致
					method = m;
					break;
				}
			}
		}
        if (method == null) {
            res.setSuccessful(false);
            return &quot;Method[&quot;+getMethod()+&quot;] Not found!&quot;;
        }
        //发起调用
        parameterTypes = paramterTypeList.toArray(new String[paramterTypeList.size()]);
        parameterValues = parameterValuesList.toArray(new Object[parameterValuesList.size()]);
        Object result = null;
		try {
			result = genericService.$invoke(getMethod(), parameterTypes, parameterValues);
			res.setSuccessful(true);
		} catch (Throwable e) {
			log.error(&quot;接口返回异常：&quot;, e);
			res.setSuccessful(false);
			result = e;
		}
        return result;
    } catch (Exception e) {
        log.error(&quot;调用dubbo接口出错：&quot;, e);
        res.setSuccessful(false);
        return e;
    } finally {
        if (registry != null) {
            registry.destroyAll();
        }
        reference.destroy();
    }
}

## ClassUtils.parseParameter方法代码

public static void parseParameter(Type type,
		List&lt;Object&gt; parameterValuesList, MethodArgument arg)
		throws ClassNotFoundException {
	String className = getClassName(type);
	if (className.equals(&quot;int&quot;)) {
		parameterValuesList.add(Integer.parseInt(arg.getParamValue()));
	} else if (className.equals(&quot;double&quot;)) {
		parameterValuesList.add(Double.parseDouble(arg.getParamValue()));
	} else if (className.equals(&quot;short&quot;)) {
		parameterValuesList.add(Short.parseShort(arg.getParamValue()));
	} else if (className.equals(&quot;float&quot;)) {
		parameterValuesList.add(Float.parseFloat(arg.getParamValue()));
	} else if (className.equals(&quot;long&quot;)) {
		parameterValuesList.add(Long.parseLong(arg.getParamValue()));
	} else if (className.equals(&quot;byte&quot;)) {
		parameterValuesList.add(Byte.parseByte(arg.getParamValue()));
	} else if (className.equals(&quot;boolean&quot;)) {
		parameterValuesList.add(Boolean.parseBoolean(arg.getParamValue()));
	} else if (className.equals(&quot;char&quot;)) {
		parameterValuesList.add(arg.getParamValue().charAt(0));
	} else if (className.equals(&quot;java.lang.String&quot;)
			|| className.equals(&quot;String&quot;) || className.equals(&quot;string&quot;)) {
		parameterValuesList.add(String.valueOf(arg.getParamValue()));
	} else if (className.equals(&quot;java.lang.Integer&quot;)
			|| className.equals(&quot;Integer&quot;) || className.equals(&quot;integer&quot;)) {
		parameterValuesList.add(Integer.valueOf(arg.getParamValue()));
	} else if (className.equals(&quot;java.lang.Double&quot;)
			|| className.equals(&quot;Double&quot;)) {
		parameterValuesList.add(Double.valueOf(arg.getParamValue()));
	} else if (className.equals(&quot;java.lang.Short&quot;)
			|| className.equals(&quot;Short&quot;)) {
		parameterValuesList.add(Short.valueOf(arg.getParamValue()));
	} else if (className.equals(&quot;java.lang.Long&quot;)
			|| className.equals(&quot;Long&quot;)) {
		parameterValuesList.add(Long.valueOf(arg.getParamValue()));
	} else if (className.equals(&quot;java.lang.Float&quot;)
			|| className.equals(&quot;Float&quot;)) {
		parameterValuesList.add(Float.valueOf(arg.getParamValue()));
	} else if (className.equals(&quot;java.lang.Byte&quot;)
			|| className.equals(&quot;Byte&quot;)) {
		parameterValuesList.add(Byte.valueOf(arg.getParamValue()));
	} else if (className.equals(&quot;java.lang.Boolean&quot;)
			|| className.equals(&quot;Boolean&quot;)) {
		parameterValuesList.add(Boolean.valueOf(arg.getParamValue()));
	} else {
		parameterValuesList.add(JsonUtils.formJson(arg.getParamValue(),
				type));
	}
}

## JsonUtils.formJson方法代码

public static &lt;T&gt; T formJson(String json, Type type) {
	try {
		return gson.fromJson(json, type);
	} catch (JsonSyntaxException e) {
		logger.error(&quot;json to class[&quot; + type.getClass().getName()
				+ &quot;] is error!&quot;, e);
	}
	return null;
}
</code></pre>

<h2 id="总结">总结</h2>

<ol>
<li>复杂参数类型：<code>Map&lt;Object, ResourceVo&gt;</code>、<code>List&lt;ResourceVo&gt;</code>、<code>List&lt;Map&lt;Object,ResourceVo&gt;&gt;</code>使用<code>gson.fromJson(json, classOfT)</code>反序列化会丢失内部的类型。通过使用<code>gson.fromJson(json, type)</code>方式可以得到正确的类型。</li>
<li>通过<code>Proxy</code>对象的<code>method.getGenericParameterTypes()</code>获取的<code>Type</code>值全部为<code>java.lang.Class</code>，我们需要的是<code>java.util.Map&lt;com.package.ResourceVo&gt;</code>。</li>
<li>使用<code>Class.forName</code>得到<code>Class</code>，再获取Method，再通过<code>method.getGenericParameterTypes()</code>获取我们想要的参数<code>Type</code>是：<code>java.util.Map&lt;com.package.ResourceVo&gt;</code></li>
<li>通过<code>Class.forName</code>得到<code>Class</code>，再获取Method，再通过<code>method.getGenericParameterTypes()</code>构造出来的参数类型和参数值，无法通过<code>Proxy</code>代理对象来进行<code>method.invoke</code>，其原因是：原始接口的方法参数定义和代理对象的方法参数定义不同导致。</li>
<li>放弃通过<code>Proxy</code>对象的<code>method.invoke</code>方式调用接口，通过<code>Dubbo</code>的通用服务接口（<code>GenericService</code>）来调用任何服务接口方法：<code>GenericService.$invoke(method, parameterTypes, args)</code></li>
</ol>

<p>参数对照参考表如下</p>

<table>
<thead>
<tr>
<th align="left">Java类型</th>
<th align="left">paramType</th>
<th align="left">paramValue</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">int</td>
<td align="left">int</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">double</td>
<td align="left">double</td>
<td align="left">1.2</td>
</tr>

<tr>
<td align="left">short</td>
<td align="left">short</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">float</td>
<td align="left">float</td>
<td align="left">1.2</td>
</tr>

<tr>
<td align="left">long</td>
<td align="left">long</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">byte</td>
<td align="left">byte</td>
<td align="left">字节</td>
</tr>

<tr>
<td align="left">boolean</td>
<td align="left">boolean</td>
<td align="left">true或false</td>
</tr>

<tr>
<td align="left">char</td>
<td align="left">char</td>
<td align="left">A，如果字符过长取值为：&rdquo;STR&rdquo;.charAt(0)</td>
</tr>

<tr>
<td align="left">java.lang.String</td>
<td align="left">java.lang.String或String或string</td>
<td align="left">字符串</td>
</tr>

<tr>
<td align="left">java.lang.Integer</td>
<td align="left">java.lang.Integer或Integer或integer</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">java.lang.Double</td>
<td align="left">java.lang.Double或Double</td>
<td align="left">1.2</td>
</tr>

<tr>
<td align="left">java.lang.Short</td>
<td align="left">java.lang.Short或Short</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">java.lang.Long</td>
<td align="left">java.lang.Long或Long</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">java.lang.Float</td>
<td align="left">java.lang.Float或Float</td>
<td align="left">1.2</td>
</tr>

<tr>
<td align="left">java.lang.Byte</td>
<td align="left">java.lang.Byte或Byte</td>
<td align="left">字节</td>
</tr>

<tr>
<td align="left">java.lang.Boolean</td>
<td align="left">java.lang.Boolean或Boolean</td>
<td align="left">true或false</td>
</tr>

<tr>
<td align="left">JavaBean</td>
<td align="left">com.package.Bean</td>
<td align="left">{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}</td>
</tr>

<tr>
<td align="left">java.util.Map以及子类</td>
<td align="left">java.util.Map以及子类</td>
<td align="left">{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}</td>
</tr>

<tr>
<td align="left">java.util.Map&#60;String,JavaBean&gt;</td>
<td align="left">java.util.Map</td>
<td align="left">{&ldquo;name&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001},&ldquo;value&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}}</td>
</tr>

<tr>
<td align="left">java.util.HashMap&#60;Object,Object&gt;</td>
<td align="left">java.util.HashMap</td>
<td align="left">{&ldquo;name&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001},&ldquo;value&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}}</td>
</tr>

<tr>
<td align="left">java.util.Collection以及子类</td>
<td align="left">java.util.Collection以及子类</td>
<td align="left">[&ldquo;a&rdquo;,&ldquo;b&rdquo;]</td>
</tr>

<tr>
<td align="left">java.util.List&#60;String&gt;</td>
<td align="left">java.util.List</td>
<td align="left">[&ldquo;a&rdquo;,&ldquo;b&rdquo;]</td>
</tr>

<tr>
<td align="left">java.util.List&#60;JavaBean&gt;</td>
<td align="left">java.util.List</td>
<td align="left">[{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001},{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}]</td>
</tr>

<tr>
<td align="left">java.util.List&#60;Map&#60;Object, JavaBean&gt;&gt;</td>
<td align="left">java.util.List</td>
<td align="left">[{&ldquo;name&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001},&ldquo;value&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}},{&ldquo;name&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001},&ldquo;value&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}}]</td>
</tr>

<tr>
<td align="left">java.util.List&#60;Long&gt;</td>
<td align="left">java.util.List</td>
<td align="left">[1,2,3]</td>
</tr>

<tr>
<td align="left">java.util.ArrayList&#60;Object&gt;</td>
<td align="left">java.util.ArrayList</td>
<td align="left">[&ldquo;ny&rdquo;,1,true]</td>
</tr>
</tbody>
</table>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/69-java-reflect/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/68-jmeter-plugin-dubbo-1.2.0/">New Version V1.2.0, Dubbo Plugin for Apache JMeter</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-03-13T13:18:21.000&#43;00:00' itemprop="datePublished">2018-03-13</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/jmeter">jmeter</a>

<a href="https://ningyu1.github.io/site/tags/dubbo">dubbo</a>

<a href="https://ningyu1.github.io/site/tags/test">test</a>

<a href="https://ningyu1.github.io/site/tags/dubbo%E5%8F%AF%E8%A7%86%E5%8C%96%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7">Dubbo可视化测试工具</a>

<a href="https://ningyu1.github.io/site/tags/jmeter%E5%AF%B9dubbo%E6%8E%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E5%8F%AF%E8%A7%86%E5%8C%96%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95">Jmeter对Dubbo接口进行可视化压力测试</a>

<a href="https://ningyu1.github.io/site/tags/dubbo-jmeter%E6%8F%92%E4%BB%B6">Dubbo Jmeter插件</a>


</div>
    </div>
        

<h1 id="项目地址">项目地址</h1>

<p>jmeter-plugin-dubbo项目已经transfer到dubbo group下</p>

<p><a href="https://github.com/dubbo/jmeter-plugins-dubbo">github: jmeter-plugin-dubbo</a></p>

<p><a href="https://gitee.com/ningyu/jmeter-plugins-dubbo">码云: jmeter-plugin-dubbo</a></p>

<h1 id="v1-2-0">V1.2.0</h1>

<ol>
<li>使用gson进行json序列化、反序列化</li>
<li>使用dubbo泛化调用方式重构反射调用方式</li>
<li>支持复杂类型、支持泛型，例如：&rdquo;java.lang.List<ResourceVo>,Map<String,ResourceVo> map,List<Map<String, ResourceVo>&gt; list&rdquo;</li>
</ol>

<p>本次版本主要对反射参数类型进行了增强，支持复杂类型、支持参数泛型，可以参考如下的参数对照表：</p>

<table>
<thead>
<tr>
<th align="left">Java类型</th>
<th align="left">paramType</th>
<th align="left">paramValue</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">int</td>
<td align="left">int</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">double</td>
<td align="left">double</td>
<td align="left">1.2</td>
</tr>

<tr>
<td align="left">short</td>
<td align="left">short</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">float</td>
<td align="left">float</td>
<td align="left">1.2</td>
</tr>

<tr>
<td align="left">long</td>
<td align="left">long</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">byte</td>
<td align="left">byte</td>
<td align="left">字节</td>
</tr>

<tr>
<td align="left">boolean</td>
<td align="left">boolean</td>
<td align="left">true或false</td>
</tr>

<tr>
<td align="left">char</td>
<td align="left">char</td>
<td align="left">A，如果字符过长取值为：&rdquo;STR&rdquo;.charAt(0)</td>
</tr>

<tr>
<td align="left">java.lang.String</td>
<td align="left">java.lang.String或String或string</td>
<td align="left">字符串</td>
</tr>

<tr>
<td align="left">java.lang.Integer</td>
<td align="left">java.lang.Integer或Integer或integer</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">java.lang.Double</td>
<td align="left">java.lang.Double或Double</td>
<td align="left">1.2</td>
</tr>

<tr>
<td align="left">java.lang.Short</td>
<td align="left">java.lang.Short或Short</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">java.lang.Long</td>
<td align="left">java.lang.Long或Long</td>
<td align="left">1</td>
</tr>

<tr>
<td align="left">java.lang.Float</td>
<td align="left">java.lang.Float或Float</td>
<td align="left">1.2</td>
</tr>

<tr>
<td align="left">java.lang.Byte</td>
<td align="left">java.lang.Byte或Byte</td>
<td align="left">字节</td>
</tr>

<tr>
<td align="left">java.lang.Boolean</td>
<td align="left">java.lang.Boolean或Boolean</td>
<td align="left">true或false</td>
</tr>

<tr>
<td align="left">JavaBean</td>
<td align="left">com.package.Bean</td>
<td align="left">{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test-${__RandomString(5,12345,ids)}&ldquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}</td>
</tr>

<tr>
<td align="left">java.util.Map以及子类</td>
<td align="left">java.util.Map以及子类</td>
<td align="left">{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test-${__RandomString(5,12345,ids)}&ldquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}</td>
</tr>

<tr>
<td align="left">java.util.Map&#60;String,JavaBean&gt;</td>
<td align="left">java.util.Map</td>
<td align="left">{&ldquo;name&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test-${__RandomString(5,12345,ids)}&ldquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001},&ldquo;value&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}}</td>
</tr>

<tr>
<td align="left">java.util.HashMap&#60;Object,Object&gt;</td>
<td align="left">java.util.HashMap</td>
<td align="left">{&ldquo;name&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test-${__RandomString(5,12345,ids)}&ldquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001},&ldquo;value&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}}</td>
</tr>

<tr>
<td align="left">java.util.Collection以及子类</td>
<td align="left">java.util.Collection以及子类</td>
<td align="left">[&ldquo;a&rdquo;,&ldquo;b&rdquo;]</td>
</tr>

<tr>
<td align="left">java.util.List&#60;String&gt;</td>
<td align="left">java.util.List</td>
<td align="left">[&ldquo;a&rdquo;,&ldquo;b&rdquo;]</td>
</tr>

<tr>
<td align="left">java.util.List&#60;JavaBean&gt;</td>
<td align="left">java.util.List</td>
<td align="left">[{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test-${<strong>RandomString(5,12345,ids)}&ldquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001},{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test-${</strong>RandomString(5,12345,ids)}&ldquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}]</td>
</tr>

<tr>
<td align="left">java.util.List&#60;Map&#60;Object, JavaBean&gt;&gt;</td>
<td align="left">java.util.List</td>
<td align="left">[{&ldquo;name&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test-${<strong>RandomString(5,12345,ids)}&ldquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001},&ldquo;value&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}},{&ldquo;name&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test-${</strong>RandomString(5,12345,ids)}&ldquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001},&ldquo;value&rdquo;:{&ldquo;service&rdquo;:&ldquo;test1&rdquo;,&ldquo;url&rdquo;:&ldquo;test&rdquo;,&ldquo;action&rdquo;:&ldquo;GET&rdquo;,&ldquo;enabled&rdquo;:true,&ldquo;isPublic&rdquo;:false,&ldquo;appId&rdquo;:8,&ldquo;menuId&rdquo;:30001}}]</td>
</tr>

<tr>
<td align="left">java.util.List&#60;Long&gt;</td>
<td align="left">java.util.List</td>
<td align="left">[1,2,3]</td>
</tr>

<tr>
<td align="left">java.util.ArrayList&#60;Object&gt;</td>
<td align="left">java.util.ArrayList</td>
<td align="left">[&ldquo;ny&rdquo;,1,true]</td>
</tr>
</tbody>
</table>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/68-jmeter-plugin-dubbo-1.2.0/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/67-python-requirements/">Python项目生成requirements.txt的多种方式，用于类库迁移必备</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-03-09T14:19:54.000&#43;00:00' itemprop="datePublished">2018-03-09</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/pip">pip</a>

<a href="https://ningyu1.github.io/site/tags/freeze">freeze</a>

<a href="https://ningyu1.github.io/site/tags/pipreqs">pipreqs</a>

<a href="https://ningyu1.github.io/site/tags/python">python</a>


</div>
    </div>
        

<p>我相信任何软件程序都会有依赖的类库，尤其现在开源如此的火爆，很多轮子可以拿来直接使用不再需要自己再去开发（拿来主义者），这样大大的提高开发效率。<code>NPM</code>就是轮子最多的地方，哈哈！开个玩笑！</p>

<p>我们做开发时为何需要对依赖库进行管理？当依赖类库过多时，如何管理类库的版本？</p>

<p>我相信大家都知道怎么回答这个问题，为了更加规范管理项目结构，提高开发效率所以我们需要对依赖库进行管理，不管使用任何开发语言，如今都有依赖库的管理工具。</p>

<p>例如：<code>Java</code>有<code>Maven</code>、<code>Gradle</code>，<code>JS</code>有<code>NPM</code>，<code>Python</code>有<code>pip</code>、<code>easy_install</code>，<code>Linux</code>有<code>apt-get</code>、<code>yun</code> 等。</p>

<p>我们这里就对<code>Python</code>的依赖库管理来进一步说一说。</p>

<p><code>Python</code>提供通过<code>requirements.txt</code>文件来进行项目中依赖的三方库进行整体安装导入。</p>

<p>那首先让我们看一下<code>requirements.txt</code>的格式</p>

<pre><code>requests==1.2.0
Flask==0.10.1
</code></pre>

<p><code>Python</code>安装依赖库使用<code>pip</code>可以很方便的安装，如果我们需要迁移一个项目，那我们就需要导出项目中依赖的所有三方类库的版本、名称等信息。</p>

<p>接下来就看<code>Python</code>项目如何根据<code>requirements.txt</code>文件来安装三方类库</p>

<h1 id="方法一-pip-freeze">方法一：pip freeze</h1>

<pre><code>pip freeze &gt; requirements.txt
</code></pre>

<p><code>pip freeze</code>命令输出的格式和<code>requirements.txt</code>文件内容格式完全一样，因此我们可以将<code>pip freeze</code>的内容输出到文件<code>requirements.txt</code>中。在其他机器上可以根据导出的<code>requirements.txt</code>进行包安装。</p>

<p>如果要安装<code>requirements.txt</code>中的类库内容，那么你可以执行</p>

<pre><code>pip install -r requirements.txt
</code></pre>

<p><span style="color:blue"><em>注意：<code>pip freeze</code>输出的是本地环境中所有三方包信息，但是会比<code>pip list</code>少几个包，因为<code>pip</code>，<code>wheel</code>，<code>setuptools</code>等包，是自带的而无法(<code>un</code>)<code>install</code>的，如果要显示所有包可以加上参数<code>-all</code>，即<code>pip freeze -all</code></em></span></p>

<h1 id="方法二-pipreqs">方法二：pipreqs</h1>

<p>使用<code>pipreqs</code>生成<code>requirements.txt</code></p>

<p>首先先安装<code>pipreqs</code></p>

<pre><code>pip install pipreqs
</code></pre>

<p>使用<code>pipreqs</code>生成<code>requirements.txt</code></p>

<pre><code>pipreqs requirements.txt
</code></pre>

<p><span style="color:blue"><em>注意：<code>pipreqs</code>生成指定目录下的依赖类库</em></span></p>

<h1 id="上面两个方法的区别">上面两个方法的区别？</h1>

<p>使用<code>pip freeze</code>保存的是当前<code>Python</code>环境下所有的类库，如果你没有用<code>virtualenv</code>来对<code>Python</code>环境做虚拟化的话，类库就会很杂很多，在对项目进行迁移的时候我们只需关注项目中使用的类库，没有必要导出所有安装过的类库，因此我们一般迁移项目不会使用<code>pipreqs</code>，<code>pip freeze</code>更加适合迁移整个<code>python</code>环境下安装过的类库时使用。</p>

<p><span style="color:blue"><em>不知道<code>virtualenv</code>是什么或者不会使用它的可以查看：<a href="https://ningyu1.github.io/site/post/63-python-virtualenv/">《构建Python多个虚拟环境来进行不同版本开发之神器-virtualenv》</a></em></span></p>

<p>使用<code>pipreqs</code>它会根据当前目录下的项目的依赖来导出三方类库，因此常用与项目的迁移中。</p>

<p>这就是<code>pip freeze</code>、<code>pipreqs</code>的区别，前者是导出<code>Python</code>环境下所有安装的类库，后者导出项目中使用的类库。</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/67-python-requirements/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/66-jmeter-plugin-dubbo-bugfix/">Bug Fix Version V1.1.0, Dubbo Plugin for Apache JMeter</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-03-07T18:00:54.000&#43;00:00' itemprop="datePublished">2018-03-07</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/jmeter">jmeter</a>

<a href="https://ningyu1.github.io/site/tags/dubbo">dubbo</a>

<a href="https://ningyu1.github.io/site/tags/test">test</a>

<a href="https://ningyu1.github.io/site/tags/dubbo%E5%8F%AF%E8%A7%86%E5%8C%96%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7">Dubbo可视化测试工具</a>

<a href="https://ningyu1.github.io/site/tags/jmeter%E5%AF%B9dubbo%E6%8E%A5%E5%8F%A3%E8%BF%9B%E8%A1%8C%E5%8F%AF%E8%A7%86%E5%8C%96%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95">Jmeter对Dubbo接口进行可视化压力测试</a>

<a href="https://ningyu1.github.io/site/tags/dubbo-jmeter%E6%8F%92%E4%BB%B6">Dubbo Jmeter插件</a>


</div>
    </div>
        

<p>首先先感谢网友 @流浪的云 提的bug，让我感觉到写这个工具没有白费还有点价值，非常感谢，</p>

<p>他在使用<code>jmeter-plugin-dubbo</code>插件时发现<code>GUI</code>中输入的信息无法使用<code>Jmeter</code>变量<code>${var}</code>与函数来进行参数化，以下是我修复这个问题的记录。</p>

<h1 id="项目地址">项目地址</h1>

<p>jmeter-plugin-dubbo项目已经transfer到dubbo group下</p>

<p><a href="https://github.com/dubbo/jmeter-plugins-dubbo">github: jmeter-plugin-dubbo</a></p>

<p><a href="https://gitee.com/ningyu/jmeter-plugins-dubbo">码云: jmeter-plugin-dubbo</a></p>

<h1 id="问题描述">问题描述</h1>

<ol>
<li><code>jmeter-plugin-dubbo</code>插件<code>GUI</code>输入的信息无法使用<code>${var}</code>变量来进行参数化</li>
</ol>

<h1 id="问题修复">问题修复</h1>

<p><code>Jmeter</code>的输出要想使用用户自定义变量、<code>CSV</code>变量、<code>BeanShell</code>、函数来进行参数化，必须将输入的参数通过<code>JMeterProperty</code>的子类<code>add</code>到<code>Jmeter</code>管理。如果使用的是<code>Swing</code>的<code>Bean</code>绑定机制可以很好的支持变量与函数参数化，如果是手写的GUI与Sample就需要注意这一点，可能写出来的插件不能使用变量<code>${var}</code>参数化。</p>

<p>我之前在处理参数值在GUI和Sample之间传递时，没有使用<code>org.apache.jmeter.testelement.property.JMeterProperty</code>系列子类来处理参数，因此变量无法支持，让我们来看一下区别。</p>

<p>先让我们看一下<code>org.apache.jmeter.testelement.property.JMeterProperty</code>都有哪些子类。</p>

<p><img src="https://ningyu1.github.io/site/img/jmeter-plugins-dubbo/7.png" alt="" /></p>

<p>我们之前使用的参数赋值是这样的：</p>

<pre><code>public String getVersion() {
    return this.getPropertyAsString(FIELD_DUBBO_VERSION, DEFAULT_VERSION);
}
public void setVersion(String version) {
    this.setProperty(FIELD_DUBBO_VERSION, version);
}
</code></pre>

<p>这种方式是无法支持使用<code>${var}</code>变量来参数化赋值的（也就是动态赋值）。</p>

<p>我们应该给<code>setProperty</code>传入<code>JMeterProperty</code>的子类来支持变量参数化，如下：</p>

<pre><code>public String getVersion() {
    return this.getPropertyAsString(FIELD_DUBBO_VERSION, DEFAULT_VERSION);
}
public void setVersion(String version) {
    this.setProperty(new StringProperty(FIELD_DUBBO_VERSION, version));
}
</code></pre>

<p><span style="color:blue"><em>ps.注意setProperty的使用不一样，这里使用的是new StringProperty</em></span></p>

<p>上面的参数还相对简单的普通字符串参数，当我们遇到集合或更加复杂的参数类型时如何处理？</p>

<p>我本以为使用<code>JMeterProperty</code>的子类<code>CollectionProperty</code>是可以让集合参数支持变量参数化的，结果测试下来没有任何用，传入的<code>${var}</code>变量，在运行的时候还是变量没有变成相应的值。</p>

<p>于是又换成<code>MapProperty</code>和<code>ObjectProperty</code>一样无法支持变量参数化。</p>

<p>查看<code>Jmeter Plugins</code>的<code>Http Sample</code>源码，看他是如何处理的。</p>

<h2 id="org-apache-jmeter-protocol-http-util-httpargument源码">org.apache.jmeter.protocol.http.util.HTTPArgument源码</h2>

<pre><code>package org.apache.jmeter.protocol.http.util;

import java.io.Serializable;
import java.io.UnsupportedEncodingException;
import java.net.URLDecoder;
import java.util.LinkedList;
import java.util.List;
import org.apache.jmeter.config.Argument;
import org.apache.jmeter.config.Arguments;
import org.apache.jmeter.testelement.property.BooleanProperty;
import org.apache.jmeter.testelement.property.JMeterProperty;
import org.apache.jorphan.logging.LoggingManager;
import org.apache.log.Logger;

public class HTTPArgument
  extends Argument
  implements Serializable
{
  private static final Logger log = ;
  private static final long serialVersionUID = 240L;
  private static final String ALWAYS_ENCODE = &quot;HTTPArgument.always_encode&quot;;
  private static final String USE_EQUALS = &quot;HTTPArgument.use_equals&quot;;
  private static final EncoderCache cache = new EncoderCache(1000);
  
  public HTTPArgument(String name, String value, String metadata)
  {
    this(name, value, false);
    setMetaData(metadata);
  }
  
  public void setUseEquals(boolean ue)
  {
    if (ue) {
      setMetaData(&quot;=&quot;);
    } else {
      setMetaData(&quot;&quot;);
    }
    setProperty(new BooleanProperty(&quot;HTTPArgument.use_equals&quot;, ue));
  }
  
  public boolean isUseEquals()
  {
    boolean eq = getPropertyAsBoolean(&quot;HTTPArgument.use_equals&quot;);
    if ((getMetaData().equals(&quot;=&quot;)) || ((getValue() != null) &amp;&amp; (getValue().length() &gt; 0)))
    {
      setUseEquals(true);
      return true;
    }
    return eq;
  }
  
  public void setAlwaysEncoded(boolean ae)
  {
    setProperty(new BooleanProperty(&quot;HTTPArgument.always_encode&quot;, ae));
  }
  
  public boolean isAlwaysEncoded()
  {
    return getPropertyAsBoolean(&quot;HTTPArgument.always_encode&quot;);
  }
  
  public HTTPArgument(String name, String value)
  {
    this(name, value, false);
  }
  
  public HTTPArgument(String name, String value, boolean alreadyEncoded)
  {
    this(name, value, alreadyEncoded, &quot;UTF-8&quot;);
  }
  
  public HTTPArgument(String name, String value, boolean alreadyEncoded, String contentEncoding)
  {
    setAlwaysEncoded(true);
    if (alreadyEncoded) {
      try
      {
        if (log.isDebugEnabled()) {
          log.debug(&quot;Decoding name, calling URLDecoder.decode with '&quot; + name + &quot;' and contentEncoding:&quot; + &quot;UTF-8&quot;);
        }
        name = URLDecoder.decode(name, &quot;UTF-8&quot;);
        if (log.isDebugEnabled()) {
          log.debug(&quot;Decoding value, calling URLDecoder.decode with '&quot; + value + &quot;' and contentEncoding:&quot; + contentEncoding);
        }
        value = URLDecoder.decode(value, contentEncoding);
      }
      catch (UnsupportedEncodingException e)
      {
        log.error(contentEncoding + &quot; encoding not supported!&quot;);
        throw new Error(e.toString(), e);
      }
    }
    setName(name);
    setValue(value);
    setMetaData(&quot;=&quot;);
  }
  
  public HTTPArgument(String name, String value, String metaData, boolean alreadyEncoded)
  {
    this(name, value, metaData, alreadyEncoded, &quot;UTF-8&quot;);
  }
  
  public HTTPArgument(String name, String value, String metaData, boolean alreadyEncoded, String contentEncoding)
  {
    this(name, value, alreadyEncoded, contentEncoding);
    setMetaData(metaData);
  }
  
  public HTTPArgument(Argument arg)
  {
    this(arg.getName(), arg.getValue(), arg.getMetaData());
  }
  
  public HTTPArgument() {}
  
  public void setName(String newName)
  {
    if ((newName == null) || (!newName.equals(getName()))) {
      super.setName(newName);
    }
  }
  
  public String getEncodedValue()
  {
    try
    {
      return getEncodedValue(&quot;UTF-8&quot;);
    }
    catch (UnsupportedEncodingException e)
    {
      throw new Error(&quot;Should not happen: &quot; + e.toString());
    }
  }
  
  public String getEncodedValue(String contentEncoding)
    throws UnsupportedEncodingException
  {
    if (isAlwaysEncoded()) {
      return cache.getEncoded(getValue(), contentEncoding);
    }
    return getValue();
  }
  
  public String getEncodedName()
  {
    if (isAlwaysEncoded()) {
      return cache.getEncoded(getName());
    }
    return getName();
  }
  
  public static void convertArgumentsToHTTP(Arguments args)
  {
    List&lt;Argument&gt; newArguments = new LinkedList();
    for (JMeterProperty jMeterProperty : args.getArguments())
    {
      Argument arg = (Argument)jMeterProperty.getObjectValue();
      if (!(arg instanceof HTTPArgument)) {
        newArguments.add(new HTTPArgument(arg));
      } else {
        newArguments.add(arg);
      }
    }
    args.removeAllArguments();
    args.setArguments(newArguments);
  }
}
</code></pre>

<h2 id="org-apache-jmeter-protocol-http-gui-httpargumentspanel源码">org.apache.jmeter.protocol.http.gui.HTTPArgumentsPanel源码</h2>

<pre><code>package org.apache.jmeter.protocol.http.gui;

import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.util.Iterator;
import javax.swing.JMenuItem;
import javax.swing.JPopupMenu;
import javax.swing.JTable;
import org.apache.commons.lang3.BooleanUtils;
import org.apache.commons.lang3.StringUtils;
import org.apache.jmeter.config.Argument;
import org.apache.jmeter.config.Arguments;
import org.apache.jmeter.config.gui.ArgumentsPanel;
import org.apache.jmeter.protocol.http.util.HTTPArgument;
import org.apache.jmeter.testelement.TestElement;
import org.apache.jmeter.testelement.property.JMeterProperty;
import org.apache.jmeter.util.JMeterUtils;
import org.apache.jorphan.gui.GuiUtils;
import org.apache.jorphan.gui.ObjectTableModel;
import org.apache.jorphan.reflect.Functor;

public class HTTPArgumentsPanel
  extends ArgumentsPanel
{
  private static final long serialVersionUID = 240L;
  private static final String ENCODE_OR_NOT = &quot;encode?&quot;;
  private static final String INCLUDE_EQUALS = &quot;include_equals&quot;;
  
  protected void initializeTableModel()
  {
    this.tableModel = new ObjectTableModel(new String[] { &quot;name&quot;, &quot;value&quot;, &quot;encode?&quot;, &quot;include_equals&quot; }, HTTPArgument.class, new Functor[] { new Functor(&quot;getName&quot;), new Functor(&quot;getValue&quot;), new Functor(&quot;isAlwaysEncoded&quot;), new Functor(&quot;isUseEquals&quot;) }, new Functor[] { new Functor(&quot;setName&quot;), new Functor(&quot;setValue&quot;), new Functor(&quot;setAlwaysEncoded&quot;), new Functor(&quot;setUseEquals&quot;) }, new Class[] { String.class, String.class, Boolean.class, Boolean.class });
  }
  
  public static boolean testFunctors()
  {
    HTTPArgumentsPanel instance = new HTTPArgumentsPanel();
    instance.initializeTableModel();
    return instance.tableModel.checkFunctors(null, instance.getClass());
  }
  
  protected void sizeColumns(JTable table)
  {
    GuiUtils.fixSize(table.getColumn(&quot;include_equals&quot;), table);
    GuiUtils.fixSize(table.getColumn(&quot;encode?&quot;), table);
  }
  
  protected HTTPArgument makeNewArgument()
  {
    HTTPArgument arg = new HTTPArgument(&quot;&quot;, &quot;&quot;);
    arg.setAlwaysEncoded(false);
    arg.setUseEquals(true);
    return arg;
  }
  
  public HTTPArgumentsPanel()
  {
    super(JMeterUtils.getResString(&quot;paramtable&quot;));
    init();
  }
  
  public TestElement createTestElement()
  {
    Arguments args = getUnclonedParameters();
    super.configureTestElement(args);
    return (TestElement)args.clone();
  }
  
  public Arguments getParameters()
  {
    Arguments args = getUnclonedParameters();
    return (Arguments)args.clone();
  }
  
  private Arguments getUnclonedParameters()
  {
    stopTableEditing();
    
    Iterator&lt;HTTPArgument&gt; modelData = this.tableModel.iterator();
    Arguments args = new Arguments();
    while (modelData.hasNext())
    {
      HTTPArgument arg = (HTTPArgument)modelData.next();
      args.addArgument(arg);
    }
    return args;
  }
  
  public void configure(TestElement el)
  {
    super.configure(el);
    if ((el instanceof Arguments))
    {
      this.tableModel.clearData();
      HTTPArgument.convertArgumentsToHTTP((Arguments)el);
      for (JMeterProperty jMeterProperty : ((Arguments)el).getArguments())
      {
        HTTPArgument arg = (HTTPArgument)jMeterProperty.getObjectValue();
        this.tableModel.addRow(arg);
      }
    }
    checkButtonsStatus();
  }
  
  protected boolean isMetaDataNormal(HTTPArgument arg)
  {
    return (arg.getMetaData() == null) || (arg.getMetaData().equals(&quot;=&quot;)) || ((arg.getValue() != null) &amp;&amp; (arg.getValue().length() &gt; 0));
  }
  
  protected Argument createArgumentFromClipboard(String[] clipboardCols)
  {
    HTTPArgument argument = makeNewArgument();
    argument.setName(clipboardCols[0]);
    if (clipboardCols.length &gt; 1)
    {
      argument.setValue(clipboardCols[1]);
      if (clipboardCols.length &gt; 2)
      {
        argument.setAlwaysEncoded(Boolean.parseBoolean(clipboardCols[2]));
        if (clipboardCols.length &gt; 3)
        {
          Boolean useEqual = BooleanUtils.toBooleanObject(clipboardCols[3]);
          
          argument.setUseEquals(useEqual != null ? useEqual.booleanValue() : true);
        }
      }
    }
    return argument;
  }
  
  private void init()
  {
    JTable table = getTable();
    JPopupMenu popupMenu = new JPopupMenu();
    JMenuItem variabilizeItem = new JMenuItem(JMeterUtils.getResString(&quot;transform_into_variable&quot;));
    variabilizeItem.addActionListener(new ActionListener()
    {
      public void actionPerformed(ActionEvent e)
      {
        HTTPArgumentsPanel.this.transformNameIntoVariable();
      }
    });
    popupMenu.add(variabilizeItem);
    table.setComponentPopupMenu(popupMenu);
  }
  
  private void transformNameIntoVariable()
  {
    int[] rowsSelected = getTable().getSelectedRows();
    for (int selectedRow : rowsSelected)
    {
      String name = (String)this.tableModel.getValueAt(selectedRow, 0);
      if (StringUtils.isNotBlank(name))
      {
        name = name.trim();
        name = name.replaceAll(&quot;\\$&quot;, &quot;_&quot;);
        name = name.replaceAll(&quot;\\{&quot;, &quot;_&quot;);
        name = name.replaceAll(&quot;\\}&quot;, &quot;_&quot;);
        this.tableModel.setValueAt(&quot;${&quot; + name + &quot;}&quot;, selectedRow, 1);
      }
    }
  }
}
</code></pre>

<p>能发现它使用的是继承<code>Argument</code>来处理和<code>GUI</code>之间的参数传递，使用继承<code>ArgumentsPanel</code>来处理<code>GUI</code>页面，这个就是我们上面说的，通过<code>Swing</code>的<code>Bean</code>绑定机制来进行开发，很遗憾我们没有使用这种方式，如果要改成这种方式，整个代码结构都要修改，成本太大。</p>

<p>但是我们发现像<code>String</code>，<code>Integer</code>等这种普通类型的参数通过使用<code>JMeterProperty</code>的子类可以很好的支持变量参数化，那我们能不能将集合参数拉平来直接使用普通类型的参数来处理，我承认这种方式有点恶心。</p>

<h1 id="解决方式">解决方式</h1>

<p>首先我们的集合参数有索引下标和总行数，每一行有两列，那就修改集合参数的赋值，代码如下：</p>

<pre><code>//标记集合参数前缀
public static String FIELD_DUBBO_METHOD_ARGS = &quot;FIELD_DUBBO_METHOD_ARGS&quot;;
//集合参数总数
public static String FIELD_DUBBO_METHOD_ARGS_SIZE = &quot;FIELD_DUBBO_METHOD_ARGS_SIZE&quot;;

public List&lt;MethodArgument&gt; getMethodArgs() {
	int paramsSize = this.getPropertyAsInt(FIELD_DUBBO_METHOD_ARGS_SIZE, 0);
	List&lt;MethodArgument&gt; list = new ArrayList&lt;MethodArgument&gt;();
	for (int i = 1; i &lt;= paramsSize; i++) {
		String paramType = this.getPropertyAsString(FIELD_DUBBO_METHOD_ARGS + &quot;_PARAM_TYPE&quot; + i);
		String paramValue = this.getPropertyAsString(FIELD_DUBBO_METHOD_ARGS + &quot;_PARAM_VALUE&quot; + i);
		MethodArgument args = new MethodArgument(paramType, paramValue);
		list.add(args);
	}
	return list;
}
public void setMethodArgs(List&lt;MethodArgument&gt; methodArgs) {
	int size = methodArgs == null ? 0 : methodArgs.size();
	this.setProperty(new IntegerProperty(FIELD_DUBBO_METHOD_ARGS_SIZE, size));
	if (size &gt; 0) {
		for (int i = 1; i &lt;= methodArgs.size(); i++) {
			this.setProperty(new StringProperty(FIELD_DUBBO_METHOD_ARGS + &quot;_PARAM_TYPE&quot; + i, methodArgs.get(i-1).getParamType()));
			this.setProperty(new StringProperty(FIELD_DUBBO_METHOD_ARGS + &quot;_PARAM_VALUE&quot; + i, methodArgs.get(i-1).getParamValue()));
		}
	}
}
</code></pre>

<p>上面的代码就是将集合参数拉平来进行传递，大致的结果如下：</p>

<pre><code>FIELD_DUBBO_METHOD_ARGS_SIZE = 2
FIELD_DUBBO_METHOD_ARGS_SIZE_PARAM_TYPE_1 = xx${var1}xx 
FIELD_DUBBO_METHOD_ARGS_SIZE__PARAM_VALUE_1 = xx${var2}xx 
FIELD_DUBBO_METHOD_ARGS_SIZE_PARAM_TYPE_2 = xx${var3}xx 
FIELD_DUBBO_METHOD_ARGS_SIZE__PARAM_VALUE_2 = xx${var4}xx 
</code></pre>

<p>让我们测试一下是否可用。</p>

<p><img src="https://ningyu1.github.io/site/img/jmeter-plugins-dubbo/8.png" alt="" />
<img src="https://ningyu1.github.io/site/img/jmeter-plugins-dubbo/9.png" alt="" />
<img src="https://ningyu1.github.io/site/img/jmeter-plugins-dubbo/10.png" alt="" /></p>

<p>测试结果<code>GUI</code>上所有的输入框均可以支持<code>Jmeter</code>变量<code>${var}</code>参数化.</p>

<p>我觉得应该还是更加完美的解决办法只不过我没有找到，有空了再细致研究一下<code>Jmeter</code>的插件开发的细节看看能否找到突破口。</p>

<p>再次感谢网友 @流浪的云 提的bug，非常感谢！感谢使用插件的朋友多提rp和bug，让我们来一起完善起来，感谢这个开放的世界，最后还是一句老话：世界和平，Keep Real!</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/66-jmeter-plugin-dubbo-bugfix/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/65-java-inner-class/">Java中内部类使用注意事项，内部类对序列化与反序列化的影响</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-03-06T16:50:17.000&#43;00:00' itemprop="datePublished">2018-03-06</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/inner-class">inner class</a>

<a href="https://ningyu1.github.io/site/tags/static">static</a>

<a href="https://ningyu1.github.io/site/tags/non-static">non-static</a>

<a href="https://ningyu1.github.io/site/tags/innerclassserialization">innerClassSerialization</a>

<a href="https://ningyu1.github.io/site/tags/fastjson">fastjson</a>

<a href="https://ningyu1.github.io/site/tags/gson">gson</a>

<a href="https://ningyu1.github.io/site/tags/dubbo-json">dubbo json</a>


</div>
    </div>
        

<p>现在很多服务架构都是微服务、分布式架构，开发模式也都是模块化开发，在分布式的开发方式下服务之间的调用不管是<code>RPC</code>还是<code>RESTful</code>或是其他<code>SOA</code>方案，均离不开序列化与反序列化，尤其是使用<code>Java</code>开发，<code>Bean</code>实现序列化接口几乎已经是必备的要求，而且这个要求已经纳入到很多大厂公司的开发规范中，开发规范中强制要求实现序列化接口和重写<code>toString</code>、<code>hashCode</code>方法。</p>

<p>前面提到了序列化与反序列化，那序列化与反序列化的对象就是开发人员写的<code>java bean</code>，不同的<code>java bean</code>会给序列化反序列化带来什么问题呢？接下来就让我们看一下内部类对序列化反序列化的影响。</p>

<p>在这之前我们先看一下常用的序列化工具：</p>

<ul>
<li>JavaSerialize</li>
<li>fastjson</li>
<li>dubbo json</li>
<li>google gson</li>
<li>google protoBuf</li>
<li>hessian</li>
<li>kryo</li>
<li>Avro</li>
<li>fast-serialization</li>
<li>jboss-serialization</li>
<li>jboss-marshalling-river</li>
<li>protostuff</li>
<li>msgpack-databind</li>
<li>json/jackson/databind</li>
<li>json/jackson/db-afterburner</li>
<li>xml/xstream+c</li>
<li>xml/jackson/databind-aalto</li>
</ul>

<p>工具太多了这里就不列了，让我们先做一个测试。</p>

<h1 id="测试">测试</h1>

<h1 id="常规java-bean">常规java bean</h1>

<p>测试类：</p>

<pre><code>import java.io.Serializable;

public class Test implements Serializable {
	private static final long serialVersionUID = 2010307013874058143L;
	private String name;

	public String getName() {
		return name;
	}

	public void setName(String name) {
		this.name = name;
	}
}
</code></pre>

<p>调用序列化与反序列化:</p>

<pre><code>public static String toJson(Object obj) {
    try {
        return JSON.json(obj);
    } catch (IOException e) {
        log.error(&quot;class to json is error!&quot;, e);
    }
    return null;
}
public static &lt;T&gt; T formJson(String json, Class&lt;T&gt; classOfT) {
    try {
        return JSON.parse(json, classOfT);
    } catch (ParseException e) {
        log.error(&quot;json to class is error! &quot;+classOfT.getName(), e);
    }
    return null;
}
public static void main(String[] args) {
	Test test = new Test();
	System.out.println(toJson(test));
	String json = &quot;{\&quot;name\&quot;:\&quot;test\&quot;}&quot;;
	test = formJson(json, Test.class);
	System.out.println(test.getName());
}
</code></pre>

<p>输出：</p>

<pre><code>{&quot;name&quot;:null}
test
</code></pre>

<p>我们能看到不管是序列化还是反序列化都没有任何问题，我们这里测试使用了常用的<code>fastjson</code>、<code>dubbo json</code>做了测试。</p>

<h2 id="有内部类的java-bean">有内部类的java bean</h2>

<p>测试类：</p>

<pre><code>import java.io.Serializable;

public class Test implements Serializable {
	private static final long serialVersionUID = 2010307013874058143L;
	private String name;
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public C1 c1;
	public C1 getC1() {
		return c1;
	}
	public void setC1(C1 c1) {
		this.c1 = c1;
	}
	public class C1 {
		public String name;
		public C1() {
		}
		public String getName() {
			return name;
		}
		public void setName(String name) {
			this.name = name;
		}
	}
}
</code></pre>

<p>调用序列化与反序列化:</p>

<pre><code>public static String toJson(Object obj) {
    try {
        return JSON.json(obj);
    } catch (IOException e) {
        log.error(&quot;class to json is error!&quot;, e);
    }
    return null;
}
public static &lt;T&gt; T formJson(String json, Class&lt;T&gt; classOfT) {
    try {
        return JSON.parse(json, classOfT);
    } catch (ParseException e) {
        log.error(&quot;json to class is error! &quot;+classOfT.getName(), e);
    }
    return null;
}
public static void main(String[] args) {
	Test test = new Test();
	System.out.println(toJson(test));
	String json = &quot;{\&quot;name\&quot;:\&quot;test\&quot;,\&quot;c1\&quot;:{\&quot;name\&quot;:\&quot;c1\&quot;}}&quot;;
	test = formJson(json, Test.class);
	System.out.println(test.getC1().getName());
}
</code></pre>

<p>输出：</p>

<pre><code>{&quot;c1&quot;:null,&quot;name&quot;:null,&quot;C1&quot;:null}
Exception in thread &quot;main&quot; java.lang.NullPointerException
ERROR   2018-03-06 15:19:05.418 [xxx] (): json to class is error! Test
com.alibaba.dubbo.common.json.ParseException: java.lang.InstantiationException: Test$C1
java.lang.InstantiationException: Test$C1
	at java.lang.Class.newInstance(Class.java:359)
	at com.alibaba.dubbo.common.json.J2oVisitor.objectBegin(J2oVisitor.java:119)
	at com.alibaba.dubbo.common.json.JSON.parse(JSON.java:745)
	at com.alibaba.dubbo.common.json.JSON.parse(JSON.java:227)
	at com.alibaba.dubbo.common.json.JSON.parse(JSON.java:210)
</code></pre>

<p>可以成功序列化，但是反序列化报错了：无法创建实例<code>Test$C1</code>，这是什么问题？为什么会有这个错误？接下来我们分析一下</p>

<h1 id="错误分析-java-lang-instantiationexception-test-c1">错误分析（java.lang.InstantiationException: Test$C1）</h1>

<p>通过使用fastjson和dubbo json的错误代码跟踪，找到了<code>J2oVisitor.objectBegin(J2oVisitor.java:119)</code>这个地方，代码如下：</p>

<pre><code>//下面是com.alibaba.dubbo.common.json.J2oVisitor的方法
public void objectBegin() throws ParseException
{
	mStack.push(mValue);
	mStack.push(mType);
	mStack.push(mWrapper);

	if( mType == Object.class || Map.class.isAssignableFrom(mType) )
	{
		if (! mType.isInterface() &amp;&amp; mType != Object.class) {
			try {
				mValue = mType.newInstance();
			} catch (Exception e) {
				throw new IllegalStateException(e.getMessage(), e);
			}
		} else if (mType == ConcurrentMap.class) {
			mValue = new ConcurrentHashMap&lt;String, Object&gt;();
		} else {
			mValue = new HashMap&lt;String, Object&gt;();
		}
		mWrapper = null;
	} else {
		try {
			mValue = mType.newInstance();
			mWrapper = Wrapper.getWrapper(mType);
		} catch(IllegalAccessException e){ 
			throw new ParseException(StringUtils.toString(e)); 
		} catch(InstantiationException e){ 
			throw new ParseException(StringUtils.toString(e)); 
		}
	}
}
//下面是Class的方法
public T newInstance()
        throws InstantiationException, IllegalAccessException
{
    if (System.getSecurityManager() != null) {
        checkMemberAccess(Member.PUBLIC, Reflection.getCallerClass(), false);
    }

    // NOTE: the following code may not be strictly correct under
    // the current Java memory model.

    // Constructor lookup
    if (cachedConstructor == null) {
        if (this == Class.class) {
            throw new IllegalAccessException(
                &quot;Can not call newInstance() on the Class for java.lang.Class&quot;
            );
        }
        try {
            Class&lt;?&gt;[] empty = {};
            final Constructor&lt;T&gt; c = getConstructor0(empty, Member.DECLARED);
            // Disable accessibility checks on the constructor
            // since we have to do the security check here anyway
            // (the stack depth is wrong for the Constructor's
            // security check to work)
            java.security.AccessController.doPrivileged(
                new java.security.PrivilegedAction&lt;Void&gt;() {
                    public Void run() {
                            c.setAccessible(true);
                            return null;
                        }
                    });
            cachedConstructor = c;
        } catch (NoSuchMethodException e) {
            throw new InstantiationException(getName());
        }
    }
    Constructor&lt;T&gt; tmpConstructor = cachedConstructor;
    // Security check (same as in java.lang.reflect.Constructor)
    int modifiers = tmpConstructor.getModifiers();
    if (!Reflection.quickCheckMemberAccess(this, modifiers)) {
        Class&lt;?&gt; caller = Reflection.getCallerClass();
        if (newInstanceCallerCache != caller) {
            Reflection.ensureMemberAccess(caller, this, null, modifiers);
            newInstanceCallerCache = caller;
        }
    }
    // Run constructor
    try {
        return tmpConstructor.newInstance((Object[])null);
    } catch (InvocationTargetException e) {
        Unsafe.getUnsafe().throwException(e.getTargetException());
        // Not reached
        return null;
    }
}
</code></pre>

<p>代码中使用的是<code>tmpConstructor.newInstance((Object[])null)</code>不带参数的构造器，查看我们的原类，我们的内部类也是无参数的构造器，那为什么无法实例化呢？</p>

<p>我们来看一下我们的java源代码中内部类生成的class字节码文件，通过反编译工具查看如下：</p>

<pre><code>public class Test$C1
{
  public String name;
  
  public Test$C1(Test paramTest) {}
  
  public String getName()
  {
    return this.name;
  }
  
  public void setName(String name)
  {
    this.name = name;
  }
}

</code></pre>

<p>我们是空构造器为什么生成的确是带参数的构造器而且参数<code>paramTest</code>的类型是<code>Test</code>，这是为什么呢？</p>

<p>我们来看一下JDK doc关于<code>Constructor.newInstance</code>它的解释</p>

<pre><code>Uses the constructor represented by this Constructor object to create and initialize a new instance of the constructor's declaring class, with the specified initialization parameters. Individual parameters are automatically unwrapped to match primitive formal parameters, and both primitive and reference parameters are subject to method invocation conversions as necessary. 
If the number of formal parameters required by the underlying constructor is 0, the supplied initargs array may be of length 0 or null. 

If the constructor's declaring class is an inner class in a non-static context, the first argument to the constructor needs to be the enclosing instance; see The Java Language Specification, section 15.9.3. 

If the required access and argument checks succeed and the instantiation will proceed, the constructor's declaring class is initialized if it has not already been initialized. 

If the constructor completes normally, returns the newly created and initialized instance.

</code></pre>

<p><span style="color:blue"><em>具体关注这句：If the constructor&rsquo;s declaring class is an inner class in a non-static context, the first argument to the constructor needs to be the enclosing instance; see The Java Language Specification, section 15.9.3</em></span></p>

<p>意思是说：如果构造函数的声明类是一个非静态（non-static）上下文中的内部类，则构造函数的第一个参数需要是封闭实例;参见Java语言规范，第15.9.3节。</p>

<p><a href="https://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html">15.9.3节</a>具体看：15.9.3. Choosing the Constructor and its Arguments的说明</p>

<p>到这里我们应该清楚内部类在没有修饰符<code>static</code>和有修饰符<code>static</code>的区别了吧，就是<code>non-static</code>的内部类在生成的时候构造器第一个参数是<code>parent</code>实例，用来共享<code>parent</code>的属性访问的，那让我们将内部类修改为<code>static</code>再做一次测试验证。</p>

<h1 id="验证">验证</h1>

<p>测试类：</p>

<pre><code>import java.io.Serializable;

public class Test implements Serializable {
	private static final long serialVersionUID = 2010307013874058143L;
	private String name;
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public C1 c1;
	public C1 getC1() {
		return c1;
	}
	public void setC1(C1 c1) {
		this.c1 = c1;
	}
	public static class C1 {
		public String name;
		public C1() {
		}
		public String getName() {
			return name;
		}
		public void setName(String name) {
			this.name = name;
		}
	}
}
</code></pre>

<p><span style="color:blue"><em>ps.内部类C1增加了static修饰符</em></span></p>

<p>调用序列化与反序列化:</p>

<pre><code>public static String toJson(Object obj) {
    try {
        return JSON.json(obj);
    } catch (IOException e) {
        log.error(&quot;class to json is error!&quot;, e);
    }
    return null;
}
public static &lt;T&gt; T formJson(String json, Class&lt;T&gt; classOfT) {
    try {
        return JSON.parse(json, classOfT);
    } catch (ParseException e) {
        log.error(&quot;json to class is error! &quot;+classOfT.getName(), e);
    }
    return null;
}
public static void main(String[] args) {
	Test test = new Test();
	System.out.println(toJson(test));
	String json = &quot;{\&quot;name\&quot;:\&quot;test\&quot;,\&quot;c1\&quot;:{\&quot;name\&quot;:\&quot;c1\&quot;}}&quot;;
	test = formJson(json, Test.class);
	System.out.println(test.getC1().getName());
}
</code></pre>

<p>输出：</p>

<pre><code>{&quot;c1&quot;:null,&quot;name&quot;:null,&quot;C1&quot;:null}
c1
</code></pre>

<p>结果可以正常的序列化了，以上测试使用的是<code>fastjson</code>与<code>dubbo json</code>进行测试。</p>

<h1 id="总结">总结</h1>

<p>按照规范内部类是不太推荐使用的，如果要用尽量使用<code>static</code>修饰符修饰内部类，这个问题其实就是<code>Java</code>的基本功，尽量一个<code>Java</code>文件中只保留一个类，这样在大多数序列化与反序列化工具中都不会出现问题，也比较符合当下模块化开发的规范，内部类改为<code>static</code>修饰符修饰还可以有效的避免内存泄漏，很多大厂的性能建议文档与<code>Java</code>开发规范文档都可以看到对内部类使用的注意事项，有空多看看大厂的经验总结。</p>

<p>使用<code>Google</code>的<code>gson</code>进行测试，<code>non-static</code>的内部类可以正常序列化，<code>Google</code>出的工具包就是强大兼容了各种使用方式，从<code>gson</code>的<code>api</code>还发现可以通过参数来<code>disable</code>或<code>enable</code>对<code>inner class</code>序列化的支持，具体查看如下代码：</p>

<p>测试类：</p>

<pre><code>import java.io.Serializable;

public class Test implements Serializable {
	private static final long serialVersionUID = 2010307013874058143L;
	private String name;
	public String getName() {
		return name;
	}
	public void setName(String name) {
		this.name = name;
	}
	public C1 c1;
	public C1 getC1() {
		return c1;
	}
	public void setC1(C1 c1) {
		this.c1 = c1;
	}
	public class C1 {
		public String name;
		public C1() {
		}
		public String getName() {
			return name;
		}
		public void setName(String name) {
			this.name = name;
		}
	}
}
</code></pre>

<p><span style="color:blue"><em>ps.注意我这里的内部类C1是non-static的</em></span></p>

<h2 id="gson开启内部类序列化">gson开启内部类序列化</h2>

<pre><code>public static void main(String[] args) {
	Gson gson = new GsonBuilder().serializeNulls().create();
	Test test = new Test();
	test.setName(&quot;序列化参数name&quot;);
	System.out.println(gson.toJson(test));
	String json = &quot;{\&quot;name\&quot;:\&quot;test\&quot;,\&quot;c1\&quot;:{\&quot;name\&quot;:\&quot;c1\&quot;}}&quot;;
	test = gson.fromJson(json, Test.class);
	System.out.println(test.getC1() == null ? &quot;null&quot; : test.getC1().getName());
}
</code></pre>

<p><span style="color:blue"><em>ps.默认InnerClassSerialization就是开启的</em></span></p>

<p>输出：</p>

<pre><code>{&quot;name&quot;:&quot;序列化参数name&quot;,&quot;c1&quot;:null}
c1
</code></pre>

<h2 id="gson禁用内部类序列化">gson禁用内部类序列化</h2>

<pre><code>public static void main(String[] args) {
	Gson gson = new GsonBuilder().serializeNulls().disableInnerClassSerialization().create();
	Test test = new Test();
	test.setName(&quot;序列化参数name&quot;);
	System.out.println(gson.toJson(test));
	String json = &quot;{\&quot;name\&quot;:\&quot;test\&quot;,\&quot;c1\&quot;:{\&quot;name\&quot;:\&quot;c1\&quot;}}&quot;;
	test = gson.fromJson(json, Test.class);
	System.out.println(test.getC1() == null ? &quot;null&quot; : test.getC1().getName());
}
</code></pre>

<p><span style="color:blue"><em>ps.调用GsonBuilder.disableInnerClassSerialization()禁用InnerClassSerialization</em></span></p>

<p>输出：</p>

<pre><code>{&quot;name&quot;:&quot;序列化参数name&quot;}
null
</code></pre>

<p>从而能看出<code>Google</code>出的工具包就是强大兼容各种使用方式，<code>Google</code>出的都是精品，从<code>guava</code>就可以看出。</p>

<p>好了到这里整个文章就介绍完了，最后还是一句老话：世界和平、Keep Real！</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/65-java-inner-class/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/64-rancher-agent-instance/">Trouble Shooting —— Docker rancher/agent-instance cannot start automatically</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-03-05T17:23:11.000&#43;00:00' itemprop="datePublished">2018-03-05</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/trouble-shooting">trouble shooting</a>

<a href="https://ningyu1.github.io/site/tags/docker">docker</a>

<a href="https://ningyu1.github.io/site/tags/rancher">rancher</a>

<a href="https://ningyu1.github.io/site/tags/rancher/agentv1.0.2">rancher/agent:v1.0.2</a>

<a href="https://ningyu1.github.io/site/tags/rancher/agent-instancev0.8.3">rancher/agent-instance:v0.8.3</a>


</div>
    </div>
        

<p>今天发现一个<code>docker</code>机器莫名其妙的无工作了，于是进入宿主机查看信息如下：</p>

<pre><code>docker@xxx:~$ docker ps
be4238200956        rancher/agent:v1.0.2                          &quot;/run.sh run&quot;            5 months ago        Up 34 minutes                                                              rancher-agent

</code></pre>

<p>发现只有一个<code>rancher/agent</code>容器是启动的，其余的都没有启动，查看<code>rancher</code>控制台，服务都在转圈圈<code>Restaring</code>状态，而且长时间一直这个状态没有变化。</p>

<p>这是什么问题呢？</p>

<p>查看机器上所有的容器</p>

<pre><code>docker@xxx:~$ docker ps -a
CONTAINER ID        IMAGE                                         COMMAND                  CREATED             STATUS                        PORTS               NAMES
d9da7f16ef2d        192.168.0.34:5000/saas-erp:latest             &quot;./entrypoint.sh&quot;        4 days ago          Exited (0) 50 minutes ago                         r-erp_erp-dubbo_1
79e8e475db19        192.168.0.34:5000/tms2job:latest              &quot;./entrypoint.sh&quot;        4 weeks ago         Exited (0) 50 minutes ago                         r-tms_tms2-job_1
0995dabe324b        192.168.0.34:5000/customer-mq:latest          &quot;catalina.sh run&quot;        8 weeks ago         Exited (143) 7 weeks ago                          r-customer_customer-mq_1
65492930b132        192.168.0.34:5000/saas-account:latest         &quot;./entrypoint.sh&quot;        9 weeks ago         Exited (0) 50 minutes ago                         r-account_account-dubbo_1
248514cd635a        192.168.0.34:5000/saas-erp-http-main:latest   &quot;./entrypoint.sh&quot;        4 months ago        Exited (0) 50 minutes ago                         r-erp_erp-http-main_1
94e51332cc40        192.168.0.34:5000/zookeeper:elevy             &quot;/entrypoint.sh zkSer&quot;   5 months ago        Exited (0) 50 minutes ago                         db61a2f2-9b47-4d97-97a3-b6e0764208ca
d72c359c2d5e        192.168.0.34:5000/mysql:5.6.30                &quot;docker-entrypoint.sh&quot;   5 months ago        Exited (0) 50 minutes ago                         c7638fa0-f263-45bd-85d7-2e3b7407ad2f
0c8d3edbc53d        rancher/agent-instance:v0.8.3                 &quot;/etc/init.d/agent-in&quot;   5 months ago        Exited (128) 50 minutes ago                       e505b911-a391-4d1c-8ef2-7bbb306df8eb
be4238200956        rancher/agent:v1.0.2                          &quot;/run.sh run&quot;            5 months ago        Up 11 minutes                                     rancher-agent
</code></pre>

<p>发现服务全都是<code>Exited</code>状态，<code>Rancher</code>控制台上<code>Network Agent</code>容器也是一直转圈圈<code>Restarting</code>状态。</p>

<p>因此断定应该是<code>Network Agent</code>服务没有启动导致的所有服务无法恢复自动启动。</p>

<p>那为什么会出现这个问题？这个问题是什么原因导致的呢？</p>

<p>在解决这个问题之前先看一下<code>Rancher</code>的网络+负载均衡 实现与说明</p>

<h1 id="rancher网络-负载均衡的实现与说明">Rancher网络+负载均衡的实现与说明</h1>

<p>依赖镜像：<code>rancher/agent-instance:v0.8.3</code></p>

<p><code>Rancher</code>网络是采用SDN技术所建容器为虚拟ip地址，各host之间容器采用ipsec隧道实现跨主机通信，使用的是udp的500和4500端口。</p>

<p>启动任务时，在各个host部署容器之前会起一个<code>Network  Agent</code>容器，负责组建网络环境。</p>

<p>网络全都靠<code>agent-instance</code>容器实现，网络没有准备好其余的容器当然也不会自动恢复。</p>

<p>那我们的这个问题就是<code>agent-instance</code>容器没有起来导致的，那让我们启动<code>agent-instance</code>容器。</p>

<pre><code>docker@xxx:~$ docker start 0c8d3edbc53d
Error response from daemon: rpc error: code = 2 desc = &quot;oci runtime error: exec format error&quot;
Error: failed to start containers: 0c8d3edbc53d
</code></pre>

<p>很遗憾提示错误无法启动，那让我们看一下日志中的错误是什么？</p>

<pre><code>docker@xxx:~$ docker logs --tail=200 -f 0c8d3edbc53d
.......省略其他的
INFO: Sending agent-instance-startup applied 3-0f669dbfe83bbb7389a0c2129247f633575904e41d665e311051de2ce1b85737
Starting monit daemon with http interface at [localhost:2812]
The system is going down NOW!
Sent SIGTERM to all processes
Sent SIGKILL to all processes
Requesting system reboot
INFO: Downloading agent http://192.168.0.34:8080/v1/configcontent/configscripts
</code></pre>

<p>发现<code>The system is going down NOW!</code>这个错误，什么情况？无法启动要求重启系统。</p>

<p>于是查看<code>rancher</code>官方相关这个问题的issues，也没看出个所以然来，跟我的系统版本和agent、agent-instance版本都一致也有很多人无法启动或者启动报错。</p>

<ul>
<li><a href="https://github.com/rancher/rancher/issues/5951">agent-instance cannot start automatically on Ubuntu 16.04.X #5951</a></li>
<li><a href="https://github.com/rancher/rancher/issues/4237">Rancher network agent stuck in restart loop - DNS lookup issue #4237</a></li>
</ul>

<p>最终无解尝试暴力做法，删除以前的agent-instance容器，然后重新创建重启</p>

<p>删除rancher/agent-instance:v0.8.3容器</p>

<pre><code>docker@xxx:~$ docker rm 0c8d3edbc53d
0c8d3edbc53d
</code></pre>

<p>查看有没有rancher/agent-instance:v0.8.3这个镜像</p>

<pre><code>docker@xxx:~$ docker images
REPOSITORY                             TAG                 IMAGE ID            CREATED             SIZE
192.168.0.34:5000/saas-erp             latest              0ad78488245a        4 days ago          275.4 MB
192.168.0.34:5000/tms2job              latest              caa888ff603f        4 weeks ago         236.8 MB
192.168.0.34:5000/customer-mq          latest              db319e29bd7f        8 weeks ago         431.8 MB
192.168.0.34:5000/saas-account         latest              004999746d2c        9 weeks ago         181.9 MB
192.168.0.34:5000/saas-erp-http-main   latest              9a5f8be5ef8d        4 months ago        200.8 MB
192.168.0.34:5000/messer               1.0                 74e9ec4742cc        7 months ago        184.8 MB
192.168.0.34:5000/tomcat               7                   830387a4274c        19 months ago       357.8 MB
rancher/agent-instance                 v0.8.3              b6b013f2aa85        20 months ago       331 MB
192.168.0.34:5000/rancher/agent        v1.0.2              860ed2b2e8e3        20 months ago       454.3 MB
rancher/agent                          v1.0.2              860ed2b2e8e3        20 months ago       454.3 MB
192.168.0.34:5000/mysql                5.6.30              2c0964ec182a        21 months ago       329 MB
192.168.0.34:5000/zookeeper            elevy               d2805d0326a9        2 years ago         131.8 MB
</code></pre>

<p>有镜像，根据镜像重新创建rancher/agent-instance:v0.8.3容器</p>

<pre><code>docker@xxx:~$ docker run -d b6b013f2aa85
0060edfa2594
</code></pre>

<p><span style="color:blue"><em>ps.-d, &ndash;detach                    Run container in background and print container ID，后台运行容器并且打印出容器ID</em></span></p>

<p>OK创建好了，再ps查看一下其余的容器是否都自动恢复了</p>

<pre><code>docker@xxx:~$ docker ps
CONTAINER ID        IMAGE                                         COMMAND                  CREATED             STATUS              PORTS                                                  NAMES
854fa1039e76        192.168.0.34:5000/zookeeper:elevy             &quot;/entrypoint.sh zkSer&quot;   33 minutes ago      Up 33 minutes       2888/tcp, 3888/tcp, 0.0.0.0:2181-&gt;2181/tcp, 9010/tcp   r-zookeeper_zookeeper-2_1
47c189dbd5c6        b6b013f2aa85                                  &quot;/etc/init.d/agent-in&quot;   37 minutes ago      Up 37 minutes                                                              drunk_tesla
0060edfa2594        rancher/agent-instance:v0.8.3                 &quot;/etc/init.d/agent-in&quot;   37 minutes ago      Up 37 minutes       0.0.0.0:500-&gt;500/udp, 0.0.0.0:4500-&gt;4500/udp           e505b911-a391-4d1c-8ef2-7bbb306df8eb
d9da7f16ef2d        192.168.0.34:5000/saas-erp:latest             &quot;./entrypoint.sh&quot;        4 days ago          Up 37 minutes       0.0.0.0:20833-&gt;20833/tcp                               r-erp_erp-dubbo_1
79e8e475db19        192.168.0.34:5000/tms2job:latest              &quot;./entrypoint.sh&quot;        4 weeks ago         Up 37 minutes       0.0.0.0:50831-&gt;50831/tcp                               r-tms_tms2-job_1
65492930b132        192.168.0.34:5000/saas-account:latest         &quot;./entrypoint.sh&quot;        9 weeks ago         Up 37 minutes       0.0.0.0:20834-&gt;20834/tcp                               r-account_account-dubbo_1
248514cd635a        192.168.0.34:5000/saas-erp-http-main:latest   &quot;./entrypoint.sh&quot;        4 months ago        Up 37 minutes       0.0.0.0:20902-&gt;20902/tcp                               r-erp_erp-http-main_1
d72c359c2d5e        192.168.0.34:5000/mysql:5.6.30                &quot;docker-entrypoint.sh&quot;   5 months ago        Up 37 minutes       0.0.0.0:3306-&gt;3306/tcp                                 c7638fa0-f263-45bd-85d7-2e3b7407ad2f
be4238200956        rancher/agent:v1.0.2                          &quot;/run.sh run&quot;            5 months ago        Up About an hour                                                           rancher-agent
</code></pre>

<p>很好全都恢复了，Status全都是Up。早知道删除重建就不需要这么麻烦去Issues中找答案，以后记住了只要Network  Agent容器（rancher/agent-instance:v0.8.3）出问题先尝试start，如果无法start就删除了重新创建容器。</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/64-rancher-agent-instance/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/63-python-virtualenv/">构建Python多个虚拟环境来进行不同版本开发之神器-virtualenv</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-03-02T11:22:28.000&#43;00:00' itemprop="datePublished">2018-03-02</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/virtualenv">virtualenv</a>

<a href="https://ningyu1.github.io/site/tags/virtualenvwrapper">virtualenvwrapper</a>

<a href="https://ningyu1.github.io/site/tags/python">python</a>


</div>
    </div>
        

<p>我们都知道<code>Python</code>的类库很多，但是大多支持的版本还是<code>Python2.x</code>系列，<code>Python3</code>支持的类库相对较少，因此我们在开发的时候经常还使用的<code>Python2</code>系列的版本，<code>Python3</code>对语法进行了比较大的重构，<code>Python3</code>中将一些<code>Python2</code>的模块名称做了修改，虽然兼容<code>Python2</code>但还是需要我们做一些处理来保证代码在不同<code>Python</code>版本中能够正常运作，如果我们想同时使用<code>Python2</code> 和 <code>Python3</code>，这个时候大家最常用的做法就是机器上配置多个版本，虽然可以解决问题但是配合多个项目的各种杂乱的包依赖情况，问题就变的非常复杂了，可能升级某一个第三方依赖库会对很多项目产生影响。</p>

<p>我们都知道在安装<code>Python</code>类库的时候它默认会安装到<code>Python</code>的目录下，有编程洁癖的人都会因此苦恼，因为它污染了<code>Python</code>的目录，并且在开发的时候不同的项目使用的类库差异也蛮大，为了使多个项目之间互相不影响，我们能不能根据项目来区分开<code>Python</code>环境目录？</p>

<p>当然可以，<code>virtualenv</code>就能帮助我们解决上面的苦恼，它是一个可以创建多个隔绝<code>Python</code>环境的工具，<code>virtualenv</code>可以创建一个包含所有必要的可执行的文件夹，用来使用<code>Python</code>工程所需要的包，同时还不污染<code>Python</code>的原安装目录。</p>

<p>这个工具简直就是给有开发洁癖的人送福音的。<scpan style="color:blue"><em>画外音：专业送快递</em></span></p>

<p>上面大致说了一下我们使用<code>virtualenv</code>的初衷，接下来让我们看一下<code>virtualenv</code>如何使用，在使用之前先正式的了解一下<code>virtualenv</code></p>

<h1 id="什么是virtualenv">什么是virtualenv?</h1>

<p><code>Virtualenv</code>是一个用来创建独立的<code>Python</code>环境的工具</p>

<h1 id="为什么我们需要一个独立的python环境">为什么我们需要一个独立的Python环境？</h1>

<p>引用<code>virtualenv</code>的文档</p>

<pre><code>virtualenv is a tool to create isolated Python environments.
The basic problem being addressed is one of dependencies and versions, and indirectly permissions. Imagine you have an application that needs version 1 of LibFoo, but another application requires version 2. How can you use both these applications? If you install everything into /usr/lib/python2.7/site-packages (or whatever your platform’s standard location is), it’s easy to end up in a situation where you unintentionally upgrade an application that shouldn’t be upgraded.
Or more generally, what if you want to install an application and leave it be? If an application works, any change in its libraries or the versions of those libraries can break the application.
Also, what if you can’t install packages into the global site-packages directory? For instance, on a shared host.
In all these cases, virtualenv can help you. It creates an environment that has its own installation directories, that doesn’t share libraries with other virtualenv environments (and optionally doesn’t access the globally installed libraries either).
</code></pre>

<p>上面这段话的意思大致是这样的，我们需要处理的基本问题是包的依赖、版本和间接权限问题。想象一下，你有两个应用，一个应用需要<code>libfoo</code>的版本1，而另一应用需要版本2。如何才能同时使用这些应用程序？如果您安装到的<code>/usr/lib/python2.7/site-packages</code>（或任何平台的标准位置）的一切，在这种情况下，您可能会不小心升级不应该升级的应用程序。或者更广泛地说，如果您想要安装一个应用程序并离开它呢?如果应用程序工作，其库中的任何更改或这些库的版本都可以破坏应用程序。另外，如果您不能将包安装到全局站点包目录中，该怎么办?例如，在共享主机上。在所有这些情况下，<code>virtualenv</code>可以帮助您。它创建了一个有自己的安装目录的环境，它不与其他<code>virtualenv</code>环境共享库(也不可能访问全局安装的库)。</p>

<p>简单地说，你可以为每个项目建立不同的/独立的Python环境，你将为每个项目安装所有需要的软件包到它们各自独立的环境中。</p>

<p>到这里我相信我们已经很清晰的知道了<code>virtualenv</code>是什么，能做什么，那接下来就让我们来用一用它。</p>

<h1 id="使用virtualenv">使用virtualenv</h1>

<h2 id="安装">安装</h2>

<pre><code>pip install virtualenv
</code></pre>

<p><scpan style="color:blue"><em>画外音：pip安装非常简单，简直就是傻瓜式的</em></span></p>

<h2 id="使用">使用</h2>

<p><code>virtualenv</code>安装完毕后，可以通过运行下面的命令来为你的项目创建独立的<code>Python</code>环境：</p>

<pre><code>mkdir my_project_dir
cd my_project_dir
virtualenv --distribute my_venv
# my_venv为虚拟环境目录名，目录名自定义
</code></pre>

<p>OK，执行成功，上面发生了什么？</p>

<p>它会在<code>my_project_dir</code>目录中创建一个文件夹（my_venv），包含了<code>Python</code>可执行文件，以及 <code>pip</code> 库的一份拷贝，这样就能安装其他包了。虚拟环境的名字（my_venv）可以是任意的；不写名字会使用当前目录创建。</p>

<p>我们再来看看输出：</p>

<pre><code>1 New python executable in my_venv/bin/python2.7
2 Also creating executable in my_venv/bin/python
3 Installing Setuptools......done.
4 Installing Pip...........done.
</code></pre>

<p><code>--distribute</code> 选项使<code>virtualenv</code>使用新的基于发行版的包管理系统而不是 <code>setuptools</code> 获得的包。 你现在需要知道的就是 <code>--distribute</code> 选项会自动在新的虚拟环境中安装 <code>pip</code> ，这样就不需要手动安装了。 当你成为一个更有经验的<code>Python</code>开发者，你就会明白其中细节。</p>

<p>当然还有很多参数配置，例如：-p参数指定Python解释器程序路径，这里就过多介绍了，通过help去查看。</p>

<p>到这里这个虚拟环境就创建好了，但是要真正使用还需要激活，通过如下命令激活。</p>

<pre><code>my_project_dir\my_venv\Scripts\activate
</code></pre>

<p>激活后输出如下：</p>

<pre><code># window下
(my_venv) yourpath\venv\Scripts&gt;

# linux下
(my_venv)[root@docker-x my_venv]#
</code></pre>

<p>从现在起，任何你使用pip安装的包将会放在 my_venv文件夹中，与全局安装的<code>Python</code>隔绝开，是不是很赞，想怎么装怎么装。</p>

<p>就像平常一样安装包，例如：</p>

<pre><code>pip install flask
</code></pre>

<p>上面启用激活，有激活那就有停用，如果你在当前虚拟环境中暂时完成了工作，可以使用如下命令停用它：</p>

<pre><code>my_project_dir\my_venv\Scripts\deactivate
</code></pre>

<p>这将会回到系统默认的<code>Python</code>解释器，包括已安装的库也会回到默认的。要删除一个虚拟环境，只需删除它的文件夹。（执行 <code>rm -rf venv</code> ）。</p>

<h2 id="思考">思考</h2>

<p>让我们看看激活与停用<code>virtualenv</code>，调用python/pip命令有什么不一样。先停用<code>virtualenv</code>，如下：</p>

<pre><code>[root@docker-x ~]# which python
/usr/bin/python
[root@docker-x ~]# which pip
/usr/local/bin/pip
</code></pre>

<p>让我们激活<code>virtualenv</code>后，再来一次！看看有什么不同。如下：</p>

<pre><code>[root@docker-x ~]# which python
/usr/local/my_venv/bin/python

[root@docker-x ~]# which pip
/usr/local/my_venv/bin/pip
</code></pre>

<p><code>virtualenv</code>拷贝了<code>Python</code>可执行文件的副本，并创建一些有用的脚本和安装了项目需要的软件包，你可以在项目的整个生命周期中安装/升级/删除这些包。 它也修改了一些搜索路径，例如<code>PYTHONPATH</code>，以确保：</p>

<ol>
<li>当安装包时，它们被安装在当前活动的<code>virtualenv</code>里，而不是系统范围内的<code>Python</code>路径。</li>
<li>当import代码时，<code>virtualenv</code>将优先采取本环境中安装的包，而不是系统<code>Python</code>目录中安装的包。</li>
</ol>

<p>还有一点比较重要，在默认情况下，所有安装在系统范围内的包对于<code>virtualenv</code>是可见的。这意味着如果你将<code>simplejson</code>安装在您的系统<code>Python</code>目录中，它会自动提供给所有的<code>virtualenvs</code>使用。这种行为可以被更改，在创建<code>virtualenv</code>时增加 <code>--no-site-packages</code> 选项,<code>virtualenv</code>就不会读取系统包，如下：</p>

<pre><code>virtualenv my_venv --no-site-packages
</code></pre>

<h1 id="virtualenvwrapper">virtualenvwrapper</h1>

<p>有的时候<code>virtualenv</code>也会带来一些问题，由于<code>virtualenv</code>的启动、停止脚本都在特定文件夹，可能一段时间后，你可能会有很多个虚拟环境散落在系统各处，你可能忘记它们的名字甚至忘记它的位置。怎么来管理<code>virtualenv</code>?</p>

<p>鉴于<code>virtualenv</code>不便于对虚拟环境集中管理，所以推荐直接使用<code>virtualenvwrapper</code>。</p>

<p><code>virtualenvwrapper</code>提供了一系列命令使得和虚拟环境工作变得便利。它把你所有的虚拟环境都放在一个地方。</p>

<h2 id="安装-1">安装</h2>

<pre><code>pip install virtualenvwrapper
pip install virtualenvwrapper-win　　#Windows使用该命令
</code></pre>

<p><span style="color:blue">
<em>注意：安装virtualenvwrapper之前首先确保virtualenv已安装</em>
</span></p>

<p>安装完成后，在~/.bashrc写入以下内容</p>

<pre><code>export WORKON_HOME=~/Envs
source /usr/local/bin/virtualenvwrapper.sh

#读入配置文件，立即生效
source ~/.bashrc
</code></pre>

<p><span style="color:blue">
<em>说明：第一行：virtualenvwrapper存放虚拟环境目录，第二行：virtrualenvwrapper会安装到python的bin目录下，所以该路径是python安装目录下bin/virtualenvwrapper.sh</em></p>

<h2 id="使用-1">使用</h2>

<p>使用如下命令创建虚拟环境:</p>

<pre><code>mkvirtualenv my_venv_py3
</code></pre>

<p>这样会在<code>WORKON_HOME</code>变量指定的目录下新建名为 my_venv_py3 的虚拟环境。</p>

<p>若想指定<code>Python</code>版本，可通过<code>--python</code>指定<code>Python</code>解释器</p>

<pre><code>mkvirtualenv --python=/usr/local/python3.5.3/bin/python my_venv_py3
</code></pre>

<p>查看当前的虚拟环境目录</p>

<pre><code>[root@docker-x ~]# workon
my_venv_py2
my_venv_py3
</code></pre>

<p>切换到虚拟环境</p>

<pre><code>[root@docker-x ~]# workon my_venv_py3
(my_venv_py3) [root@docker-x ~]# 
</code></pre>

<p>退出虚拟环境</p>

<pre><code>(my_venv_py3) [root@docker-x ~]# deactivate
[root@docker-x ~]# 
</code></pre>

<p>删除虚拟环境</p>

<pre><code>rmvirtualenv my_venv_py3
</code></pre>

<p>到这里 <code>virtualenvs</code> 和 <code>virtualenvwrapper</code> 就讲完了，是不是 so easy！跟着步骤来，一切都是顺理成章的。而且功能也很强大，使<code>Python</code>的开发环境配置起来变得非常简单。尤其是扩展工具<code>virtualenvwrapper</code> 使得构建出来的虚拟环境可以更好的管理起来。感谢这个世界，世界和平，Keep Real！</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/63-python-virtualenv/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/62-ant-path-matcher/">RESTful访问权限管理实现思路，采用路径匹配神器之AntPathMatcher</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-02-27T16:15:49.000&#43;00:00' itemprop="datePublished">2018-02-27</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/antpathmatcher">antPathMatcher</a>

<a href="https://ningyu1.github.io/site/tags/restful">restful</a>


</div>
    </div>
        

<p>我们经常在写程序时需要对路径进行匹配，比如说：资源的拦截与加载、<code>RESTful</code>访问控制、审计日志采集、等，伟大的<code>SpringMVC</code>在匹配<code>Controller</code>路径时是如何实现的？全都归功于ant匹配规则。</p>

<p><code>Spring</code>源码之<code>AntPathMatcher</code>，这个工具类匹配很强大，采用的是ant匹配规则。</p>

<p>什么是ant匹配规则？</p>

<table>
<thead>
<tr>
<th align="left">字符wildcard</th>
<th align="left">描述</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">?</td>
<td align="left">匹配一个字符（matches one character）</td>
</tr>

<tr>
<td align="left">*</td>
<td align="left">匹配0个及以上字符（matches zero or more characters ）</td>
</tr>

<tr>
<td align="left">**</td>
<td align="left">匹配0个及以上目录directories（matches zero or more &lsquo;directories&rsquo; in a path ）</td>
</tr>
</tbody>
</table>

<p>这个匹配规则很简单，采用简洁明了的方式来进行匹配解析，简化版本的正则。</p>

<p>结合官方的示例来理解一下</p>

<table>
<thead>
<tr>
<th align="left">Pattern</th>
<th align="left">匹配说明</th>
</tr>
</thead>

<tbody>
<tr>
<td align="left">com/t?st.jsp</td>
<td align="left">匹配: com/test.jsp  ,  com/tast.jsp  ,  com/txst.jsp</td>
</tr>

<tr>
<td align="left">com/*.jsp</td>
<td align="left">匹配: com文件夹下的全部.jsp文件</td>
</tr>

<tr>
<td align="left">com/**/test.jsp</td>
<td align="left">匹配: com文件夹和子文件夹下的全部.jsp文件</td>
</tr>

<tr>
<td align="left">org/springframework/*<em>/</em>.jsp</td>
<td align="left">匹配: org/springframework文件夹和子文件夹下的全部.jsp文件</td>
</tr>

<tr>
<td align="left">org/**/servlet/bla.jsp</td>
<td align="left">匹配: org/springframework/servlet/bla.jsp  , org/springframework/testing/servlet/bla.jsp  ,  org/servlet/bla.jsp</td>
</tr>
</tbody>
</table>

<h2 id="如何实现restful访问权限管理">如何实现RESTful访问权限管理？</h2>

<p>在微服务和前后端分离的开发模式下，往往会使用<code>RESTful</code>来开发后端服务，那服务的访问权限控制就是一个问题，那下来我们就说一下如何实现<code>RESTful</code>访问权限管理。</p>

<h2 id="权限资源类型">权限资源类型</h2>

<p>资源分为如下两种类型：</p>

<ul>
<li><code>public</code>（公有）：<code>public</code>为不控制访问的资源</li>
<li><code>private</code>（私有）：<code>private</code>为需要被控制访问的资源</li>
</ul>

<p><span style="color:blue"><em>ps.这种方式资源管理的相对严格一些，如果想管理的粗矿一些，可以不需要public，只要在private中未找到的资源就是不控制访问的资源即可，实现时可以根据自己的业务场景来调整。</em></span></p>

<h2 id="匹配原则">匹配原则</h2>

<p>基础匹配规则：使用ant匹配规则</p>

<p>在<code>SpringMVC</code>的路径匹配原则中有一个原则是：最长匹配原则(has more characters)</p>

<p>什么是最长匹配原则(has more characters)？</p>

<p>最长匹配原则(has more characters)简单的理解就是目标<code>URL</code>有多个<code>pattern</code>都可以匹配上就取最长的那个<code>pattern</code></p>

<p>例如：请求的<code>URL</code>为<code>/app/dir/file.jsp</code>，有两个<code>pattern</code> <code>/**/*.jsp</code>和<code>/app/dir/*.jsp</code>都可以匹配成功，那么会根据<code>pattern</code>的长度来控制是否采用哪一个，这里使用<code>/app/dir/*.jsp</code>来匹配。</p>

<p>为什么要使用最长匹配原则？我的理解是长的<code>pattern</code>更符合目标<code>URL</code>格式，短的<code>pattern</code>往往是范围较广的，匹配取最适合的<code>pattern</code>也是比较符合预期的。</p>

<h2 id="根据服务名分类">根据服务名分类</h2>

<p>在做资源访问权限时往往会有多个服务可能会出现相同的资源路径，因此增加一级服务名来对资源进行分类。</p>

<p>例如：<code>GET /v1/service1/product/1</code> 和 <code>GET /v1/service2/product/1</code>，根据二级目录<code>service</code>名称来对服务进行模块化分割。<code>/v1</code>为RESTful版本号</p>

<p><span style="color:blue"><em>ps.服务名就是为了做资源分类</em></span></p>

<h2 id="权限验证逻辑">权限验证逻辑</h2>

<ul>
<li>验证<code>public</code>资源

<ul>
<li>去除末尾<code>&quot;/&quot;</code></li>
<li>验证<code>service</code>服务名，服务名为空返回没有权限</li>
<li>获取服务名下<code>enabled=true</code>的资源表，结果进行<code>cache</code>，结果为空没有权限</li>
<li>根据<code>pattern</code>长度倒序</li>
<li>匹配<code>method</code>，匹配成功进行下一步匹配</li>
<li>匹配请求的<code>url</code>，匹配成功返回有权限，反之返回没有权限</li>
</ul></li>
<li>验证<code>private</code>资源

<ul>
<li>去除末尾<code>&quot;/&quot;</code></li>
<li>验证<code>service</code>服务名，服务名为空返回没有权限</li>
<li>获取服务名下用户角色对应的资源列表聚合结果，结果进行<code>cache</code>，结果为空返回没有权限</li>
<li>根据<code>pattern</code>长度倒序</li>
<li>匹配<code>method</code>，匹配成功进行下一步匹配，反之<code>continue</code></li>
<li>匹配请求的<code>url</code>，匹配成功进行下一步匹配，反之<code>continue</code></li>
<li>检查匹配成功的<code>url</code>是否为禁用状态，如果禁用返回无权限，反之进行下一步匹配</li>
<li>匹配成功的<code>url</code>对应的角色列表进行登录用户的角色匹配</li>
<li>角色匹配成功返回有权限，反之返回没有权限</li>
</ul></li>
</ul>

<p><span style="color:blue"><em>ps.method是<code>GET</code>、<code>POST</code>、<code>PUT</code>、<code>PATCH</code>、<code>DELETE</code>，<code>service</code>是服务模块名</em></span></p>

<h2 id="缓存结构">缓存结构</h2>

<ul>
<li>private资源数据

<ul>
<li>结构：<code>hash</code></li>
<li><code>cache key=${APPNAME}.METADATA.RESOURCE</code>，<code>field=${RESOURCE_ID}</code>，<code>value=Resource</code>对象</li>
</ul></li>
<li>public资源数据

<ul>
<li>结构：<code>hash</code></li>
<li><code>cache key=${APPNAME}.METADATA.RESOURCE.PUBLIC</code>，<code>field=${SERVICE}</code>，<code>value=List&lt;Resource&gt;</code></li>
</ul></li>
<li>用户关联角色数据

<ul>
<li>结构：<code>hash</code></li>
<li><code>cache key=${APPNAME}.METADATA.ROLE</code>，<code>field=${USER_ID}</code>，<code>value=List&lt;ROLE_ID&gt;</code></li>
</ul></li>
<li>角色关联的资源数据

<ul>
<li>结构：<code>hash</code></li>
<li><code>cache key=${APPNAME}.METADATA.MAPPING</code>，<code>field=${SERVICE}</code>，<code>value=List&lt;Metadata&lt;Resource,List&lt;ROLE_ID&gt;&gt;&gt;</code></li>
<li>这里存储的数据结构是反向的，获取服务下的资源列表，每个资源数据中会有拥有这个资源的角色列表。</li>
</ul></li>
</ul>

<p><span style="color:blue"><em>ps.缓存可以使用分布式的<code>redis</code>、<code>redisson</code>、如果单机可以使用<code>jvm cache</code>。</em></span></p>

<h2 id="缓存控制">缓存控制</h2>

<ul>
<li>private资源数据发生变更时

<ul>
<li>调用<code>MetadataCache.invalidResources()</code>，失效<code>cache key=${APPNAME}.METADATA.RESOURCE</code>下所有数据</li>
</ul></li>
<li>public资源数据发生变更时

<ul>
<li>调用<code>MetadataCache.invalidPublicResource(service)</code>失效服务名下的<code>public</code>资源集合，失效<code>cache key=${APPNAME}.METADATA.RESOURCE.PUBLIC</code>下的某个<code>${SERVICE}</code>数据</li>
<li>调用<code>MetadataCache.invalidPublicResource()</code>失效所有服务名下的<code>public</code>资源集合，失效<code>cache key=${APPNAME}.METADATA.RESOURCE.PUBLIC</code>下所有数据</li>
</ul></li>
<li>用户关联角色数据发生变更时

<ul>
<li>调用<code>MetadataCache.invalidUserRoles(userId)</code>失效用户下的角色集合，失效<code>cache key=${APPNAME}.METADATA.ROLE</code>下所有数据</li>
</ul></li>
<li>角色关联的资源数据发生变更时

<ul>
<li>调用<code>MetadataCache.invalidMetadata(service)</code>失效服务名下的资源角色聚合对象，失效<code>cache key=${APPNAME}.METADATA.MAPPING</code>下的某个<code>${SERVICE}</code>数据</li>
<li>调用<code>MetadataCache.invalidMetadata()</code>失效所有服务名下的资源角色聚合对象，失效<code>cache key=${APPNAME}.METADATA.MAPPING</code>下所有数据</li>
</ul></li>
</ul>

<p><span style="color:blue"><em>ps.在以上触发点上对缓存数据进行更新，这里采用失效再加载方式</em></span></p>

<h2 id="缓存加载">缓存加载</h2>

<ul>
<li><code>private</code>资源数据，在系统启动加载，加载所有私有资源，如果失效了，会在<code>private</code>匹配的时再进行加载</li>
<li><code>public</code>资源数据，在<code>public</code>匹配时加载，通过服务名加载，如果失效了，会在<code>public</code>匹配时再进行加载</li>
<li>用户关联角色数据，在<code>private</code>匹配时加载，如果失效了，会在<code>private</code>匹配时再进行加载</li>
<li>角色关联的资源数据，在<code>private</code>匹配时加载，如果失效了，会在<code>private</code>匹配时再进行加载</li>
</ul>

<p><span style="color:blue"><em>ps.资源数据加载触发点</em></span></p>

<h2 id="pattern配置建议">pattern配置建议</h2>

<ul>
<li>配置资源时，将不需要配置权限的url配置为<code>public</code>资源</li>
<li>每个服务名下建议配置一个<code>**</code>（双星）通配符给超级管理员使用，例如：<code>/v1/products/**</code></li>
<li>每个<code>url</code>的第二级目录要与服务名一致，例如：<code>/v1/products/{pid}</code>，服务名为<code>products</code></li>
<li><code>url</code>的目录结构必须大于两级目录，例如：<code>/v1/products/{pid}</code>，不允许为：<code>/v1/{pid}</code></li>
<li><code>url</code>与权限通配符映射关系，前面<code>url</code>，后面<code>pattern</code>

<ul>
<li>例如：<code>/v1/products/{pid}</code> -&gt; <code>/v1/products/*</code></li>
<li>例如：<code>/v1/products/{pid}/skus/{sid}</code> -&gt; <code>/v1/products/*/skus/*</code></li>
<li>例如：<code>/v1/products/enabled</code> -&gt; <code>/v1/products/enabled</code></li>
<li>例如：<code>/v1/products/**</code>，匹配<code>products</code>目录下所有目录</li>
</ul></li>
</ul>

<p><strong>以上就是一种RESTful资源管理的实现思路，能控制到RESTful的方法级别，在前后端分离的项目可以使用这种方式来控制访问权限。</strong></p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/62-ant-path-matcher/#disqus_thread">Comments</a></span>
    
    
</div>
</article>

  <article class="post">
    <h2 class="title"> 
        <a href="https://ningyu1.github.io/site/post/61-disconf-ext/">扩展Disconf支持Global共享配置，简化业务应用参数配置</a>
    </h2>
    <div class="entry-content">
    <div class="meta">
        <div class="date">Published on: <time datetime='2018-02-11T11:26:49.000&#43;00:00' itemprop="datePublished">2018-02-11</time>
</div>
        <div class="tags">Tags: 

<a href="https://ningyu1.github.io/site/tags/disconf">disconf</a>

<a href="https://ningyu1.github.io/site/tags/ucm">ucm</a>


</div>
    </div>
        

<p>当我们使用统一配置中心（<code>UCM</code>）后或许都会出现这种烦恼，项目中的配置项目多，当项目引用到基础中间件时都要增加基础中间件的配置，例如：zk参数、redis参数、rpc参数、loadbalance参数、mq参数、等。这些配置都是基础的中间件配置，应该做成共享的方式让所有APP都共享，而并不是在用的时候再去APP中添加，Global的配置基础中间件团队维护即可。</p>

<h3 id="为什么要有公共共享的配置">为什么要有公共共享的配置？</h3>

<p>因为在APP配置中有很多是公共的配置，如果没有Global就需要在自己的APP中配置这些配置信息，导致APP中配置信息过多不好维护，公共的配置信息修改需要通知各业务APP修改自己APP中的配置，没有达到一处修改，各处使用的目标。</p>

<h3 id="这时候有朋友就会问我了如果做成全局共享配置-那不同项目需要修改全局某个参数怎么办呢">这时候有朋友就会问我了如果做成全局共享配置，那不同项目需要修改全局某个参数怎么办呢？</h3>

<p>这个需求也很正常，比如loadbalance参数确实需要根据不同项目的具体情况去配置参数，对于这种问题其实很好解决，我们可以使用APP中的配置去覆盖Global配置，也就是说当APP中的配置项与Global配置项相同的情况下，以APP的配置为主即可。</p>

<p>这样一来APP的配置生效的优先级为：Local conf &gt; Project conf &gt; Global conf，当出现相同配置项以APP自身的配置为主去覆盖。</p>

<p>增加了Global的支持后，APP中的配置减少了，避免了一些由于配置导致的错误，也可以通过Global的方式去规范APP的配置，让业务开发不关心公共配置的细节，在使用的时候直接使用无需维护。</p>

<p><code>Disconf</code>作为一个比较老牌的<code>UCM</code>在这方面支持的并不好，它并没有共享配置这个概念，这样一来公共的配置就需要在每个APP中都要配置一份，操作起来很烦人。</p>

<h1 id="那我们如何来解决这个问题-我们能否扩展-disconf-让其支持-global-共享配置呢">那我们如何来解决这个问题？我们能否扩展<code>Disconf</code>让其支持<code>Global</code>共享配置呢？</h1>

<h2 id="扩展思路">扩展思路</h2>

<p>在加载properties的时候，也就是ReloadablePropertiesFactoryBean的locations，给前面默认加一个GlobalProp项目的索引项：global（使用disconf的新建配置项，而不是配置文件），这个索引项的值是所有global配置文件的名称，使用&rdquo;,&ldquo;分隔，例如：</p>

<pre><code>global-dubbo.properties,global-redis.properties,global-zookeeper.properties,global-sso.properties,global-mq.properties,global-fastdfs.properties,global-elasticsearch.properties 
</code></pre>

<p>让disconf下载配置文件的时候优先下载global的配置文件，在properties加载的时候优先加载global的配置，这样当发生重复项时后加载的会覆盖前面的信息，从而达到了我们上面的需求，当APP中修改了某个global配置应该以APP的配置项为主。</p>

<p>接下来就让我们看一下具体扩展了哪些类？</p>

<p>Disconf的扩展点做的不是那么的好，因此扩展起来有些麻烦，我使用的是比较暴力的方式，直接使用原包的类在名称后加Ext然后修改代码，使用的时候使用Ext的类替代即可，这种方式的弊端是升级<code>Disconf</code>的时候很麻烦。</p>

<h2 id="disconf扫描管理">Disconf扫描管理</h2>

<pre><code>com.baidu.disconf.client.DisconfMgrBean
扩展一个
com.baidu.disconf.client.DisconfMgrBeanExt

com.baidu.disconf.client.DisconfMgrBeanSecond
扩展一个
com.baidu.disconf.client.DisconfMgrBeanSecondExt
</code></pre>

<h2 id="reloadable-properties">Reloadable Properties</h2>

<pre><code>com.baidu.disconf.client.addons.properties.ReloadablePropertiesFactoryBean
扩展一个
com.baidu.disconf.client.addons.properties.ReloadablePropertiesFactoryBeanExt
</code></pre>

<p>可以增加一个开关从而支持启用global的自由度，默认是开启的。</p>

<p>下面来看一下扩展后的具体使用方法如下</p>

<h2 id="项目地址">项目地址</h2>

<p><a href="https://github.com/ningyu1/disconf-client-ext">disconf-client-ext</a></p>

<p><a href="https://github.com/ningyu1/disconf-client-ext/releases"><img src="https://img.shields.io/github/release/ningyu1/disconf-client-ext.svg?style=social&amp;label=Release"></a>&nbsp;<a href="https://github.com/ningyu1/disconf-client-ext/stargazers"><img src="https://img.shields.io/github/stars/ningyu1/disconf-client-ext.svg?style=social&amp;label=Star"></a>&nbsp;<a href="https://github.com/ningyu1/disconf-client-ext/fork"><img src="https://img.shields.io/github/forks/ningyu1/disconf-client-ext.svg?style=social&amp;label=Fork"></a>&nbsp;<a href="https://github.com/ningyu1/disconf-client-ext/watchers"><img src="https://img.shields.io/github/watchers/ningyu1/disconf-client-ext.svg?style=social&amp;label=Watch"></a> <a href="http://www.gnu.org/licenses/gpl-3.0.html"><img src="https://img.shields.io/badge/license-GPLv3-blue.svg"></a></p>

<h2 id="disconf-client-ext的使用">disconf-client-ext的使用</h2>

<ul>
<li>依赖disconf版本：2.6.32</li>
<li>pom中引入disconf-client-ext依赖</li>
<li>修改disconf配置

<ul>
<li>替换<code>com.baidu.disconf.client.DisconfMgrBean</code> &ndash;&gt; <code>com.baidu.disconf.client.DisconfMgrBeanExt</code></li>
<li>替换<code>com.baidu.disconf.client.DisconfMgrBeanSecond</code> &ndash;&gt; <code>com.baidu.disconf.client.DisconfMgrBeanSecondExt</code></li>
<li>替换<code>com.baidu.disconf.client.addons.properties.ReloadablePropertiesFactoryBean</code> &ndash;&gt; <code>com.baidu.disconf.client.addons.properties.ReloadablePropertiesFactoryBeanExt</code></li>
<li>修改locations中配置文件，只保留项目自己的配置文件，例如</li>
</ul></li>
</ul>

<pre><code>&lt;bean id=&quot;disconfNotReloadablePropertiesFactoryBean&quot; class=&quot;com.baidu.disconf.client.addons.properties.ReloadablePropertiesFactoryBeanExt&quot;&gt;
	&lt;property name=&quot;locations&quot;&gt;
		&lt;list&gt;
			&lt;value&gt;classpath:/jdbc.properties&lt;/value&gt;
		&lt;/list&gt;
	&lt;/property&gt;
&lt;/bean&gt;
</code></pre>

<ul>
<li><span style="color:red">关闭global共享配置（默认是开启的）</span></li>
</ul>

<pre><code>&lt;bean id=&quot;disconfNotReloadablePropertiesFactoryBean&quot; class=&quot;com.baidu.disconf.client.addons.properties.ReloadablePropertiesFactoryBeanExt&quot;&gt;
	&lt;property name=&quot;locations&quot;&gt;
		&lt;list&gt;
			&lt;value&gt;classpath:/jdbc.properties&lt;/value&gt;
		&lt;/list&gt;
	&lt;/property&gt;
	&lt;property name=&quot;globalShareEnable&quot; value=&quot;false&quot; /&gt;
&lt;/bean&gt;
</code></pre>

<ul>
<li>最后一步添加global项目到<code>Disconf</code></li>
</ul>

<p><img src="https://ningyu1.github.io/site/img/disconf-ext/1.png" alt="" /></p>

<p>世界和平，Keep Real!</p>

    </div>

<div class="meta">
    
    
    <span class="comments"><a href="https://ningyu1.github.io/site/post/61-disconf-ext/#disqus_thread">Comments</a></span>
    
    
</div>
</article>



  <nav id="pagenavi">
    
        <a href="https://ningyu1.github.io/site/page/4/" class="prev">Prev</a>
    
    
        <a href="https://ningyu1.github.io/site/page/6/" class="next">Next</a>
    
    <div class="center"><a href="https://ningyu1.github.io/site/archives/index.html">Blog Archives</a></div>
  </nav>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2024
    
    凝雨-Yun
    . Powered by <a href="http://gohugo.io" target="_blank">Hugo</a> |
    Theme is <a href="https://github.com/wd/hugo-fabric">hugo-fabric</a>
</div>

    </footer>
    <script src="https://ningyu1.github.io/site/js/fabric.js"></script>


</div>
</div>
<script src="https://ningyu1.github.io/site/js/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
 
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery);
 
</script>
</body>
</html>
